(function(e){var t={id:"1c215cb2b26f2cbeb305c7cbcf472a99",filename:"drag.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=window,o=s.document,u=i(s),a=i(o);var f={not_lock:false,lock_x:false,lock_y:false,min_x:0,max_x:1e5,min_y:0,max_y:1e5,container:null,move:i.noop,drag_start:i.noop,drag_end:i.noop};var l=function(e,t){var n=(e[0]||{}).nodeName;var r;if(n){r="body html".indexOf(n.toLowerCase())>-1?{top:0,left:0}:e.offset()}else{r={top:0,left:0}}var i=e.width();var s=e.height();return{min_x:Math.max(r.left,t.min_x),max_x:Math.min(r.left+i,t.max_x),min_y:Math.max(r.top,t.min_y),max_y:Math.min(r.top+s,t.max_y)}};var c=0;var h=function(e,t){this._dom=e;this._opts=t;this._id="drag_"+c++};h.prototype.dom=function(){return this._dom};h.prototype.init=function(){var e=this,t=this._id;e.enable()};h.prototype._dragStart=function(e){if(e.button&&e.button===2){return}var t=this;if(!t._enabled){return}i("body").addClass("unselect");e.preventDefault&&e.preventDefault();var n=0;var r=t._dom,o=t._id,f=r.width(),c=r.height();var h=e.pageX,p=e.pageY,d=r.offset();start_pos=r.position();var v=h-d.left,m=p-d.top;var g=a;var y=u.height(),b=u.width();var w=null;if(t._opts.container){w=t._opts.container}else{w=i("body")}var E;if(!t._opts.not_lock){E=l(w,t._opts)}r.bind("mouseup."+"id",function(){n=1});i(s).bind("blur."+o,i.proxy(t._dragEnd,t));g.bind("mousemove."+o,function(e){if(n===1){return}var i=e.pageX,s=e.pageY;var o=i-h,u=s-p;if(!t._started){var a=r.css("position");if(a!=="absolute"){r.data("position",a);r.css("position","absolute")}t._started=true;t._opts.drag_start(t,start_pos)}var l={left:start_pos.left+o,top:start_pos.top+u};if(!t._opts.not_lock){if(l.left<E.min_x){l.left=E.min_x}if(l.left+f>E.max_x){l.left=E.max_x-f}if(l.top<E.min_y){l.top=E.min_y}if(l.top+c>E.max_y){l.top=E.max_y-c}if(t._opts.lock_x){delete l.left}if(t._opts.lock_y){delete l.top}}r.css(l);t._opts.move(t,l,start_pos,o,u)});g.bind("mouseup."+o,function(e){t._dragEnd(e)})};h.prototype._dragEnd=function(e){var t=this;var n=t._id;var r=e.pageX,s=e.pageY;i("body").removeClass("unselect");if(!t._started){return}t._started=false;a.unbind("mousemove."+n);a.unbind("mouseup."+n);u.unbind("blur."+n);a.unbind("losecapture");t.enable();t._opts.drag_end(t,{x:r,y:s})};h.prototype.enable=function(){if(!this._enabled){this._enabled=true;this._dom.bind("mousedown."+this._id,i.proxy(this._dragStart,this))}};h.prototype.disable=function(){this._enabled=false;var e=this._id;this._dom.unbind("mousedown."+e)};h.prototype.undragable=function(){var e=this;e.disable();for(var t in e){delete e[t]}};h.prototype.setOptions=function(e,t){if(i.type(e)==="object"){for(var n in e){if(e.hasOwnProperty(n)){this._opts[n]=e[n]}}}else if(i.type(e)==="string"&&i.type(t)!=="undefined"){this._opts[e]=t}};h.prototype.dragStart=h.prototype._dragStart;h.prototype.dragEnd=h.prototype._dragEnd;var p="__drag__";i.fn.dragable=function(e){var e=e||{};var t=i.extend({},f,e);this.each(function(e,n){var r=i(n);var s=new h(r,t);r.data(p,s);s.init()});return this};i.fn.undragable=function(){var e=this.data(p);e&&e.undragable();this.removeData(p);return this};n.exports=h}(t.exports,t,e);e.____MODULES["1c215cb2b26f2cbeb305c7cbcf472a99"]=t.exports})(this);(function(e){var t={id:"f3a70949d66a5dac19d321c4bb9e82f8",filename:"HashParams.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r={};QNR.HashParams={get:function(){var e="#"+(window.location.href.split("#")[1]||""),t={};var n=e.replace(/.*?#.*?!*/,"");QNR.forEach(n.split("&"),function(e){var n=e.split("=");if(n[1]){t[n[0]]=decodeURIComponent(n[1])}});return t},set:function(e,t){if(t===""||t==null){delete r[e]}else if(QNR.type(e)==="object"){for(var n in e){r[n]=encodeURIComponent(e[n])}}else if(QNR.type(e)==="string"){r[e]=encodeURIComponent(t)}location.hash=function(){html=[];for(var e in r){html.push(e+"="+r[e])}if(html[0]){return"#!"+html.join("&")}return""}()}};t.exports=QNR.HashParams}(t.exports,t,e);e.____MODULES["f3a70949d66a5dac19d321c4bb9e82f8"]=t.exports})(this);(function(e){var t={id:"9f7da0fd7ad3ca7bfc636e2365d14ec5",filename:"Event.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=i.Event,o=[].slice;var u=function(){u.$super.apply(this,arguments)};i.extend(u,s,{bind:function(e,t,n){if(i.type(e)==="object"){var r=[];for(var s in e){r.push(this.bind(s,e[s],n))}return r}else{if(n){t=i.proxy(t,n)}var o=this._getOne(e);if(o.fired){t.apply(null,t.args);delete o.fired;delete o.args;return t}this._getOne(e).push(t);return t}},trigger:function(e){var t=this._getOne(e)||[];var n=o.call(arguments,1);var r=this;var i=t.map(function(e){return e.apply(r,n)});return i},triggerReady:function(e){var t=this._getOne(e);var n=o.call(arguments,1);t.forEach(function(e,t){if(typeof e!="function"){return null}return e.apply(null,n)});t.fired=true;t.args=n}});u.prototype.fire=u.prototype.trigger;n.exports=u}(t.exports,t,e);e.____MODULES["9f7da0fd7ad3ca7bfc636e2365d14ec5"]=t.exports})(this);(function(__context){var module={id:"9cab0f225703746b5f45fa641e54f68a",filename:"json2.js",exports:{}};if(!__context.____MODULES){__context.____MODULES={}}var r=function(exports,module,global){if(!window.JSON){window.JSON={}}(function(JSON){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){escapable.lastIndex=0;return escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];if(a&&typeof a==="object"&&typeof a.toJSON==="function"){a=a.toJSON(e)}if(typeof rep==="function"){a=rep.call(t,e,a)}switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a){return"null"}gap+=indent;u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1){u[n]=str(n,a)||"null"}i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]";gap=o;return i}if(rep&&typeof rep==="object"){s=rep.length;for(n=0;n<s;n+=1){if(typeof rep[n]==="string"){r=rep[n];i=str(r,a);if(i){u.push(quote(r)+(gap?": ":":")+i)}}}}else{for(r in a){if(Object.prototype.hasOwnProperty.call(a,r)){i=str(r,a);if(i){u.push(quote(r)+(gap?": ":":")+i)}}}}i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}";gap=o;return i}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;if(typeof JSON.stringify!=="function"){JSON.stringify=function(e,t,n){var r;gap="";indent="";if(typeof n==="number"){for(r=0;r<n;r+=1){indent+=" "}}else if(typeof n==="string"){indent=n}rep=t;if(t&&typeof t!=="function"&&(typeof t!=="object"||typeof t.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":e})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i==="object"){for(n in i){if(Object.prototype.hasOwnProperty.call(i,n)){r=walk(i,n);if(r!==undefined){i[n]=r}else{delete i[n]}}}}return reviver.call(e,t,i)}var j;text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})(JSON)}(module.exports,module,__context);__context.____MODULES["9cab0f225703746b5f45fa641e54f68a"]=module.exports})(this);(function(e){var t={id:"60f02d1516c54ca88306bd00b7b4d021",filename:"index.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){e.____MODULES["9cab0f225703746b5f45fa641e54f68a"]}(t.exports,t,e);e.____MODULES["60f02d1516c54ca88306bd00b7b4d021"]=t.exports})(this);(function(e){var t={id:"7d96db7148e169d323379e8589367acb",filename:"db_config.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r={days:[1],locations:[3,4,5,6,7,8,9,10,17,21,24],customs:[18,19,20],hotels:[15],sights:[16],travelTraffics:[12,13,14],events:[2],urbanTraffics:[22,23],traffics:[25]};t.exports=r}(t.exports,t,e);e.____MODULES["7d96db7148e169d323379e8589367acb"]=t.exports})(this);(function(e){var t={id:"c51777e35917abcb15bcf62b870b9df9",filename:"msg_box.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r=$('<div class="msg_info_box hide" id="msg_info_box"><div class="msg_info_box_inner"><div class="msg_content"><img src="//source.qunarzz.com/site/images/travel/new_plan/tan.gif"><span></span></div></div></div>');var i=r.find(".msg_content span");$("body").append(r);var s;t.exports={showInfo:function(e,t){if(s){clearTimeout(s);s=null}i.text(e);r.height(84).show();if(t){this.hideInfo(3e3)}},hideInfo:function(e){if(s){clearTimeout(s)}if(!r.is(":visible")){return}s=setTimeout(function(){r.animate({height:0},{speed:1e3,complete:function(){r.hide()}})},e||0)}}}(t.exports,t,e);e.____MODULES["c51777e35917abcb15bcf62b870b9df9"]=t.exports})(this);(function(e){var t={id:"0d69e05a3d7d97743857afa7e3b62db1",filename:"DbAction.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function v(e){var t={};d.forEach(function(n){var r=e[n];if(r.length){var i=t[n]={};s.forEach(f,function(e,t){r.forEach(function(n){var r=n.typeId;if(e.indexOf(r)>-1){if(!i[t]){i[t]=[]}i[t].push(n)}})})}});return t}e.____MODULES["60f02d1516c54ca88306bd00b7b4d021"];e.____MODULES["fe84b0b9d47dc2feed8b14b3d6c1c878"];var i=e.____MODULES["88d5c499e26b6f8fc86d873910ae3aea"];var s=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var o=e.____MODULES["24538986015918d4b562e397230af418"];var u=e.____MODULES["c332ad9877eaf8e1dc5cd36e053c3583"];var a=e.____MODULES["72ccee1acde6f77563f5f551b427b29d"];var f=e.____MODULES["7d96db7148e169d323379e8589367acb"];var l=Hogan.compile("/travelbook/books/info/update/{{bookId}}");var c=Hogan.compile("/travelbook/plan/{{bookId}}/update");var h=e.____MODULES["c51777e35917abcb15bcf62b870b9df9"];var p={saveBase:function(e,t,n){var r=l.render({bookId:a.Book_Id});e=e||{};e._method="PUT";e.id=a.Book_Id;e.userId=a.P_User_Id;i.post(r,e,function(e){var n=e.data;t&&t(n)},function(e){var t=e.status,r=e.message;if(n){n(e)}else{if(e.errcode===14){LoginDialog.showModileDialog()}else{var i="出错了,请刷新重试";if(r){i=r}h.showInfo(i)}h.hideInfo(2500)}})},saveBook:function(e,t,n){var r=a.Book_Id,i=a.P_User_Id;var s=e.nodes;if(!s.length){return}delete e.nodes;var u=v(e);var f=c.render({bookId:r});var l=o.getItem("csrfToken");f+="?csrfToken="+l;var p=function(e){if(e&&e.errcode===0){var n=e.data||{};t&&t(n,s)}else{d(e)}};var d=function(e){if(n){n(e)}else{if(e.errcode===14){LoginDialog.showModileDialog()}else{var t="出错了,请刷新重试";if(e&&e.errmsg){t=e.errmsg}h.showInfo(t)}h.hideInfo(2500)}};$.ajax({url:f,data:JSON.stringify(u),contentType:"application/json",processData:false,type:"POST",dataType:"json",success:p,error:d})},addRoute:function(e,t,n){var r=e.routeid,s=e.id,o=e.order;var u=function(e){if(n){n(e)}else{var t="出错了,请刷新重试";if(e.errmsg){t=e.errmsg}h.showInfo(t);h.hideInfo(2500)}};var f="/travelbook/plan/"+a.Book_Id+"/route/"+r;var l={dayId:s,entire:true};if(typeof o!=="undefined"){l.albumDay=o;l.entire=false}i.post(f,l,function(e){var n=e.data,r;if(n.book&&(r=n.book.travelBookDayList)){t(r,n.updateDayIds)}else if(n.dayId){t(n.dayId)}else{u(e)}},u)}};var d=["add","update","delete"];n.exports=p}(t.exports,t,e);e.____MODULES["0d69e05a3d7d97743857afa7e3b62db1"]=t.exports})(this);(function(e){var t={id:"5300a7046b4db16ea4ce4c2ad9bf3523",filename:"context.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=i.Event;var o=i.mix;var u=i.extend(function(e){this._changed_hash={};s.call(this);this._name=name;this._hash=o({},e)},s,{_changed:false,changed:function(){if(this._changed){return o({},this._changed_hash)}return false},hasChanged:function(){return!!this._changed},clearChanged:function(){this._changed=false;this._changed_hash={}},remove:function(e){delete this._hash[e];delete this._changed_hash[e]},context:function(e,t,n){if(typeof e=="object"){for(var r in e){arguments.callee.call(this,r,e[r])}return}if(t!==undefined){var i=this._hash[e];if(t===i)return;this._changed=true;this._changed_hash[e]=t;this._hash[e]=t;this.trigger("set_"+e,t,i);this.trigger("changed",e,t,i)}else{return this._hash[e]}},get:function(){return this._hash},empty:function(){this.clearChanged();this._hash={}},has:function(e){return e in this._hash},setKeyChange:function(e){if(this.has(e)){this._changed=true;var t=this._changed_hash[e]=this._hash[e];this.trigger("set_"+e,t);this.trigger("changed",e,t);var n=1}}});n.exports=u}(t.exports,t,e);e.____MODULES["5300a7046b4db16ea4ce4c2ad9bf3523"]=t.exports})(this);(function(e){var t={id:"e48a74a252a520897453ae043780aecd",filename:"EventObj.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r=function(e){var t=this;t.event_name=e.name;t.target=e.target;t._stopPropagation=false;t._params={}};r.prototype.stopPropagation=function(){this._stopPropagation=true};r.prototype.releaseStop=function(){this._stopPropagation=false};r.prototype.isStop=function(){return this._stopPropagation};r.prototype.setParams=function(e){this._params=e};r.prototype.getParams=function(){return this._params};t.exports=r}(t.exports,t,e);e.____MODULES["e48a74a252a520897453ae043780aecd"]=t.exports})(this);(function(e){var t={id:"c90af09b7097baf4bdfab89cb5fed51b",filename:"BookNode.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["c332ad9877eaf8e1dc5cd36e053c3583"];var o=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var u=e.____MODULES["5300a7046b4db16ea4ce4c2ad9bf3523"];var a=e.____MODULES["9f7da0fd7ad3ca7bfc636e2365d14ec5"];var f=e.____MODULES["e48a74a252a520897453ae043780aecd"];var l=a.prototype.trigger,c=[].slice,h=i.mix,p=function(){};var d=function(e){var t=this;d.$super.apply(t,arguments);t._id=o.createId(t._nodeType,e.order);t._context=new u;t._children=[];t._deleted=false;t.context("client_id",t._id);t._parseData(e);t.bindNodeEvent()};var v={before_move:"before_move",move_node:"move_node",rm_node:"rm_node",node_load_id:"node_load_id"};var d=i.extend(d,a,{_nodeType:"node",_id_key_name:"id",_order_key_name:"order",Node_Event_List:v,COMMOND_TYPES:{ADD:"add",UPDATE:"update",DELETE:"delete",NONE:"none"},_DB_CONTEXT_FILTER:{},_parseData:function(e){this.clearChanged()},bindNodeEvent:function(){var e=this,t=e.Node_Event_List;e._context.on("changed",function(t,n,r){e.trigger("changed",t,n,r)});for(var n in t){var r="__event_"+t[n];if(i.type(e[r])==="function"){e.on(n,e[r],e)}}},unbindNodeEvent:function(){var e=this,t=e.Node_Event_List;e._context.unbind();for(var n in t){e.unbind(n)}},trigger:function(e){var t=this;var n=t.Node_Event_List;if(!n[e]){var r=c.call(arguments,0);return l.apply(t,r)}var r=c.call(arguments,1),i,s;if(r[0]instanceof f){i=r[0];r=[e].concat(r);s=l.apply(t,r)}else{i=new f({name:e,target:t});r=[e,i].concat(r);s=l.apply(t,r)}if(!i.isStop()){var o=t.parent();o&&o.trigger.apply(o,r)}return s},_val_:function(e,t){var n=this;if(i.type(t)!=="undefined"){n.context(e,t);return n}else{return n.context(e)}},id:function(){var e=this;return e._id},getId:function(){var e=this;var t=e._id_key_name;if(e._context.has(t)){return e.context(t)}else{return null}},len:function(){var e=this;return e._children.length},children:function(){var e=this;return e._children.slice(0)},hasChild:function(){var e=this;return!!e.len()},parent:function(){var e=this;return e._parent},hasParent:function(){var e=this;return!!e.parent()},setParent:function(e){var t=this;t._parent=e},removeParent:function(){var e=this;e._parent=null},nodeType:function(){var e=this;return e._nodeType},type:function(){var e=this;return e.context("type_id")},order:function(e){var t=this;return t.context.apply(t,[t._order_key_name].concat(c.call(arguments,0)))},_setChildsOrder:function(e){var t=this;if(e){t._children.slice(e).forEach(function(t,n){t&&t.order(e+n)});return}t._children.forEach(function(e,t){e&&e.order(t)})},_checkMove:function(){},moveTo:function(e,t,n){var r=this,i=r.parent(),s=r.order(),o,n=n===false?false:true;if(i===e){if(s===t){return false}else{r.trigger(r.Node_Event_List.before_move,e,t,i,s);e._children.splice(e._children.indexOf(r),1);e.addCell(r,t,true);r.trigger(r.Node_Event_List.move_node,e,t,i,s);return true}}o=e._checkMove(r,t);if(o.status===0){r.trigger(r.Node_Event_List.before_move,e,t,i,s);if(r.hasParent()){r.parent().rmCell(r)}e.addCell(r,t);n&&r.trigger(r.Node_Event_List.move_node,e,t,i,s);return true}else{return o}},addCell:function(e,t,n){var r=this;var i=r.len();r._children.splice(t,0,e);if(n){r._setChildsOrder()}else if(t<i){r._setChildsOrder(Math.max(t-1,0))}else{r._children[i].order(t)}e.setParent(r)},rmCell:function(e){var t=this;t._children.splice(t._children.indexOf(e),1);t._setChildsOrder();e.removeParent()},context:function(e,t){var n=this;return n._context.context.apply(n._context,c.call(arguments,0))},contextAll:function(){var e=this;return h({},e._context.get())},loadId:function(e){var t=this;var n=t.context("client_id"),r;if(r=e[n]){t.context(t._id_key_name,r);t.clearChanged();t.trigger(t.Node_Event_List.node_load_id,r);return true}else{return false}},parseKeyName:function(e){var t={};for(var n in e){if(n.indexOf("_")===-1){t[n]=e[n];continue}var r=n.replace(/_(\w)/g,function(e,t){return t.toUpperCase()});t[r]=e[n]}return t},getDbData:function(){var e=this,t=e._DB_CONTEXT_FILTER,n;var r=e.commondType();var n;switch(r){case e.COMMOND_TYPES.ADD:n=e.contextAll();break;case e.COMMOND_TYPES.UPDATE:n=e._context.changed();n[e._id_key_name]=e.context(e._id_key_name);n.type_id=e.type();break;case e.COMMOND_TYPES.DELETE:n={id:e.context(e._id_key_name),type_id:e.type()};break;default:n=null;break}if(n){for(var i in t){delete n[i]}n.command=r;n=e.parseKeyName(n)}return n},hasChanged:function(){return this._context.changed()},clearChanged:function(){var e=this;e._context.clearChanged()},isDeleted:function(){return this._deleted},setDeleted:function(){this._deleted=true},commondType:function(){var e=this;if(e._deleted){return e.COMMOND_TYPES.DELETE}else if(typeof e.context(e._id_key_name)==="undefined"){return e.COMMOND_TYPES.ADD}else if(e._context.hasChanged()){return e.COMMOND_TYPES.UPDATE}else{return e.COMMOND_TYPES.NONE}},findByNodeType:function(e){var t=this;return t.children().filter(function(t){return t.nodeType()===e})},findByHandle:function(e){var t=this;return t.children().filter(function(t){return t.id()===e})},flattenChildren:function(){var e=this;var t=[];var n=[e];var r,i;while(i=n.shift()){r=i.children();for(var s=0,o=r.length;s<o;s++){if(i=r[s]){t.push(i);if(i.children().length)n.push(r[s])}}}return t},remove:function(){var e=this;e.clear();e.destroy()},clear:function(){var e=this;if(e.hasParent())e._parent.rmCell(e);e._children.forEach(function(e){e.remove()});e._children=[]},destroy:function(){var e=this;e.unbind();for(var t in e)delete e[t]},isDestroy:function(){return!this._id}});n.exports=d}(t.exports,t,e);e.____MODULES["c90af09b7097baf4bdfab89cb5fed51b"]=t.exports})(this);(function(e){var t={id:"b9d479a232d0298d5bf7be17b5bc0e33",filename:"BookElement.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var o=e.____MODULES["c90af09b7097baf4bdfab89cb5fed51b"];var u=function(){var e=this;u.$super.apply(e,arguments)};i.extend(u,o,{_nodeType:"BOOK_ELEMENT",_order_key_name:"travelOrder",__event_move_node:function(e){this.context("dayId",this.parent().getId())},_parseData:function(e){var t=this;if(typeof e.type!=="undefined"){e.type_id=e.type}t.context(e);t.clearChanged()},getDbData:function(){var e=o.prototype.getDbData.apply(this,arguments);if(e){e.dayId=this.context("dayId");if(e.command===this.COMMOND_TYPES.UPDATE){var t=[];e.travelOrder=this.context("travelOrder");s.forEach(e,function(e,n){t.push(n)});e.keys=t}}return e},getPoiId:function(){var e=this.context("locationId")||this.context("poiIdNum");e=(e+"").replace(/\w_/,"");return e||0},hasLatLng:function(){var e=this;var t=e.context("lng")||e.context("blng")||e.context("glng");var n=e.context("lat")||e.context("blat")||e.context("glat");return t&&n},isAbroad:function(){var e=this;return!!e.context("abroad")},lng:function(){var e=this;if(!e.isAbroad()){return e.context("blng")||e.context("lng")}return e.context("glng")||e.context("lng")},lat:function(){var e=this;if(!e.isAbroad()){return e.context("blat")||e.context("lat")}return e.context("glat")||e.context("lat")},name:function(){return this.context("name")},cityName:function(){return this.context("cityName")}});n.exports=u}(t.exports,t,e);e.____MODULES["b9d479a232d0298d5bf7be17b5bc0e33"]=t.exports})(this);(function(e){var t={id:"83d62adfc2fbd5a9aeee9e544a2807bb",filename:"AllowMoveResult.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r={success:function(){return{status:0}},repeate:function(){return{status:1,msg:"不能重复添加日程元素"}},max:function(){return{status:2,msg:"已经是最大限制了,不能添加"}}};t.exports=r}(t.exports,t,e);e.____MODULES["83d62adfc2fbd5a9aeee9e544a2807bb"]=t.exports})(this);(function(e){var t={id:"5304114d73c733af2d632c1c6f6298ce",filename:"config.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r={Drive:"driving",Transit:"transit",Walk:"walking"};var i=[10,11,12];var s={drive:0,walk:1,bus:2,subway:3,ferry:4};t.exports={Mode:r,TACTICS:i,R_TYPE:s}}(t.exports,t,e);e.____MODULES["5304114d73c733af2d632c1c6f6298ce"]=t.exports})(this);(function(e){var t={id:"34e814670e74b19de1c6553b8188f327",filename:"qmap.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];if(typeof window.QNR=="undefined"){window.QNR={}}window.QNR.Map=i.Map||{};(function(){function e(e,t){var n=this;this._event=this._event||[];this._event["baidu"]=this._event["baidu"]||[];this._event["baidu"][e]=this._event["baidu"][e]||[];var r=this._event["baidu"][e].length;this._event["baidu"][e][r]=function(e){e.target=n;if(e.point){e.latlng=new i.Map.LatLng(new BMap.Point(e.point.lng,e.point.lat))}if(e.pixel){e.pixel={x:e.pixel.x,y:e.pixel.y}}t.apply(n,[e])};this._objs["baidu"].addEventListener(e,this._event["baidu"][e][r]);return this._event["baidu"][e][r]}function t(e,t){a(this._event["baidu"][e],t);this._objs["baidu"].removeEventListener(e,t)}function n(e,t){var n=this;this._event=this._event||[];this._event["google"]=this._event["google"]||[];this._event["google"][e]=this._event["google"][e]||[];var r=this._event["google"][e].length;var s=google.maps.event.addListener(this._objs["google"],e,function(e){var r=e;if(e&&e.latLng){e.latlng=new i.Map.LatLng(new google.maps.LatLng(e.latLng.lat(),e.latLng.lng()))}if(e&&e.pixel){e.pixel={x:e.pixel.x,y:e.pixel.y}}t.apply(n,[e])});this._event["google"][e][r]=s;return s}function r(e,t){a(this._event["google"][e],t);google.maps.event.removeListener(t)}function s(e,t){var n=function(){};n.prototype=t.prototype;e.prototype=new n;e.prototype.constructor=e}function o(e,t){for(var n in e.prototype){if("function"==typeof e.prototype[n]){t[n]=e.prototype[n]}}}function u(e,t){if("undefined"==typeof e){return t}else if(e){return true}else{return false}}function a(e,t){var n=e.length;while(n--){if(n in e&&e[n]===t){e.splice(n,1)}}return e}function f(e){var t=[],n=0,r;for(r in e){if(e.hasOwnProperty(r)){t[n++]=r}}return t}i.Map=function(e,t,n){e=e.toLowerCase();if("baidu"===e){return new i.Map.Adapter.Baidu(t,n)}else if("google"===e){return new i.Map.Adapter.Google(t,n)}else{throw"No such adapter vendor."}};i.Map.LatLng=function(e,t,n){this._objs={};this.addObject(e,t,n)};i.Map.LatLng.prototype={addObject:function(e,t,n){if(window.BMap&&BMap.Point&&e instanceof BMap.Point){this._objs["baidu"]={lat:e.lat,lng:e.lng,obj:e}}else if(window.google&&google.maps&&google.maps.LatLng&&e instanceof google.maps.LatLng){this._objs["google"]={lat:e.lat(),lng:e.lng(),obj:e}}else{this._objs[n]={lat:e,lng:t,obj:null}}},getLat:function(e){var t=f(this._objs),n;if(this._objs[e]){n=this._objs[e]}else{n=this._objs[t[0]]}return n.lat},getLng:function(e){var t=f(this._objs),n;if(this._objs[e]){n=this._objs[e]}else{n=this._objs[t[0]]}return n.lng},equals:function(e){},_toBaidu:function(){if(!this._objs["baidu"]){this._transLatLng("baidu")}else if(!this._objs["baidu"].obj){this._objs["baidu"].obj=new BMap.Point(this._objs["baidu"].lng,this._objs["baidu"].lat)}return this._objs["baidu"].obj},_toGoogle:function(){if(!this._objs["google"]){this._transLatLng("google")}if(!this._objs["google"].obj){this._objs["google"].obj=new google.maps.LatLng(this._objs["google"].lat,this._objs["google"].lng)}return this._objs["google"].obj},_transLatLng:function(e){var t,n,r,i;t=f(this._objs);r=t.length;for(n=0;n<r;n++){i="_"+t[n].toLowerCase()+"To"+e.charAt(0).toUpperCase()+e.substring(1).toLowerCase();if(this[i]&&"function"==typeof this[i]){this._objs[e]=this[i](this._objs[t[n]]);break}}if(!this._objs[e]){throw"Can't convert to "+e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()}},_baiduToGoogle:function(e){return{lat:e.lat-.006,lng:e.lng-.0065,obj:null}},_googleToBaidu:function(e){return{lat:e.lat+.006,lng:e.lng+.0065,obj:null}}};i.Map.Pixel=function(e,t){this.x=e;this.y=t;this._objs={}};i.Map.Pixel.prototype._toBaidu=function(){if(!this._objs["baidu"]){this._objs["baidu"]=BMap.Pixel(this.x,this.y)}return this._objs["baidu"]};i.Map.Pixel.prototype._toGoogle=function(){if(!this._objs["google"]){this._objs["google"]=new google.maps.Point(this.x,this.y)}return this._objs["google"]};i.Map.Bounds=function(e,t,n){this._sw=e,this._ne=t;this._objs=[];if("baidu"==n){this._toBaidu()}else if("google"==n){this._toGoogle()}};i.Map.Bounds.prototype._toBaidu=function(){if(!this._objs["baidu"]){this._objs["baidu"]=new BMap.Bounds(this._sw?this._sw._toBaidu():null,this._ne?this._ne._toBaidu():null);o(this._toBaidu,this)}return this._objs["baidu"]};i.Map.Bounds.prototype._toBaidu.prototype.equals=function(e){return this._objs["baidu"].equals(e._toBaidu)};i.Map.Bounds.prototype._toBaidu.prototype.getSouthWest=function(){var e=this._objs["baidu"].getSouthWest();return new i.Map.LatLng(new BMap.Point(e.lng,e.lat))};i.Map.Bounds.prototype._toBaidu.prototype.getNorthEast=function(){var e=this._objs["baidu"].getNorthEast();return new i.Map.LatLng(new BMap.Point(e.lng,e.lat))};i.Map.Bounds.prototype._toBaidu.prototype.isEmpty=function(){return this._objs["baidu"].isEmpty()};i.Map.Bounds.prototype._toBaidu.prototype.toSpan=function(){var e=this._objs["baidu"].toSpan();return new i.Map.LatLng(new BMap.Point(e.lng,e.lat))};i.Map.Bounds.prototype._toBaidu.prototype.intersects=function(e){return!this._objs["baidu"].intersects(e._toBaidu()).isEmpty()};i.Map.Bounds.prototype._toBaidu.prototype.getCenter=function(){var e=this._objs["baidu"].getCenter();return new i.Map.LatLng(new BMap.Point(e.lng,e.lat))};i.Map.Bounds.prototype._toBaidu.prototype.extend=function(e){this._objs["baidu"].extend(e._toBaidu());this._sw=this.getSouthWest();this._ne=this.getNorthEast()};i.Map.Bounds.prototype._toBaidu.prototype.containsPoint=function(e){var t=this._objs["baidu"];var n=e._toBaidu();return t.containsPoint(n)};i.Map.Bounds.prototype._toGoogle=function(e){if(!this._objs["google"]){if(this._sw&&this._ne){this._objs["google"]=new google.maps.LatLngBounds(this._sw._toGoogle(),this._ne._toGoogle())}else{this._objs["google"]=new google.maps.LatLngBounds}o(this._toGoogle,this)}return this._objs["google"]};i.Map.Bounds.prototype._toGoogle.prototype.equals=function(e){return this._objs["google"].equals(e._toGoogle())};i.Map.Bounds.prototype._toGoogle.prototype.getSouthWest=function(){var e=this._objs["google"].getSouthWest();return new i.Map.LatLng(e.lat(),e.lng(),"google")};i.Map.Bounds.prototype._toGoogle.prototype.getNorthEast=function(){var e=this._objs["google"].getNorthEast();return new i.Map.LatLng(e.lat(),e.lng(),"google");return new i.Map.LatLng(google.maps.LatLng(e.lat(),e.lng()))};i.Map.Bounds.prototype._toGoogle.prototype.isEmpty=function(){return this._objs["google"].isEmpty()};i.Map.Bounds.prototype._toGoogle.prototype.toSpan=function(){var e=this._objs["google"].toSpan();return new i.Map.LatLng(google.maps.LatLng(e.lat(),e.lng()))};i.Map.Bounds.prototype._toGoogle.prototype.intersects=function(e){return this._objs["google"].intersects(e._toGoogle())};i.Map.Bounds.prototype._toGoogle.prototype.getCenter=function(){var e=this._objs["google"].getCenter();return new i.Map.LatLng(new google.maps.LatLng(e.lat(),e.lng()))};i.Map.Bounds.prototype._toGoogle.prototype.extend=function(e){this._objs["google"].extend(e._toGoogle());this._sw=this.getSouthWest();this._ne=this.getNorthEast()};i.Map.Bounds.prototype._toGoogle.prototype.containsPoint=function(e){var t=this._objs["google"];var n=e._toGoogle();return t.contains(n)};i.Map.Size=function(e,t){this.width=e;this.height=t;this._objs=[]};i.Map.Size.prototype._toBaidu=function(){if(!this._objs["baidu"]){this._objs["baidu"]=new BMap.Size(this.width,this.height)}return this._objs["baidu"]};i.Map.Size.prototype._toGoogle=function(){if(!this._objs["google"]){this._objs["google"]=new google.maps.Size(this.width,this.height)}return this._objs["google"]};i.Map.Icon=function(e,t,n,r){this._url=e,this._size=t,this._origin=n,this._anchor=r;this._objs=[]};i.Map.Icon.prototype._toBaidu=function(){var e={};if(!this._objs["baidu"]){if(this._origin)e.imageOffset=new BMap.Size(0-this._origin.x,this._origin.y);if(this._anchor)e.anchor=new BMap.Size(this._anchor.x,this._anchor.y);this._objs["baidu"]=new BMap.Icon(this._url,this._size._toBaidu(),e)}return this._objs["baidu"]};i.Map.Icon.prototype._toGoogle=function(){var e,t;if(!this._objs["google"]){if(this._anchor){e=this._anchor._toGoogle();t=this._origin._toGoogle();this._objs["google"]=new google.maps.MarkerImage(this._url,this._size._toGoogle(),t,e)}else if(this._origin){t=this._origin._toGoogle();this._objs["google"]=new google.maps.MarkerImage(this._url,this._size._toGoogle(),t)}else{this._objs["google"]=new google.maps.MarkerImage(this._url,this._size._toGoogle())}}return this._objs["google"]};i.Map.Control=function(e,t,n){this._map=e;this._objs=[];this._opts=t||{};this._init=n};i.Map.Control.prototype._toBaidu=function(){var e=this;if(!this._objs["baidu"]){this._objs["baidu"]=new BMap.Control;this._objs["baidu"].defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT;this._objs["baidu"].defaultOffset=new BMap.Size(0,0);this._objs["baidu"].initialize=function(){return e._init.apply(e._objs["baidu"],[e._map])}}return this._objs["baidu"]};i.Map.Control.prototype._toGoogle=function(){var e=this;if(!this._objs["google"]){var t=this._init(this._map);this._objs["google"]={pos:google.maps.ControlPosition.RIGHT_BOTTOM,div:t}}return this._objs["google"]};i.Map.Control.Position={};i.Map.Control.Position.TOP_LEFT=1;i.Map.Control.Position.TOP_RIGHT=2;i.Map.Control.Position.BOTTOM_LEFT=3;i.Map.Control.Position.BOTTOM_RIGHT=4;i.Map.Control.Position._toBaidu=function(e){var t=[null,BMAP_ANCHOR_TOP_LEFT,BMAP_ANCHOR_TOP_RIGHT,BMAP_ANCHOR_BOTTOM_LEFT,BMAP_ANCHOR_BOTTOM_RIGHT];return t[e]};i.Map.Control.Position._toGoogle=function(e){var t=[null,google.maps.ControlPosition.LEFT_TOP,google.maps.ControlPosition.TOP_RIGHT,google.maps.ControlPosition.BOTTOM_LEFT,google.maps.ControlPosition.BOTTOM_RIGHT];return t[e]};i.Map.Control.Navigation=function(e,t){i.Map.Control.apply(this,[e,t,null]);this._opts.position=this._opts.position||i.Map.Control.Position.TOP_LEFT};i.Map.Control.Navigation.prototype=new i.Map.Control;i.Map.Control.Navigation.prototype.constructor=i.Map.Control.Navigation;i.Map.Control.Navigation.prototype._toBaidu=function(){if(!this._objs["baidu"]){var e=this._opts.style;this._objs["baidu"]=new BMap.NavigationControl({anchor:i.Map.Control.Position._toBaidu(this._opts.position),type:e})}return this._objs["baidu"]};i.Map.Control.Navigation.prototype._toGoogle=function(){var e=i.Map.Control.Position._toGoogle(this._opts.position);var t=this._opts.style;if(!this._objs["google"]){this._objs["google"]={pos:e,obj:{panControl:true,panControlOptions:{position:e},zoomControl:true,zoomControlOptions:{position:e,style:t}}}}return this._objs["google"]};i.Map.Control.OverviewMap=function(e,t){i.Map.Control.apply(this,arguments)};i.Map.Control.OverviewMap.prototype=new i.Map.Control;i.Map.Control.OverviewMap.prototype.constructor=i.Map.Control.OverviewMap;i.Map.Control.OverviewMap.prototype._toBaidu=function(){return new BMap.OverviewMapControl({isOpen:u(this._options.open,false)})};i.Map.Control.OverviewMap.prototype._toGoogle=function(){var e={overviewMapControl:true,overviewMapControlOptions:{opened:u(this._options.open,false)}};return e};i.Map.Overlay=function(){};i.Map.Overlay.prototype._toBaidu=function(n){var r=this.constructor.prototype;var i=r._objs=r._objs||[];var o=this,u;if(!i["baidu"]){i["baidu"]=function(e,t){this._overlay=e;this._map=t};s(i["baidu"],BMap.Overlay);i["baidu"].prototype.initialize=function(){var e=this._map;return r.onInit.apply(this,[e,this._overlay])};i["baidu"].prototype.draw=function(){var e=this._map;return r.onDraw.apply(this,[e,this._overlay])};i["baidu"].prototype.getPanes=function(){var e=this._map;return e.getPanes()}}this.addEventListener=e;this.removeEventListener=t;if(!this.hasOwnProperty("_objs")){this._objs=[]}if(!this._objs["baidu"]){this._objs["baidu"]=new i["baidu"](o,n)}return this._objs["baidu"]};i.Map.Overlay.prototype._toGoogle=function(e){var t=this.constructor.prototype;var i=t._objs=t._objs||[];var o=this,u;if(!i["google"]){i["google"]=function(e,t){this._overlay=e;this._map=t};s(i["google"],google.maps.OverlayView);i["google"].prototype.onAdd=function(){var e=this._map;this._div=t.onInit.apply(this,[e,this._overlay]);return this._div};i["google"].prototype.draw=function(){var e=this._map;return t.onDraw.apply(this,[e,this._overlay])};i["google"].prototype.onRemove=function(){this._div.parentNode.removeChild(this._div);this._div=null}}o.addEventListener=n;o.removeEventListener=r;if(!this.hasOwnProperty("_objs")){this._objs=[]}if(!this._objs["google"]){this._objs["google"]=new i["google"](o,e)}return this._objs["google"]};i.Map.Overlay.Marker=function(e,t){this._point=e,this._options=t;this._map=null,this._objs=[],this._event=[]};i.Map.Overlay.Marker.prototype=new i.Map.Overlay;i.Map.Overlay.Marker.prototype.constructor=i.Map.Overlay.Marker;i.Map.Overlay.Marker.prototype._toBaidu=function(e){this._map=e;var t={enableDragging:this._options["draggable"]||false,enableClicking:this._options["clickable"]||true,raiseOnDrag:this._options["raiseOnDrag"]||false,title:this._options["title"]||""};if(this._options["icon"]){t.icon=this._options["icon"]._toBaidu()}if(!this._objs["baidu"]){this._objs["baidu"]=new BMap.Marker(this._point._toBaidu(),t);o(this._toBaidu,this)}return this._objs["baidu"]};i.Map.Overlay.Marker.prototype._toBaidu.prototype.addEventListener=e;i.Map.Overlay.Marker.prototype._toBaidu.prototype.removeEventListener=t;i.Map.Overlay.Marker.prototype._toBaidu.prototype.setPosition=function(e){};i.Map.Overlay.Marker.prototype._toBaidu.prototype.getPosition=function(){};i.Map.Overlay.Marker.prototype._toBaidu.prototype.getPoint=function(){return this._point};i.Map.Overlay.Marker.prototype._toGoogle=function(){var e={clickable:this._options["clickable"]||true,draggable:this._options["draggable"]||false,position:this._point._toGoogle(),raiseOnDrag:this._options["raiseOnDrag"]||false,title:this._options["title"]||""};if(this._options["icon"]){e.icon=this._options["icon"]._toGoogle()}var t=new google.maps.Marker(e);if(!this._objs["google"]){this._objs["google"]=new google.maps.Marker(e);o(this._toGoogle,this)}return this._objs["google"]};i.Map.Overlay.Marker.prototype._toGoogle.prototype.getPoint=function(){return this._point};i.Map.Overlay.Marker.prototype._toGoogle.prototype.addEventListener=n;i.Map.Overlay.Marker.prototype._toGoogle.prototype.removeEventListener=r;i.Map.Overlay.Marker.prototype._toGoogle.prototype.setIcon=function(e){this._objs["google"].setIcon(e)};i.Map.Overlay.Marker.prototype._toGoogle.prototype.getIcon=function(e){return i.Map.Icon._fromBaidu(this._objs["baidu"].getIcon())};i.Map.Overlay.Polyline=function(e,t){this._map=null;this._points=e;this._options=t||{};this._objs=[];this._event=[]};i.Map.Overlay.Polyline.prototype=new i.Map.Overlay;i.Map.Overlay.Polyline.prototype.constructor=i.Map.Overlay.Polyline;i.Map.Overlay.Polyline.prototype._toBaidu=function(e){this._map=e;var t=[],n=this._points.length;for(var r=0;r<n;r++){t.push(this._points[r]._toBaidu())}var s={strokeStyle:"solid",enableMassClear:true,enableEditing:false};i.mix(s,this._options,true);if(!this._objs["baidu"]){this._objs["baidu"]=new BMap.Polyline(t,s);o(this._toBaidu,this)}return this._objs["baidu"]};i.Map.Overlay.Polyline.prototype._toBaidu.prototype.addEventListener=e;i.Map.Overlay.Polyline.prototype._toBaidu.prototype.removeEventListener=t;i.Map.Overlay.Polyline.prototype._toBaidu.prototype.getPath=function(){var e=this._objs["baidu"].getPath();var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(new i.Map.LatLng(e[n]))}return t};i.Map.Overlay.Polyline.prototype._toBaidu.prototype.setPath=function(e){var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(e[n]._toBaidu())}this._objs["baidu"].setPath(t)};i.Map.Overlay.Polyline.prototype._toBaidu.prototype.setStrokeColor=function(e){this._objs["baidu"].setStrokeColor(e)};i.Map.Overlay.Polyline.prototype._toGoogle=function(e){this._map=e;var t=[],n=this._points.length;for(var r=0;r<n;r++){t.push(this._points[r]._toGoogle())}var i={path:t,strokeColor:"#0096ff"};if(this._options["strokeColor"])i.strokeColor=this._options["strokeColor"];if(this._options["strokeOpacity"])i.strokeOpacity=this._options["strokeOpacity"];if(this._options["strokeWeight"])i.strokeWeight=this._options["strokeWeight"];if(this._options["clickable"])i.clickable=this._options["clickable"];if(!this._objs["google"]){this._objs["google"]=new google.maps.Polyline(i);o(this._toGoogle,this)}return this._objs["google"]};i.Map.Overlay.Polyline.prototype._toGoogle.prototype.addEventListener=n;i.Map.Overlay.Polyline.prototype._toGoogle.prototype.removeEventListener=r;i.Map.Overlay.Polyline.prototype._toGoogle.prototype.getPath=function(){var e=this._objs["google"].getPath();var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(new i.Map.LatLng(e[n]))}return t};i.Map.Overlay.Polyline.prototype._toGoogle.prototype.setPath=function(e){var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(e[n]._toGoogle())}this._objs["google"].setPath(t)};i.Map.Overlay.Polyline.prototype._toGoogle.prototype.setStrokeColor=function(e){this._objs["google"].setOptions({strokeColor:e})};i.Map.Overlay.Polygon=function(e,t){this._map=null;this._points=e;this._options=t;this._objs=[];this._event=[]};i.Map.Overlay.Polygon.prototype=new i.Map.Overlay;i.Map.Overlay.Polygon.prototype.constructor=i.Map.Overlay.Polygon;i.Map.Overlay.Polygon.prototype._toBaidu=function(e){this._map=e;var t=[],n=this._points.length;for(var r=0;r<n;r++){t.push(this._points[r]._toBaidu())}var i={strokeStyle:"solid",enableMassClear:true,enableEditing:false};if(this._options["strokeColor"])i.strokeColor=this._options["strokeColor"];if(this._options["strokeOpacity"])i.strokeOpacity=this._options["strokeOpacity"];if(this._options["strokeWeight"])i.strokeWeight=this._options["strokeWeight"];if(this._options["fillColor"])i.fillColor=this._options["fillColor"];if(this._options["fillOpacity"])i.fillOpacity=this._options["fillOpacity"];if(this._options["clickable"])i.enableClicking=this._options["clickable"];if(!this._objs["baidu"]){this._objs["baidu"]=new BMap.Polygon(t,i);o(this._toBaidu,this)}return this._objs["baidu"]};i.Map.Overlay.Polygon.prototype._toBaidu.prototype.addEventListener=e;i.Map.Overlay.Polygon.prototype._toBaidu.prototype.removeEventListener=t;i.Map.Overlay.Polygon.prototype._toBaidu.prototype.getPath=function(){var e=this._objs["baidu"].getPath();var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(new i.Map.LatLng(e[n]))}return t};i.Map.Overlay.Polygon.prototype._toBaidu.prototype.setPath=function(e){var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(e[n]._toBaidu())}this._objs["baidu"].setPath(t)};i.Map.Overlay.Polygon.prototype._toBaidu.prototype.setStrokeColor=function(e){this._objs["baidu"].setStrokeColor(e)};i.Map.Overlay.Polygon.prototype._toBaidu.prototype.setFillColor=function(e){this._objs["baidu"].setFillColor(e)};i.Map.Overlay.Polygon.prototype._toBaidu.prototype.setFillOpacity=function(e){this._objs["baidu"].setFillOpacity(e)};i.Map.Overlay.Polygon.prototype._toBaidu.prototype.getBounds=function(e){return this._objs["baidu"].getBounds()};i.Map.Overlay.Polygon.prototype._toGoogle=function(e){this._map=e;var t=[],n=this._points.length;for(var r=0;r<n;r++){t.push(this._points[r]._toGoogle())}t.push(this._points[0]._toGoogle());var i={paths:t};if(this._options["strokeColor"])i.strokeColor=this._options["strokeColor"];if(this._options["strokeOpacity"])i.strokeOpacity=this._options["strokeOpacity"];if(this._options["strokeWeight"])i.strokeWeight=this._options["strokeWeight"];if(this._options["fillColor"])i.fillColor=this._options["fillColor"];if(this._options["fillOpacity"])i.fillOpacity=this._options["fillOpacity"];if(this._options["clickable"])i.clickable=this._options["clickable"];if(!this._objs["google"]){this._objs["google"]=new google.maps.Polygon(i);o(this._toGoogle,this)}return this._objs["google"]};i.Map.Overlay.Polygon.prototype._toGoogle.prototype.addEventListener=n;i.Map.Overlay.Polygon.prototype._toGoogle.prototype.removeEventListener=r;i.Map.Overlay.Polygon.prototype._toGoogle.prototype.getPath=function(){var e=this._objs["google"].getPath();var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(new i.Map.LatLng(e[n]))}return t};i.Map.Overlay.Polygon.prototype._toGoogle.prototype.setPath=function(e){var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(e[n]._toGoogle())}this._objs["google"].setPath(t)};i.Map.Overlay.Polygon.prototype._toGoogle.prototype.setStrokeColor=function(e){this._objs["google"].setOptions({strokeColor:e})};i.Map.Overlay.Polygon.prototype._toGoogle.prototype.setFillColor=function(e){this._objs["google"].setOptions({fillColor:e})};i.Map.Overlay.Polygon.prototype._toGoogle.prototype.setFillOpacity=function(e){this._objs["google"].setOptions({fillOpacity:e})};i.Map.Overlay.Polygon.prototype._toGoogle.prototype.getBounds=function(){return this._objs["google"].getBounds()};i.Map.Adapter={};i.Map.Adapter.Baidu=function(e,t){this._overlays=[],this._controls=[],this._event=[],this._objs=[];var n={mapType:BMAP_NORMAL_MAP,enableHighResolution:false,enableAutoResize:true,enableMapClick:false};if("number"==typeof t.minZoom){n.minZoom=t.minZoom}if("number"==typeof t.maxZoom){n.maxZoom=t.maxZoom}this._map=new BMap.Map(e,n);if(t.center&&"number"==typeof t.zoom){this._map.centerAndZoom(t.center._toBaidu(),t.zoom)}u(t.scrollwheel,false)?this._map.enableScrollWheelZoom():this._map.disableScrollWheelZoom();u(t.doubleClickZoom,true)?this._map.enableDoubleClickZoom():this._map.disableDoubleClickZoom();u(t.keyboard,false)?this._map.enableKeyboard():this._map.disableKeyboard();this._objs["baidu"]=this._map};i.Map.Adapter.Google=function(e,t){this._overlays=[],this._controls=[],this._event=[],this._objs=[];e="string"==typeof e?document.getElementById(e):e;this._options={center:t.center._toGoogle(),zoom:t.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:true};this._options.draggable=u(t.draggable,true);this._options.scrollwheel=u(t.scrollwheel,false);this._options.disableDoubleClickZoom=!u(t.doubleClickZoom,true);this._options.keyboardShortcuts=u(t.keyboard,false);if("number"==typeof t.minZoom){this._options.minZoom=t.minZoom}if("number"==typeof t.maxZoom){this._options.maxZoom=t.maxZoom}this._options.styles=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];this._map=new google.maps.Map(e,this._options);this._objs["google"]=this._map};i.Map.Adapter.Baidu.prototype.getContainer=function(){return this._map.getContainer()};i.Map.Adapter.Google.prototype.getContainer=function(){return this._map.getDiv()};i.Map.Adapter.Baidu.prototype.getMap=function(){return this._map};i.Map.Adapter.Google.prototype.getMap=function(){return this._map};i.Map.Adapter.Baidu.prototype.getCenter=i.Map.Adapter.Google.prototype.getCenter=function(){return i.Map.LatLng(this._map.getCenter())};i.Map.Adapter.Baidu.prototype.setCenter=function(e){this._map.setCenter(e._toBaidu())};i.Map.Adapter.Google.prototype.setCenter=function(e){this._map.setCenter(e._toGoogle())};i.Map.Adapter.Baidu.prototype.getZoom=i.Map.Adapter.Google.prototype.getZoom=function(){return this._map.getZoom()};i.Map.Adapter.Baidu.prototype.setZoom=i.Map.Adapter.Google.prototype.setZoom=function(e){this._map.setZoom(e)};i.Map.Adapter.Baidu.prototype.getBounds=function(){var e=this._map.getBounds();return new i.Map.Bounds(new i.Map.LatLng(e.getSouthWest()),new i.Map.LatLng(e.getNorthEast()),"baidu")};i.Map.Adapter.Google.prototype.getBounds=function(){var e=this._map.getBounds();return new i.Map.Bounds(new i.Map.LatLng(e.getSouthWest()),new i.Map.LatLng(e.getNorthEast()),"google")};i.Map.Adapter.Baidu.prototype.setCursor=function(e){this._map.setDefaultCursor(e)};i.Map.Adapter.Google.prototype.setCursor=function(e){this._map.setOptions({draggableCursor:e})};i.Map.Adapter.Baidu.prototype.setViewport=function(e,t){var n=[],r,s;if(e instanceof i.Map.Bounds){n.push(e.getSouthWest()._toBaidu());n.push(e.getNorthEast()._toBaidu())}else if(e instanceof Array){s=e.length;for(r=0;r<s;r++){n.push(e[r]._toBaidu())}}this._map.setViewport(n,t)};i.Map.Adapter.Google.prototype.setViewport=function(e,t){var n;if(e instanceof i.Map.Bounds){n=e._toGoogle()}else if(e instanceof Array){var n=new google.maps.LatLngBounds,r,s=e.length;for(r=0;r<s;r++){n.extend(e[r]._toGoogle())}}if(t&&t.margins){var o=this._map.getDiv().clientHeight,u=this._map.getDiv().clientWidth;var a=t.margins[0],f=t.margins[1],l=t.margins[2],c=t.margins[3];var h=o-a-l,p=u-c-f;var d=n.toSpan();var v;if(h/d.lat()<p/d.lng()){v=h/d.lat();c+=(p-d.lng()*v)*c/(c+f);f+=(p-d.lng()*v)*f/(c+f)}else{v=p/d.lng();a+=(h-d.lat()*v)*a/(a+l);l+=(h-d.lat()*v)*l/(a+l)}var m=n.getSouthWest(),g=n.getNorthEast();var y=new google.maps.LatLng(m.lat()-c/v,m.lng()-l/v);var b=new google.maps.LatLng(g.lat()+f/v,g.lng()+a/v);n.extend(y);n.extend(b)}this._map.fitBounds(n)};i.Map.Adapter.Google.prototype.setViewport=function(e,t){var n;var r=this;if(e instanceof i.Map.Bounds){n=e._toGoogle()}else if(e instanceof Array){var n=new google.maps.LatLngBounds,s,o=e.length;for(s=0;s<o;s++){n.extend(e[s]._toGoogle())}}this._map.fitBounds(n);if(t&&t.margins){var u=null;var a=function(){var e=new google.maps.LatLngBounds;var i=r._map.getDiv().clientHeight,s=r._map.getDiv().clientWidth;var o=t.margins[0],a=t.margins[1],f=t.margins[2],c=t.margins[3];if(o){var h=new google.maps.Point(0,o);var p=l.getGLatLng(r._map,h,n);e.extend(p)}if(c){var h=new google.maps.Point(c,0);var p=l.getGLatLng(r._map,h,n);e.extend(p)}if(a){var h=new google.maps.Point(s-a,0);var p=l.getGLatLng(r._map,h,n);e.extend(p)}if(f){var h=new google.maps.Point(0,i-f);var p=l.getGLatLng(r._map,h,n);e.extend(p)}r._map.fitBounds(n.union(e));if(u){google.maps.event.removeListener(u)}};if(!r._map.getProjection()){u=google.maps.event.addListener(r._map,"projection_changed",a)}else{a()}}};i.Map.Adapter.Baidu.prototype.MAP_TYPE="baidu";i.Map.Adapter.Google.prototype.MAP_TYPE="google";i.Map.Adapter.Baidu.prototype.panBy=function(e,t){this._map.panBy(e,t)};i.Map.Adapter.Google.prototype.panBy=function(e,t){this._map.panBy(-e,-t)};i.Map.Adapter.Baidu.prototype.panTo=function(e){this._map.panTo(e._toBaidu())};i.Map.Adapter.Google.prototype.panTo=function(e){this._map.panTo(e._toGoogle())};i.Map.Adapter.Baidu.prototype.addControl=function(e){this._map.addControl(e._toBaidu());this._controls.push(e)};i.Map.Adapter.Google.prototype.addControl=function(e){var t=e._toGoogle();if(t.obj instanceof i.Map.Control){this._map.controls[t.pos].push(t.obj);this._controls.push(e)}else{this._map.setOptions(t.obj);this._controls.push(e)}};i.Map.Adapter.Baidu.prototype.removeControl=function(e){this._map.removeControl(e._toBaidu());a(this._controls,e)};i.Map.Adapter.Google.prototype.removeControl=function(e){var t=e._toGoogle(),n,r;if(e instanceof i.Map.Control){n=this._map.controls[t.pos].getLength();for(r=0;r<n;r++){if(this._map.controls[t.pos].getAt(r)==e._toGoogle()){this._map.controls[t.pos].removeAt(r);a(this._controls,e)}}}else{for(r in t){if(t.hasOwnProperty(r)){if(true==t[r]){t[r]=false}}}this._map.setOptions(t);a(this._controls,e)}};i.Map.Adapter.Baidu.prototype.addOverlay=function(e){e._adapter="baidu";this._map.addOverlay(e._toBaidu(this))};i.Map.Adapter.Baidu.prototype.removeOverlay=function(e){this._map.removeOverlay(e._toBaidu(this))};i.Map.Adapter.Baidu.prototype.getPanes=function(){var e;e=this._map.getPanes();return{map:e.mapPane,markerShadow:e.markerShadow,markerPane:e.markerPane,floatShadow:e.floatShadow,markerMouseTarget:e.overlayMouseTarget,floatPane:e.floatPane}};i.Map.Adapter.Baidu.prototype.pointToPixel=function(e,t){return this._map.pointToOverlayPixel(e._toBaidu())};i.Map.Adapter.Baidu.prototype.addEventListener=e;i.Map.Adapter.Baidu.prototype.removeEventListener=t;i.Map.Adapter.Google.prototype.addEventListener=n;i.Map.Adapter.Google.prototype.removeEventListener=r;i.Map.Adapter.Google.prototype.addOverlay=function(e){var t=e._toGoogle(this);e._adapter="google";t.setMap(this._map)};i.Map.Adapter.Google.prototype.removeOverlay=function(e){var t=e._toGoogle(this);t.setMap(null)};i.Map.Adapter.Google.prototype.getPanes=function(){var e,t=0,n=this._overlays.length,r;for(var t=0;t<n;t++){if(this._overlays[t]){r=this._overlays[t]._toGoogle(this);if(!(r.getPanes&&r.getPanes())){continue}e=r.getPanes();return{map:e.mapPane,markerShadow:e.overlayShadow,markerPane:e.overlayImage,floatShadow:e.floatShadow,markerMouseTarget:e.overlayMouseTarget,floatPane:e.floatPane}}}return{}};i.Map.Adapter.Google.prototype.pointToPixel=function(e,t){var n=t.getProjection();return n.fromLatLngToDivPixel(e._toGoogle())};var l=function(){function t(e){return e*Math.PI/180}function n(n,r,i,s){var o=t(n);var u=t(i);var a=o-u;var f=t(r)-t(s);var l=2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(o)*Math.cos(u)*Math.pow(Math.sin(f/2),2)));l=l*e;return l}function r(e,t){var n=Math.pow(2,e.getZoom());var r=new google.maps.LatLng(e.getBounds().getNorthEast().lat(),e.getBounds().getSouthWest().lng());var i=e.getProjection().fromLatLngToPoint(r);var s=e.getProjection().fromLatLngToPoint(t);var o=new google.maps.Point(Math.floor((s.x-i.x)*n),Math.floor((s.y-i.y)*n));return o}function i(e,t,n){var r=e.getProjection();var i=Math.pow(2,e.getZoom());var s=new google.maps.LatLng((n||e.getBounds()).getNorthEast().lat(),(n||e.getBounds()).getSouthWest().lng());var o=e.getProjection().fromLatLngToPoint(s);var u=new google.maps.Point(t.x/i+o.x,t.y/i+o.y);var a=e.getProjection().fromPointToLatLng(u);return a}var e=6378.137;return{calDistance:n,getGPix:r,getGLatLng:i}}()})()}(t.exports,t,e);e.____MODULES["34e814670e74b19de1c6553b8188f327"]=t.exports})(this);(function(e){var t={id:"b2bd20ce8abfb5f44654103deab53ed9",filename:"MapLoader.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function c(e,t){if(!f[e]){f[e]=new l(e)}f[e].load(function(){t(e)})}var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];e.____MODULES["34e814670e74b19de1c6553b8188f327"];var s=i.QMap;var o=window;var u=(o.__BAIDU_URL__||"https://api.map.baidu.com/api")+"?v=2.0&ak=ZAwlP8RG0tengGxBZerHUXHg&s=1";var a=o.__GOOGLE_URL__||"http://maps.google.cn/maps/api/js?v=3.9&key=AIzaSyDsv6Wsc_53sZOEf3jaxiZgNPw_6ptXC5U&sensor=false&libraries=places";var f={baidu:null,google:null};o.MapLoadCallback={};var l=function(e){this.loading=false;this.loaded=false;this._url=e==="google"?a:u;this._callbacks=[]};l.prototype.load=function(e){var t=this;var n="map_load_callback_"+(new Date).getTime();if(t.loaded){e();return}else{t._callbacks.push(e)}if(t.loading){return}o.MapLoadCallback[n]=function(){t.loading=false;t.loaded=true;var e=t._callbacks;var r;while(r=e.shift()){r()}try{o.MapLoadCallback[n]}catch(i){}};t.loading=true;var r=this._url+"&callback=MapLoadCallback."+n;i.loadJS(r)};n.exports=c}(t.exports,t,e);e.____MODULES["b2bd20ce8abfb5f44654103deab53ed9"]=t.exports})(this);(function(e){var t={id:"dfd66d8a77e8f348619e6734d9b7e0b4",filename:"MapLoader.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){n.exports=e.____MODULES["b2bd20ce8abfb5f44654103deab53ed9"]}(t.exports,t,e);e.____MODULES["dfd66d8a77e8f348619e6734d9b7e0b4"]=t.exports})(this);(function(e){var t={id:"0eec31e8c188b203d0f7fcfaa1d41e72",filename:"baidu_search.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function w(e,t){var n;if(e===l){t=t||11;n=t===11?BMAP_DRIVING_POLICY_LEAST_TIME:t===12?BMAP_DRIVING_POLICY_LEAST_DISTANCE:BMAP_DRIVING_POLICY_AVOID_HIGHWAYS}else if(e===c){t=t||BMAP_TRANSIT_POLICY_LEAST_TIME;n=t}else{n=""}return n}var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=e.____MODULES["dfd66d8a77e8f348619e6734d9b7e0b4"];var o=e.____MODULES["5304114d73c733af2d632c1c6f6298ce"].Mode;var u=e.____MODULES["5304114d73c733af2d632c1c6f6298ce"].TACTICS;var a=[].slice,f="//travel.qunar.com/travelbook/api/direction",l="driving",c="transit",h="walking",p={ak:"ZAwlP8RG0tengGxBZerHUXHg",output:"json"},d=function(e){e=e||{};return i.extend(e,p)},v=null;var m=function(e,t,n,r,i,s){var o=a.call(arguments,1);if(e==="web"){y.apply(null,o)}else{g.apply(null,o)}};var g=function(e,t,n,r,i){var o=a.call(arguments,1);var u=t.destName||t.name,f;i=i||{};i.region=u;s("baidu",function(){var s=b(e,r,i);s.search(t,n)})};var y=function(e,t,n,r,s){s=s||{};var o=d({mode:e,origin:t.lat+","+t.lng,destination:n.lat+","+n.lng});switch(e){case l:o.origin_region=t.destName;o.destination_region=t.destName;if(s.policy){o.tactics=s.policy}else{o.tactics=11}break;case c:o.region=t.destName;break;case h:o.region=t.destName;break;default:break}return i.ajax({url:f,data:o,dataType:"jsonp",success:function(i){var o=s.error||function(){console.error("百度查询错误",arguments)};if(i&&i.status===0){if(i.type===2){r(i.result,e,t,n)}else{o(arguments)}return}o(arguments)}})};var b=function(e,t,n){var r;switch(e){case l:case c:r=function(t,n){var r=n.region||"";var i=w(e,n.policy);var s=new BMap[e===l?"DrivingRoute":"TransitRoute"](r,{onSearchComplete:t,policy:i});return{search:function(t,n,r,i,o){var u=new BMap.Point(t.lng,t.lat),a=new BMap.Point(n.lng,n.lat);r&&s.setLocation(r);i&&s.setSearchCompleteCallback(i);if(o){o=w(e,o);s.setPolicy(o)}s.search(u,a)},service:s}}(t,n);break;case h:r=function(e,t){var n=t.region||"";var r=new BMap.WalkingRoute(n,{onSearchComplete:e});return{search:function(e,t,n,i){var s=new BMap.Point(e.lng,e.lat),o=new BMap.Point(t.lng,t.lat);n&&route_service.setLocation(n);i&&route_service.setSearchCompleteCallback(i);r.search(s,o)},service:r}}(t,n);break;default:console.error("model error",model);break}return r};n.exports={queryDirection:m}}(t.exports,t,e);e.____MODULES["0eec31e8c188b203d0f7fcfaa1d41e72"]=t.exports})(this);(function(e){var t={id:"5df29fa97c6a5c7cdd894e18a94ef721",filename:"google_search.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=e.____MODULES["dfd66d8a77e8f348619e6734d9b7e0b4"];var o=[].slice;var u=function(e,t,n,r,i,s){var u=o.call(arguments,1);a.apply(null,u)};var a=function(e,t,n,r,i){var o=e.toUpperCase();var u={origin:t.lat+","+t.lng,destination:n.lat+","+n.lng,travelMode:o};s("google",function(){var t=new google.maps.DirectionsService;t.route(u,function(t,n){if(n===google.maps.DirectionsStatus.OK){var s=t.routes;r.call(null,s,e)}else if(n==="OVER_QUERY_LIMIT"){i.error&&i.error.apply(null,arguments)}else{i.error&&i.error.apply(null,arguments)}})})};n.exports={queryDirection:u}}(t.exports,t,e);e.____MODULES["5df29fa97c6a5c7cdd894e18a94ef721"]=t.exports})(this);(function(e){var t={id:"350def52ea851fa034c769d39147cce1",filename:"query_factory.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["0eec31e8c188b203d0f7fcfaa1d41e72"].queryDirection;var s=e.____MODULES["5df29fa97c6a5c7cdd894e18a94ef721"].queryDirection;var o=window,u=[].slice;var a=function(e){var t=this;var n=e.type;var r=e.mode;t.setMode=function(e){r=e};t.search=function(e,t,o,a){var l=e.is_abroad,c=t.is_abroad;var h=new f;var p=function(e){var t=u.call(arguments,0);h.main.apply(h,[true].concat(t));h.remove()};var d=function(){var e=u.call(arguments,0);h.main.apply(h,[false].concat(e));h.remove()};if(l!==c){setTimeout(function(){d()},0);return h}if(o&&!a){if(typeof o==="object"){a=o;o=r}else{a=a||{}}}o=o||r;a=a||{};if(!a.error){a.error=d}if(l){s(n,o,e,t,p,a)}else{i(n,o,e,t,p,a)}return h}};var f=function(){var e=this,t=function(){};e._fns=[];e.then=function(n,r){e._fns.push({success:n||t,error:r||t});return e};e.success=function(n){e._fns.push({success:n,error:t});return e};e.error=function(n){e._fns.push({success:t,error:n});return e};e.main=function(t){var n=[].slice.call(arguments,1);e._fns.forEach(function(e){var r=e.success,i=e.error;if(t){r.apply(null,n)}else{i.apply(null,n)}})};e.remove=function(){e._fns=[]}};n.exports=a}(t.exports,t,e);e.____MODULES["350def52ea851fa034c769d39147cce1"]=t.exports})(this);(function(e){var n={id:"4c7e9bfea58c0a5a083700f240bbe09c",filename:"route_parse.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var r=function(n,r,i){function f(e){var t=this;var n=e.instructions||e.stepInstruction||"",r,i=e.path,s=e.stepOriginLocation,o=e.stepDestinationLocation,u=e.vehicle,a=e.type;if(i){path_obj=c(i);r=[s,path_obj,o]}else{r=[s,o]}if(u===null){a=1}else{a=0}return{path:r,description:n,type:a}}function l(e){var t=e.detail;var n=[];var r;for(var i=0,s=t.length;i<s;i++){var o=t[i];if(!r)r=o.total_price;n.push(o.desc+"费用是"+o.total_price+"元")}var u=n.join(",")+(s?"。":"")+(e.remark||"");return{remark:u,taxi_fee:r}}function c(e){var t=e.split(",");return{lng:t[0]*1,lat:t[1]*1}}function h(e){var n=e/3600,r;if(n<1){r=Math.ceil(e/60);n=0}else{t=n>>0;r=Math.round((n-t)*60);n=t}var i="约"+(n?n+"小时":"")+(r?r+"分钟":"");return i}function p(e){if(e>1e3){e=Math.round(e/1e3*100)/100;return e+"公里"}else{return e+"米"}}function d(e,t){var n=t.getStart(),r=t.getEnd(),i=t.getNumPlans(),s=t.taxiFare,o,u,a,f;var l=[];if(e==="transit"){i=Math.min(i,3)}for(u=0;u<i;u++){var c=t.getPlan(u),h;if(e==="transit"){h=m.call(this,c,e)}else{h=v.call(this,c,e)}l.push(h)}if(s){o={distance:s.distance,distance_txt:p(s.distance),taxi_fee:(s.day||{}).totalFare||"",remark:s.remark,day:x(s.day),night:x(s.night)}}return{plans:l,taxi:o}}function v(e,t){var n=this;var r=e.getNumRoutes(),i=e.getDistance(),s=e.getDuration(),o,u=[];for(o=0;o<r;o++){var a=e.getRoute(o);var f=b(a);u.push(f)}return{routes:u,distance:i,duration:s,distance_txt:i,duration_txt:s}}function m(e,t){var n=this;var r=e.getNumLines(),i=e.getNumRoutes(),o=e.getDistance(),u=e.getDuration(),a,f=Math.max(i,r),l=[];var c=[];for(a=0;a<f;a++){var h=e.getRoute(a);var p=e.getLine(a);var d,v;if(h){var m=p?x(p.getGetOnStop()):null;v=b.call(n,h,m);l.push(v)}if(p){d=y.call(n,p);l.push(d);c.push(g(d.name).name)}}c=c.join(s);return{routes:l,route_summary_txt:c,distance:o,distance_txt:o,duration:u,duration_txt:u}}function g(e){var t=/^([^(]+)\((.*)\)$/.exec(e);var n=t[1];var r=t[2];if(/^[^\d]*\d+$/.test(n))n=n+"路";return{name:n,ext:r}}function y(e){var t=this;var n=e.title,r=e.type,i=e.getNumViaStops(),s=x(e.getGetOnStop()),o=x(e.getGetOffStop()),u=e.getPath(),a=e.getDistance();u=u.map(function(e){return{lat:e.lat,lng:e.lng}});var f={path:u,type:E(r),name:n,num_stops:i,get_on_stop:s,get_off_stop:o,distance:a,distance_txt:p(a)};return f}function b(e,t){var n=this;var r=e.getNumSteps(),i=e.getDistance(),s=e.getPath(),o=e.getRouteType(),u,a=[],f=[];for(u=0;u<r;u++){var l=e.getStep(u);var c=w(l);a.push(c)}s=s.map(function(e){return{lat:e.lat,lng:e.lng}});var a={path:s,steps:a,distance:i,distance_txt:i,end:t&&{title:t.title},type:S(o)};return a}function w(e){var t=e.getPosition(),n=e.getIndex(),r=e.getDescription(false),i=e.getDistance();return{point:t,index:n,description:r,distance:i}}function E(e){var t;switch(e){case 0:t=o.bus;break;case 1:t=o.subway;break;case 2:t=o.ferry;break;default:console.error("type is error");break}return t}function S(e){if(e===3){return o.drive}else if(e===2){return o.walk}console.error("type is error")}function x(e){if(!e)return null;var t={};for(var n in e){if(e.hasOwnProperty(n)&&!(typeof n==="function")){t[n]=e[n]}}return t}var s="→";var o=e.____MODULES["5304114d73c733af2d632c1c6f6298ce"].R_TYPE;var u=e.____MODULES["5304114d73c733af2d632c1c6f6298ce"].Mode;var a=function(){};a.prototype.parse=d;a.prototype.parseWebRoute=function(e){var t=this;var n=e.taxi,r=e.routes||[];var r=r.map(function(e){var n=e.steps;var r=e.originLocation;var i=p(e.distance),s=h(e.duration);n=n.map(function(e){return f.call(t,e)});return{routes:n,distance:e.distance,duration:e.duration,distance_txt:i,duration_txt:s}});var i;if(n&&n.detail){i=l(n)}var s={plans:r,taxi:i};return s};a.prototype.parseWebTransit=function(e){var t=this;var n=e.routes;var r=e.taxi;n=n.map(function(e){var n=e.scheme[0];var r=n.steps,i=n.distance,s=n.duration;var o=p(i),u=h(s);r=r.map(function(e){return f.call(t,e[0])});r=[].concat.apply([],r);return{distance:i,duration:s,distance_txt:o,duration_txt:u,routes:r}});var i;if(r&&r.detail){i=l(r)}var s={plans:n,taxi:i};return s};var T=function(){function n(e){if(e.travel_mode==="TRANSIT"&&e.transit){var t=e.distance,n=e.duration,s=t.value,u=t.text,a=n.text,f=n.value;var l=e.transit,c=l.headsign,h=l.departure_stop,p=l.arrival_stop,d=i(h),v=i(p),m=l.num_stops,g=e.path.map(function(e){return{lat:e.lat(),lng:e.lng()}});return{type:o.bus,name:c,num_stops:m,get_on_stop:d,get_off_stop:v,path:g,distance:s,distance_txt:u}}else{return r(e)}}function r(e){var t=e.instructions,n=e.distance,r=e.duration,i=n.value,s=n.text,o=r.text,a=r.value,f=e.path.map(function(e){return{lat:e.lat(),lng:e.lng()}});return{distance:i,distance_txt:s,duration:a,duration_txt:o,description:t,type:u(e.travel_mode),path:f}}function i(e){return{title:e.name,point:{lat:e.location.lat(),lng:e.location.lng()},address:e.name}}function u(e){e=e.toLowerCase();if(e==="walking"){return o.walk}else{return o.drive}}var e=function(){};var t=e.prototype;t.parse=function(e,t){var i;i=t.map(function(t){var i=0,o=0;var u=t.legs;var a=[];var f=[];u.forEach(function(t){var s=t.distance,u=t.duration,l=t.start_address,c=t.address,h=t.start_location,p=t.end_location,d=t.steps,v=[],m;i+=s.value;o+=u.value;if(e==="transit"){d=d.map(function(e){var t=e.steps;if(t&&t.length){return t}return e}).expand();m=d.map(function(e){var t=n(e);v.push(t.path);if(t&&t.name)a.push(t.name);return t})}else{m=d.map(function(e){var t=r(e);v.push(t.path);return t})}f.push(m)});var l=f.expand();a=a.join(s);return{routes:l,route_summary_txt:a,distance:i,distance_txt:p(i),duration:o,duration_txt:h(o)}});return{plans:i,taxi:null}};return e}();var N=function(e){var t=e.taxi;if(t){return l(t)}return null};var C=function(e){var t=e.routes[0];var n=t.duration;var r=h(n);return r};r.exports={BdRoute:a,GGRoute:T,getTaxi:N,getDuration:C}}(n.exports,n,e);e.____MODULES["4c7e9bfea58c0a5a083700f240bbe09c"]=n.exports})(this);(function(e){var t={id:"d3bb1d851e8966f66207fd394f5b607a",filename:"Traffic.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function h(e,t,n,r,i){var s=p(e);var u=p(t);var h=d(e.lat(),e.lng(),t.lat(),t.lng());var v,m,g;if(i){v=function(e){switch(mde){case"walking":return"步行";case"transit":return"公交";case"driving":return"驾车"}}()}else{if(h<=2){i=a.Walk;v="步行"}else if(s.destName!==u.destName){i=a.Drive;v="驾车"}else{i=a.Transit;v="公交"}}var y=function(){S();r&&r()};if(s.is_abroad){var b=function(e){g=true;S();var t=(new o.GGRoute).parse(i,e);var r;if((r=t.plans)&&(r=r[0])){var a="相距"+r.distance_txt+","+v+r.duration_txt;var f={start:s,end:u,route_info:t,mode:i,distance_txt:a,unparse:false};n(f);return}y()};var w=function(e,t){S();if(t==="ZERO_RESULTS"&&i===a.Transit){i=a.Drive;v="驾车";f.search(s,u,i).then(b,w);x();return}y()};f.search(s,u,i).then(b,w)}else{var E=function(e){S();g=true;var t=(new o.BdRoute).parse(i,e);var r=t.plans;if(!r[0]){if(i===a.Transit){i=a.Drive;v="驾车";f.search(s,u,i).then(E,y);x()}else{y()}return}var c=r[0];var h="相距"+c.distance_txt+","+v+c.duration_txt;var p=function(e){var r=o.getTaxi(e);var a={start:s,end:u,route_info:t,taxi:r,mode:i,distance_txt:h,unparse:false};n(a)};l.search(s,u,a.Drive).then(p,p)};f.search(s,u,i).then(E,y)}var S=function(){if(m){clearTimeout(m);m=null}};var x=function(){S();m=setTimeout(function(){if(!g){r&&r(c.timeout)}},2e4)};x()}function p(e){var t={name:e.name(),lng:e.lng(),lat:e.lat(),type:e.type(),id:e.getId(),is_abroad:e.isAbroad(),destName:e.cityName()};return t}var i=e.____MODULES["5304114d73c733af2d632c1c6f6298ce"];var s=e.____MODULES["350def52ea851fa034c769d39147cce1"];var o=e.____MODULES["4c7e9bfea58c0a5a083700f240bbe09c"];var u=window;var a=i.Mode,f,l;var c={querying:"querying",timeout:"timeout",no_result:"no_result"};l=new s({type:"web",mode:a.Drive});f=new s({type:"js",mode:a.Transit});var d=function(){function n(t){return t*e.PI/180}function r(r,i,s,o){var u=n(s-r),a=n(o-i);r=n(r);s=n(s);var f=e.pow(e.sin(u/2),2)+e.cos(r)*e.cos(s)*e.pow(e.sin(a/2),2);var l=2*e.atan2(e.sqrt(f),e.sqrt(1-f));var c=t*l;return c}var e=window.Math;var t=6371;return r}();window.getDistance=d;n.exports={query:h}}(t.exports,t,e);e.____MODULES["d3bb1d851e8966f66207fd394f5b607a"]=t.exports})(this);(function(e){var t={id:"b1e46fbf4172c66855bcbc581fae265f",filename:"AidDayTraffic.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["350def52ea851fa034c769d39147cce1"];var s=e.____MODULES["4c7e9bfea58c0a5a083700f240bbe09c"];var o=new i({type:"js",mode:"transit"});var u=function(e,t,n,r,i,u){if(n==="transit"){var a=getDistance(e.lat,e.lng,t.lat,t.lng);if(a<=2){n="walking"}}var f=function(e){switch(e){case"walking":return"步行";case"driving":return"驾车";case"transit":return"公交"}}(n);var l=function(a){var p=(new s.GGRoute).parse(n,a);var d;if((d=p.plans)&&(d=d[0])){m=true;g();var v="相距"+d.distance_txt+","+f+d.duration_txt;var b={start:e,end:t,route_info:p,taxi:r,mode:n,distance_txt:v,unparse:false};i(b,n)}else{if(u&&n!=="driving"){n="driving";f="驾车";o.search(e,t,n).then(l,c);y()}else{h()}}};var c=function(r,i){if(i==="ZERO_RESULTS"&&u&&n!=="driving"){n="driving";f="驾车";o.search(e,t,n).then(l,gg_no_result_fn);y();return}h()};var h=function(){m=true;g();i(null,n)};var p=function(a){var l=(new s.BdRoute).parse(n,a);var c=l.plans;if(!c[0]){if(u&&n!=="driving"){n="driving";f="驾车";o.search(e,t,n).then(p,d);y()}else{h()}}else{m=true;g();var v=c[0];var b="相距"+v.distance_txt+","+f+v.duration_txt;var w={start:e,end:t,route_info:l,taxi:r,mode:n,distance_txt:b,unparse:false};i(w,n)}};var d=function(){h()};var v,m;var g=function(){if(v){clearTimeout(v);v=null}};var y=function(){g();v=setTimeout(function(){if(!m){h()}},2e4)};y();if(e.is_abroad){o.search(e,t,n).then(l,c)}else{o.search(e,t,n).then(p,d)}};n.exports={queryByMode:u}}(t.exports,t,e);e.____MODULES["b1e46fbf4172c66855bcbc581fae265f"]=t.exports})(this);(function(e){var t={id:"e244653bae83b3fdf4aed46b0a97b35c",filename:"BookDay.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["60f02d1516c54ca88306bd00b7b4d021"];var u=e.____MODULES["88d5c499e26b6f8fc86d873910ae3aea"];var a=e.____MODULES["24538986015918d4b562e397230af418"];var f=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var l=e.____MODULES["c90af09b7097baf4bdfab89cb5fed51b"];var c=e.____MODULES["b9d479a232d0298d5bf7be17b5bc0e33"];var h=e.____MODULES["83d62adfc2fbd5a9aeee9e544a2807bb"];var p=e.____MODULES["c51777e35917abcb15bcf62b870b9df9"];var d=e.____MODULES["d3bb1d851e8966f66207fd394f5b607a"];var v=e.____MODULES["b1e46fbf4172c66855bcbc581fae265f"];var m=36;var g=10;var y={3:1,24:1,22:1,23:1};var b=function(e){var t=this;t._inited=false;t._callbacks=[];b.$super.apply(t,arguments)};var w=i.mix({day_selected:"day_selected",reload_day:"reload_day"},l.prototype.Node_Event_List);var E={__event_move_node:function(e,t,n,r,i){var s=this;if(e.target.nodeType()==="BOOK_ELEMENT"&&!s._inited){e.stopPropagation();s.cmpTraffic(e.target,t,n);return}if(e.target.nodeType()==="BOOK_ELEMENT"){if(r!==s){var o=e.target,u=o.context("cityId"),a=o.context("parentId"),f=o.context("parentName"),l=o.context("cityName");var c={cityId:a||u,cityName:f||l,distType:a?7:6};if(c.cityId||c.cityName){s.addDest(c)}}else{s.trigger("move_element_in_day")}var h=e.target;if(h.getId()){s.cmpTraffic(h,t,n)}}},__event_before_move:function(e,t,n,r,i){if(e.target.nodeType()!=="BOOK_ELEMENT"){return}var s=this;if(r){r.rmTraffic(i);if(n<i){r.rmTraffic(n,"up")}else if(n>i){r.rmTraffic(n,"down")}r.loadTraffic(r.getEleByOrder(i-1),r.getEleByOrder(i+1))}},__event_node_load_id:function(e,t){var n=this;if(e.target.nodeType()==="BOOK_ELEMENT"){var r=e.target.order();n.fire("before_load_ele_traffic",e.target,t);n.cmpTraffic(e.target,n,r)}}};var S={_nodeType:"BOOK_DAY",_order_key_name:"dayOrder",_type_id:1,Node_Event_List:w,_DB_CONTEXT_FILTER:{traffics:1,day_date:1,start_time:1},isCollect:function(){return!!this._isCollect},_parseData:function(e){var t=this;e=e||{};if(typeof e.type!=="undefined"){delete e.type}var n=e.start_time,r=e.dayOrder,i=n&&f.plusDay(n,r);e.day_date=i;t.context(e);t.context("type_id",t._type_id);var s=e.bookDayCities;if(s){t.context("dest",s)}else{t.context("dest",[])}t.clearChanged()},_parseTraffic:function(e){var t={};e.forEach(function(e){var n=e.fromElementId+"_"+e.fromElementType+"_"+e.toElementId+"_"+e.toElementType;var r=e.route;t[n]={id:e.id,key:n,route:r,fromElementId:e.fromElementId,fromElementType:e.fromElementType,toElementId:e.toElementId,toElementType:e.toElementType,distance:r.distance_txt,type:r.mode}});return t},memo:function(e){var t=this;return t._val_("memo")},getDest:function(){return this.context("dest")},setDest:function(e){this.context("dest",e)},day_date:function(e){var t=this;return t._val_("day_date",e)},order:function(e){if(typeof e==="undefined"){return l.prototype.order.apply(this,arguments)}if(this.order()===e){return e}var t=this.context("start_time")&&f.plusDay(this.context("start_time"),e);this.day_date(t);return l.prototype.order.apply(this,arguments)},delDestByIndex:function(e){var t=this;var n=t.context("dest");n.splice(e,1);var r=n[e],i=n[e-1];if(r&&i&&r.cityName===i.cityName){n.splice(e,1)}t._context.setKeyChange("dest")},delDest:function(e){var t=this;var n=t.context("dest");var r;n.some(function(t,n){if(e===t.dest_id){r=n;return true}return false});if(i.type(r)!=="undefined"){n.splice(r,1);t._context.setKeyChange("dest")}},addDest:function(e){var t=this;var n=t.context("dest");if(!n.some(function(t){return t.cityId===e.cityId&&t.cityName===e.cityName})){n.push(e);t._context.setKeyChange("dest")}},userAddDest:function(e){var t=this;var n=t.context("dest");if(n.length>=g){p.showInfo("一天内最多只能添加"+g+"个城市",true);return false}var r=n[n.length-1];if(r&&r.cityId===e.cityId&&r.cityName===e.cityName&&r.distType==e.distType){return false}n.push(e);t._context.setKeyChange("dest");return true},mixDest:function(){var e=this,t=e.context("dest"),n=e._getDests(),r=t.slice(0),i;if(n.length){n.forEach(function(e){if(!t.some(function(t){return e.cityId===t.cityId&&e.cityName===t.cityName})){i=true;r.push(e)}});if(i){e.context("dest",r)}}},selected:function(){var e=this;e._inited=false;e.loadEles(function(){e.trigger(e.Node_Event_List.day_selected,e)});return},setInited:function(){this._inited=true},_getDests:function(){var e=this;var t=e.getEles();var n={};var r=[];t.forEach(function(e){var t=e.context("cityId");var i=e.context("cityName");var s;if((s=t||i)&&!n[s]){n[s]=true;r.push({cityId:t||0,cityName:i})}});return r},getDbData:function(){var e=l.prototype.getDbData.apply(this,arguments);if(e){if(e.dest){var t=e.dest;delete e.dest;e.bookDayCities=t}if(e.command===this.COMMOND_TYPES.UPDATE){var n=[];f.forEach(e,function(e,t){n.push(t)});e.keys=n}}return e},getLngLatData:function(){var e=this.children();var t=false;var n=e.map(function(e){var n,r,i=e.context("abroad");if(i){t=true}if(i){n=e.context("glng")||e.context("lng");r=e.context("glat")||e.context("lat")}else{n=e.context("blng")||e.context("lng");r=e.context("blat")||e.context("lat")}if(n&&r){return{state_marking:e.context("mark_state"),name:e.context("name"),index:e.order(),id:e.getId(),type:e.type(),lng:n,lat:r}}}).filter(function(e){return e!==void 0});return{is_abroad:t,data:n}},reload:function(e){var t=this;t._inited=false;t._children=[];t.loadEles(function(){e&&e()})},resetInit:function(){this._inited=false},cmpTraffic:function(e,t,n){var r=this;var i=t._children[n-1],s=t._children[n+1];r.loadTraffic(i,e);r.loadTraffic(e,s)},rmTraffic:function(e,t){var n=this,r=n._children,i,o,u,a,l,c,h,p,d;var v=s.type(t)==="undefined"?"all":t;if(i=r[e]){var m=n.getTraffic();h=i.getId();a=i.type();o=r[e-1];u=r[e+1];p=o?o.getId():null;d=u?u.getId():null;l=o?o.type():null;c=u?u.type():null;var g=[];var y=p+"_"+l+"_"+h+"_"+a;var b=h+"_"+a+"_"+d+"_"+c;f.forEach(m,function(e,t){if(v==="up"){if(y===t){g.push(e)}}else if(v==="down"){if(b===t){g.push(e)}}else{if(y===t||b===t){g.push(e)}}});if(g.length){var w=g.map(function(e){return e.id});n.deleteTrff(w,g)}}},loadTraffic:function(e,t){var n=this;var r=1e-6;if(e&&t&&!y[e.type()]&&!y[t.type()]&&e.hasLatLng()&&t.hasLatLng()){var i=e.getId()+"_"+e.type()+"_"+t.getId()+"_"+t.type();var s=n.getTraffic();var o;if(Math.abs(e.lng()-t.lng())<r&&Math.abs(e.lat()-t.lat())<r){n.fire("day_traffic_update",i,{status:"same"});return}if((o=s[i])&&o.route){if(typeof o.route==="string"){o.route=JSON.parse(o.route);if(o.route.route_info){n.fire("day_traffic_update",i,o);return}}}else{}d.query(e,t,function(e){delete s[i];n.saveTraffic(i,e,function(e){s[i]=e;n.fire("day_traffic_update",i,e)},function(){n.fire("day_traffic_update",i,null)})},function(){delete s[i];n.fire("day_traffic_update",i,null)})}else{if(e&&t){var i=e.getId()+"_"+e.type()+"_"+t.getId()+"_"+t.type();n.fire("day_traffic_update",i,null)}}},getTraffic:function(){var e=this;return e.context("traffics")||{}},updateTrafficByMode:function(e,t){var n=this,r=n.children(),i=n.getTraffic();var s=[];var o=e;if(e==="transit"){o="walking"}if(r.length<2){t();return}r.reduce(function(t,n){var r=t.getId()+"_"+t.type()+"_"+n.getId()+"_"+n.type();var u=i[r];if(u&&typeof u.route==="string"){u.route=JSON.parse(u.route)}if(u&&u.route&&u.route.mode!==e&&u.route.mode!==o){s.push({key:r,id:u.id,taxi:u.route.taxi,start:u.route.start,end:u.route.end})}return n});var u=s.length;if(!u){t()}else{var a=0;var f=function(e,r,i){a++;if(!r){r={mode:i}}n.updateOneRoute(e,r,function(){if(a===u){t()}})};var l=s.map(function(e){return e.id});s.forEach(function(t){v.queryByMode(t.start,t.end,e,t.taxi,function(e,n){f(t.key,e,n)})})}},updateOneRoute:function(e,t,n){var r=this;var i=r.parent().getId();var o="/travelbook/plan/"+i+"/traffic";var u=a.getItem("csrfToken");o+="?csrfToken="+u;var f,l;var c=r.getTraffic();if((f=c[e])&&(l=f.route)){if(t&&!t.route_info){t={start:l.start,end:l.end,mode:t.mode,taxi:l.taxi,route_info:null,distance_txt:""}}var h={id:f.id,route:JSON.stringify(t),source:"js",distance_txt:t.distance_txt};f.route=t;f.distance_txt=t.distance_txt;r.fire("day_traffic_update",e,f);s.ajax({url:o,data:JSON.stringify(h),contentType:"application/json",processData:false,type:"POST",dataType:"json",success:function(e){n&&n()},error:function(){n&&n()}})}else{n&&n()}},saveTraffic:function(e,t,n,r){var o=this;var u=o.getTraffic();var f=t.start,l=t.end;var c=o.parent().getId();var h="/travelbook/plan/"+c+"/traffic";var p=Math.ceil(Math.random()*1e5);var d=a.getItem("csrfToken");h+="?csrfToken="+d;var v={clientId:p,fromElementId:f.id,fromElementType:f.type,toElementId:l.id,toElementType:l.type,route:t,type:t.mode,source:"js",distance:t.distance_txt};var m=i.mix({route:JSON.stringify(t)},v);s.ajax({url:h,data:JSON.stringify(m),contentType:"application/json",processData:false,type:"POST",dataType:"json",success:function(t){if(t.errcode===0&&t.data&&t.data[p]){v.id=t.data[p];v.key=e;n&&n(v)}else{r&&r()}},error:function(){r&&r()}})},deleteTrff:function(e,t){var n=this;var r=n.parent().getId();var i="/travelbook/plan/"+r+"/traffic";var s=n.getTraffic();t.forEach(function(e){delete s[e.key]});u.ajax({url:i,type:"POST",data:{_method:"delete",ids:e.join(",")},success:function(){}})}};var x={loadEles:function(e){var t=this;if(t._inited){e&&e();return}if(t._loadding){e&&t._callbacks.push(e);return}t._loading=true;var n=function(n){t._children=[];var r=n.data.day,i;t._loading=false;var s={};if(r.traffics){s=t._parseTraffic(r.traffics)}t.context("hotelMap",n.data.hotelMap||{});t.context("sightMap",n.data.sightMap||{});t.context("traffics",s);if(i=r.elementList){i.forEach(function(e,n){var r=new c(e,t._event);r.moveTo(t,n)})}t.clearChanged();t._inited=true;var o;while(o=t._callbacks.shift()){o()}e&&e()};var r=t.context("id");var i=t.parent().context("id");u.get("/travelbook/plan/"+i+"/"+r,n)},getEles:function(){var e=this;return e.children()},getEleByOrder:function(e){return this.children()[e]},getEleById:function(e){return this.children().filter(function(t,n){return t.getId()===e})[0]},getOrderById:function(e){var t=this.getEleById(e);return t&&t.order()},_checkMove:function(e){return h.success()},addElement:function(e){var t=this;var n=t.len(),r=e.order==null?n:e.order;if(n>=m){p.showInfo("添加的行程地点已超过最大限制，请调整后在继续",true);return}var i=new c(e);var s=i.moveTo(t,r);if(s===true){this.trigger("add_element",i,r)}},parseToElement:function(e){return new c(e)},rmElement:function(e){var t=this;var n=e.order();var r=e.getId();t.rmCell(e);t.trigger("rm_element",n,r)},addCell:function(){var e=this;b.$super.prototype.addCell.apply(e,arguments)},rmCell:function(){var e=this;b.$super.prototype.rmCell.apply(e,arguments)},remove:function(){var e=this;e.trigger("day_self_rm");b.$super.prototype.remove.apply(e,arguments)}};i.extend(b,l,i.mix({},E,S,x));n.exports=b}(t.exports,t,e);e.____MODULES["e244653bae83b3fdf4aed46b0a97b35c"]=t.exports})(this);(function(e){var t={id:"c40a12a69af5784a5522d77d468cee9c",filename:"BookBase.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var o=e.____MODULES["c90af09b7097baf4bdfab89cb5fed51b"];var u=e.____MODULES["e244653bae83b3fdf4aed46b0a97b35c"];var a=e.____MODULES["e48a74a252a520897453ae043780aecd"];var f=e.____MODULES["83d62adfc2fbd5a9aeee9e544a2807bb"];var l=e.____MODULES["72ccee1acde6f77563f5f551b427b29d"];var c=[].slice;var h=function(e,t){var n=this;n._event=t;n._select_day=null;h.$super.apply(n,arguments)};var p=i.mix({day_add_dest:"day_add_dest",day_del_dest:"day_del_dest",day_selected:"day_selected",reload_day:"reload_day"},o.prototype.Node_Event_List);var d={__event_move_node:function(e,t,n,r,i){var s=this;if(s._move_event_stop){e.stopPropagation()}var o=e.target;s._event.trigger("move_node",o,t,n,r,i)},__event_rm_node:function(e){var t=this;t._event.trigger("rm_node",e.target)},__event_day_selected:function(e,t){var n=this;n._event.trigger("day_selected",t)},__event_reload_day:function(e,t){var n=this;n._event.trigger("reload_day",t)}};var v={_nodeType:"BOOK_BASE",Node_Event_List:p,_type_id:0,_DB_CONTEXT_FILTER:{day_count:1},title:function(e){var t=this;return t._val_("title",e)},startTime:function(e){var t=this;t.updateDaysVal("start_time",e);return t._val_("startTime",e)},updateDaysVal:function(e,t){var n=this.children()||[];n.forEach(function(n,r){n.context(e,t)})},_parseData:function(e){var t=e.startTime;e.startTime=t?new Date(t):null;this.context(e);this._initDays(e);this.clearChanged()},_initDays:function(e){var t=this,n=(e.travelBookDayList||[]).filter(function(e){return e.dayType===0});if(n.length){n.forEach(i.proxy(t._moveDay,t))}else{}},_moveDay:function(e,t,n){var r=this;var n=n===false?false:true;var i=r.startTime();e.start_time=i;var s=new u(e);s.moveTo(r,t,n);return s},bindNodeEvent:function(){var e=this;e._context.on("set_startTime",function(t){e.children().forEach(function(e){var n=s.plusDay(t,e.order());e.context("day_date",n)})});o.prototype.bindNodeEvent.call(e)},proxyEvents:function(){var e=this,t=e._event;var n=e.EventList;for(var r in n){e.bind(r,function(){var e=c.call(arguments,0);t.trigger.apply(t,[r].concat(e))})}},getDbChangeData:function(){var e=this,t=e._DB_CONTEXT_FILTER,n=e._context.changed();if(n){for(var r in t){delete n[r]}n.startTime=s.format(e.startTime(),"yyyy-MM-dd");n.title=e.title();n.command=e.COMMOND_TYPES.UPDATE;n.type_id=e._type_id}return n},reloadDays:function(e,t,n){var r=this;r._setMoveStop(true);var i,s;i=r.getDayById(t);s=i.order();s+=1;for(var o=0;o<e.length;o++){var u=e[o];var a=r.getDayById(u.id);a&&a.context({dayOrder:o})}while((t=(e[s]||{}).id)&&!(i=r.getDayById(t))){var f=e[s];if(f.dayType===0){var l=r._moveDay(f,s,false);r.fire("add_day",l,s)}s+=1}if(n&&n.length){n.forEach(function(e){var t=r.getDayById(e);if(t){t.resetInit()}})}r._setMoveStop(false)},_setMoveStop:function(e){this._move_event_stop=e}};var m={_checkMove:function(){return f.success()},getDays:function(){var e=this;return e.children().filter(function(e){return!e.isCollect()})},createDay:function(e){var t=this;var n=t.getDayByOrder(e-1);var r={start_time:t.startTime(),dayOrder:e};var i;if(n){var s=n.context("dest");i=s[s.length-1]}else if(n=t.getDayByOrder(e)){var s=n.context("dest");i=s[0]}r.bookDayCities=i?[i]:null;var o=new u(r,t._event);o.setInited();o.moveTo(t,e);t.fire("add_day",o,e);return o},rmDay:function(e){var t=this;t.fire("rm_day",e);t.rmCell(e)},removeDay:function(){},hasDayByOrder:function(e){var t=this;var n=t.children();return n.length>e},getDayByOrder:function(e){var t=this;var n=t.children();if(t.hasDayByOrder(e)){return n[e]}else{return null}},getDayById:function(e){var t=this;return t.children().filter(function(t){return t.getId()===e})[0]},getDayByDate:function(e){var t=this;return t.children().filter(function(t){return s.format(t.context("day_date"))===e})[0]},selectDay:function(e){var t=this,n=t.getDayByOrder(e);t._select_day=n;n.selected()},getSelectDay:function(){return this._select_day},isSelectDay:function(e){return this._select_day===e},rmCell:function(e){o.prototype.rmCell.apply(this,arguments);this.context("day_count",this.len())},addCell:function(e,t){o.prototype.addCell.apply(this,arguments);this.context("day_count",this.len())}};var g={deepFindById:function(e){var t=this;return t.flattenChildren().filter(function(t){t.id()===e})[0]}};i.extend(h,o,i.mix({},v,m,d));n.exports=h}(t.exports,t,e);e.____MODULES["c40a12a69af5784a5522d77d468cee9c"]=t.exports})(this);(function(e){var t={id:"1078e55f46c9b52af96debc4b8f2be22",filename:"box.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=function(e){var t=this;t._box=e.box;t._model=e.model;t._observer=e.observer;t._init(e)};s.prototype={constructor:s,_init:function(e){this.listen();this.onModelEvent()},getDom:function(){return this._box},onModelEvent:function(){var e=this;e._change_fn=i.proxy(e.modelChange,e);e._model.on("changed",e._change_fn)},unModelEvent:function(){var e=this;if(e._model.isDestroy()){e._model=null;e._change_fn=null;return}if(e._change_fn){e._model.unbind("changed",e._change_fn)}},listen:function(){},modelChange:function(e,t){},box:function(){return this._box},remove:function(){var e=this;e.unModelEvent();e._box.remove();for(var t in e){delete e[t]}},model:function(){return this._model}};n.exports=s}(t.exports,t,e);e.____MODULES["1078e55f46c9b52af96debc4b8f2be22"]=t.exports})(this);(function(e){var t={id:"f2f15a51d66bfd2af2213994bf6d509b",filename:"drag_proxy.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=[].slice,o=function(){};var u=i(document);var a=i("body");var f=function(e){function y(t){var n=null;var o=false;if(i.type(r)==="function"){n=r(t)}else if(r instanceof i){n=r}else{n=i(r)}var u=function(){o=true;f.apply(null,[t,n].concat(s.call(arguments,0)));n.css("visibility","")};n.dragable({container:e.container||i("body"),drag_start:function(e){},move:function(e,t,r,i,s){if(!o){h();u()}l(n,t)},drag_end:function(e,t){p();c(n,t);n.undragable();n.remove();n=null}});i("body").append(n.css("visibility","hidden"));var a=n.data("__drag__");a.dragStart(t)}var t=this;this.opts=e;var n="drag";var r=e.html;var a=e.drag_able_dom;var f=e.drag_start||o;var l=e.move||o;var c=e.drag_end||o;var d=false;var v;var m=function(e){var t={pageX:e.pageX,pageY:e.pageY,button:e.button};y(t);u.unbind("mousemove",m)};a.bind("mousedown."+n,function(t){if(e.stop_event){t.stopPropagation()}if(t.button===2){return}u.one("mousemove",m)});a.on("mouseup",function(){u.unbind("mousemove",m)});t.undrag=function(){a.unbind("mousedown."+n);a.unbind("click."+n);a.unbind("mouseup."+n);for(var e in t){delete t[e]}};var g=300};var l=function(){var e=this;var t={};var n=[];e.drag_targets=n;e.add=function(e){n.push(e)};e.remove=function(e){return n.remove(e)};e.indexOf=function(e){return n.indexOf(e)};e.method=function(e){if(n[e]){return n[e].apply(n,s.call(arguments,1))}};e.locate=function(e,t){var r=e.width,i=e.height,s=e.left,o=e.top,u=s+r,a=o+i,f=s+r/2,l=o+i/2;var c=null,h=null;n.forEach(function(e,n){var r=e.dom();var i=r.offset(),s=r.width(),o=r.height();if(i.top+o>l&&i.top<l&&i.left+s>f&&i.left<f){c=e;h=n}t&&t(e,n)});if(c){return{index:h,target:c}}return null}};var c=function(e){var t=e.target;if(!t.nodeName.toLowerCase().match(/input|textarea/)){return false}};var h=function(){a.addClass("unselect").attr("unselectable","on").on("selectstart",c)};var p=function(){a.removeClass("unselect").removeAttr("unselectable").unbind("selectstart",c)};n.exports=f}(t.exports,t,e);e.____MODULES["f2f15a51d66bfd2af2213994bf6d509b"]=t.exports})(this);(function(e){var t={id:"83d6887f608130b3ab1de57c7928c8e0",filename:"qdatepicker.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){(function(e){function u(e,t){e=e==null?"":e+"";for(var n=0,r=t-e.length;n<r;n++)e="0"+e;return e}function f(e){var t=e.split("-");return new Date(t[0],t[1]-1,t[2])}function l(e){var t={};for(var n in e){var r=n;var s=e[n];t[n]=s;var o="";var u="";if(s.beforeTime>0){for(var a=1;a<=s.beforeTime;a++){var l={};var h=new Date(f(r).getTime()-a*24*3600*1e3);var p=c(h);l.holidayName=s.holidayName+i.before+a+i.day;l.dayindex=s.dayindex;if(!t[p]){t[p]=l}else{if(s.dayindex>t[p].dayindex&&t[p].beforeTime==null){t[p]=l}}}}if(s.afterTime>0){for(var a=1;a<=s.afterTime;a++){var l={};var d=new Date(f(r).getTime()+a*24*3600*1e3);var v=c(d);l.holidayName=s.holidayName+i.after+a+i.day;l.dayindex=s.dayindex;if(!t[v]){t[v]=l}else{if(s.dayindex>t[v].dayindex&&t[c(new Date(h))].afterTime==null){t[v]=l}}}}}return t}function c(e){if(typeof e=="number"){e=new Date(e)}return e.getFullYear()+"-"+h(e.getMonth()+1)+"-"+h(e.getDate())}function h(e){return e<10?"0"+e:e}function p(e){e.setHours(0);e.setMinutes(0);e.setSeconds(0);e.setMilliseconds(0);return e}function d(e){var t=e.offset();t["top"]+=e.outerHeight();return t}function v(n){var r;if(n&&!n.nodeType)r=jQuery.event.fix(n||window.event).target;else r=n;if(!r)return null;var i=e(r).parents("."+t);return i.size()>0?i.eq(0).data(t):null}function m(){}function g(e,t){if(!this.init)return new g(e,t);else return this.init(e,t)}e.qdatepicker={};var t=e.qdatepicker.ROOT_KEY="q-datepicker";var n;var r=0;HolidayData={};var i={week:"周",day:"天",before:"前",after:"后"};var s={LANG:{prev:"",next:"",day_names:["日","一","二","三","四","五","六"],OUT_OF_RANGE:"超出范围",ERR_FORMAT:"格式错误"},CLASS:{group:"g",header:"h",calendar:"c",next:"n",prev:"p",title:"t",week:"w",month:"cm_",day_default:"st",day_selected:"st-a",day_othermonth:"st-s",day_today:"st-t",day_hover:"st-h",day_disabled:"st-d",day_round:"st-a-r"},WEEKDAYS:7,STARTDAY:1,showOtherMonths:false,defaultDay:"",customClass:"",customActiveClass:"",multi:2,showTip:true,linkTo:null,linkRules:"",refObj:null,forceCorrect:true,formatTitle:function(e){return e.getFullYear()+"年"+(e.getMonth()+1)+"月"},showOnInit:false,showOnFocus:false,container:null,minDate:null,maxDate:null,ui:null,parseDate:function(e){var t=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);return t?new Date(t[1],t[2]*1-1,t[3]):null},formatDate:function(e){return e.getFullYear()+"-"+u(e.getMonth()+1,2)+"-"+u(e.getDate(),2)}};var o=function(){var t=this;for(var n=0,r=arguments.length;n<r;n++)e.each(arguments[n],function(e,n){var r;if(t.prototype[e]&&jQuery.isFunction(t.prototype[e]))r=t.prototype[e];t.prototype[e]=n;if(r)t.prototype[e]["_PARENT_"]=r});if(!t.prototype["parent"])t.prototype["parent"]=function(){return arguments.callee.caller["_PARENT_"].apply(this,arguments)}};var a=l(HolidayData);m.implement=o;e.extend(m.prototype,{isUI:1,init:function(){var t=this,n=this.picker,r=n.ns;t.attachedEl=t.attachedEl||new e;if(!n.args.dotAutoHide)e(document).bind("mouseup."+r,function(e){var r;if(n.activeEl[0]===e.target&&(r=1)||t.attachedEl.index(e.target)!=-1&&(r=2)){if(!n.visible()){n.show(t.getDate())}else{n.hide()}if(r==2)n.activeEl.focus();return}var i;if((i=v(e))&&i.key===n.key)return;else n.hide()});var i=function(){if(!n.get("container"))n.getContainer().css(d(n.activeEl))};e(window).bind("load."+r+" resize."+r,i);if(!n.args.dotAutoHide)n.activeEl.bind("focus."+r,function(e){if(n.get("showOnFocus"))n.show(t.getDate())});if(!n.args.dotAutoHide)n.activeEl.bind("keydown."+r,function(e){switch(e.keyCode){case 9:case 27:n.hide();break;default:t.onKeyDown(e)}})},_init:function(e){this.picker=e},select:function(e){this.picker.activeEl.val(this.picker.args.formatDate(e))},change:function(e,t,n){this.draw(t)},draw:function(t,n){this.drawDate=t;p(t);var r=this.picker,n=e.extend({},r.args,n||{}),i=n.multi,s=n["CLASS"];n.activeDate=n.activeDate||n.parseDate(r.activeEl.val());var o=[];n["count"]=i;var u=new Date(t.getTime());u.setDate(1);o.push('<div class="'+s["group"]+" "+s["group"]+i+'">');for(var a=0;a<i;a++){o.push('<div class="'+s["calendar"]+" ",s["month"],u.getMonth()+1,'">');n["index"]=a;o.push(this._drawTitle(u,n));o.push(this._drawBody(u,n));o.push("</div>");u.setMonth(u.getMonth()+1)}o.push("</div>");e(o.join("")).appendTo(r.getContainer().empty())},dispose:function(){var t="."+this.picker.ns;e(document).unbind(t);e(window).unbind(t)},getDate:function(){var e=this.picker.get("parseDate")(this.picker.activeEl.val());return e!=e?null:e},setDate:function(e){this.picker.activeEl.val(this.picker.get("formatDate")(e))},onBeforeDraw:function(e){var t=function(e,t){if(e.getFullYear()>t.getFullYear())return 1;else if(e.getFullYear()===t.getFullYear())return(e.getMonth()-t.getMonth())/(Math.abs(e.getMonth()-t.getMonth())||1);else return-1};if(this.selectedDate&&this.drawDate)e.setTime(this.drawDate.getTime());else{var n=this.picker,r=n.get("minDate"),i=n.get("maxDate"),s=n.get("multi");var o=new Date(e.getFullYear(),e.getMonth()+s-1,1);if(i&&t(o,i)>0)for(var u=1;i&&s&&s>1&&s-u>0;u++){o=new Date(e.getFullYear(),e.getMonth()+s-u-1,1);if(t(o,i)<=0){o.setMonth(o.getMonth()-s+1);break}}else o=null;if(o&&(!r||o.getTime()>=r.getTime()))e.setTime(o.getTime())}},onKeyDown:function(e){},onSet:function(){this.selectedDate=null},_drawTitle:function(e,t){var n=t["LANG"],r=t["CLASS"];var i=[];var s=t.minDate,o=t.maxDate;var u=t["index"]===0;var a=t["count"]===t["index"]+1;i.push('<div class="'+r["header"]+'">');i.push('<span href="#" class="'+r["next"]+'"',(!o||o.getFullYear()>e.getFullYear()||o.getFullYear()===e.getFullYear()&&o.getMonth()>e.getMonth())&&a?"":' style="display:none;"'," onclick=\"QDP.change( event , '+1M' );return false;\">",n["next"],"</span>");i.push('<span href="#" class="'+r["prev"]+'"',(!s||s.getFullYear()<e.getFullYear()||s.getFullYear()===e.getFullYear()&&s.getMonth()<e.getMonth())&&u?"":' style="display:none;"'," onclick=\"QDP.change( event , '-1M' );return false;\">",n["prev"],"</span>");i.push('<div class="'+r["title"]+'">',t.formatTitle(e),"</div>");i.push("</div>");return i.join("")},_drawBody:function(t,n){var r=n["STARTDAY"],i=n["WEEKDAYS"];var s=n["LANG"],o=n["CLASS"];var u=n.activeDate;var a=n.minDate,f=n.maxDate;if(u&&u!=u)u=null;var l=new Date;var c=["<table>","<thead>","<tr>"];for(var h=0;h<i;h++){var p=(r+h)%i;c.push('<th class="'+o["week"]+p+'">',s["day_names"][p]||"","</th>")}c.push("</tr>","</thead>");c.push("<tbody>");var d=[];var v=t.getFullYear(),m=t.getMonth()+1;var g=new Date(v,m-1,1);var y=1,b=(new Date(v,m,0)).getDate();var w=g.getDay()-r;while(w<0)w+=i;var E=y-w;var S=i-((1-E+b)%i||i)+b;for(var h=E,x=0;h<=S;h++,x++){var T=new Date(v,m-1,h);if(x%i==0)d.push("</tr>","<tr>");var p=(r+x)%i;d.push('<td class="'+o["week"]+p+" "+o["day_default"]);var N=false;if(e.grep(["getFullYear","getMonth","getDate"],function(e){return T[e]()==l[e]()}).length==3)d.push(" "+o["day_today"]);if(u!=null&&u.getTime()==T.getTime())d.push(" "+o["day_selected"]);var C=false;if(h<1||h>b){d.push(" "+o["day_othermonth"]);C=true;N=true}if(a&&T.getTime()<a.getTime()||f&&T.getTime()>f.getTime()){if(!C){d.push(" "+o["day_disabled"])}N=true}var k=this._getDateClass(T);if(k&&!C)d.push(" "+k);d.push('"');if(!N){d.push(" onmouseover=\"jQuery(this).addClass('",o["day_hover"],"');\" onmouseout=\"jQuery(this).removeClass(' ",o["day_hover"]," ');\"");d.push(' onclick="QDP.select(event,new Date('+T.getFullYear()+","+T.getMonth()+","+T.getDate()+"));",'return false;"')}d.push(">");if(!C||n.showOtherMonths){d.push("<span>");d.push(T.getDate());d.push("</span>")}else{d.push("&nbsp;")}d.push("</td>")}c.push(d.length>0?d.slice(1,-1).join(""):"");c.push("</tbody>","</table>");return c.join("")},_getDateClass:function(t){var n=this.picker.args.formatDate(t);var r="";if(this.picker.get("linkTo")){if(linkedQDP=this.picker.get("linkTo").data(e.qdatepicker.ROOT_KEY)){if(typeof linkedQDP.activeEl.val()!="undefined"&&n==linkedQDP.activeEl.val()){r=this.addRoundClass("BACK")}}}else if(this.picker.get("refObj")){if(typeof this.picker.activeEl.val()!="undefined"&&n==this.picker.activeEl.val()){r=this.addRoundClass("BACK")}if(refQDP=this.picker.get("refObj").data(e.qdatepicker.ROOT_KEY)){if(typeof refQDP.activeEl.val()!="undefined"&&n==refQDP.activeEl.val()){r=this.addRoundClass("FROM")}}}if(HolidayData[n])r+=" "+"holi";return e.trim(r)}});window.QDP={};e.each(["select","change","_trigger"],function(e,t){window.QDP[t]=function(){if(!arguments[0])return;var e=v(arguments[0]);if(e&&e[t])return e[t].apply(e,Array.prototype.slice.call(arguments,1))}});e.extend(g.prototype,{init:function(n,i){i=i||{};if(i["ui"]){if(i["ui"]["isUI"])this.ui=i["ui"];else if(typeof i["ui"]=="string"&&e.qdatepicker.uis[i["ui"]])this.ui=new e.qdatepicker.uis[i["ui"]]}if(!this.ui)this.ui=new m;this.ui._init(this);i=this.args=e.extend(true,{},s,i||{});this.key=++r;var o=this.ns=t+this.key;var u=this.activeEl=e(n);this.el=e('<div class="'+t+(i.customClass?" "+i.customClass:"")+'"></div>').appendTo(this.args["container"]||document.body).hide();e(this.el).data(t,this);this.ui.init();this.lastShowedDate=null;this.showedDate=null;if(i["showOnInit"])this.show();e.each(i["on"]||{},function(e,t){u.bind(e+"."+o,t)});return this},_trigger:function(){this.activeEl.triggerHandler.apply(this.activeEl,arguments)},select:function(e){this.ui.select(e);this.hide();this._trigger("q-datepicker-select",[e])},set:function(e,t,n){if(!this.ui.onSet||this.ui.onSet(e,t,n)===false)return;if(typeof e==="string"){var r=false;switch(e){case"container":this.el.appendTo(t||document.body);this.el.css({top:"",left:""});break}for(var i=0,s=e.split("."),o=s.length,u=this.args;i<o&&(i!==o-1&&(u[s[i]]||(u[s[i]]={}))||(u[s[i]]=t));u=u[s[i]],i++){}}if(n&&this.visible()){this._show(this.showedDate)}},get:function(e){for(var t=0,n=this.args,r=e.split("."),i=r.length;t<i&&(n=n[r[t]]);t++){}return n},change:function(e){var t=typeof e==="string"?n(e,this.showedDate):e;var r=this.showedDate;this.lastShowedDate=this.showedDate;this.showedDate=t;this.ui.change(r,t,e);this._trigger("q-datepicker-change",[r,t,e])},show:function(e){var t,n=this.get("minDate"),r=this.get("maxDate");if(!e)t=new Date;else t=e;if(n&&t.getTime()<n.getTime())t.setTime(n.getTime());else if(r&&t.getTime()>r.getTime())t.setTime(r.getTime());this.ui.onBeforeDraw(t);this._show.call(this,t);this._trigger("q-datepicker-show",[e])},_show:function(e){this.lastShowedDate=this.showedDate;this.showedDate=e;if(this.ui.draw(e)!==false);this.el.show()},hide:function(){if(this.visible()){this.el.hide();this._trigger("q-datepicker-hide")}},dispose:function(){this.ui.dispose();this.el.remove();this.activeEl.unbind("."+this.ns);this._trigger("q-datepicker-dispose")},visible:function(){return this.el.css("display")!=="none"},getContainer:function(){return this.el}});var y={"+M":function(e,t){var n=e.getDate();e.setMonth(e.getMonth()+t);if(e.getDate()!==n)e.setDate(0)},"-M":function(e,t){var n=e.getDate();e.setMonth(e.getMonth()-t);if(e.getDate()!==n){e.setDate(0)}},"+D":function(e,t){e.setDate(e.getDate()+t)},"-D":function(e,t){e.setDate(e.getDate()-t)},"+Y":function(e,t){e.setFullYear(e.getFullYear()+t)},"-Y":function(e,t){e.setFullYear(e.getFullYear()-t)}};e.extend(e.qdatepicker,{uis:[],createUI:function(t,n){var r=n&&e.qdatepicker.uis[n]?e.qdatepicker.uis[n]:m;var i=function(){};e.extend(i,r);e.extend(i.prototype={},r.prototype);if(t){e.qdatepicker.uis[t]=i;i.prototype.name=t}return i},calcTime:function(e,t){e=(e||"").toString();var n;if(t)n=new Date(t.getTime());else{n=new Date;var r=e.match(/^\d+/);if(r)n.setTime(r[0]*1)}var i=/([+-])(\d+)([MDY])/g,s;while(s=i.exec(e)){var o=s[1]+s[3];if(y[o])y[o](n,s[2]*1)}return n}});e.qdatepicker.createUI("qunar").implement({init:function(){this.parent.apply(this,arguments);var e=this,t=this.picker;var n=t.get("customActiveClass");var r=this.triggerEl=t.activeEl.wrap('<div class="qunar-dp'+(n?" "+n:"")+'"></div>').before('<div class="dp-info"><b/><span class="dp-text"></span></div>').parent();if(!t.args.container)t.set("container",r[0]);this.attachedEl=this.attachedEl.add(r.find(".dp-info > b , .dp-info")).add(r.find(".dp-info > b , .dp-info > .dp-text "));t.activeEl.attr("maxlength",10);t.activeEl.addClass("textbox");t.activeEl.bind("keyup."+t.ns,function(t){e.updateTip(e.validate.call(e))}).bind("hlur."+t.ns,function(t){e.autoCheck.call(e)});if(t.get("defaultDay")!=null)this.setDate(this.getDefaultDate());this.updateTip(this.validate());this.selectedDate=null;this.checkLinked();this.forIframe(t)},forIframe:function(t){e(window).bind("blur."+t.ns,function(){t.hide()})},getDefaultDate:function(){var e=this.picker;var t=n("",e.get("defaultDay"));var r=e.get("minDate"),i=e.get("maxDate");if(r&&r.getTime()>t.getTime()||i&&i.getTime()<t.getTime())t=r||i;return t},checkLinked:function(){var t=this.picker,r;if(!t.get("linkTo")||!(r=t.get("linkTo").data(e.qdatepicker.ROOT_KEY))||r.ui.name.indexOf("qunar")!==0)return;var i=(t.get("linkRules")||"").split(",");var s=this.getDate();if(s==null)return;var o={};e.each(["ds","mind","maxd"],function(e,t){if(i[e])o[t]=n(i[e],s)});var u=r.get("strictMinDate"),a=r.get("strictMaxDate");if(o["mind"]||u){var f=(o["mind"]?o["mind"].getTime():-1)>(u?u.getTime():-1)?o["mind"]:u;r.set("minDate",f,false)}if(o["maxd"]||a){var f=(o["maxd"]?o["maxd"].getTime():Number.MAX_VALUE)>(a?a.getTime():Number.MAX_VALUE)?a:o["maxd"];r.set("maxDate",f,false)}r.set(null,null,true);var l=r.ui.validate();if(!l["success"]&&t.get("forceCorrect")){r.select(o["ds"]);r.ui.drawDate=null;l=r.ui.validate()}r.ui.updateTip(l);var c="Y";return c},select:function(e,t){var n=this.picker;this.parent.apply(this,arguments);this.selectedDate=e;if(!t)this.autoCheck()},showText:function(e){var t=this.triggerEl.find(".dp-text");t.removeClass("errtext").html(e)},showErrText:function(e){var t=this.triggerEl.find(".dp-text");t.addClass("errtext").html(e)},autoCheck:function(){var e=this.picker;var t=this.validate();if(!t["success"]&&e.get("forceCorrect")){}else{if(t["formatted"])e.activeEl.val(t["formatted"]);this.updateTip(t)}this.checkLinked()},updateTip:function(e){if(!this.picker.get("showTip"))return;if(!e.success)this.showErrText(e.errmsg);else this.showText(e.daytip)},validate:function(){var e=this.picker;var t=this.picker.activeEl.val();var n=this.getDate();var r=this;if(this.selectedDate&&n&&this.selectedDate.getTime()!=n.getTime())this.selectedDate=null;var i="";if(n==null){i=e.get("LANG.ERR_FORMAT");e._trigger("q-datepicker-error",["FORMAT",t])}else{var s=e.get("minDate"),o=e.get("maxDate");if(s&&s.getTime()>n.getTime()||o&&o.getTime()<n.getTime()){i=e.get("LANG.OUT_OF_RANGE");e._trigger("q-datepicker-error",["RANGE",t])}}var u={success:!i,errmsg:i,formatted:null,daytip:null};if(u["success"]){var f=e.get("formatDate")(n);u["daytip"]=a[f]?a[f]["holidayName"]:"周"+e.get("LANG.day_names")[n.getDay()];u["formatted"]=f}return u},addRoundClass:function(e){if(e=="FROM")return this.picker.get("CLASS")["day_selected"];else if(e=="BACK")return this.picker.get("CLASS")["day_round"]}});e.fn.qdatepicker=function(){if(this[0]){if(arguments[0]==="__get__")return this.data(t);if(arguments.length>1&&this.data(t)){var e=this.data(t);if(arguments[0]==="option"||arguments[0]==="setting"){return arguments.length>2?e.set(arguments[1],arguments[2]):e.get(arguments[1])}}else if(arguments.length<=1){if(this.data(t)){this.data(t).dispose();this.removeData(t)}var n=new g(this[0],arguments[0]);this.data(t,n);this.attr("readonly","readonly")}}return this};n=e.qdatepicker.calcTime})(jQuery)}(t.exports,t,e);e.____MODULES["83d6887f608130b3ab1de57c7928c8e0"]=t.exports})(this);(function(e){var t={id:"984f35e17703f305d346e3b2e2435fe0",filename:"sch_item.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["sch_item"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="d_info">');r.b("\n"+n);r.b('    <div class="icon">D');r.b(r.v(r.f("day_text",e,t,0)));r.b("</div>");r.b("\n"+n);r.b('    <div class="d_text">');r.b("\n"+n);r.b('        <div class="city_info">');r.b("\n"+n);r.b("            ");r.b(r.t(r.f("city_info",e,t,0)));r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b('        <div class="date_info">');r.b("\n"+n);r.b('            <span class="txt">');r.b("\n"+n);r.b("                ");r.b(r.v(r.f("date",e,t,0)));r.b("&nbsp; ");r.b(r.v(r.f("week",e,t,0)));r.b("\n"+n);r.b("            </span> ");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b('    <div class="del_icon"></div>');r.b("\n"+n);r.b("</div> ");r.b("\n"+n);r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["sch_item"]}(t.exports,t,e);e.____MODULES["984f35e17703f305d346e3b2e2435fe0"]=t.exports})(this);(function(e){var t={id:"3c97410a2949497158f7b640acdf9660",filename:"sch_tree.mod.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){e.____MODULES["984f35e17703f305d346e3b2e2435fe0"];var i=window.QTMPL;n.exports={sch_item:i.sch_item}}(t.exports,t,e);e.____MODULES["3c97410a2949497158f7b640acdf9660"]=t.exports})(this);(function(e){var t={id:"48a6bc89d864a7b0fd198921504df48e",filename:"confirm.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s;var o=i("body");var u={top:"50%",left:"50%","margin-top":"-42px","margin-left":"-86px"};var a=0;var f=function(e,t,n,r){var f="confirm_"+a++;if(s){s.remove()}var l=i('<div class="del_confirm_dlg" style="display:none;"><div class="del_confirm_inner">        <p class="cf_content"><em class="cf_icon"></em><span class="cf_msg">'+e+'</span></p>        <div class="buttons"><a href="javascript:;" class="cancel">取消</a><a href="javascript:;" class="confirm">确定</a></div>        </div></div>');if(i.type(n)==="object"){r=n;n=null}r=r||u;l.css(r);var c=function(){o.unbind("mousedown."+f);n&&n(l);l.remove();t=null;if(s===l){s=null}};l.bind("mousedown",function(e){e.stopPropagation()});l.find(".confirm").click(function(){t();l.remove();if(s===l){s=null}});l.find(".cancel").click(c);s=l;o.append(l);o.bind("mousedown."+f,function(){c()});l.show();return l};n.exports={confirm:f}}(t.exports,t,e);e.____MODULES["48a6bc89d864a7b0fd198921504df48e"]=t.exports})(this);(function(e){var t={id:"297b5fec00bd70dc90c65ed5ff040800",filename:"SchDay.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var o=e.____MODULES["3c97410a2949497158f7b640acdf9660"];var u=e.____MODULES["1078e55f46c9b52af96debc4b8f2be22"];var a=e.____MODULES["48a6bc89d864a7b0fd198921504df48e"];var f=o.sch_item;var l=function(e){var t=this;var n=i('<div class="node_box day_info"></div>');u.call(t,QNR.mix({box:n},e))};var c={parse:function(e,t){var n=this;var r=e.dayOrder,i=e.dest,o,u;if(i.length){u=i.map(function(e){return'<em class="city" data-id="'+e.cityId+'" data-type="'+e.distType+'">'+QNR.HTMLEncode(e.cityName)+"</em>"}).join("<span class='r_arrow'></span>")}else{u='<em class="city">暂未安排</em>'}o=e.day_date;return{day_text:r+1,city_info:u,date:o&&s.format(o,"MM月dd日"),week:o&&s.getWeekDay(o),showDateInfo:o?true:false}},_init:function(e){var t=this,n=t._box,r=f.render(t.parse(t._model.contextAll(),e.start_time));n.html(r);t._order_dom=n.find(".icon");t._date_dom=n.find(".date_info .txt");t._city_dom=n.find(".city_info");u.prototype._init.call(this,e)},listen:function(){var e=this;e._box.mouseenter(function(t){e._box.addClass("day_info_hover")}).mouseleave(function(t){e._box.removeClass("day_info_hover")}).click(function(t){var n;if(t.target.className.indexOf("city")>-1&&(n=t.target.getAttribute("data-id"))&&(ty=t.target.getAttribute("data-type"))){var r={cityId:n,cityName:t.target.textContent||t.target.innerText,distType:ty};QNR.PubSub.fire("show_dest",r);if(e.model()!==e.model().parent().getSelectDay()){e._observer.fire("view_day_selected",e.model().order())}return}e._observer.fire("view_day_selected",e.model().order())});e._box.find(".del_icon").click(function(t){t.stopPropagation();var n=i(this).offset();n.left=n.left-60;n.top=n.top-20;a.confirm("确认要删除吗?",function(){e._observer.fire("view_rm_day",e.model())},n)}).mousedown(function(e){e.stopPropagation()})},modelChange:function(e,t){var n=this;if(e==="dest"){n.updateDest(t)}else if(e==="dayOrder"){n.updateOrder(t)}else if(e==="day_date"){n.updateDate(t)}},updateOrder:function(e){e+=1;this._order_dom.html("D"+e)},updateDest:function(e){var t=this,n;if(e.length){n=e.map(function(e){if(e.cityName){return'<em class="city" data-id="'+e.cityId+'" data-beacon="'+e.distType+'" >'+e.cityName+"</em>"}}).filter(function(e){return e!==void 0}).join("<span class='r_arrow'></span>")}else{n='<em class="city">暂未安排</em>'}t._city_dom.html(n)},updateDate:function(e){this._date_dom.html(s.format(e,"MM月dd日")+"&nbsp;"+s.getWeekDay(e))},select:function(){this._box.addClass("day_info_selected")},unselect:function(){this._box.removeClass("day_info_selected")},setDragProxy:function(e){this._drag_proxy=e},remove:function(){if(this._drag_proxy){this._drag_proxy.undrag()}u.prototype.remove.apply(this,arguments)}};QNR.extend(l,u,c);n.exports=l}(t.exports,t,e);e.____MODULES["297b5fec00bd70dc90c65ed5ff040800"]=t.exports})(this);(function(e){var t={id:"11196581d12c301d7679eb4cbc6a7b18",filename:"SchView.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var u=e.____MODULES["72ccee1acde6f77563f5f551b427b29d"];var a=e.____MODULES["1078e55f46c9b52af96debc4b8f2be22"];var f=e.____MODULES["f2f15a51d66bfd2af2213994bf6d509b"];var l=e.____MODULES["c51777e35917abcb15bcf62b870b9df9"];e.____MODULES["83d6887f608130b3ab1de57c7928c8e0"];var c=e.____MODULES["297b5fec00bd70dc90c65ed5ff040800"];var h=function(e){var t=this;t._childs=[];a.call(t,i.mix({box:s("#sch_box")},e))};var p={constructor:h,_init:function(){var e=this,t=e._box;e._day_count_dom=t.find(".sch_day_count");e._tree_box=t.find(".sch_tree_box");e._day_box=t.find("#sch_tree");e._info_box=t.find(".sch_info_box");e._info_inner=s(".sch_info_inner",e._info_box);e._drag_ph=s('<div class="node_box day_info" style="height:50px;border:1px dashed #ccc;"></div>');a.prototype._init.call(e);e._initViewData()},_initViewData:function(){var e=this,t=e._model;e._day_count_dom.text(t.len());t.children().forEach(s.proxy(e.addDay,e))},onModelEvent:function(){var e=this;e._model.on("add_day",function(t,n){e.addDay(t,n,true)});e._model.on("rm_day",function(t){var n=t.order();e.delDay(n)});a.prototype.onModelEvent.call(this)},unModelEvent:function(){this._model.unbind("add_day");this._model.unbind("rm_day");a.prototype.unModelEvent.call(this)},modelChange:function(e,t){var n=this;if(e==="day_count"){n._day_count_dom.text(t)}},listen:function(){var e=this;e._tree_box.delegate(".day_op","click",s.proxy(e.__event_add_day,e));e._tree_box.delegate(".day_op","mouseenter",function(){s(this).closest(".day_op").addClass("day_op_hover")});e._tree_box.delegate(".day_op","mouseleave",function(){s(this).closest(".day_op").removeClass("day_op_hover")})},__event_add_day:function(e){e.preventDefault();var t=this,n=s(e.currentTarget),r;if(t._add_disabled){return}t._add_disabled=true;setTimeout(function(){t._add_disabled=false},500);if(n.hasClass("first")){r=0}else if(n.hasClass("last")){r=t.model().len()}else{if(e.target.className.indexOf("icon")===-1){}r=n.next(".day_info").find(".icon").text().replace(/D/,"")*1;r-=1}t._observer.trigger("view_add_day",r)},_addPh:'<div class="node_box day_op"><div class="d_info "><div class="icon"></div><div class="d_text hide">添加一天</div></div></div>',addDay:function(e,t,n){var r=this;var i=new c({model:e,start_time:r.start_time,observer:r._observer});var o=i.box();var u=r._childs[t-1]||null;var a="up";if(t===0){r._day_box.prepend(o);if(!r._childs.length){r._childs.push(i)}else{o.after(r._addPh);r._childs.splice(0,0,i)}}else{var f=s(r._addPh);u.box().after(f);f.after(o);r._childs.splice(t,0,i)}if(t===r._childs.length-1){a="down"}if(s.type(n)==="boolean"){r.showDay(o);o.find(".d_info").hide().effect("slide",{duration:500,direction:a,mode:"show"})}r._wrapDay(i)},delDay:function(e){var t=this,n=t._childs,r=n.length,i=n[e];var s;if(e<r-1){s=i.box().next(".day_op")}else{s=i.box().prev(".day_op")}s.remove();n.splice(e,1);i.box().effect("slide",{direction:"left",mode:"hide",distance:225},200,function(){i.remove()})},selectDay:function(e){var t=this;var n;t._childs.forEach(function(t,r){if(e===r){n=t;t.select()}else{t.unselect()}});if(n){t.showDay(n.box())}},scrollTo:function(e){this._info_box.scrollTop(e)},getScrollVal:function(){return this._info_box.scrollTop()},scrollByOffset:function(e){this.scrollTo(this.getScrollVal()+e)},showDay:function(e){var t=this;var n=e[0].getBoundingClientRect();var r=t._info_box[0].getBoundingClientRect();if(n.bottom>r.bottom){var i=n.bottom-r.bottom;t.scrollByOffset(i+50)}else if(n.top<r.top){var i=r.top-n.top;t.scrollByOffset(i)}},_wrapDay:function(e){var t=this,n;var r=e.box();var s;var o=new f({drag_able_dom:r,container:t._info_inner,html:function(){var e=r.clone();var t=r.offset();t.position="absolute";t.width=r.width();e.css(t).data({rect:{w:t.width,h:r.height()}});e.css("z-index",1e3);e.removeClass("day_info_hover").removeClass("day_info_selected").addClass("day_info_drag");return e},drag_start:function(){r.after(t._drag_ph);r.hide();n=t._info_box.offset();n.height=t._info_box.height();s=r.prev(".day_op").hide()},move:function(e,r){var s=e.data("rect");var o=i.mix({},s,r);var u=t.locate(o);if(u){var a=u.target;t._drag_ph.remove();if(a){a.before(t._drag_ph)}else{t._day_box.append(t._drag_ph)}t._drag_ph.data("index",u.index)}if(o.top<n.top+100){t.scrollByOffset(-20)}else if(o.top>n.top+n.height-200){t.scrollByOffset(20)}},drag_end:function(){var e=t._drag_ph.data("index");var n=t._childs.map(function(e){return e.box()}).indexOf(r);if(n===e||typeof e==="undefined"){r.effect("drop",{direction:"up",mode:"show"});s&&s.show()}else{var i=t._childs[n],o=t._childs[n-1],u=t._childs[n+1];if(o&&u||o){o.box().next(".day_op").remove()}else if(u){u.box().prev(".day_op").remove()}var a=t._drag_ph.offset();t._drag_ph.replaceWith(r);r.effect("drop",{direction:"up",mode:"show"});t._childs.splice(n,1);if(n<e){e-=1}t._childs.splice(e,0,i);var f=t._childs[e-1],l=t._childs[e+1];if(l&&f||l){l.box().before(t._addPh)}else if(f){f.box().after(t._addPh)}t._observer.trigger("view_day_move",i.model(),e);var c=/\d+/.exec(r.find(".icon").text());if(c&&c.length&&parseInt(c[0],10)===1){var h=r.parent().prev(".day_op");if(h.length){h.remove()}}}t._drag_ph.remove();s=null}});e.setDragProxy(o)},locate:function(e){var t=this,n=e.w,r=e.h,s=e.left,o=e.top,u=s+n,a=o+r,f=s+n/2,l=o+r/2;var c=null,h=null;var p=n*r;t._childs.map(function(e){return e.box()}).some(function(e,t){if(!e.is(":visible")){return false}var n=i.mix(e.offset(),{w:e.width(),h:e.height()});var r=Math.max(s,n.left),f=Math.max(o,n.top),l=Math.min(u,n.left+n.w),c=Math.min(a,n.top+n.h);if(r>l||f>c){return false}var p=f+(c-f)/2,d=n.top+n.h/2;if(p<d){h=t}else{h=t+1}return true});if(h!==null){h=Math.min(Math.max(0,h),t._childs.length);var d,c=(d=t._childs[h])?d.box():null;return{index:h,target:c}}return null}};i.extend(h,a,p);n.exports=h}(t.exports,t,e);e.____MODULES["11196581d12c301d7679eb4cbc6a7b18"]=t.exports})(this);(function(e){var t={id:"9b26ef05f14959a7ee8c30e49af33f44",filename:"head.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var o=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var u=e.____MODULES["c51777e35917abcb15bcf62b870b9df9"];var a=e.____MODULES["72ccee1acde6f77563f5f551b427b29d"];var f=20;var l=function(e,t){var n=this;n._box=e;n._observer=t;n._init()};l.prototype._init=function(){function S(){if(E){clearTimeout(E)}E=setTimeout(function(){var t=o.trim(m.val());if(t){t=s.cutString(t,f,"");e._observer.trigger("view_book_title_change",t);l.text(t)}d.hide();r.show()},500)}var e=this,t=e._box,n=e._observer;var r=t.find(".title_wrap");var l=r.find("h1");var c=t.find(".finish_button");var h=t.find("div.traffic_btn_box");var p=h.find("div.list_box");var d=t.find(".title_input_box_wrap");var v=d.find("div.title_input_box");var m=v.find(".title_input");var g=r.find(".edit_icon");var y=d.find(".cancel_btn");var b=d.find(".confrim_btn");r.click(function(e){e.preventDefault();r.hide();d.show();m.val(l.text()).focus()});if(i.Browser.isIE6||i.Browser.isIE7){r.hover(function(){r.addClass("hovered")},function(){r.removeClass("hovered")})}var w,E;s.bindInput(m,function(e){if(s.countStrByWord(e)>f){u.showInfo("攻略标题最多只能输入"+f+"个字");m.val(s.cutString(e,f,""))}u.hideInfo(3e3)});m.keyup(function(e){var t=e.which;if(t===13){S()}}).focus(function(){v.addClass("title_input_box_focus");s.setCursorPos(m[0],m.val().length)}).blur(function(){v.removeClass("title_input_box_focus")});b.click(S);y.click(function(e){m.val("");d.hide();r.show()});c.click(function(){var e=a.Book_Id;var t="/gonglve/"+e;window.location.href=t});h.delegate(".txt_label .arrow","click",function(e){e.preventDefault()});var x;h.delegate(".txt_label,.list_box","mouseenter",function(){if(x){clearTimeout(x);x=null}p.show()});h.mouseleave(function(){if(x){clearTimeout(x);x=null}x=setTimeout(function(){p.hide()},300)});var T=h.find(".txt").click(function(t){var n=o(this);var r=n.text();if(r.indexOf("公交")>-1){e._observer.trigger("view_traffic_show","transit");s.planBc("bus")}else if(r.indexOf("自驾")>-1){e._observer.trigger("view_traffic_show","driving");s.planBc("drive")}else{e._observer.trigger("view_traffic_show");s.planBc("traffic")}});p.mousedown(function(e){e.stopPropagation()});o("body").on("mousedown.head",function(){p.hide()});var N=p.find("li");N.eq(0).hide();N.click(function(t){t.preventDefault();var n=o(this);var r=n.text();T.text(r);var i;if(n.hasClass("js_bus_trf")){i="transit"}else if(n.hasClass("js_drive_trf")){i="driving"}e._observer.trigger("view_traffic_show",i);N.show();n.hide();p.hide()})};n.exports=l}(t.exports,t,e);e.____MODULES["9b26ef05f14959a7ee8c30e49af33f44"]=t.exports})(this);(function(e){var t={id:"909b4128e418b00dbddd48f6e9267af1",filename:"LocEles.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function c(e,t){var n=e.data("id")+"_"+e.data("type")+"_"+t.data("id")+"_"+t.data("type");return'<li class="t_route clrfix" data-key="'+n+'" ><div class="icon_box"><div class="t_t_line"></div><div class="icon"></div></div><div class="txt_box"><span class="t_txt">正在查询</span></div></li>'}var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var u=s("body");var a=e.____MODULES["f2f15a51d66bfd2af2213994bf6d509b"];var f={4:"around",6:"around",5:"around",7:"around",8:"around",21:"around",16:"custom",15:"custom",18:"custom",20:"custom",2:"custom"};var l=function(e,t){var n=this;n._box=e;n._observer=t;n._$win=s(window);n._day_model=null;n._init()};l.prototype._drag_ph_html="<div class='t_drag_ph'></div>";l.prototype._init=function(){var e=this;e._ele_list=e._box.find("ul.t_ele_list");e._resize();e.listen()};l.prototype.listen=function(){var e=this;e._$win.on("resize.LocEles",function(){e._resize()});e._ele_list.delegate("li.t_route","click",function(t){var n=this.getAttribute("data-key");e._observer.fire("show_traffic_detail",n);o.planBc("traffic_details")});e._ele_list.delegate("li.t_route","mouseenter",function(e){s(this).find(".t_view").show()});e._ele_list.delegate(".js_del","click",function(t){if(e.getDayModel()){o.planBc("del");e._observer.fire("traffic_view_rm_element",e.getDayModel().getEleById(s(this).closest("li").data("id")))}});e._ele_list.delegate(".js_setpoint","click",function(t){var n=s(this);if(n.hasClass("js_modify")){o.planBc("edit_marker")}else{o.planBc("marker_place")}if(e.getDayModel()){e._observer.fire("traffic_view_setpoint_element",t,e.getDayModel().children()[s(this).closest("li").data("order")])}});e._ele_list.delegate("li.t_route","mouseleave",function(e){s(this).find(".t_view").hide()});e._ele_list.delegate("li.t_ele","mouseenter",function(e){s(this).addClass("hover")});e._ele_list.delegate("li.t_ele","mouseleave",function(e){s(this).removeClass("hover")});e._ele_list.delegate(".t_ele .btn_around","click",function(t){o.planBc("nearby");var n=e._ele_list.find(".t_ele").index(s(this).parent().parent());e._observer.fire("show_around_detail",e.getDayModel().children()[n]);s(this).parents(".t_ele").addClass("opening_around").siblings().removeClass("opening_around")})};l.prototype._resize=function(){var e=this;var t=e._$win.height();e._box.height(t-187)};l.prototype.getDayModel=function(){return this._day_model};l.prototype.rmEleByIndex=function(e,t){var n=this.getElelst();var r=n.filter(function(e,n){return s(n).data("id")===t});if(r.length>0){e=r.eq(0).data("order")}else{return}var i=n.length;if(e<i){this.rmEleAndUpdateTraffic(e,n);n.eq(e).remove();this.updateElesOrder();if(i-1===0){this.showNoData()}}};l.prototype.addEle=function(e,t){var n=this,r=n._day_model,i=r.children(),s=i[t-1],o=i[t+1];var u=this.getElelst();var a=s&&e&&n.getEleItemHtml(s,e,t,"trafficLoading");u.eq(t-1).after(a);n.updateElesOrder();var f=n.getElelst(),l=f.eq(t),h=l.prev(".t_ele");l.next(".t_route").remove();var p=l.next(".t_ele");var d=h.length&&c(h,l),v=p.length&&c(l,p);d&&l.before(d);v&&l.after(v);n._onDrag(l)};l.prototype.updateOneEleId=function(e){function u(e,t){return[e.context("id"),e.context("type")||e.context("type_id"),t.context("id"),t.context("type")||t.context("type_id")].join("_")}var t=e.context("travelOrder"),n=e.context("id"),t=e.context("travelOrder");eleModels=e.parent().children(),prevModel=eleModels[t-1],nextModel=eleModels[t+1];var r=this.getElelst(),i=r.eq(t),s=i.prev(".t_route"),o=i.next(".t_route");i.attr("data-id",n).data("id",n);s.length&&prevModel&&s.attr("data-key",u(prevModel,e));o.length&&nextModel&&o.attr("data-key",u(e,nextModel))};l.prototype.rmEleAndUpdateTraffic=function(e,t){var n=t.length;var r=this.getDayModel();var i=t.eq(e);if(e===n-1){i.prev("li.t_route").remove();return}else if(e===0){i.next("li.t_route").remove();return}else{i.prev("li.t_route").remove();i.next("li.t_route").remove();var s=i.prev("li.t_ele");var o=i.next("li.t_ele");var u=c(s,o);i.replaceWith(u);this.loadTraffic(s,o)}};l.prototype.loadTraffic=function(e,t){var n=this.getDayModel();n.loadTraffic(n.getEleById(e.data("id")),n.getEleById(t.data("id")))};l.prototype.getElelst=function(){return this._ele_list.find("li.t_ele")};l.prototype.render=function(e){var t=this;t._day_model=e;var n=e.children().filter(function(e,t){return(e.context("type")||e.context("type_id"))!==2});var r=e.getTraffic();var i;var s="";var u;if(n.length>0){i=n[0].type();u=f[""+i];if(i===21){var a=n[0];if(a.context("locationId")||a.context("poiId")){u="around"}else{u="custom"}}if(u==="around"){s='<span class="btn_around">查看周边</span>'}else if(u==="custom"){if(n[0].hasLatLng()){s='<span class="btn_around">查看周边</span><span class="btn_mark js_setpoint js_modify">重新标记</span>'}else{s='<span class="btn_mark no_border js_setpoint">标记位置</span>'}}else{s=""}var l=['<li class="t_ele clrfix" data-order="0" data-id="'+n[0].getId()+'" data-type="'+i+'" ><div class="icon_box"><div class="icon">01</div></div><div class="txt_box">'+s+'<span class="t_txt">'+o.HTMLEncode(n[0].context("name"))+'</span><b class="del js_del"></b></div></li>'];n.reduce(function(e,n,r){var i=t.getEleItemHtml(e,n,r);l.push(i);return n});t._ele_list.html(l.join(""));t._wrapDom()}else{t.showNoData()}t._box.scrollTop(0)};l.prototype.getEleItemHtml=function(e,t,n,r){var i=this;var s=i._day_model.getTraffic();var u,a=[];var l=e.getId(),c=e.type(),h=t.getId(),p=t.type(),d=parseInt(e.getPoiId(),10),v=parseInt(t.getPoiId(),10);var m="";var u=f[""+p];if(p===21){if(t.context("locationId")||t.context("poiId")){u="around"}else{u="custom"}}if(u==="around"){m='<span class="btn_around">查看周边</span>'}else if(u==="custom"){if(t.hasLatLng()){m='<span class="btn_around">查看周边</span><span class="btn_mark js_setpoint js_modify">重新标记</span>'}else{m='<span class="btn_mark no_border js_setpoint">标记位置</span>'}}else{m=""}var g=l+"_"+c+"_"+h+"_"+p;var y=s[g],b;if(d&&d===v&&c===p){a.push('<li class="t_route no-show clrfix" data-key="'+g+'" data-same="true" ><div class="icon_box"><div class="t_t_line"></div></div></li>')}else{if(y){if(typeof y.route==="string"){y.route=i._parseRoute(y.route)}b=y.route}else{i._day_model.loadTraffic(e,t)}if(b&&b.route_info){var w=y.route.mode,E=y.route.distance_txt;a.push('<li class="t_route clrfix" data-key="'+g+'" ><div class="icon_box"><div class="t_t_line"></div><div class="icon '+w+'"></div></div><div class="txt_box"><span class="t_txt">'+E+'</span><a href="javascript:;" class="t_view">查看<i></i></a></div></li>')}else{if(y&&y.status==="querying"||r=="trafficLoading"){}else{a.push('<li class="t_route no-show clrfix" data-key="'+g+'" ><div class="icon_box"><div class="t_t_line"></div></div></li>')}}}a.push('<li class="t_ele clrfix" data-order="'+n+'" data-id="'+t.getId()+'" data-type="'+t.type()+'" ><div class="icon_box"><div class="icon">'+(n+1>9?n+1:"0"+(n+1))+'</div></div><div class="txt_box">'+m+'<span class="t_txt">'+o.HTMLEncode(t.context("name"))+'</span><b class="del js_del"></b></div></li>');return a.join("")};l.prototype.showNoData=function(){this._ele_list.html("<div class='t_no_data'><p>这一天没有行程数据，请添加</p></div>")};l.prototype._parseRoute=function(e){return JSON.parse(e)};l.prototype.renderRowTrffic=function(e,t){var n=this;var r=n._ele_list.find("li.t_route").filter("[data-key="+e+"]");if(r.length){if(t&&t.status==="same"){r.html('<div class="icon_box"><div class="t_t_line"></div></div>').addClass("no-show");return}if(t&&t.route&&t.route.route_info){var i=t.route.mode,s=t.route.distance_txt;r.removeClass("no-show");r.html('<div class="icon_box"><div class="t_t_line"></div><div class="icon '+i+'"></div></div><div class="txt_box"><span class="t_txt">'+s+'</span><a href="javascript:;" class="t_view">查看<i></i></a></div>')}else{r.html('<div class="icon_box"><div class="t_t_line"></div></div>').addClass("no-show")}}};l.prototype.updateElesOrder=function(){this.getElelst().each(function(e,t){s(t).find(".icon").text(e+1>9?e+1:"0"+(e+1));s(t).attr("data-order",e)})};l.prototype._wrapDom=function(){var e=this,t=e._ele_list.find("li.t_ele");t.each(function(t,n){e._onDrag(s(n))})};l.prototype._onDrag=function(e){var t=this;var n=e;var r;var i=new a({drag_able_dom:n,html:function(){var e=s("<div class='t_ele clrfix'></div>").html(n.html());e.css(n.offset()).addClass("t_r_draging");p();return e},drag_start:function(e,i){n.hide();r=t._box[0].getBoundingClientRect();t._$holder=s(t._drag_ph_html);if(!n.prev("li.t_route").hide().length){n.next("li.t_route").hide()}t._$holder.insertAfter(n)},move:function(e,i){var s=e[0].getBoundingClientRect();var o=t._ele_list.find("li.t_ele");var u=o.length;var a=null;for(var f=0;f<u;f++){var l=o[f];if(l===n[0]){continue}var c=l.getBoundingClientRect();var h=Math.max(s.left,c.left),p=Math.max(s.top,c.top),d=Math.min(s.right,c.right),v=Math.min(s.bottom,c.bottom);if(h>d||p>v){continue}var m=p+(v-p)/2,g=c.top+(c.bottom-c.top)/2;if(m<g){a=f}else{a=f+1}break}if(a!==null){a=Math.min(Math.max(0,a),u);t._$holder.data("index",a);if(a===u){t._ele_list.append(t._$holder)}else{o.eq(a).before(t._$holder)}}if(s.top<r.top+60){t._box.scrollTop(t._box.scrollTop()-10)}else if(s.bottom>r.bottom-60){t._box.scrollTop(t._box.scrollTop()+10)}},drag_end:function(e){e.removeClass("t_r_draging");var i=n;var s=t.getDayModel().getOrderById(i.data("id"));var o;var u=t._$holder.nextAll(".t_ele");var a=t._$holder.prevAll(".t_ele");if(u.length>0){o=u.data("id")}else if(a.length>0){o=a.data("id")}var f=t.getDayModel().getOrderById(o);if(f==s||typeof f==="undefined"){t._$holder.remove();t._$holder=null;i.show();i.next("li.t_route").show();i.prev("li.t_route").show();return}next_route=i.next("li.t_route");prev_route=i.prev("li.t_route");next_route.remove();prev_route.remove();next_ele=i.next("li.t_ele");prev_ele=i.prev("li.t_ele");if(next_ele[0]&&prev_ele[0]){next_ele.before(c(prev_ele,next_ele));t.loadTraffic(prev_ele,next_ele)}i.show();t._$holder.replaceWith(i);t._$holder.remove();t._$holder=null;i.css("position","static");i.next("li.t_route").remove();i.prev("li.t_route").remove();var l=i.prev("li.t_ele"),h=i.next("li.t_ele");if(l[0]){i.before(c(l,i));t.loadTraffic(l,i)}if(h[0]){i.after(c(i,h));t.loadTraffic(i,h)}t.updateElesOrder();r=null;t._observer.fire("move_ele",f,s);d()}});n.data("drag_proxy",i)};var h=function(e){var t=e.target;if(!t.nodeName.toLowerCase().match(/input|textarea/)){return false}};var p=function(){u.addClass("unselect").attr("unselectable","on").on("selectstart",h)};var d=function(){u.removeClass("unselect").removeAttr("unselectable").unbind("selectstart",h)};n.exports=l}(t.exports,t,e);e.____MODULES["909b4128e418b00dbddd48f6e9267af1"]=t.exports})(this);(function(e){var t={id:"89a3f5c4ca3f9ac25c199fff63165a12",filename:"Render.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function a(e,t){var n=this;var r=e.start,s=e.end,u=e.mode;var a=i.Mode;var f=i.R_TYPE;var l=e.route_info.plans,c=(e.taxi||{}).taxi_fee;var h=r.name,p=s.name,d=r.is_abroad;var v=new o;var m=['<div class="t_detail_transit" >','<div class="hd clrfix">',u===t?'<a href="#" class="fr btn_already js_def_btn">已设为首选</a>':'<a href="#" data-mode="'+u+'" class="fr btn_not_already js_def_btn">设为首选</a>','<div class="fl" >公交/地铁</div>',"</div>",'<div class="ct_box">',l.map(function(e,t){var n=t+1,r=e.routes,i=e.route_summary_txt,s=e.distance_txt,o=e.duration_txt;var u=['<div class="cell ',t===0?"cell_expand":"",'">','<div class="tit clr_after">','<h3 ><span class="num fl">',n,'</span><strong class="fl">',i,"</strong></h3>",'<p class="des">(共<span>',s,"</span>，约<span>",o,")</span></p>","</div>",'<div class="cont">','<h3 class="place">','<span class="iconq fl"></span>','<span class="g_wp">',h,"</span>","</h3>",'<ul class="list">',r.map(function(e,t){if(e.type===f.walk){return v.renderWalkLine(e)}else{return v.renderLine(e)}}).join(""),"</ul>",'<h3 class="place">','<span class="iconz fl"></span>','<span class="g_wp">',"<em>",p,"</em>","</span>","</h3>","</div>","</div>"].join("");return u}).join(""),"</div>",c?'<div class="ft_box clrfix"><span class="taix_icon fl"></span><em class="fr">按最短路程计算</em>打车费用：约<span class="js_taxi_fee">'+c+'元</span><em class="taxi_em">(按最少时间计算)</em></span></div>':"","</div>"].join("");return m}function f(e,t){var n=this;var r=i.Mode;var s=i.R_TYPE;var u=e.start,a=e.end,f=e.mode;var l=e.route_info.plans,c=(e.taxi||{}).taxi_fee;var h=u.name,p=a.name,d=u.is_abroad;var v=new o;var m=l.map(function(e,n){var r=e.routes,i=e.distance_txt,s=e.duration_txt;var o=['<div class="" >','<div class="hd clrfix">',f===t?'<a href="#" class="fr btn_already js_def_btn">已设为首选</a>':'<a href="#" data-mode="'+f+'" class="fr btn_not_already js_def_btn">设为首选</a>','<div class="fl" >',"<span>",i,"</span>，<span>",s,"</span></div>","</div>",'<div class="d_r_cont">','<h3 class="place">','<span class="iconq fl"></span>','<span class="g_wp">',h,"</span>","</h3>",'<ul class="list">',r.map(function(e,t){return v.renderRoute(e)}).join(""),"</ul>",'<h3 class="place">','<span class="iconz"></span>','<span class="g_wp">',"<em>",p,"</em>","</span>","</h3>","</div>",c?'<div class="ft_box clrfix d_b_border"><span class="taix_icon fl"></span>打车费用：约<span>'+c+'元</span><em class="taxi_em">(按最少时间计算)</em></div>':"","</div>"];return o.join("")});m=m.join("");return m}var i=e.____MODULES["5304114d73c733af2d632c1c6f6298ce"];var s={0:"驾车",1:"步行"};var o=function(){};var u=o.prototype;u.renderRoute=function(e){var t=e.steps,n=e.type,r=e.end,i=[];if(e.description){return'<li class="clrfix"><p class="fl"><span class="icon_s fl"></span>'+e.description.replace(/<[^>]+>/g,"")+"</p></li>"}else if(t&&t.length){i=t.map(function(e){return'<li class="clrfix"><p class="fl"><span class="icon_s fl"></span>'+e.description.replace(/<[^>]+>/g,"")+"</p></li>"})}else{var o=r?r.title:"终点";i=['<li class="clrfix "><p class="fl"><span class="icon_s fl"></span>',[s[n]+"约"+e.distance+",到达",o].join(""),"</p></li>"]}return i.join("")};u.renderLine=function(e){function t(e){var t=e.name,n=e.distance_txt,r=e.num_stops,i=e.get_off_stop;var s="";var o="bus";if(e.type===3){o="subway"}s='<li class="clr_after"> <em class="fr">'+r+'站</em><p class="fl"><span class="'+o+' fl"></span>乘坐'+t+",在"+i.title+"下车</p></li>";return s}if(e.description){return['<li class="clr_after"><p class="fl"><span class="walk fl"></span>',e.description.replace(/<[^>]+>/g,""),"</p></li>"].join("")}if(e.steps){return e.steps.map(t).join("")}return t(e)};u.renderWalkLine=function(e){if(e.description){return['<li class="clr_after"><p class="fl"><span class="walk fl"></span>',e.description.replace(/<[^>]+>/g,""),"</p></li>"].join("")}var t=e.end;var n=t?t.title:"终点";return['<li class="clr_after"><em class="fr">',e.distance,'</em><p class="fl"><span class="walk fl"></span>步行至'+n+"</p></li>"].join("")};u.renderWebStep=function(e,t){return e.replace(/<[^>]+>/g,"")};n.exports={Render:o,renderRoute:f,renderTransit:a}}(t.exports,t,e);e.____MODULES["89a3f5c4ca3f9ac25c199fff63165a12"]=t.exports})(this);(function(e){var t={id:"10f4d4b42e5b4d4f56b91241a6cae0a9",filename:"DetailBox.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["350def52ea851fa034c769d39147cce1"];var u=e.____MODULES["4c7e9bfea58c0a5a083700f240bbe09c"];var a=e.____MODULES["89a3f5c4ca3f9ac25c199fff63165a12"];var f=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var l=function(e,t){var n=this;n._box=e;n._observer=t;n._query_obj=null;n._init()};l.prototype._init=function(){var e=this;e._$win=s(window);e._content_box=e._box.find("div.d_r_info_content");e._content_box_p=e._content_box.parent();e._content_box_2p=e._content_box_p.parent();e._close_btn=e._box.find("a.close_btn");e._showed=false;e._initTab();e._resize();e.listen()};l.prototype._initTab=function(){var e=this,t=e._box;var n=t.find("ul.d_t_tabs li");e.tabs=n;n.click(function(t){var r=s(this);if(r.hasClass("selected")){return}n.removeClass("selected");r.addClass("selected");var i=r.data("mode");e._query_obj.query(i,function(t){if(t){var n=t.mode&&t.mode===e._def_mode?t.mode:null;e._render(t,n)}else{e._content_box.html("<div class='t_no_data' >没有交通数据</div>")}});f.planBc("change_tab")})};l.prototype.listen=function(){var e=this;e._$win.on("resize.DetailBox",function(){e._resize()});e._close_btn.click(function(t){t.preventDefault();e.hide()});e._content_box.delegate(".cell","click",function(){var e=s(this);if(e.hasClass("cell_expand")){return}e.siblings().removeClass("cell_expand").removeClass("cell_hover");e.removeClass("cell_hover").addClass("cell_expand")});e._content_box.delegate(".cell","mouseenter",function(){if(this.className.indexOf("cell_expand")>-1){return}this.className="cell cell_hover"});e._content_box.delegate(".cell","mouseleave",function(){if(this.className.indexOf("cell_expand")>-1){return}this.className="cell"});e._content_box.delegate(".js_def_btn","click",function(t){t.preventDefault();var n=s(this);if(n.hasClass("btn_not_already")){var r=e._query_obj.getDataByMode(n.data("mode"));if(r){e._observer.fire("user_set_traffic",e._data.key,r)}n.removeClass("btn_not_already").addClass("btn_already").text("已设为首选");e._def_mode=r.mode;f.planBc("first_choose")}});i.PubSub.on("reset_map_button",function(){e._box.hide()})};l.prototype.show=function(){var e=this;e._box.effect("slide",{duration:500,direction:"left",distance:400,mode:"show"});e._showed=true};l.prototype.hide=function(){var e=this;if(!e._showed){return false}this._box.effect("slide",{mode:"hide",complete:function(){e._observer.fire("not_show_traffic_detail")}});e._showed=false};l.prototype.setRoute=function(e){var t=this;t._query_obj=new c(e)};l.prototype.unsetData=function(){this._data=null;this._query_obj=null;this._def_mode=null};l.prototype.render=function(e){var t=this;var n=e.route;t._data=e;t.setRoute(n);t._def_mode=n.mode;t._render(n,n.mode);t.show()};l.prototype._render=function(e,t){var n=this;var r="";var i=e.distance_txt;var s=i.match(/(\d+\.*\d*)(?:公里)/);if(e.mode!=="walking"&&s&&s[1]*1>=5){n.tabs.eq(2).hide()}else{n.tabs.eq(2).show()}if(e.route_info){if(e.mode==="transit"){r=a.renderTransit(e,t)}else{r=a.renderRoute(e,t)}}else{r="<div class='t_no_data' >没有交通数据</div>"}var o=e.mode;n._content_box.html(r);n.tabs.removeClass("selected").filter("[data-mode="+o+"]").addClass("selected");n._observer.fire("show_traffic_line",e,0)};l.prototype._resize=function(){var e=this;var t=e._$win.height();e._content_box_2p.height(t-70)};var c=function(e){var t=this;t._cache_data={};t._cache_data[e.mode]=e;t._start=e.start;t._end=e.end;t._qfactory=new o({type:"js",mode:"transit"})};c.prototype.getDataByMode=function(e){return this._cache_data[e]||null};c.prototype.query=function(e,t){var n=this,r=n._cache_data[e];if(typeof r!=="undefined"){t(r);return}var i=n._start,s=n._end;var o=(n._cache_data.transit||n._cache_data.driving||n._cache_data.walking||{}).taxi;var a=function(e){switch(e){case"walking":return"步行";case"driving":return"驾车";case"transit":return"公交"}}(e);n._qfactory.search(i,s,e).then(function(r){if(i.is_abroad){var f=(new u.GGRoute).parse(e,r);var l;if((l=f.plans)&&(l=l[0])){var c="相距"+l.distance_txt+","+a+l.duration_txt;var h={start:i,end:s,route_info:f,taxi:o,mode:e,distance_txt:c,unparse:false};n._cache_data[e]=h;t(h)}else{n._cache_data[e]=null;t(null)}}else{var p=(new u.BdRoute).parse(e,r);var d=p.plans;if(!d[0]){n._cache_data[e]=null;t(null)}else{var l=d[0];var c="相距"+l.distance_txt+","+a+l.duration_txt;var f={start:i,end:s,route_info:p,taxi:o,mode:e,distance_txt:c,unparse:false};n._cache_data[e]=f;t(f)}}},function(){n._cache_data[e]=null})};n.exports=l}(t.exports,t,e);e.____MODULES["10f4d4b42e5b4d4f56b91241a6cae0a9"]=t.exports})(this);(function(e){var t={id:"4ac223463c8cb76debdd73127d225d1c",filename:"RouteBox.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["909b4128e418b00dbddd48f6e9267af1"];var u=e.____MODULES["10f4d4b42e5b4d4f56b91241a6cae0a9"];var a=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var f=function(e,t){var n=this;n._box=e;n._observer=t;n._model=null;n._init()};f.prototype._init=function(){var e=this;e._top_box=e._box.find("div.t_top");e._t_t_title=e._box.find(".t_t_left .t_t_title");e._switch_day_box=e._top_box.find("div.select_box");e._day_txt=e._switch_day_box.find(".txt_label");e._day_list_box=e._switch_day_box.find(".list_box");e._initLocEles();e._initDetailBox();e.listen();e.logicListen()};f.prototype.listen=function(){function n(){e._day_list_box.hide();e._day_txt.find(".arrow").removeClass("up");t=false}var e=this;var t=false;e._day_txt.click(function(r){if(!t){e._day_list_box.show();e._day_txt.find(".arrow").addClass("up");t=true}else{n()}});e._day_list_box.delegate("li.item","click",function(t){t.preventDefault();var r=this.getAttribute("data-order");e._observer.fire("traffic_change_day",r);n();a.planBc("change_day")});e._switch_day_box.mousedown(function(e){e.stopPropagation()});s("body").on("mousedown.RouteBox",function(e){n()})};f.prototype.logicListen=function(){var e=this;e._observer.on("show_traffic_detail",function(t){var n=e._model;var r=n.getTraffic();var i;if(i=r[t]){e._detail_box.render(i)}});e._observer.on("move_ele",function(t,n){var r=e._model;if(r){var i=r.getEleByOrder(n);i.moveTo(r,t)}});e._observer.on("user_set_traffic",function(t,n){var r=e._model;if(r){r.updateOneRoute(t,n)}});e._observer.on("traffic_change_day",function(){e._detail_box.hide()})};f.prototype.render=function(e,t){var n=this;var r=n._day_list_box;var i=e.order();var s="<ul class='lists' >";for(var o=0,u=t;o<u;o++){s+='<li class="item '+(o+1===u?"last":"")+'" data-order='+o+' ><a href="#" >第'+(o+1)+"天</a></li>"}r.html(s);n._day_txt.find(".txt").text("查看其它天");n.setModel(e);n._t_t_title.text("第"+(i+1)+"天行程")};f.prototype.setModel=function(e){var t=this;var n=t._model;if(n){t.unModel()}t._model=e;t._renderRoute(e);t._listened_obj={day_self_rm:function(){if(t._model){t._model.unbind("day_traffic_update");t._detail_box.unsetData();t._model=null}},before_load_ele_traffic:function(e){t._loc_eles_mod.updateOneEleId(e)},rm_element:function(e,n){t._loc_eles_mod.rmEleByIndex(e,n);t._model.trigger("move_element_in_day")},add_element:function(e,n){t._loc_eles_mod.addEle(e,n);t._observer.trigger("update_day_ele_map",t._model)},day_traffic_update:function(e,n){t._loc_eles_mod.renderRowTrffic(e,n)},move_element_in_day:function(){t._detail_box.hide();t._observer.fire("hide_around_view");t._observer.fire("view_move_element_in_day",t._model);t._detail_box.unsetData()}};for(var r in t._listened_obj){t._model.bind(r,t._listened_obj[r])}};f.prototype._initLocEles=function(){var e=this;e._loc_eles_mod=new o(e._box.find("div.t_middle"),e._observer)};f.prototype._renderRoute=function(e){var t=this;t._loc_eles_mod.render(e)};f.prototype._initDetailBox=function(){var e=this;e._detail_box=new u(e._box.find("div.detail_traffic"),e._observer)};f.prototype.getDetailTraffic=function(){return this._detail_box};f.prototype.getModel=function(){return this._model};f.prototype.hideDetailBox=function(){this._detail_box.hide()};f.prototype.unModel=function(){var e=this._model;var t=this._listened_obj;if(e&&t){for(var n in t){e.unbind(n,t[n])}this._listened_obj=null;this._model=null}};f.prototype.getLocElesMod=function(){return this._loc_eles_mod};n.exports=f}(t.exports,t,e);e.____MODULES["4ac223463c8cb76debdd73127d225d1c"]=t.exports})(this);(function(e){var t={id:"56483375e8bf013e95419f32c44a39a1",filename:"def_img_config.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r="//source.qunarzz.com/site/images/travel/new_plan/";var i=r+"big_ele_sight.jpg",s=r+"big_ele_flight.jpg",o=r+"big_ele_shop.jpg",u=r+"big_ele_food.jpg",a=r+"big_ele_hotel.jpg",f=r+"big_ele_traffic.jpg",l=r+"big_ele_note.jpg",c=r+"big_ele_event.jpg",h=r+"big_ele_location.jpg",p=r+"big_ele_yule.jpg",d=r+"big_ele_ship.jpg",v=r+"big_ele_car.jpg",m="//s.qunarzz.com/travel/plan/big_ele_fun_v2.jpg",g=r+"big_ele_train.jpg";var y={4:i,16:i,5:u,6:a,15:a,18:u,8:o,20:o,7:m,19:m,13:s,21:function(e){var t=e.style;var n;switch(t){case"火车":n=g;break;case"飞机":n=s;break;case"汽车":n=v;break;case"轮船":n=d;break;default:n=f;break}return n},12:g,14:f,22:v,23:v,2:l,def:h,getImg:function(e,t){var n=this[e];if(n){if(typeof n==="function"){return n(t)}return n}else{return this.def}}};t.exports=y}(t.exports,t,e);e.____MODULES["56483375e8bf013e95419f32c44a39a1"]=t.exports})(this);(function(e){var t={id:"302f8bb902b3c3e1b4660c83d164820a",filename:"poi_item.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["poi_item"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<li class="poi_item ');if(r.s(r.f("is_collect",e,t,1),e,t,0,35,50,"{{ }}")){r.rs(e,t,function(e,t,n){n.b("collet_poi_item")});e.pop()}r.b('" data-type="');r.b(r.v(r.f("type",e,t,0)));r.b('" data-city="');r.b(r.v(r.f("city",e,t,0)));r.b('">');r.b("\n"+n);r.b('<div class="p_left_box">');r.b("\n"+n);r.b('    <div class="poi_img_box">');r.b("\n"+n);r.b('            <img src="');r.b(r.v(r.f("image",e,t,0)));r.b('" class="poi_img" >');r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("    ");if(r.s(r.f("distance",e,t,1),e,t,0,244,446,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<div class="distance_box ');if(n.s(n.f("view_pos",e,t,1),e,t,0,282,318,"{{ }}")){n.rs(e,t,function(e,t,n){n.b("distance_box_width js_view_position ")});e.pop()}n.b('"><div class="distance_bg"></div><div class="distance_con"><i class="distance_icon"></i>距离约');n.b(n.v(n.f("distance",e,t,0)));n.b("</div></div>")});e.pop()}r.b("\n"+n);r.b("    ");if(r.s(r.f("haslatlng",e,t,1),e,t,0,478,609,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<div class="distance_box view_position js_view_position "><div class="distance_bg"></div><div class="distance_con">查看位置</div></div>')});e.pop()}r.b("\n"+n);r.b("</div>");r.b("\n"+n);r.b('<dl class="poi_box">');r.b("\n"+n);r.b('    <dt class="poi_name"><a href="#" target="_blank" class="name_wrap"><strong class="main_title lowie_hover">');r.b(r.v(r.f("main_title",e,t,0)));r.b("</strong></a>");if(r.s(r.f("subtitle",e,t,1),e,t,0,802,844,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<span class="subtitle">');n.b(n.v(n.f("subtitle",e,t,0)));n.b("</span>")});e.pop()}r.b("</dt>");r.b("\n"+n);r.b("    ");r.b(r.t(r.f("poi_info",e,t,0)));r.b("\n"+n);r.b('    <dd class="poi_button"><button class="btn" type="button" >添加到行程</button></dd>');r.b("\n"+n);r.b("</dl>");r.b("\n"+n);if(r.s(r.f("is_collect",e,t,1),e,t,0,985,1030,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<a href="javascript:;" class="close_btn"></a>')});e.pop()}r.b("\n"+n);r.b("</li>");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["poi_item"]}(t.exports,t,e);e.____MODULES["302f8bb902b3c3e1b4660c83d164820a"]=t.exports})(this);(function(e){var t={id:"85cbf6cc8cabf130fa1a4bf936b70fac",filename:"route.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["route"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="sight_route">');r.b("\n"+n);r.b('    <div class="sight_route_name"><a href="');r.b(r.v(r.f("route_url",e,t,0)));r.b('" target="_blank" data-beacon="to_dest_route">');r.b(r.v(r.f("name",e,t,0)));r.b("<a></div>");r.b("\n"+n);r.b('    <p class="sight_route_desc">');r.b("\n"+n);r.b("    ");r.b(r.v(r.f("desc",e,t,0)));r.b("\n"+n);r.b("    </p>");r.b("\n"+n);r.b('    <ol class="route_box">');r.b("\n"+n);if(r.s(r.f("routes",e,t,1),e,t,0,247,623,"{{ }}")){r.rs(e,t,function(e,t,r){r.b('        <li class="route_item">');r.b("\n"+n);r.b("            <ul>");r.b("\n"+n);r.b('                <li class="r_day_add_box" ><a href="javascript:;"  class="r_day_add" data-routeid="');r.b(r.v(r.f("id",e,t,0)));r.b('" data-order="');r.b(r.v(r.f("index",e,t,0)));r.b('" ></a></li>');r.b("\n"+n);r.b('                <li class="day"><div class="txt"><span>D');r.b(r.v(r.f("index",e,t,0)));r.b('</span><div class="icon"></div></div></li>');r.b("\n"+n);r.b("                ");r.b(r.t(r.f("day_route",e,t,0)));r.b("\n"+n);r.b("            </ul>     ");r.b("\n"+n);r.b("        </li>");r.b("\n")});e.pop()}r.b("    </ol>");r.b("\n"+n);r.b('    <div class="route_button">');r.b("\n"+n);r.b('        <button class="btn" type="button" data-routeid="');r.b(r.v(r.f("id",e,t,0)));r.b('">添加到行程</button>');r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("</div> ");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["route"]}(t.exports,t,e);e.____MODULES["85cbf6cc8cabf130fa1a4bf936b70fac"]=t.exports})(this);(function(e){var t={id:"515af4a210b8bd4d307a396569a1b9d0",filename:"mark.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["mark"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="b_mark_popup m_mark" style="color:red;">');r.b("\n"+n);r.b('    <a href="javascript:;" class="mkcont">');r.b("\n"+n);r.b('        <span class="bm_tri"></span>');r.b("\n"+n);r.b('        <span class="bm_title"><em class="ind">');r.b(r.t(r.f("indexStr",e,t,0)));r.b('</em><em class="all">');r.b(r.v(r.f("name",e,t,0)));r.b('</em><em class="shut">');r.b(r.v(r.f("s_name",e,t,0)));r.b("</em></span>");r.b("\n"+n);r.b("    </a>");r.b("\n"+n);r.b("</div>");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["mark"]}(t.exports,t,e);e.____MODULES["515af4a210b8bd4d307a396569a1b9d0"]=t.exports})(this);(function(e){var t={id:"3632b9c0095db72c3b028cee74b397eb",filename:"point.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["point"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="m_poi_point"><a href="javascript:;">');r.b(r.v(r.f("indexWord",e,t,0)));r.b("</a></div>");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["point"]}(t.exports,t,e);e.____MODULES["3632b9c0095db72c3b028cee74b397eb"]=t.exports})(this);(function(e){var t={id:"22935298acf6d3acbc64646c80cc5dfe",filename:"mark_ico.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["mark_ico"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="b_mark_popup m_mark">');r.b("\n"+n);r.b('	<div class="mark_ct js_mark_ct">');r.b("\n"+n);r.b('		<div class="mark_ico"></div>');r.b("\n"+n);r.b('		<div class="confirm_dlg">');r.b("\n"+n);r.b('			<div class="confirm_inner">');r.b("\n"+n);r.b('				<p class="cf_content">');r.b("\n"+n);r.b('					<span class="cf_msg">标记位置</span>');r.b("\n"+n);r.b("				</p>");r.b("\n"+n);r.b('				<div class="buttons">');r.b("\n"+n);r.b('					<a class="cancel js_close" href="#">取消</a>');r.b("\n"+n);r.b('					<a href="#" class="confirm js_ok">确定位置</a>');r.b("\n"+n);r.b("				</div>");r.b("\n"+n);r.b("			</div>");r.b("\n"+n);r.b("		</div>");r.b("\n"+n);r.b("	</div>");r.b("\n"+n);r.b("</div>");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["mark_ico"]}(t.exports,t,e);e.____MODULES["22935298acf6d3acbc64646c80cc5dfe"]=t.exports})(this);(function(e){var t={id:"7ea48124f3242f657c6c82dbe706450c",filename:"mark_confirm.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["mark_confirm"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="b_mark_popup m_mark">');r.b("\n"+n);r.b('	<div class="mark_ct js_mark_ct">');r.b("\n"+n);r.b('		<div class="confirm_dlg">');r.b("\n"+n);r.b('			<div class="confirm_inner">');r.b("\n"+n);r.b('				<p class="cf_content">');r.b("\n"+n);r.b('					<span class="cf_msg">修改位置</span>');r.b("\n"+n);r.b("				</p>");r.b("\n"+n);r.b('				<div class="buttons">');r.b("\n"+n);r.b('					<a href="#" class="confirm js_remove">清除位置</a>');r.b("\n"+n);r.b('					<a href="#" class="confirm js_ok">确定位置</a>');r.b("\n"+n);r.b("				</div>");r.b("\n"+n);r.b('				<a href="#" class="close_btn js_close"></a>');r.b("\n"+n);r.b("			</div>");r.b("\n"+n);r.b("		</div>");r.b("\n"+n);r.b("	</div>");r.b("\n"+n);r.b("</div>");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["mark_confirm"]}(t.exports,t,e);e.____MODULES["7ea48124f3242f657c6c82dbe706450c"]=t.exports})(this);(function(e){var t={id:"dacd39f425f4c7469335c26c545bc050",filename:"dest_box.mod.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){e.____MODULES["302f8bb902b3c3e1b4660c83d164820a"];e.____MODULES["85cbf6cc8cabf130fa1a4bf936b70fac"];e.____MODULES["515af4a210b8bd4d307a396569a1b9d0"];e.____MODULES["3632b9c0095db72c3b028cee74b397eb"];e.____MODULES["22935298acf6d3acbc64646c80cc5dfe"];e.____MODULES["7ea48124f3242f657c6c82dbe706450c"];var i=window.QTMPL;n.exports={poi_item:i.poi_item,route:i.route,mark:i.mark,point:i.point,mark_ico:i.mark_ico,mark_confirm:i.mark_confirm}}(t.exports,t,e);e.____MODULES["dacd39f425f4c7469335c26c545bc050"]=t.exports})(this);(function(e){var t={id:"149b8fe92ccc904ad366cf8da083f63d",filename:"config.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["56483375e8bf013e95419f32c44a39a1"];var o=e.____MODULES["dacd39f425f4c7469335c26c545bc050"];var u=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var a=o.poi_item;var f;var l={tag:function(e){if(!e){return""}if(typeof e==="string"){e=e.split(/\s+/)}if(e&&e.length){return'<dd class="poi_info">标签:&nbsp;'+e.join("&nbsp;")+"</dd>"}return""},addr:function(e){if(!e){return""}return'<dd class="poi_info">地址:&nbsp;'+e+"</dd>"},intro:function(e){if(!e){return""}e=u.splitStr(e,100,"...");return'<dd class="poi_info">简介:&nbsp;'+e+"</dd>"},memo:function(e){if(!e){return""}return'<dd class="poi_info">备注:&nbsp;'+e+"</dd>"},priceDesc:function(e){var t=e*1;var n=i.type(e);if(t===t){if(!t){return""}return'<dd class="poi_info price">价格:&nbsp;<em class="rmb">￥</em><em class="num">'+e+"</em>起</dd>"}else if(n==="string"){return'<dd class="poin_info price">价格:&nbsp;'+e+"</dd>"}else{return""}}};var c={1:"经济型",2:"舒适型",3:"高档型",4:"豪华型"};var h={1:"一星级",2:"二星级",3:"三星级",4:"四星级",5:"五星级"};var p=[{key:"tag",fn:l.tag}];var d=[{key:"star&dangci",fn:function(e){var t=e[0],n=e[1],r;if(r=h[t]||c[n]){return'<dd class="poi_info">'+r+"</dd>"}else{return""}}},{key:"priceDesc",fn:l.priceDesc},{key:"addr",fn:l.addr}];var v=[{key:"tag",fn:l.tag},{key:"priceDesc",fn:function(e){return l.priceDesc(e).replace("起","")}}];var m=[{key:"tag",fn:l.tag}];var g=[{key:"addr",fn:l.addr}];var y=function(e,t){var n=s[e];if(n){if(typeof n==="function"){return n(t)}else{return n}}else{return s.def}};var b={dest_content_url:Hogan.compile("/place/api/poi_search/{{dest_id}}/pois"),front_to_server_type:{4:4,6:2,5:5,7:6,8:3,21:21},server_to_front_type:{4:4,2:6,5:5,6:7,3:8,21:21},_getBaseInfo:function(e){var t=e.image||y(e.type,e);var n={image:t,main_title:e.name,subtitle:e.enName,city:e.cityName,type:e.type,is_collect:e.is_collect,haslatlng:e.lng||e.blng||e.glng,distance:e.distance?e.distance>2e3?Math.round(e.distance/10)/100+"公里":e.distance+"米":null};if(n.distance){var r=n.haslatlng;if(r){n.view_pos=true}delete n.haslatlng}return n},_getInfoHtml:function(e,t){var n=t.map(function(t){var n=t.key,r=t.fn,i;i=n.split("&");if(i.length>1){var s=i.map(function(t){return e[t]});return r(s)}return r(e[n])}).join("");return n},parseToHtml:function(e){var t=this._getBaseInfo(e);var n=this._getInfoHtml(e,p);var r=[],i;e.commentCount&&r.push({name:"评论",cls:"ugc_comment",val:e.commentCount});e.imageCount&&r.push({name:"照片",cls:"ugc_photo",val:e.imageCount});var s=(i=r.length)>0?'<dd class="poi_info">'+r.map(function(t,n){var r="";if(i-1==n){r="last"}var s="/place/poi/"+e.id;return'<a href="'+s+'" target="_blank" class="ugc_txt '+t.cls+" "+r+'" >'+t.name+(t.val?"("+t.val+")":"")+"</a>"}).join("")+"</dd>":"";var o=n+s;t.poi_info=o;return a.render(t)},parseHotelHtml:function(e){var t=this._getBaseInfo(e);t.poi_info=this._getInfoHtml(e,d);return a.render(t)},parseTrafficHtml:function(e){var t=this._getBaseInfo(e);t.poi_info=this._getInfoHtml(e,g);return a.render(t)},parseFoodHtml:function(e){var t=this._getBaseInfo(e);t.poi_info=this._getInfoHtml(e,g);return a.render(t)},parseShopHtml:function(e){var t=this._getBaseInfo(e);t.poi_info=this._getInfoHtml(e,g);return a.render(t)},parseComHtml:function(e){var t=this._getBaseInfo(e);t.poi_info=this._getInfoHtml(e,[{key:"addr",fn:l.addr},{key:"intro",fn:l.intro}]);return a.render(t)},parseEventHtml:function(e){var t=this._getBaseInfo(e);t.poi_info=this._getInfoHtml(e,[{key:"memo",fn:l.memo}]);return a.render(t)},parseP2PHtml:function(e){var t={main_title:e.name,city:e.beginCity,type:e.typeId,image:e.image||y(e.type,e),is_collect:e.is_collect};t.poi_info=this._getInfoHtml(e,[{key:"memo",fn:l.memo}]);return a.render(t)}};n.exports=b}(t.exports,t,e);e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"]=t.exports})(this);(function(e){var t={id:"8f497e9f3a20743d77a2de8d09bc7071",filename:"Mark.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["dacd39f425f4c7469335c26c545bc050"];var o=s.point;var u=s.mark;var a=500;var f=function(e,t,n,r){this.point=e;this._data=t;var i=this.parse(t,n);if(!r){this._div_obj=$(u.render(i))}else{this._div_obj=$(o.render(t))}this._div_obj.css({"z-index":a-n.toString().split(",")[0]});if(!i.image){this._div_obj.find("div.inner").css("padding","4px")}};f.prototype=new i.Map.Overlay;f.prototype.constructor=f;f.prototype.parse=function(e,t){var n={name:e.name,indexStr:t,s_name:i.subStr(e.name,8)};return n};f.prototype.setContent=function(e){this._div_obj=$(e)};f.prototype.setDrawOffset=function(e,t){this._draw_offset={x:e,y:t}};f.prototype.getDrawOffset=function(){return this._draw_offset||{x:0,y:0}};f.prototype.onInit=function(e,t){var n=this.getPanes();(n.markerPane||n.overlayImage).appendChild(t._div_obj[0]);var r=e.pointToPixel(t.point,this);t._div_obj.css({left:r.x+t.getDrawOffset().x||0+"px",top:r.y+t.getDrawOffset().y||0+"px"});t._initEvents();return t._div_obj[0]};f.prototype.onDraw=function(e,t){var n=e.pointToPixel(t.point,this);t._div_obj.css({left:n.x+t.getDrawOffset().x||0+"px",top:n.y+t.getDrawOffset().y||0+"px"})};f.prototype._initEvents=function(){var e=this;var t=e._div_obj.css("z-index");e._div_obj.mouseenter(function(){e._div_obj.css("z-index",1e3).addClass("m_overing");e._div_obj.find("div.js_detail").show()}).mouseleave(function(){e._div_obj.css("z-index",t).removeClass("m_overing");e._div_obj.find("div.js_detail").hide()})};f.prototype.getDom=function(e){return this._div_obj};f.prototype.getPoint=function(){return this.point};n.exports=f}(t.exports,t,e);e.____MODULES["8f497e9f3a20743d77a2de8d09bc7071"]=t.exports})(this);(function(e){var t={id:"9491942e56463f76418cf9e5b72b9345",filename:"AroundViewItem.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"];var s=e.____MODULES["8f497e9f3a20743d77a2de8d09bc7071"];var o=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var u=Hogan.compile('<ul class="item">    <li class="top"><span class="add_btn"><b class="icon"></b>插入行程</span><h3 class="tit"><b class="index">{{indexWord}}</b><a target="_blank" href="{{detailUrl}}">{{name}}</a></h3></li>    <li class="btm"><span class="total_star"><span class="cur_star" style="width:{{qtScore}}%"></span></span><span class="distance">{{distanceTxt}}</span></li>    </ul>');var a=Hogan.compile('<div class="point_item_around"></div>');var f={4:"景点",6:"酒店",5:"美食",7:"玩乐",8:"购物",21:"交通"};var l="abcdefghigklmnopqrstuvwxyz".toUpperCase();var c=function(e,t,n){this.observer=n;this.oriData=e;this.data=$.extend({},e,{distanceTxt:e.distance>1e3?Math.round(e.distance/1e3*100)/100+"公里":e.distance+"米",qtScore:e.qtScore||e.stars||40,indexWord:l.charAt(t),detailUrl:"//travel.qunar.com/place/poi/"+e.id});this.ind=t;this.init(t)};c.prototype={init:function(e){var t=this;this.listView=$(u.render(t.data));this.typeName=f[t.data.type];this.initPoint(e);this.onEvent()},initPoint:function(e){var t=this,n=t.data,r=t.observer.trigger("get_map_type");var i=new QNR.Map.LatLng(n.lat,n.lng,"baidu");var o=new s(i,n,e+1,true);t.pointView=o;t.pointViewDom=o.getDom()},onEvent:function(){var e=this;e.listView.bind("mouseenter",function(){e.pointViewDom.trigger("mouseenter").addClass("m_poi_point_hover")}).bind("mouseleave",function(){e.pointViewDom.trigger("mouseleave").removeClass("m_poi_point_hover")}).delegate(".add_btn","click",function(){o.planBc("add");e.observer.trigger("add_poi_to_day",e.oriData);e.observer.trigger("del_item",e.ind)});e.pointViewDom.bind("mouseenter",function(){e.listView.addClass("hover")}).bind("mouseleave",function(){e.listView.removeClass("hover")})},renderViewIndex:function(){},hide:function(){this.listView.hide();this.pointView.hide()},show:function(){this.listView.show();this.pointView.show()},getListView:function(){return this.listView},getPointView:function(){return this.pointView},removeView:function(){var e=this;e.listView.remove();e.observer.trigger("remove_around_marker_in_map",e.pointView,e.ind)},resetOrder:function(e){var t=this;t.ind=e;var n=t.data.indexWord=l.charAt(e);t.listView.find(".tit .index").text(n);t.pointViewDom.find("a").text(n)}};n.exports=c}(t.exports,t,e);e.____MODULES["9491942e56463f76418cf9e5b72b9345"]=t.exports})(this);(function(e){var t={id:"2c4f393b42a71856e484edcdc2b8e137",filename:"AroundView.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var u=e.____MODULES["56483375e8bf013e95419f32c44a39a1"];var a=e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"];var f=e.____MODULES["9491942e56463f76418cf9e5b72b9345"];var l=e.____MODULES["88d5c499e26b6f8fc86d873910ae3aea"];var c={offset:0,limit:26,poi_types:4,add_center_distance:true,sort:1,order:1};var h=function(e,t,n){var r=this;r._wrap=e;r._list_scroll_box=e.find(".around_main");r._box=e.find(".main_cont");r._tit=e.find(".around_top .tit");r._filter_type_box=e.find(".select_box");r._type_txt=r._filter_type_box.find(".txt_label");r._type_list_box=r._filter_type_box.find(".list_box");r._close_btn=e.find(".around_btm .btn");r._observer=n;r._query_obj=null;r._init(t)};h.prototype._init=function(e){var t=this;t.updateModel(e);t._cache_param=s.extend({},c);t._$win=s(window);t._resize();t._initFilter();t._observer.on("add_poi_to_day",function(e){var n=t._parseToElement(e);i.PubSub.fire("poi_add_to_book",s.extend(n,{order:t.eleModel.context("travelOrder")+1}),t.dayModel)});t._observer.on("del_item",function(e){var n=t.aroundPois[e];n.removeView();t.aroundPois.splice(e,1);t.updateAroundOrder();if(!t.aroundPois.length){t._showNoData("添加完了，没有了")}});t._close_btn.bind("click",function(){o.planBc("close_nearby");t._observer.trigger("hide_around_view")})};h.prototype._parseToElement=function(e){var t=e.image||e.images;var n=e.type;if(t){var r=i.type(t);if(r==="array"&&t.length){t=t[0].smallUrl}else if(r!=="string"){t=u.getImg(n,e)}}else{t=u.getImg(n,e)}var s={image:t,name:e.name,enName:e.enName,address:e.addr,tel:e.tel,blat:e.blat,blng:e.blng,lat:e.lat,lng:e.lng,glat:e.glat,glng:e.glng,cityId:e.cityId||e.city_id||e.distId,cityName:e.cityName||e.city||e.distName,parentName:null,parentId:0,type_id:a.server_to_front_type[n]||n,abroad:e.abroad,locationId:e.id||(e.g_id?e.g_id.replace(/^\w_/,""):"0"),poi_detail:e};if(e.type===2){var f=this.eleModel.parent().context("day_date");s.startTime=o.format(f,"yyyy-MM-dd hh:mm:ss");s.endTime=o.format(o.plusDay(f,1),"yyyy-MM-dd hh:mm:ss")}return s};h.prototype._initFilter=function(){function n(){e._type_list_box.hide();e._type_txt.find(".arrow").removeClass("up");t=false}var e=this;var t=false;e._type_txt.click(function(r){if(!t){e._type_list_box.show();e._type_txt.find(".arrow").addClass("up");t=true}else{n()}});e._type_list_box.delegate("li.item","click",function(t){t.preventDefault();o.planBc("nearby_class");var r=s(this).data("type");e._type_txt.find(".txt").text(s(this).text());e.show(r);n();o.planBc("change_around_type")});e._filter_type_box.mousedown(function(e){e.stopPropagation()});s("body").on("mousedown.AroundView",function(e){n()})};h.prototype.updateAroundOrder=function(){var e=this;i.forEach(e.aroundPois,function(e,t){e.resetOrder(t)})};h.prototype._resize=function(){function o(){var n=parseInt(s(this).height(),10);var r=n-t;e._list_scroll_box.css({height:r+"px"})}var e=this,t=67+120,n=s(window),r=i.Browser.isIE6;n.bind("resize",s.proxy(o,n));o.apply(n)};h.prototype.show=function(e){var t=this;t._observer.fire("clear_around_point_in_map");t.empty();t._tit.text(o.splitStr(t.eleModel.context("name"),7,"...")+"周边");var n=t.eleModel;t._cache_param.poi_types=a.front_to_server_type[e]||e||4;var r=n.getPoiId();t._cache_param.pid=r==undefined||r==="undefined"?0:r;t._cache_param.lng=n.lng();t._cache_param.lat=n.lat();t.query();t._wrap.effect("slide",{duration:500,direction:"left",distance:400,mode:"show"})};h.prototype.hide=function(){var e=this;this._wrap.effect("slide",{mode:"hide",complete:function(){e._observer.fire("not_show_around_view")}})};h.prototype.empty=function(){};h.prototype.clearCache=function(){this._cache_param=s.extend(this._cache_param,c)};h.prototype.query=function(e){var t=this;if(e==="all"){delete t._cache_param.poi_type}else if(e){e=a.front_to_server_type[e];t._cache_param.poi_type=e}var n="/place/api/nearBy/poi";var r=i.mix({},t._cache_param);t._showNoData("正在加载数据...");l.get(n,r,function(e){var n=e.data;if(n!=undefined&&n.length>0){var r=t._unique(n);r.length>0?t._render(r):t._showNoData()}else{t._showNoData()}},function(){t._showNoData("请求失败，请重试")})};h.prototype._render=function(e){var t=this,n=e.length;var r=[];t.aroundPois=i.map(e,function(e,n){var i=new f(e,n,t._observer);r.push(i.getPointView());return i});t.markers=r;t._box.empty();t._renderListView();t._renderPointView()};h.prototype._renderListView=function(){var e=this;e.aroundPois.forEach(function(t){e._box.append(t.getListView())})};h.prototype._renderPointView=function(e){var t=this;t._observer.trigger("render_around_poi",t.markers)};h.prototype._unique=function(e){var t=this,n=t.dayModel.children();var r=function(e){var t=[];i.forEach(e,function(e){var n=e.context("poiId")||e.context("locationId"),r=e.context("type")||e.context("type_id");n&&t.push(n+"_"+r)});return t}(n);var s=[];for(var o=0,u=e.length;o<u;o++){var f=e[o],l=f.id,c=a.server_to_front_type[f.type]||f.type;if(r.indexOf(f.id+"_"+c)==-1){s.push(f)}if(s.length==10){break}}return s};h.prototype._showNoData=function(e){var t=this;t._box.html('<div class="txt_ct">'+(e||"没有找到周边信息，查看其它分类试试")+"</div>")};h.prototype.updateModel=function(e){var t=this;t.eleModel=e;t.dayModel=e.parent();t.resetFilterType()};h.prototype.resetFilterType=function(){this._type_txt.find(".txt").text("景点")};n.exports=h}(t.exports,t,e);e.____MODULES["2c4f393b42a71856e484edcdc2b8e137"]=t.exports})(this);(function(e){var t={id:"d0d3c41654756284484dd7005e22ec64",filename:"EMark.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function l(e,t){l.$super.call(this,e,t);this.point=e}var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["dacd39f425f4c7469335c26c545bc050"];var o=s.point;var u=s.mark;var a=500;var f=i.Map.Overlay.Marker;i.extend(l,f,{onInit:function(e,t){var n=this.getPanes();(n.markerPane||n.overlayImage).appendChild(t._div_obj[0]);var r=e.pointToPixel(t.point,this);t._div_obj.css({left:r.x+"px",top:r.y+"px"});t._initEvents();return t._div_obj[0]},onDraw:function(e,t){var n=e.pointToPixel(t.point,this);t._div_obj.css({left:n.x+t.getDrawOffset().x||0+"px",top:n.y+t.getDrawOffset().y||0+"px"})},setContent:function(e){this._div_obj=$(e)}});n.exports=l}(t.exports,t,e);e.____MODULES["d0d3c41654756284484dd7005e22ec64"]=t.exports})(this);(function(e){var t={id:"17b7573834268d5d64191afde2264674",filename:"MapBox.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["dfd66d8a77e8f348619e6734d9b7e0b4"];var o=e.____MODULES["8f497e9f3a20743d77a2de8d09bc7071"];var u=e.____MODULES["d0d3c41654756284484dd7005e22ec64"];var a=i.Map.LatLng;var f=i.Map.Overlay.Polyline;var l=e.____MODULES["dacd39f425f4c7469335c26c545bc050"];var c=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var h=l.mark_ico;var p=function(e,t){var n=this;n._box=e;n._observer=t;n._maps={bmap:null,gmap:null};n.overlays_map={};n.beforeInit();n._init()};p.prototype.beforeInit=function(){var e=this;e._tmp_marks=[];this._box.delegate(".js_close","click",function(t){c.planBc("cancel_place");e._observer.fire("map_mark_close_click",e._currBookEle);e.closeConfirmDlg()});this._box.delegate(".js_ok","click",function(t){c.planBc("confirm_place");e._observer.fire("map_mark_save_click",e._mark_event_obj,e._currBookEle,e._map_type);e.closeConfirmDlg()});this._box.delegate(".js_remove","click",function(t){e._observer.fire("map_mark_rm_lating_click",e._currBookEle);e.closeConfirmDlg()});this._$movedLabel=this._box.parent().find(".js_move_label")};p.prototype.closeConfirmDlg=function(){this.stopMark();this.rmTmpMark();this._currBookEle=null};p.prototype.stopMark=function(){var e=this;e._marking_state=false;e.setCursor(true);e._$movedLabel.hide().css({left:-100,top:-100})};p.prototype.moveLabel=function(e,t){var n=this;if(n._marking_state){n._$movedLabel.css({left:e,top:t})}};p.prototype._init=function(){var e=this,t=e._box;e._bmap_dom=t.find(".js_baidu");e._gmap_dom=t.find(".js_google")};p.prototype.rmBookElementById=function(e){var t=this;if(e&&t.overlays_map&&t.overlays_map[e]){t.getMap(t._map_type,function(n,r){n.removeOverlay(t.overlays_map[e])})}};p.prototype.renderEles=function(e,t){var n=this;var r=e.data,s=e.is_abroad;n.type=s?"google":"baidu";if(r.length){n.getMap(s,function(e,t){var s=[];var u=[];var a=e.overlays;a.forEach(function(t){e.removeOverlay(t)});e.overlays=[];var f=n.overlays_map;r.forEach(function(n,r){var a=new i.Map.LatLng(n.lat,n.lng,t);var l=new o(a,n,r+1);e.addOverlay(l);e.overlays.push(l);f[n.id]=l;if(n.state_marking){u.push(a)}else{s.push(a)}});var l=new i.Map.Overlay.Polyline(s,{strokeColor:"#fd517b",strokeOpacity:.9,strokeWeight:3});e.addOverlay(l);e.overlays.push(l);n.overlays_points=s;n.viewPoint(s.concat(u))})}else{n.getMap(true,function(e,n){e.overlays.forEach(function(t){e.removeOverlay(t)});var r,s;if(t&&t.length){r=t[0].lng;s=t[0].lat}r=r||116.39564503787867;s=s||39.92998577808024;var o=new i.Map.LatLng(s,r,n);e.setZoom(8);e.setCenter(o)})}};p.prototype.renderTraffic=function(e,t,n){var r=this;var s=t.is_abroad;r.type=s?"google":"baidu";r.getMap(s,function(u,a){var f=[];var l=u.overlays;l.forEach(function(e){u.removeOverlay(e)});u.overlays=[];if(e.length){f=e.map(function(e){var t=e.type;return r.drawLine(e.path,t,s,u)}).expand();[t,n].forEach(function(e,t){var n=new i.Map.LatLng(e.lat,e.lng,a);var r=t?"终点":"起点";var s=new o(n,e,r);u.addOverlay(s);u.overlays.push(s);f.push(n)});r.viewPoint(f)}else{}})};p.prototype.viewPoint=function(e,t){var n=this,r=n.type,i=r=="baidu"?false:true;n.getMap(i,function(n,r){if(r==="google"){n.setViewport(e)}else{n.setViewport(e,{margins:t||[10,10,10,10]})}})};p.prototype.renderPoints=function(e){var t=this,n=t.type=="baidu"?false:true;t.overPointMaker=t.overPointMaker||[];t.getMap(n,function(n){t.overPointMaker.forEach(function(e){n.removeOverlay(e)});t.overPointMaker=[],points=[];i.forEach(e,function(e){n.addOverlay(e);t.overPointMaker.push(e);points.push(e.getPoint())});t.viewPoint(points.concat(t.overlays_points))})};p.prototype.clearAroundPoint=function(){var e=this,t=e.type=="baidu"?false:true;e.getMap(t,function(t){e.overPointMaker&&e.overPointMaker.length&&e.overPointMaker.forEach(function(e){t.removeOverlay(e)});e.overPointMaker=[]})};p.prototype.removeAroundMarker=function(e,t){var n=this,r=n.type=="baidu"?false:true;n.getMap(r,function(r){r.removeOverlay(e);t!=null&&n.overPointMaker.splice(t,1)})};p.prototype.markElement=function(e){var t=this;t._currBookEle=e;t._marking_state=true;t.setCursor(false);t._$movedLabel.show()};p.prototype.getTmpMarks=function(){return this._tmp_marks||[]};p.prototype.addTmpMark=function(e,t){var n=this;n.getMap(n._map_type,function(r,i,s){var u=new o(e.latlng,{},1e3,true);u.setContent(t.render());u.setDrawOffset(-8,-32);r.addOverlay(u);n._tmp_marks.push(u)})};p.prototype.markDragEndHander=function(e){var t=this;t._mark_event_obj=e;t.addTmpMark(e,l["mark_confirm"]);t.stopMark()};p.prototype.moveAndCenter=function(e){var t=this;t.getMap(t._map_type,function(n,r,s){t.rmTmpMark();var u=t._map_type?"google":"baidu";var a=t._map_type?"g":"b";var f=new i.Map.LatLng(e[a+"lat"],e[a+"lng"],u);var l=new o(f,{},1e3,true);l.setContent($('<div class="b_mark_popup m_mark"><div class="mark_ico_yellow"></div></div>'));n.addOverlay(l);t._tmp_marks.push(l);n.setCenter(f);n.setZoom(15)})};p.prototype.rmTmpMark=function(){var e=this;e.getMap(e._map_type,function(t){e.getTmpMarks().forEach(function(e,n){t.removeOverlay(e)});e._tmp_marks.length=0})};p.prototype.setCursor=function(e){var t=this;t.getMap(t._map_type,function(t){if(e){t.setCursor("pointer")}else{t.setCursor("default")}})};p.prototype.listen=function(e){var t=this;e.addEventListener("click",$.proxy(this.showConfirm,this));e.addEventListener("mousemove",function(e){t.moveLabel(e.pixel.x,e.pixel.y)})};p.prototype.showConfirm=function(e){var t=this;if(t._marking_state){t.stopMark();t.addTmpMark(e,l["mark_ico"]);t._mark_event_obj=e}};p.prototype.getMap=function(e,t){var n=this,r,o,u,a;n._map_type=e;if(e){r=n._maps.gmap;o=n._gmap_dom;u="google";a="gmap";n._gmap_dom.css("left",0);n._bmap_dom.css("left",-2e3)}else{r=n._maps.bmap;o=n._bmap_dom;u="baidu";a="bmap";n._bmap_dom.css("left",0);n._gmap_dom.css("left",-2e3)}if(r){t&&t(r,u,o)}else{s(u,function(){r=i.Map(u,o[0],{center:new i.Map.LatLng(0,0,u),zoom:10,draggable:true,scrollwheel:true});if(u==="baidu"){r.addControl(new i.Map.Control.Navigation(r,{style:BMAP_NAVIGATION_CONTROL_SMALL}))}else{r.addControl(new i.Map.Control.Navigation)}r.overlays=[];n._maps[a]=r;n._currMap=r;n.listen(r);t&&t(r,u,o)})}};p.prototype.drawLine=function(e,t,n,r){var i={};var s=n?"google":"baidu";if(t===1){i={strokeStyle:"dashed"}}var o=e.map(function(e){return new a(e.lat,e.lng,s)});var u=new f(o,i);r.addOverlay(u);r.overlays.push(u);return o};p.prototype.render=function(e){var t=e.getLngLatData();var n=e.getDest();this.renderEles(t,n)};n.exports=p}(t.exports,t,e);e.____MODULES["17b7573834268d5d64191afde2264674"]=t.exports})(this);(function(e){var t={id:"f359268032ef95a76c48519ac6bb62c6",filename:"jquery.qsuggest.1.3.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){(function(e){function s(e){var t=e.offset();t["top"]+=e.outerHeight();return t}function o(e){return e.closest("table").data("data")[e.attr("data-ind")*1]}function u(e){var t=this;var n=t.visible();var r=e.keyCode;if(r===40&&!n){t.show();return}var i=t.el.find("tr");var s=i.filter(".active");switch(r){case 38:case 40:if(n){t._excludeEl=t._mouseFocus;s.removeClass("active");var u=e.keyCode===38?s.prev():s.next();if(u.size()===0)u=i.filter(r===38?":last":":first");var a=t.args.getData||o;var f=a(u);t.setValue(f);u.addClass("active");e.preventDefault();t._trigger("q-suggest-user-action",[e,f,r,u])}break;case 13:if(n){var f=t.getValue();t.hide();t._trigger("q-suggest-user-action",[e,f,r,s])}break;case 27:if(n){t.hide();t._trigger("q-suggest-user-action",[e,t.getValue(),r,s])}break;case 18:case 9:break;default:}}function a(e,t){if(!this.init)return new qsuggest(e,t);else return this.init(e,t)}var t=function(){var e="data-detect-oninput",t={},n={},r=1,i=1;var s=function(e,n,r,i){if(e.addEventListener)e.addEventListener(n,r,false);else if(e.attachEvent)e.attachEvent("on"+n,r);(t[i]||(t[i]=[])).push({t:n,h:r})};var o=function(e,n){if(!t[n])return;for(var r=0,i;i=t[n][r];r++)if(e.removeEventListener)e.removeEventListener(i["t"],i["h"],false);else if(e.detachEvent)e.detachEvent("on"+i["t"],i["h"]);delete t[n]};var u=function(e,t){var n=e.value;var r=function(){var i;if((i=e.value)!==n){if(r._sleep!==true)t.call(e,i,n);n=e.value}};return r};var a=navigator.userAgent.toLowerCase();return{version:"1.3",bind:function(t,o){var f,l=o[e];if(!l)o[e]=l=r++;if(!(f=t.getAttribute(e)))t.setAttribute(e,f=""+i++);var c=u(t,o);if("oninput"in t&&!/opera/.test(a))s(t,"input",c,l);else{var h;s(t,"focus",function(){if(!h)h=setInterval(c,100)},l);s(t,"blur",function(){if(h){clearInterval(h);h=null}},l)}n[l]={eid:f,checker:c};return t},unbind:function(t,r){if(r[e]){o(t,r[e]);delete n[r[e]]}return t},set:function(t,r){var i=t.getAttribute(e);if(i){var s=[];for(var o in n)if(n[o]["eid"]===i){s.push(n[o]["checker"]);n[o]["checker"]._sleep=true}t.value=r;for(var u=0,a=s.length;u<a;u++){s[u].call(t);s[u]._sleep=false}}else t.value=r}}}();e.qsuggest={version:"1.2"};var n=e.qsuggest.ROOT_KEY="q-suggest";var r=0;var i={ajax:{url:null,cache:false,success:function(){}},reader:function(e){return e},loader:function(e){return e},max:10,min:1,container:null,delay:100,rdelay:1e3,requestWithNothing:false,trimQuery:true,autoSelect:true,css:{"z-index":500},setValue:function(e){return e},render:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},exattr:function(e){return e}};e.extend(a.prototype,{init:function(s,a){this.key=++r;var f=this.ns=n+this.key;a=this.args=e.extend(true,{},i,a||{});var l=this.activeEl=e(s);var c=this;this.el=e('<div class="'+n+(a.customClass?" "+a.customClass:"")+'"></div>').appendTo(a["container"]||document.body).hide();this.el.data(n,this);this._handler=null;this._ajaxHandler=null;this._excludeEl=null;this._mouseFocus=null;this._last=[];this._cache={};this._value=null;e.each(a["on"]||{},function(e,t){l.bind(e+"."+f,t)});if(a["css"])this.el.css(c.args["css"]);var c=this;var h=false;l.bind("keydown."+f,function(e){var t=e.keyCode;if(t>=229){h=true}});t.bind(l[0],function(){c.show()});l.bind("keydown."+f,function(e){if(h){h=false;return}var t=c.args.keyevent||u;t.call(c,e);h=false});l.bind("blur."+f,function(e){if(c.visible()){var t=c.el.find("tr.active");if(t.length>0){var n=c.args.getData||o;if(c.args.autoSelect){c.setValue(n(t))}}else{c._trigger("q-suggest-noresult",[l])}c.hide()}});e("tr",this.el[0]).live("mouseover."+f+" mouseout."+f+" mousedown."+f,function(t){var n=e.nodeName(t.target,"tr")?e(t.target):e(t.target).parents("tr").eq(0);if(e(n[0]).attr("data-sug_type")==1){t.preventDefault();return}var r=n[0]!=c._excludeEl;if(t.type==="mouseover"){if(r){n.parents().children().removeClass("active");n.addClass("active");c._excludeEl=null}c._mouseFocus=n[0]}else if(t.type==="mouseout"){c._mouseFocus=null}else{var i=c.args.getData||o;c.setValue(i(n));c.hide();c._trigger("q-suggest-user-action",[t,c.getValue(),null,n])}});return this},req:function(){var t=this;if(t._handler)clearTimeout(t._handler);if(t._timeoutHandler){clearTimeout(t._timeoutHandler);t._timeoutHandler=null}if(t._ajaxHandler){t._ajaxHandler=null}t._handler=setTimeout(function(){var n=t.activeEl.val(),r=t.args.loader(n),i=null,s;if(t.args.trimQuery)r=e.trim(r);if(!r&&!t.args.requestWithNothing){t.draw(null);return}if(t._last&&t._last[0]===r){t.draw(t._last[1]);return}if(t._last&&t._last[0]==r)i=t._last;else if(t.args.cache&&t._cache[r])i=t._cache[r];var o=typeof t.args.ajax.url=="function"?t.args.ajax.url():t.args.ajax.url;if(i)t.draw((t._last=i)[1]);else if(!o)t.draw(null);else{o=o.replace(/\*|([^*]+)$/,encodeURIComponent(r)+"$1");var u=t.args.ajax.success;t._timeoutHandler=setTimeout(function(){t.hide()},t.args.rdelay);t._ajaxHandler=e.ajax(e.extend({},t.args.ajax,{url:o,success:function(e,i){clearTimeout(t._timeoutHandler);t._timeoutHandler=null;t._ajaxHandler=null;if(n!==t.activeEl.val())return;var s=t.args.reader.call(t,e,i);if(t.type(s)==="Array"){t.draw(s);t._last=t._cache[r]=[r,s,i]}u.apply(this,arguments)}}))}},t.args.delay)},type:function(e){return Object.prototype.toString.call(e).slice(8,-1)},show:function(){this.req()},hide:function(){if(this.visible()){this.el.hide();this._trigger("q-suggest-hide")}},draw:function(t){var n=this;this.el.empty();var r=this.args.min,i=this.args.max;if(!t||!t.length||t.length<r){this.hide();return}var o=[],u=this.args.render,a=this.args.exattr,f=true;var l=e.type(this.args.firstChoose)==="undefined"?true:this.args.firstChoose;var c=e.type(this.args.firstFunc)==="undefined"?function(){return true}:this.args.firstFunc;o.push('<table cellspacing="0" cellpadding="2"><tbody>');e.each(t,function(e,t){if(e>=i)return false;var n="";var r=c;if(f&&l&&r(t)){f=false;n=' class="active" '}o.push("<tr",n,' data-ind="',e,'"><td>',u(t),"</td></tr>")});o.push("</tbody></table>");var h=e(o.join("")).appendTo(this.el).data("data",t);if(!this.args["container"])this.el.css(s(this.activeEl));var p=this.args["width"],d=this.activeEl.outerWidth();if(typeof p==="function"){p=p()}if(!p||p<d)p=d;this.el.css("width",p);this.el.show();this._trigger("q-suggest-show",[t])},dispose:function(){this._trigger("q-suggest-dispose");this.activeEl.unbind("."+this.ns);e(window).unbind("."+this.ns);this.el.remove()},visible:function(){return this.el.is(":visible")},_trigger:function(){this.activeEl.triggerHandler.apply(this.activeEl,arguments)},setValue:function(e){t.set(this.activeEl[0],e);this._value=e;this._setExtData();this._trigger("q-suggest-setvalue",[e,this.activeEl])},_setExtData:function(){var e=this.el.find("tr.active");var t=this.args.getExtData?this.args.getExtData(this.el.find("tr.active")):{};this._trigger("q-suggest-setextdata",[t,this.activeEl])},getValue:function(){return this._value},set:function(e,t){var n=false;switch(e){case"container":this.el.appendTo(t||document.body);this.el.css({top:"",left:""});break}if(!n)for(var r=0,i=e.split("."),s=i.length,o=this.args;r<s&&(r!==s-1&&(o[i[r]]||(o[i[r]]={}))||(o[i[r]]=t));o=o[i[r]],r++){}return t},get:function(e){for(var t=0,n=this.args,r=e.split("."),i=r.length;t<i&&(n=n[r[t]]);t++){}return n}});e.fn.qsuggest=function(){var t=arguments;if(arguments.length>1&&this.data(n)){var r=null;if(arguments[0]==="option"||arguments[0]==="setting")this.each(function(i,s){var o=e(s);var u=this.data(n);if(u)r=r||(t.length>2?u.set(t[1],t[2]):u.get(t[1]))});return r}else if(arguments.length<=1){this.each(function(r,i){var s=e(i);if(s.data(n)){s.data(n).dispose();s.removeData(n)}var o=new a(i,t[0]);s.data(n,o)})}return this}})(jQuery)}(t.exports,t,e);e.____MODULES["f359268032ef95a76c48519ac6bb62c6"]=t.exports})(this);(function(e){var t={id:"d1933dd3d16c7e81add897ea1d142dd1",filename:"MarkSuggest.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function a(e){var t=this;if(e){t._observer=e}t._cacheSelected=null;t._suggestResult=null;t._init()}var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];e.____MODULES["f359268032ef95a76c48519ac6bb62c6"];var o=e.____MODULES["88d5c499e26b6f8fc86d873910ae3aea"];var u=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];a.prototype={_init:function(){var e=this;var t=s("#traffic_view");e._dom=t.find(".mark_suggest");e._inputBox=e._dom.find(".input_box");e.$input=e._dom.find(".mark_suggest_inp");e._initEvts();e._initSuggest()},_initEvts:function(){var e=this;var t=e.$input;t.focus(function(e){if(t.val()=="输入熟悉的地点再标记"){t.val("")}t.addClass("kwd_black");u.planBc("search_marker")}).blur(function(e){if(t.val()==""||s.trim(t.val())==""){t.val("输入熟悉的地点再标记");t.removeClass("kwd_black")}}).keydown(function(n){var r=n.keyCode;if(r===13){if(e._cacheSelected===null&&e._suggestResult!==null){if(e._suggestResult.length>0){var i=e._suggestResult[0];t.val(i.name);if(e._observer){e._observer.fire("show_mark_suggest_poi",i)}}}}})},_initSuggest:function(){var e=this;var t=0;e.$input.qsuggest({width:250,container:e._inputBox,ajax:{url:"/suggest/custom?q=*&callback=?",dataType:"jsonp",cache:false},delay:50,css:{"z-index":1001,width:"250"},render:function(e){if(e.DIY===true){return'<div class="no_result">'+e.label+"</div>"}var t="";var n="";if(e.city!=undefined&&e.city!=""){n=e.city;t='<span class="city_name">'+n+"</span>"}return'<div data-beacon="suggest_search" data-city="'+n+'">'+e.name+t+"</div>"},firstFunc:function(){return false},reader:function(t){e._cacheSelected=null;t=t||[];var n=[];e._suggestResult=t.data;for(var r=0,i=e._suggestResult.length;r<i;++r){n.push(t.data[r])}if(n.length==0){n[0]={label:"未找到，请重新输入。",DIY:true,name:e.$input.val()}}return n},exattr:function(e){return e.name},getData:function(t){e._cacheSelected=t.closest("table").data("data")[t.attr("data-ind")*1];return e._cacheSelected.name},on:{"q-suggest-user-action":function(t,n,r,i){if(n.type==="mousedown"||i==13){u.planBc("search_marker_enter");if(e._observer&&e._cacheSelected&&e._cacheSelected.DIY!==true){e._observer.fire("show_mark_suggest_poi",e._cacheSelected)}}}},offsetTop:t,autoSelect:false})},_changeSuggestURL:function(){var e=this;var t=e.$input.data("q-suggest");t.args.ajax.url="/suggest/custom?q=*&distIds="+e.cityIds.join(",")+"&callback=?"},_reset:function(){var e=this;e._cacheSelected=null;e._suggestResult=null;e.$input.val("输入熟悉的地点再标记");e.$input.removeClass("kwd_black")},updateModel:function(e){var t=this;t.cityIds=e;t._changeSuggestURL()},show:function(){var e=this;e._reset();e._dom.show()},hide:function(){var e=this;e._dom.hide();e._reset()}};n.exports=a}(t.exports,t,e);e.____MODULES["d1933dd3d16c7e81add897ea1d142dd1"]=t.exports})(this);(function(e){var t={id:"f925719cdf04599aefc650349ef5a8e7",filename:"TrafficView.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["4ac223463c8cb76debdd73127d225d1c"];var u=e.____MODULES["2c4f393b42a71856e484edcdc2b8e137"];var a=e.____MODULES["17b7573834268d5d64191afde2264674"];var f=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var l=e.____MODULES["d1933dd3d16c7e81add897ea1d142dd1"];var c={init:function(e){var t=new i.Event;var n=this._dom=s("#traffic_view").addClass("unselect");this._info_box=n.find("div.info_wrap");this._map_box=n.find("div.traffic_map_box");this._suggest_mod=new l(t);this._map_mod=new a(n.find("div.map_container"),t);this._route_mod=new o(this._info_box,t);this._finish_btn=n.find("button.btn");this._observer=t;this._out_observer=e;this._close_btn=s('<div class="t_close_box"><a href="javascript:;" class="close_btn" ></a></div>');n.append(this._close_btn);this.listen()},listen:function(){function t(t,n){e._out_observer.fire("view_element_edit",t,n);n.context("mark_state",false);var r=n.parent();var i=r.parent();e._map_mod.render(r);e._route_mod.render(r,r.parent().children().length);e._suggest_mod.hide();r.cmpTraffic(n,r,n.order())}var e=this;e._finish_btn.click(function(t){e.hide();f.planBc("close")});e._close_btn.click(function(t){e.hide();f.planBc("editor");e._observer.trigger("hide_around_view");e._observer.trigger("hide_traffic_detail")});e._observer.on("show_traffic_line",function(t,n){n=n||0;var r=t.route_info.plans[n].routes;e._map_mod.renderTraffic(r,t.start,t.end);e._observer.trigger("hide_around_view");e._map_box.addClass("left_add_traffic")});e._observer.on("not_show_traffic_detail",function(){if(e._showed){var t=e._route_mod.getModel();e._map_mod.render(t)}e._map_box.removeClass("left_add_traffic")});e._observer.on("update_day_ele_map",function(t){e._map_mod.render(t)});e._observer.on("traffic_change_day",function(t){var n=window.getModelBook();var r=n.getDayByOrder(t);if(r){e._observer.trigger("hide_around_view");e._day_model=r;r.loadEles(function(){if(e._mode){r.updateTrafficByMode(e._mode,function(){e._route_mod.render(r,n.len());e._map_mod.render(r)})}else{e._route_mod.render(r,n.len());e._map_mod.render(r)}})}e._out_observer.fire("view_change_day",t)});e._observer.on("traffic_view_rm_element",function(t){e._out_observer.fire("view_rm_element",t)});e._observer.on("map_mark_close_click",function(t){e._suggest_mod.hide();e._map_mod.render(t.parent())});e._observer.on("show_mark_suggest_poi",function(t){if(t){e._map_mod.moveAndCenter(t)}});e._observer.on("traffic_view_setpoint_element",function(n,r){var i=r.parent();if(i){e._suggest_mod.updateModel(i.children().map(function(e,t){return e.context("cityId")}))}if(s(n.target).hasClass("js_modify")){t({lat:null,lng:null},r)}e._suggest_mod.show();e._map_mod.markElement(r)});e._observer.on("map_mark_save_click",function(e,n,r){var i={lat:e.latlng.getLat(),lng:e.latlng.getLng(),area:r?1:0,abroad:r};t(i,n)});e._observer.on("view_move_element_in_day",function(t){if(e._showed){e._map_mod.render(t);e._out_observer.fire("view_move_element_in_day",t)}});e._observer.on("render_around_poi",function(t){e._map_mod.renderPoints(t)});e._observer.on("get_map_type",function(){return e._map_mod.type});e._observer.on("show_around_detail",function(t,n){if(e._around_view){e._around_view.updateModel(t)}else{e._around_view=new u(s("#around_view"),t,e._observer)}var r=t.context("travelOrder");var i=e._route_mod.getLocElesMod().getElelst().eq(r);i&&i.addClass("opening_around");e._map_mod.clearAroundPoint();e._around_view.show(n);e._route_mod.hideDetailBox();e._map_box.addClass("left_add_around")});e._observer.on("hide_traffic_detail",function(){e._route_mod.hideDetailBox()});e._observer.on("not_show_around_view",function(){e._map_mod.clearAroundPoint();e._map_box.removeClass("left_add_around")});e._observer.on("clear_around_point_in_map",function(){e._map_mod.clearAroundPoint()});e._observer.on("hide_around_view",function(){var t=e._around_view;t&&t.hide();e._info_box.find(".t_middle").find("li.opening_around").removeClass("opening_around")});e._observer.on("remove_around_marker_in_map",function(t,n){e._map_mod.removeAroundMarker(t,n)})},openTrafficDetail:function(e){this._observer.fire("show_traffic_detail",e)},openAroundView:function(e){var t=e.context("travelOrder");this._observer.trigger("show_around_detail",e)},show:function(e,t,n){this._showed=true;this._mode=n;this._dom.css("top",0);this._day_model=e;this._route_mod.render(e,t);this._map_mod.render(e)},hide:function(){this._showed=false;this._mode=null;this._dom.css("top",-1e4);this._route_mod.unModel();i.PubSub.fire("reset_map_button");this._observer.fire("hide_around_view")}};n.exports=c}(t.exports,t,e);e.____MODULES["f925719cdf04599aefc650349ef5a8e7"]=t.exports})(this);(function(e){var t={id:"832159c35f124bc1ae44d562778e0def",filename:"day_order_info.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["day_order_info"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<h3 class="day_order_info">第<em class="day_order">');r.b(r.v(r.f("day_order",e,t,0)));r.b("</em>天</h3>");r.b("\n"+n);r.b('<h5 class="day_order_date">');r.b("\n"+n);if(r.s(r.f("showDateinfo",e,t,1),e,t,0,124,280,"{{ }}")){r.rs(e,t,function(e,t,r){r.b('    <div class="date_ct">');r.b("\n"+n);r.b('    	<span class="d_date js_show_calc">');r.b(r.v(r.f("date",e,t,0)));r.b("</span>");r.b("\n"+n);r.b('    	<span class="d_week_day js_show_calc">');r.b(r.v(r.f("week",e,t,0)));r.b("</span>");r.b("\n"+n);r.b("    </div>");r.b("\n")});e.pop()}if(!r.s(r.f("showDateinfo",e,t,1),e,t,1,0,0,"")){r.b('    <div class="date_ct">');r.b("\n"+n);r.b('	<span class="default_txt js_show_calc">选择出发日期</span>');r.b("\n"+n);r.b("    </div>");r.b("\n")}r.b('    <input type="text" value="" style="display:none;" class="date_input textbox js_date_input" maxlength="10" readonly="readonly">');r.b("\n"+n);if(r.s(r.f("showPopMsg",e,t,1),e,t,0,583,749,"{{ }}")){r.rs(e,t,function(e,t,r){r.b('    <div class="tipbox">');r.b("\n"+n);r.b('    	<div class="ct">');r.b("\n"+n);r.b('    		<div class="rectangle"></div>');r.b("\n"+n);r.b('    		<div class="bodystr js_show_calc">点击修改出发日期</div>');r.b("\n"+n);r.b("    	</div>");r.b("\n"+n);r.b("    </div>");r.b("\n")});e.pop()}r.b("</h5>");r.b("\n"+n);r.b("</span></span></h5></em></h3>");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["day_order_info"]}(t.exports,t,e);e.____MODULES["832159c35f124bc1ae44d562778e0def"]=t.exports})(this);(function(e){var t={id:"95c165a157c18931aec3ef757f90e0f0",filename:"day_dest.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["day_dest"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="dest_label" data-id="');r.b(r.v(r.f("city_id",e,t,0)));r.b('" data-disttype="');r.b(r.v(r.f("distType",e,t,0)));r.b('" data-index="');r.b(r.v(r.f("index",e,t,0)));r.b('">');r.b("\n"+n);r.b("    ");r.b(r.v(r.f("city_name",e,t,0)));r.b("\n"+n);r.b('    <i class="del_icon" ></i>');r.b("\n"+n);r.b("</div>");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["day_dest"]}(t.exports,t,e);e.____MODULES["95c165a157c18931aec3ef757f90e0f0"]=t.exports})(this);(function(e){var t={id:"13dcecd938ecb688f4ef5fd9d6ee2353",filename:"element.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["element"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="day_element_node"  data-type="');r.b(r.v(r.f("type",e,t,0)));r.b('" data-poi-id="');r.b(r.v(r.f("poiId",e,t,0)));r.b('"  data-id="');r.b(r.v(r.f("id",e,t,0)));r.b('">');r.b("\n"+n);r.b('    <div class="element_inner">');r.b("\n"+n);r.b('        <div class="element_pic_box">');r.b("\n"+n);r.b('            <img src="');r.b(r.v(r.f("image",e,t,0)));r.b('" ondragstart="return false" draggable="false" class="element_pic" >');r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b('        <dl class="element_info_box">');r.b("\n"+n);r.b('            <dt class="element_name lowie_hover">');r.b("\n"+n);r.b('                <span class="poi_idx" data-idx="');r.b(r.v(r.f("originIdx",e,t,0)));r.b('">');r.b(r.v(r.f("idx",e,t,0)));r.b("</span>");r.b("\n"+n);r.b('                <span class="name_txt">');r.b(r.v(r.f("name",e,t,0)));r.b("</span>");r.b("\n"+n);if(r.s(r.f("showEnName",e,t,1),e,t,0,532,615,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('                    <span class="other_info">');n.b(n.v(n.f("name_info",e,t,0)));n.b("</span>");n.b("\n")});e.pop()}if(r.s(r.f("has_top_order",e,t,1),e,t,0,665,798,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('                    <span class="order"><a target="_blank" class="js_order_link" href="');n.b(n.v(n.f("orderLink",e,t,0)));n.b('">预订</a></span>');n.b("\n")});e.pop()}r.b("            </dt>");r.b("\n"+n);if(r.s(r.f("showAddrRow",e,t,1),e,t,0,863,1639,"{{ }}")){r.rs(e,t,function(e,t,r){r.b('            <dd class="ele_base ele_addr">');r.b("\n"+n);if(r.s(r.f("showAddress",e,t,1),e,t,0,939,1017,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('                <span class="addr_txt">地址：');n.b(n.v(n.f("address",e,t,0)));n.b("</span>");n.b("\n")});e.pop()}if(r.s(r.f("has_lat_lng",e,t,1),e,t,0,1066,1282,"{{ }}")){r.rs(e,t,function(e,t,n){if(n.s(n.f("showAddress",e,t,1),e,t,0,1104,1182,"{{ }}")){n.rs(e,t,function(e,t,n){n.b('                        <span class="grayline">|</span>');n.b("\n")});e.pop()}n.b('                <a href="#" class="view_nearby js_around">查看周边</a>');n.b("\n")});e.pop()}if(r.s(r.f("has_bottom_order",e,t,1),e,t,0,1336,1586,"{{ }}")){r.rs(e,t,function(e,t,n){if(n.s(n.f("showAddress",e,t,1),e,t,0,1374,1452,"{{ }}")){n.rs(e,t,function(e,t,n){n.b('                        <span class="grayline">|</span>');n.b("\n")});e.pop()}n.b('                    <a href="');n.b(n.v(n.f("orderLink",e,t,0)));n.b('" target="_blank" class="view_nearby js_order_link">预订</a>');n.b("\n")});e.pop()}r.b("            </dd>");r.b("\n")});e.pop()}r.b('            <dd class="ele_base ele_memo js_edit_memo">');r.b(r.v(r.f("memo",e,t,0)));r.b("</dd>");r.b("\n"+n);r.b("        </dl>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b('    <div class="day_option_box">');r.b("\n"+n);r.b('        <div class="day_option_list">');r.b("\n"+n);r.b('            <ul class="option_list clrfix">');r.b("\n"+n);r.b('                <li class="option_li  js_edit"><a><i class="edit_icon"></i>编辑</a></li>');r.b("\n"+n);r.b('                <li class="option_li js_del"><a href="#"><i class="del_icon"></i>删除</a></li>');r.b("\n"+n);if(r.s(r.f("hasMoveBtn",e,t,1),e,t,0,2076,2194,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('                <li class="option_li last  js_move"><a href="#"><i class="move_to"></i>移动到</a></li>');n.b("\n")});e.pop()}r.b("            </ul>");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("</div>");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["element"]}(t.exports,t,e);e.____MODULES["13dcecd938ecb688f4ef5fd9d6ee2353"]=t.exports})(this);(function(e){var t={id:"b8d2495a060be43d3045a234ff2b0714",filename:"element_route.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["element_route"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="js_routeline" data-key="');r.b(r.v(r.f("key",e,t,0)));r.b('">');r.b("\n"+n);r.b('    <div  class="route_info p_');r.b(r.v(r.f("mode",e,t,0)));r.b('">');r.b(r.v(r.f("distance",e,t,0)));r.b("</div>");r.b("\n"+n);r.b("</div>");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["element_route"]}(t.exports,t,e);e.____MODULES["b8d2495a060be43d3045a234ff2b0714"]=t.exports})(this);(function(e){var t={id:"f1733d5dd1c12542d7302bd6c9418cbc",filename:"ele_memo.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["ele_memo"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="b_dialog b_memo_box g_dlg_wrap_css3">');r.b("\n"+n);r.b('    <div class="js_content">');r.b("\n"+n);r.b('        <div class="e_dialog_hd paddingpatch">添加旅行备注</div>');r.b("\n"+n);r.b('        <div class="e_dialog_ct" >');r.b("\n"+n);r.b('            <div class="textarea_wrapper">');r.b("\n"+n);r.b('                <div class="text_ct">');r.b("\n"+n);r.b('                    <textarea class="textarea js_textarea"></textarea>');r.b("\n"+n);r.b("                </div>");r.b("\n"+n);r.b('                <div class="font_counter">');r.b("\n"+n);r.b('                    <span class="current">0</span>/2000字');r.b("\n"+n);r.b("                </div>");r.b("\n"+n);r.b('                <div class="error_msg">最多可输入2000字</div>');r.b("\n"+n);r.b("            </div>");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b('        <div class="e_dialog_ft">');r.b("\n"+n);r.b('            <a href="#" class="btn_foot cancel js_close">取消</a>');r.b("\n"+n);r.b('            <a href="#" class="btn_foot ok js_save">确定</a>');r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b('        <a href="#" class="btn_close js_close js_close_new pngfix" title="关闭">x</a>');r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("</div>");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["ele_memo"]}(t.exports,t,e);e.____MODULES["f1733d5dd1c12542d7302bd6c9418cbc"]=t.exports})(this);(function(e){var t={id:"6a19e047c319d409ddbdaa2c88e7dcf2",filename:"ele_order_flight.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["ele_order_flight"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b("//flight.qunar.com/site/oneway_list.htm?searchDepartureAirport=");r.b(r.v(r.f("startCity",e,t,0)));r.b("&searchArrivalAirport=");r.b(r.v(r.f("endCity",e,t,0)));r.b("&searchDepartureTime=");r.b(r.v(r.f("startDate",e,t,0)));r.b("&nextNDays=0&startSearch=true&from=travel_plan");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["ele_order_flight"]}(t.exports,t,e);e.____MODULES["6a19e047c319d409ddbdaa2c88e7dcf2"]=t.exports})(this);(function(e){var t={id:"9ab981af0bcb6bd1e0263f9f6204b87a",filename:"ele_order_train.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["ele_order_train"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b("//train.qunar.com/stationToStation.htm?fromStation=");r.b(r.v(r.f("startCity",e,t,0)));r.b("&&from=travel_plan&toStation=");r.b(r.v(r.f("endCity",e,t,0)));r.b("&date=");r.b(r.v(r.f("startDate",e,t,0)));return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["ele_order_train"]}(t.exports,t,e);e.____MODULES["9ab981af0bcb6bd1e0263f9f6204b87a"]=t.exports})(this);(function(e){var t={id:"5cf46c251ce777b17789c3402ebfefae",filename:"ele_order_hotel.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["ele_order_hotel"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b("//hotel.qunar.com/city/");r.b(r.v(r.f("city",e,t,0)));r.b("/dt-");r.b(r.v(r.f("id",e,t,0)));r.b("/?from=travelhotelplace&fromDate=");r.b(r.v(r.f("startDate",e,t,0)));r.b("&toDate=");r.b(r.v(r.f("endDate",e,t,0)));return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["ele_order_hotel"]}(t.exports,t,e);e.____MODULES["5cf46c251ce777b17789c3402ebfefae"]=t.exports})(this);(function(e){var t={id:"6b7fbe41ab51a167737ac6250c6c42ab",filename:"day_box.mod.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){e.____MODULES["832159c35f124bc1ae44d562778e0def"];e.____MODULES["95c165a157c18931aec3ef757f90e0f0"];e.____MODULES["13dcecd938ecb688f4ef5fd9d6ee2353"];e.____MODULES["b8d2495a060be43d3045a234ff2b0714"];e.____MODULES["f1733d5dd1c12542d7302bd6c9418cbc"];e.____MODULES["6a19e047c319d409ddbdaa2c88e7dcf2"];e.____MODULES["9ab981af0bcb6bd1e0263f9f6204b87a"];e.____MODULES["5cf46c251ce777b17789c3402ebfefae"];var i=window.QTMPL;n.exports={day_order_info:i.day_order_info,day_dest:i.day_dest,element:i.element,ele_memo:i.ele_memo,order_flight:i.ele_order_flight,order_train:i.ele_order_train,order_hotel:i.ele_order_hotel}}(t.exports,t,e);e.____MODULES["6b7fbe41ab51a167737ac6250c6c42ab"]=t.exports})(this);(function(e){var t={id:"7a7b763f57a38c2f1efb532a7007aaea",filename:"Storage.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r=function(e,t){if(e.Storage){return e.Storage}var n={_store:null,_getStore:function(){if(this._store){return this._store}if(!!t.localStorage){this._store=r}else{this._store=i}return this._store},isAvailable:function(){return!!this._getStore()},setItem:function(e,t){var n=this._getStore();return n&&n.setItem(e,t)},getItem:function(e){var t=this._getStore();return t&&t.getItem(e)},removeItem:function(e){var t=this._getStore();return t&&t.removeItem(e)},clear:function(){var e=this._getStore();e&&e.clear()},onstorage:function(e,t){var n=this._getStore();n&&n.onstorage(e,t)},sync:function(t,r,i,s){if(!e.isFunction(t))return false;var o=this._genSyncKey(t);var u="~{##}~";var a="~{###}~";var f=false;this.onstorage(s||o,function(e){if(!f||!n.isStoreTriggerSelf()){try{var i=e.split(u)[1],s=i.split(a);t.apply(r,s)}catch(o){console.log("sync event error",e)}}f=false});var l=this;return function(){if(!i){t.apply(r,arguments)}f=true;l.setItem(s||o,new Date*1+""+Math.random()+u+[].slice.call(arguments).join(a))}},_genSyncKey:function(e){var t=30,e=e.toString();var n="",r=/^function\s+([^\(]+)\s*\(/ig,i=r.exec(e);if(i){n=i[1];n=n.replace(/[^\w]+/ig,"")}e=e.replace(/(function|[^\w]+)/ig,"");t-=n.length;if(t<=0){return n.substring(0,30)}if(e.length<=t){return n+e}var s=t,o=e.length,u=Math.ceil(e.length/t),a=[];for(var f=0;f<e.length;f+=u){a.push(e.substring(f,f+1));s--;o-=u;if(o<=s){a.push(e.substring(f));break}}return n+a.join("")},isStoreUseTimer:function(){return this._getStore().useTimer},isStoreTriggerSelf:function(){return this._getStore().triggerSelf},getStoreInterval:function(){return this._getStore().interval}};var r=function(){function r(e,r){var i=n[e];return function(s){setTimeout(function(){s=s||t.storageEvent;var o=s.key,u=s.newValue;if(!o){var a=n[e];if(a!=i){o=e;u=a}}if(o==e){r&&r(u);i=u}},0)}}var n=t.localStorage;return{getItem:function(e){return n.getItem(e)},setItem:function(e,t){return n.setItem(e,t)},removeItem:function(e,t){return n.removeItem(e)},clear:function(){return n.clear()},onstorage:function(n,i){var s=e.Browser;if(!this.useTimer){if(document.attachEvent&&!s.isOpera){document.attachEvent("onstorage",r(n,i))}else{t.addEventListener("storage",r(n,i),false)}}else{var o=r(n,i);setInterval(function(){o({})},this.interval)}},useTimer:e.Browser.isIE6||e.Browser.isIE9||e.Browser.isChrome,triggerSelf:e.Browser.isIE||e.Browser.isChrome||e.Browser.isIE11,interval:1e3}}();var i=function(){function t(e,t){var n=i.getItem(e);return function(){var r=i.getItem(e);if(n!=r){t&&t(r);n=r}}}var e="testlocal_storage";return{_store:null,_getStore:function(){if(!this._store){try{this._store=document.createElement("input");this._store.type="hidden";this._store.addBehavior("#default#userData");document.body.appendChild(this._store)}catch(e){var t=[];for(var n in e){t.push(n+": "+e[n])}document.title=t.join("\n");return false}}return this._store},getItem:function(t){var n=this._getStore();if(!n)return false;n.load(e);return n.getAttribute(t)},setItem:function(t,n){var r=this._getStore();if(!r)return false;r.load(e);r.setAttribute(t,n);r.save(e)},removeItem:function(t,n){var r=this._getStore();if(!r)return false;r.load(e);r.removeAttribute(t);r.save(e)},clear:function(){var t=this._getStore();if(!t)return false;var n=t.XMLDocument;var r=n.selectSingleNode("ROOTSTUB");for(var i=0;i<r.attributes.length;++i){var s=r.attributes[i];t.removeAttribute(s.baseName)}t.save(e)},onstorage:function(e,n){var r=t(e,n);setInterval(function(){r()},this.interval)},isAvailable:function(){try{var e=this._getStore();if(!e)return false;e.save();return true}catch(t){if(t.number&&Math.abs(parseInt(t.number))==2146827838){return true}if(t.description&&(t.description.indexOf("Wrong number")!=-1||t.description.indexOf("错误的参数个数")!=-1)){return true}return false}},useTimer:true,interval:1e3,triggerSelf:true}}();e.Storage=n;return n}(QNR,window);t.exports=r}(t.exports,t,e);e.____MODULES["7a7b763f57a38c2f1efb532a7007aaea"]=t.exports})(this);(function(e){var t={id:"4f04804537728a786fda904b6a7d8ac4",filename:"index.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["7a7b763f57a38c2f1efb532a7007aaea"];n.exports=i}(t.exports,t,e);e.____MODULES["4f04804537728a786fda904b6a7d8ac4"]=t.exports})(this);(function(e){var t={id:"0236011a11f892ee83ded579d0d56f82",filename:"DayTitle.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=e.____MODULES["6b7fbe41ab51a167737ac6250c6c42ab"];var o=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var u=e.____MODULES["4f04804537728a786fda904b6a7d8ac4"];var a=function(e,t){var n=this;n._box=e;n._observer=t;n._init()};a.prototype={_init:function(){var e=this,t=e._box;e._map_btn=i(".day_map_button",t);e._next_btn=i(".next",t);e._prev_btn=i(".prev",t);e._day_order_box=i(".day_order_info_box",t);e.listen()},listen:function(){var e=this;e._map_btn.click(i.proxy(e.__event_map_btn_click,e));e._next_btn.click(i.proxy(e.__event_next_click,e));e._prev_btn.click(i.proxy(e.__event_prev_click,e));e._observer.on("reset_map_button",function(){e._map_btn.text("关闭地图");e._map_btn.removeClass("day_map_button_active")})},__event_map_btn_click:function(e){e.preventDefault();var t=this;o.planBc("open_plan_map");t._observer.fire("view_day_map",this._day_order)},__event_next_click:function(e){e.preventDefault();if(e.target.className.indexOf("disable")>-1){return}this.changeDay(1);o.planBc("next_day")},__event_prev_click:function(e){e.preventDefault();if(e.target.className.indexOf("disable")>-1){return}this.changeDay(-1);o.planBc("up_day")},changeDay:function(e){var t=this,n=t._day_order,r=n+e;t._observer.fire("view_change_day",r)},render:function(e){var t=this,n=e.day_date,r=n&&o.format(n,"MM月dd日"),i=n&&o.getWeekDay(n),a=e.dayOrder,f;t._day_data=e;var l=n?true:false;var c=t._observer.getDayLen();t._day_order=a;a+=1;f={day_order:a,date:r,week:i,showDateinfo:l?true:false,showPopMsg:u.getItem("showCalcTip")?false:true};var h=s.day_order_info.render(f);t._day_order_box.html(h);var p=t._day_order_box.find(".js_date_input");t.initDatePicker(p,e.day_date,a);t._day_order_box.find(".js_show_calc").click(function(e){var t=p.data("q-datepicker");t&&t.show()});if(getModelBook().len()===1){t._next_btn.addClass("next_disable");t._prev_btn.addClass("prev_disable");return}if(a===c){t._next_btn.addClass("next_disable");t._prev_btn.removeClass("prev_disable")}else if(a===1){t._prev_btn.addClass("prev_disable");t._next_btn.removeClass("next_disable")}else{t._next_btn.removeClass("next_disable");t._prev_btn.removeClass("prev_disable")}},initDatePicker:function(e,t,n){var r=this;var i=t&&o.minusDay(t,n-1);var s=i&&o.format(i,"yyyy-MM-dd");e.qdatepicker({ui:"qunar",multi:1,defaultDay:t||new Date,customClass:"startdate",customActiveClass:"dpstartdate",forceCorrect:false,on:{"q-datepicker-show":function(){u.setItem("showCalcTip",1);r._box.find(".tipbox").remove()},"q-datepicker-hide":function(){},"q-datepicker-select":function(e,t){var i=o.minusDay(t,n-1);var u=o.format(i,"yyyy-MM-dd");if(s!==u){r._observer.trigger("view_start_date_update",i)}}}})}};n.exports=a}(t.exports,t,e);e.____MODULES["0236011a11f892ee83ded579d0d56f82"]=t.exports})(this);(function(e){var t={id:"edb44368d6da1ca32d60ffa026712ff5",filename:"jquery.placeholder.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){(function(e){e.fn.qplaceHolder=function(t){var n="qplaceholder";var r=t&&t.customClass;var i=t&&t.placeholder;var s=t&&t.allBrowser||false;var o;if(s){o=false}else{o=function(){return"placeholder"in document.createElement("input")}();if(o){return this}}this.each(function(t,s){function p(){if(e.trim(o.val())===""){l.show()}else{l.hide()}}var o=e(s);var u=o.parent("div"),a=i||o.attr("placeholder"),f=e.trim(o.val()),l;if(!a){return false}o.removeAttr("placeholder");var c=parseInt(o.css("line-height")||o.css("height")||0,10)+parseInt(o.css("padding-top")||0,10)+parseInt(o.css("padding-bottom")||0,10);var h={display:f===""?"block":"none",position:"absolute",left:parseInt(u.css("padding-left")||0,10)+parseInt(o.css("padding-left")||0,10),top:parseInt(u.css("padding-top")||0,10),height:c+"px","line-height":c+"px",color:"#999","font-size":"14px"};u.css({position:"relative"});l=a instanceof e?a:e("<span>"+a+"</span>");r?l.addClass(r):l.css(h);u.append(l);o.data("qplaceholder",l);o.bind("propertychange."+n,p);o.bind("change."+n,p);o.bind("blur."+n,p).bind("focus."+n,function(){l.hide()});l.bind("click."+n,function(){o.trigger("focus")});l.bind("focus."+n,function(){o.trigger("focus")})});return this}})(jQuery)}(t.exports,t,e);e.____MODULES["edb44368d6da1ca32d60ffa026712ff5"]=t.exports})(this);(function(e){var t={id:"525d1dc0d8839c64abc3253ded526e97",filename:"jquery.qlimitlen.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];(function(e){function t(t){var n=this;var r=e.trim(n.val());var s=Math.ceil(i.countStrByWord(r));if(s<=t){n.trigger("action_less",s);return}if(s>t){r=i.cutString(r,t,"");n.trigger("action_more",s)}n.val(r)}e.fn.qlimitlen=function(n,r){var i="qlimitlen";this.each(function(s,o){var u=e(o);var a=a||20;if(!n){return}u.bind("keyup."+i,e.proxy(t,u,n));u.bind("keydown."+i,e.proxy(t,u,n));u.bind("check",e.proxy(t,u,n));u.trigger("check");if(r){for(i in r){u.bind(i,e.proxy(r[i]))}}});return this}})(jQuery)}(t.exports,t,e);e.____MODULES["525d1dc0d8839c64abc3253ded526e97"]=t.exports})(this);(function(e){var t={id:"fb6676bbeb3f7bf171ccf693306b1d38",filename:"suggest.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function s(e){function r(){var e=t.data("q-suggest");t.parent("div").addClass("sctext_box_on")}function i(){t.parent("div").removeClass("sctext_box_on")}var t=e.el;var n=e.entercb;t.qsuggest($.extend(e,{autoSelect:false,delay:100}));t.bind("focus.on",r);t.bind("blur.off",i);t.bind("keyup",function(e){var n=e.keyCode||e.which;if(n!=40&&n!=38&&n!=13){t.data("q-suggest").show()}})}var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];e.____MODULES["f359268032ef95a76c48519ac6bb62c6"];n.exports=s}(t.exports,t,e);e.____MODULES["fb6676bbeb3f7bf171ccf693306b1d38"]=t.exports})(this);(function(e){var t={id:"cca8bfa16c042ce6eb4021cac0c04274",filename:"config.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r={SUG_URLS:{CITY:"/suggest/plan?q=*&type=1&limit=4&callback=?",AREA:"/suggest/plan?q=*&type=2&limit=7&callback=?"},SEARCH_URI:"/place/api/dist/np/{{distId}}?new_plan=true",SEARCH_HOME_DEST_URI:"/place/api/dist/np2/{{distId}}",RECOMMEND_CITYS:"/place/api/dist/recommend_cities",DEST_INFO:{CITY_LOCATION:"/api/mapsearch/distIds/"},DEST_TYPE:{6:"城市",3:"国家",1:"州",7:"城市",0:"国际"}};t.exports=r}(t.exports,t,e);e.____MODULES["cca8bfa16c042ce6eb4021cac0c04274"]=t.exports})(this);(function(e){var t={id:"f499f9cbe4503a398f85810d66af4579",filename:"CitySug.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function f(e){function u(e){var t=c(e);e=h(t);if(!e){return""}var n="";if(!e.id&&!e.isDef){n='<div class="sug_item item sug_selfdefine">添加自定义“'+QNR.HTMLEncode(e.city)+"”</div>"}else{var r=[];var i=[];e.city?r.push(e.city):null;e.country?r.push(e.country):null;e.cityEnName?i.push(e.cityEnName):null;e.countryEnName?i.push(e.countryEnName):null;n='<div class="sug_item item">'+QNR.HTMLEncode(r.join(","))+"&nbsp;"+QNR.HTMLEncode(i.join(","))+"</div>"}return n}function f(e){r=e.data||[];var n=QNR.some(r,function(e){if(e.city==t.val()){return true}});!n&&r.push({query:t.val(),id:0,distType:"6",city:t.val(),cityEnName:"",province:"",provinceEnName:"",country:"中国",countryEnName:"China"});var i=[];var s;for(var o=0,u=r.length;o<u;o++){var a=r[o];s=[a.id,a.distType].join("_");i[i.length]=s}return i}function l(e,t,r,i,s){n(p(h(i)),s)}function c(e){var t;for(var n=0;n<r.length;n++){var i=r[n];if([i.id,i.distType].join("_")==e){t=n;break}}return t}function h(e){return r[e]}function p(e){return{city_name:e.city,city_id:e.id,days:e.trDays||1}}function m(){t.bind("keyup focus",function(e){code=e.keyCode||e.which;defData=t.data("defData");if(defData&&defData.length&&t.val()===""&&(e.type=="focus"||e.type=="keyup"&&code==8)){var n=[];QNR.forEach(defData,function(e){e.isDef=true;n.push([e.id,e.distType].join("_"))});r=defData;if(e.type=="keyup"){setTimeout(function(){t.data("q-suggest").draw(n);t.data("q-suggest")._last=[]},200)}else{t.data("q-suggest").draw(n);t.data("q-suggest")._last=[]}}})}var t=e.el;var n=e.enterFn;var r=[];var s=a.CITY;var d={max:10,customClass:"city_sug",el:i("body"),ajax:{url:s,dataType:"jsonp",cache:false},render:u,reader:f,entercb:l};t.qplaceHolder().qlimitlen(10);var v=i.extend(e.on,{"q-suggest-user-action":function(e,r,i,s,o){var u=o.data("ind");t.val(h(u).city);n&&n(h(u),s)}});e.showDef&&m();o(i.extend(d,e,{on:v}))}var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];e.____MODULES["edb44368d6da1ca32d60ffa026712ff5"];e.____MODULES["525d1dc0d8839c64abc3253ded526e97"];var s=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var o=e.____MODULES["fb6676bbeb3f7bf171ccf693306b1d38"];var u=e.____MODULES["cca8bfa16c042ce6eb4021cac0c04274"];var a=u.SUG_URLS;n.exports=f}(t.exports,t,e);e.____MODULES["f499f9cbe4503a398f85810d66af4579"]=t.exports})(this);(function(e){var t={id:"461f9fd1460bd21be4b632cf6533fbdb",filename:"CityMod.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=window;var s=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var o=e.____MODULES["88d5c499e26b6f8fc86d873910ae3aea"];var u=function(){var e=i.getModelBook();var t={};var n=e.children().map(function(e){return e.getDest()}).expand().filter(function(e){var n=e.cityId;if(n&&!t[n]){t[n]=true;return e}});return n};var a=function(e,t){if(!t&&s.type(e)==="function"){t=e;e={}}var n=e.day||i.getModelBook().getSelectDay();var r=e.page_size||6;var u=n.getDest();var a=u.map(function(e){return e.cityId+"_"+e.distType||6}).join(",");var f="/travelbook/plan/hotcities";o.get(f,{cityIds:a,pageSize:r},function(e){var n=e.data;var r=n.cities||[];if(r.length>10){r=r.slice(0,10)}t(r)},function(){t([])})};n.exports={getCityList:u,getHotCity:a}}(t.exports,t,e);e.____MODULES["461f9fd1460bd21be4b632cf6533fbdb"]=t.exports})(this);(function(e){var t={id:"2711d630d7ade8814168031a697f00b6",filename:"DayDests.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=e.____MODULES["6b7fbe41ab51a167737ac6250c6c42ab"];var o=e.____MODULES["f499f9cbe4503a398f85810d66af4579"];var u=e.____MODULES["461f9fd1460bd21be4b632cf6533fbdb"];var a=e.____MODULES["f2f15a51d66bfd2af2213994bf6d509b"];var f=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var l='<div class="add_dest_box"><div class="add_dest_box_inner"><div class="hot_city"><h4 class="d_title">热门城市:</h4><p class="d_hot_city_box"></p></div><div class="city_sug_box"><div class="d_city_sug"><input type="text" placeholder="添加城市" class="city_sug_inp"></div><div class="sug_con"></div></div></div></div>';var c=function(e,t){var n=this;n._box=e;n._observer=t;n._dest_labels=[];n._init()};c.prototype={constructor:c,_init:function(){var e=this,t=e._box;var n=i(".day_dest_inner",t),r=i(".add_dest_btn",t);e.drag_con=n.parent();e.dest_box=n;e.add_btn=r;e.dest_con=i(".dests_con",t);e._drag_ph=i('<div class="dest_label_ph" ></div>');e._$body=i("body");n.delegate(".dest_label","click",function(t){var n=t.target,r=this,i=this.getAttribute("data-id"),s=this.getAttribute("data-index");dest_name=this.innerText||this.textContent;if(n.className.indexOf("del_icon")>-1){e._observer.fire("view_day_rm_dest",s)}else{e.selectDest({cityId:i,cityName:dest_name,distType:this.getAttribute("data-disttype")})}});r.click(function(t){if(!e._add_dest_box){e._initAddDestBox()}e.showDestBox()})},_initAddDestBox:function(){var e=this;var t=i(l).hide();e.dest_con.html(t);e._city_input=t.find("input");e._hot_city_box=t.find(".hot_city");e._add_dest_box=t;o({el:e._city_input,container:t.find(".sug_con"),enterFn:function(t,n){if(n!=13&&n!=null){return}var r={cityId:t.id,cityName:t.city,distType:t.distType};e._observer.fire("view_add_dest_in_day",r);e._add_dest_box.hide();e._city_input.val("");f.planBc("add_search_city")}});e._city_input.keydown(function(e){e.stopPropagation()});e._add_dest_box.mousedown(function(e){e.stopPropagation()});e._$body.on("mousedown.day_dest",function(t){e._add_dest_box.hide()});e._add_dest_box.delegate(".js_dest","click",function(t){t.preventDefault();var n=i(this);var r=n.data("id"),s=n.text(),o=6;e._observer.fire("view_add_dest_in_day",{cityId:r,cityName:s,distType:o});e._add_dest_box.hide();f.planBc("add_dependence_city")})},showDestBox:function(){var e=this;u.getHotCity(function(t){if(t.length){var n=t.map(function(e){return"<a class='dest_name js_dest' href='#' data-id='"+e.distId+"'>"+e.distName+"</a>"}).join("");e._hot_city_box.find("p").html(n);e._hot_city_box.show()}});if(e.add_btn.offset().left+e.add_btn.width()+160>e._box.offset().left+e._box.width()){e._add_dest_box.css({left:-160})}else{e._add_dest_box.css({left:0})}e._add_dest_box.show()},render:function(e){var t=this;var n=e.dest,r=s.day_dest;t._dest_labels.forEach(function(e){e&&e.remove()});t._dest_labels=[];var o=n.map(function(e,t){var n=e.cityId,i=e.cityName;if(!n){n=0}if(i){return r.render({index:t,city_id:n,city_name:i,distType:e.distType})}}).filter(function(e){return e!==void 0}).join("");this.dest_box.html(o);this.dest_box.find(".dest_label").each(i.proxy(t.wrapLabel,t))},selectDest:function(e){this._observer.trigger("view_show_dest",e)},remove:function(){this._dest_labels.forEach(function(e){e.remove()});this._box.remove();this._$body.unbind("mousedown.day_dest")},wrapLabel:function(e,t){var n=this;t=i(t);var r=new a({drag_able_dom:t,container:i("#day_detail_out_box"),html:function(){var e=t.clone();var n=t.offset();n.position="absolute";n.width=t.width();n.zIndex=9999;e.css(n).data({rect:{w:n.width,h:t.height()}});return e},drag_start:function(){t.hide()},move:function(e,t){var r=e.data("rect");var i=QNR.mix({},r,t);var s=n.locate(i);if(s){var o=s.target;n._drag_ph.remove();if(o){o.before(n._drag_ph)}else{n.dest_box.append(n._drag_ph)}n._drag_ph.data("index",s.index)}},drag_end:function(){var e=n._drag_ph.data("index");var r=n._dest_labels.map(function(e){return e.dom}).indexOf(t);if(r===e||typeof e==="undefined"){t.show()}else{var s=n._dest_labels[r];n._drag_ph.replaceWith(t);t.show();n._dest_labels.splice(r,1);if(r<e){e-=1}n._dest_labels.splice(e,0,s);var o=[];QNR.forEach(n._dest_labels,function(e){e&&o.push(e)});n._dest_labels=o;n._observer.trigger("view_day_dest_redraw",n._dest_labels.map(function(e){var t=e.dom;return{cityId:t.data("id"),cityName:i.trim(t.text()),distType:t.data("disttype")}}))}n._drag_ph.remove()}});var s={remove:function(){r.undrag();this.dom.remove()},dom:t};n._dest_labels.push(s)},locate:function(e){var t=this,n=e.w,r=e.h,i=e.left,s=e.top,o=i+n,u=s+r,a=i+n/2,f=s+r/2;var l=null,c=null;var h=n*r;t._dest_labels.map(function(e){return e&&e.dom}).some(function(e,t){if(!e.is(":visible")){return false}var n=QNR.mix(e.offset(),{w:e.width(),h:e.height()});var r=Math.max(i,n.left),a=Math.max(s,n.top),f=Math.min(o,n.left+n.w),l=Math.min(u,n.top+n.h);if(r>f||a>l){return false}var h=r+(f-r)/2,p=n.left+n.w/2;if(h<p){c=t}else{c=t+1}return true});if(c!==null){c=Math.min(Math.max(0,c),t._dest_labels.length);var p,l=(p=t._dest_labels[c])?p.dom:null;return{index:c,target:l}}return null}};n.exports=c}(t.exports,t,e);e.____MODULES["2711d630d7ade8814168031a697f00b6"]=t.exports})(this);(function(e){var t={id:"6f8bff04201cef34f595d070aa638486",filename:"DayMemo.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var o=function(e,t){var n=this;n._box=e;n._observer=t;n._init()};o.prototype={constructor:o,_init:function(){var e=this,t=e._box;var n=i(".day_memo_ph",t);var r=i("textarea",t);var o=i(".errmsg",t);e.memo_input=r;e.ph=n;e.error_box=o;n.click(function(e){r.focus()});r.focus(function(){n.hide()}).blur(function(){var t=this.value,r;r=i.trim(t);e.submit(r);if(!r){n.show()}}).mousewheel(function(e){e.stopPropagation()});s.bindInput(r,function(t){e._check(t)})},submit:function(e){var t=this;if(t._check(e)){t._observer.fire("view_day_memo",e)}},_check:function(e){if(s.countStrByWord(e)>2e3){this.showError("<span class='highclr'>您已超过最大限制2000字</span>");return false}this.error_box.hide();return true},showError:function(e){this.error_box.html(e).show()},render:function(e){var t=this;var n=e.memo;if(n){t.ph.hide();t.memo_input.val(n)}else{t.ph.show();t.memo_input.val("")}}};n.exports=o}(t.exports,t,e);e.____MODULES["6f8bff04201cef34f595d070aa638486"]=t.exports})(this);(function(e){var t={id:"11d53d0a2d1dc8c93a23f5a39cd9dde2",filename:"jquery.putCursorAtEnd.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){(function(e){jQuery.fn.putCursorAtEnd=function(){return this.each(function(){e(this).focus();if(this.setSelectionRange){var t=e(this).val().length*2;this.setSelectionRange(t,t)}else{e(this).val(e(this).val())}this.scrollTop=999999})}})(jQuery)}(t.exports,t,e);e.____MODULES["11d53d0a2d1dc8c93a23f5a39cd9dde2"]=t.exports})(this);(function(e){var t={id:"7f400bc39f0ba5be13acac4546ecdba1",filename:"dialog.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r=function(e,t,n){if(n.Dialog){return n.Dialog}var r=!!e.browser.msie,i=r&&e.browser.version==="6.0",s=e(t.document),o=e("body"),u=e(t);var a=16;var f=n.Browser.isMac;var l=false;e(function(){o=e("body")});var c='<div class="dlg_mask"></div>',h='<div class="g_dlg_box"></div>';var p="dlg",d=0,v=0,m=1e5;var g={content:"",maskVisible:true,top:0,left:0,width:0,height:0,newMask:false,contentStyle:"",borderStyle:"",titleStyle:"",closeCls:"",closeBtn:{handler:function(e){e.close()}},hideCloseBtn:false};var y=function(e,t){var n={},r;for(r in t){if(t.hasOwnProperty(r)){n[r]=typeof e[r]!=="undefined"?e[r]:t[r]}}return n};var b=function(){var e=u;return{scrollTop:s.scrollTop(),scrollLeft:s.scrollLeft(),width:e.width(),height:e.height()}};var w="dlg_mask_";var E=function(){this.id=w+ ++d;this._dom=e('<div id="'+this.id+'" class="dlg_mask" style="z-index:'+ ++m+'"></div>');this._init()};E.prototype={_init:function(){o.append(this._dom);this._dom.hide();this._initEvents();this.adaptWin();if(this._needIframe()||true){this._createIframe()}},_initEvents:function(){var e=this},_createIframe:function(){this._iframe=e('<iframe class="dlg_miframe" frameborder="0" src="about:blank"></iframe>');this._dom.append(this._iframe)},addClass:function(e){this._dom.addClass(e)},_needIframe:function(){var n=!!t.ActiveXObject&&(i&&e("select").length||e("object").length);return n},adaptWin:function(){if(i){this._dom.css({top:s.scrollTop(),left:s.scrollLeft(),height:u.height(),width:u.width()})}},hide:function(){this._dom.hide();var t=e("html").css("overflow","");if(f==false){if(l){t.css("padding-right","0px")}}},show:function(){var t=this;var n=u.width();var r=e("html").css("overflow","hidden");var i=u.width();t._dom.show();if(f==false){if(n!=i){l=true;r.css("padding-right",a+"px")}}},getDom:function(){return this._dom},remove:function(){this._dom.remove()}};var S;var x=function(e){var t=e||{};this.config=y(t,g);this._init()};x.prototype={constructor:x,_init:function(){if(!this.config){return}this.id=p+ ++v;var e=this.config;if(e.newMask){this._mask=new E}else{if(!S){S=new E;this._mask=S}else{this._mask=S}}this._creatDialog();this._initEvents();this.inited=true},_initEvents:function(){function n(){if(i){e._dlg_container.css({top:s.scrollTop(),left:s.scrollLeft(),width:u.width(),height:u.height()})}else{e._dlg_container.css({width:u.width(),height:u.height()})}e.toCenter();e._mask.adaptWin()}var e=this,t=this.id;this._closeBtn.bind({click:function(t){t.preventDefault();e.config.closeBtn.handler.call(e,e)}});u.bind("resize."+t,n);e._unbindEvents=function(){u.unbind("resize."+t)};},_creatDialog:function(){var t=this.config;var n=this._dlg_container=e(h).attr("id",this.id).css("z-index",m+=10);if(t.content instanceof e){this._dialog=t.content}else{this._dialog=e(t.content)}var r=this._dialog;r.addClass("g_dlg_wrap_css3");n.html(r);this._content=e(".js_content",r);this._closeBtn=e(".js_close",r);o.append(n);if(t.hideCloseBtn){this._closeBtn.hide()}var a="fixed";if(i){n.css({top:s.scrollTop(),left:s.scrollLeft(),width:u.width(),height:u.height()});a="absoulte"}else{n.css({width:u.width(),height:u.height()})}r.css("position","absolute");this.setPos(a)},setPos:function(e){this._dlg_container.css("position",e)},getContainer:function(){return this._dlg_container},getContent:function(){return this._content},setContent:function(e){this._content.empty();this._content.html(e)},getCloseBtn:function(){return this._closeBtn},_setStyle:function(e,t){if(typeof t=="string"){if(r){e[0].style.cssText=t}else{e.attr("style",t)}}else{e.css(t)}},toCenter:function(){var e=b(),t=this._dialog.width(),n=this._dialog.height(),r=0,s=0;var o=Math.max(e.height/2-n/2>>0+r,0);var u=e.width/2-t/2>>0+s;if(i){u-=a/2}var f={left:u,top:o};this._dialog.css(f);return this},show:function(e,t){var n=this;if(n.config.maskVisible){n._mask.show()}n._dlg_container.css({width:u.width(),height:u.height()});n._dlg_container.show();n.toCenter();if(e){e.call(t||n,n)}n.showed=true;return this},close:function(e,t){var n=this;this._mask.hide();this._dlg_container.hide();if(e){e.call(t||n,n)}this.showed=false;return this},destory:function(){this.close();this._unbindEvents();this.config.newMask&&this._mask.remove();this._dlg_container.remove();this._dialog.remove();for(var e in this){delete this[e]}},getMask:function(){return this._mask}};x.prototype.In=x.prototype.show;x.prototype.out=x.prototype.close;x.prototype.hide=x.prototype.close;x.prototype.remove=x.prototype.destory;n.Dialog=x;n.popMsg=function(t){var n=new x({maskVisible:false,newMask:true,content:['<div class="pop_msg" style="position:relative;" ><table><tr><td>',t,'</td></tr></table><i class="js_close" style="position:absolute;width:16px;height:20px;right:5px;top:5px;"></i></div>'].join(""),closeBtn:{handler:function(e){if(i){clearTimeout(i)}e.remove()}}});n.show();var r=e("html").css("overflow");var i=setTimeout(function(){n.remove();e("html").css({overflow:r})},1500)};return x}(jQuery,window,QNR);t.exports=r}(t.exports,t,e);e.____MODULES["7f400bc39f0ba5be13acac4546ecdba1"]=t.exports})(this);(function(e){var t={id:"9107c28b5689cd09e17d4039d9133542",filename:"index.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var i=e.____MODULES["7f400bc39f0ba5be13acac4546ecdba1"];n.exports=i}(t.exports,t,e);e.____MODULES["9107c28b5689cd09e17d4039d9133542"]=t.exports})(this);(function(e){var t={id:"3088bf3ec780711f9213e7da56f5d917",filename:"EleMemo.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){e.____MODULES["11d53d0a2d1dc8c93a23f5a39cd9dde2"];e.____MODULES["9107c28b5689cd09e17d4039d9133542"];var i=function(){this._constructor()};i.prototype={_constructor:function(){this._memoData=null;this._initDlg();this._initDoms();this._initEvents()},_initDoms:function(){var e=this._$Base=this._mainDlg.getContent();this._$textarea=e.find(".js_textarea");this._$okBtn=e.find(".js_save");this._$counter_ct=e.find(".font_counter");this._$counter=e.find(".font_counter .current");this._$errormsg=e.find(".error_msg")},showBox:function(e,t){this._memoData={memoTxt:e,Context:t};this._setBox(e);this._updateCount();this._mainDlg.show();this._$textarea.putCursorAtEnd()},_setBox:function(e){this._$textarea.val(e)},_clearData:function(){this._memoData=null},_initDlg:function(){var e=this;this._mainDlg=new QNR.Dialog({content:e._getDlgContent()})},_getDlgContent:function(){return window.QTMPL.ele_memo.render()},_initEvents:function(){var e=this;e._$Base.delegate(".js_save","click",function(t){t.preventDefault();if(e._getTextLen()>2e3){e.showErrorMsg()}else{if(e._getTextVal()!==e._memoData.memoTxt){$(e._memoData.Context).trigger("memo_save_click",[e._getParms().memo])}e._mainDlg.close()}});$("body").on("keyup",function(t){if(t.keyCode===27){e._mainDlg.getCloseBtn().trigger("click")}});e._$Base.delegate(".js_close","click",$.proxy(e._clearData,e));e._$textarea.on("keydown keyup",$.proxy(e._updateCount,e))},showErrorMsg:function(){this._$counter_ct.hide();this._$errormsg.show()},hideErrorMsg:function(){this._$errormsg.hide();this._$counter_ct.show()},_updateCount:function(){var e=this;var t=e._getTextLen();if(t>=2e3){e.showErrorMsg();e._$textarea.val(e._getTextVal().substr(0,2e3))}else{e.hideErrorMsg();e._$counter.text(t)}},_getTextLen:function(){return this._getTextVal().length},_getTextVal:function(){return this._$textarea.val()},_getParms:function(){var e={};e.memo=this._getTextVal();return e}};n.exports=new i}(t.exports,t,e);e.____MODULES["3088bf3ec780711f9213e7da56f5d917"]=t.exports})(this);(function(e){var t={id:"faae91d418a28269c766345667db8876",filename:"EleBox.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];e.____MODULES["525d1dc0d8839c64abc3253ded526e97"];var s=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var o=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var u=e.____MODULES["6b7fbe41ab51a167737ac6250c6c42ab"];var a=e.____MODULES["f2f15a51d66bfd2af2213994bf6d509b"];var f=e.____MODULES["1078e55f46c9b52af96debc4b8f2be22"];var l=e.____MODULES["48a6bc89d864a7b0fd198921504df48e"];var c=e.____MODULES["56483375e8bf013e95419f32c44a39a1"];var h=e.____MODULES["3088bf3ec780711f9213e7da56f5d917"];var p=i.Browser;var d=p.isIE7||p.isIE6;var v=[16,15,18,20,14,2,6];var m=function(e){e.hide()};var g=function(e){e.show()};if(d){m=function(e){e.css("visibility","hidden").hide()};g=function(e){e.show().css("visibility","visible")}}var y=function(e){var t=this;t._parent=e.parent;t._observer=e.observer;t._model=e.model;var n=t._init_dom(e.model);f.call(t,i.mix({box:n},e))};var b={SHOW_ATTRS:{},_init:function(e){var t=this,n=t._box;var r=null;var u=t.model();var a=o(".day_option_box",n);var f=o(".option",a);var c=o(".day_option_list",a);t.memoEle=n.find(".js_edit_memo");var p;t.name_txt=n.find(".name_txt");t.ele_num=n.find(".poi_idx");n.mouseenter(function(){n.addClass("day_element_node_hover")}).mouseleave(function(){n.removeClass("day_element_node_hover")}).delegate(".name_txt,.other_info,img","click",function(){var e=t.model();var n=e.context("type_id");var r=e.parent();if(i.indexOf(v,n)>=0&&n!=6){t._observer.fire("user_want_add_other",n,r,e)}else{t._observer.trigger("view_poi_detail",t.model())}if(this.nodeName.toLowerCase()==="img"){s.planBc("click_pic")}else{s.planBc("click_title")}});n.delegate(".js_edit_memo","click",function(e){h.showBox(u.context("memo")||"",t)});n.delegate(".js_edit_memo","mouseenter",function(e){o(this).addClass("ele_hover_yellow")});n.delegate(".js_edit_memo","mouseleave",function(e){o(this).removeClass("ele_hover_yellow")});o(t).on("memo_save_click",o.proxy(t._saveMemo,t));n.find("img").mousedown(function(e){e.preventDefault()});a.mousedown(function(e){e.stopPropagation()}).mousewheel(function(e){e.stopPropagation()});a.delegate(".js_del","click",function(e){e.preventDefault();var n=o(this).offset();n.left=n.left-100;n.top=n.top-50;l.confirm("确认要删除吗?",function(){t._observer.fire("view_rm_element",t.model());s.planBc("delete_poi")},n)});var d=function(e){if(/hotel.qunar.com/.test(e)){i.clickLog(window.SID,"travel_plan_hotel_booking")}else if(/train.qunar.com/.test(e)){i.clickLog(window.SID,"travel_plan_train_booking")}else if(/flight.qunar.com/.test(e)){i.clickLog(window.SID,"travel_plan_plane_booking")}else if(/piao.qunar.com/.test(e)){i.clickLog(window.SID,"travel_plan_sight_booking")}};n.delegate(".js_order_link","mousedown",function(e){e.stopPropagation();d(o(this).attr("href"))});n.delegate(".js_around","click",function(e){e.preventDefault();t._observer.fire("view_ele_around",t.model());s.planBc("nearby")});a.delegate(".js_edit","click",function(e){e.preventDefault();var n=t.model();var r=n.context("type_id");var i=n.parent();t._observer.fire("user_want_add_other",r,i,n);a.mouseleave();s.planBc("edit_poi")});var y,b;a.delegate(".js_move","mouseenter",function(){if(y){clearTimeout(y);y=null}if(b){g(a.find(".day_move_list").focus());return}b=true;var e=t._getDayList();a.find(".day_move_list").remove();if(e.length>0){a.append(e)}});a.delegate(".day_move_list","mouseenter",function(){if(y){clearTimeout(y);y=null}});a.delegate(".js_move,.day_move_list","mouseleave",function(){y=setTimeout(function(){m(a.find(".day_move_list"));b=false},500)});a.delegate(".day_item","click",function(e){e.preventDefault();var n=this.getAttribute("data-order")*1;t._observer.fire("view_move_element_to_day",t.model(),n)});this.onModelEvent()},onModelEvent:function(){var e=this;f.prototype.onModelEvent.apply(this);this._model.parent().on("changed",function(t,n,r){switch(t){case"day_date":if(e._box){e.updateOrderLink()};default:break}})},_saveMemo:function(e,t){var n=this;n._observer.trigger("view_element_edit",{memo:t},n._model);s.planBc("add_notice")},_getDualNum:function(e){var t=e;if(t<10){return"0"+t}else{return t}},adjustByNum:function(e){var t=this;var n=t.ele_num;var r=parseInt(n.data("idx"),10);var i=r+e;this.setEleNo(i)},setEleNo:function(e){this.ele_num.html(this._getDualNum(e+1));this.ele_num.data("idx",e)},_init_dom:function(e){var t=this;var n=e.contextAll();var r;var a=n.transNumber;var f={poiId:n.poiId,image:n.image||c.getImg(e.type(),n),name:n.name+(a?"("+a+")":""),name_info:n.enName||r,showEnName:n.abroad,type:n.type_id,id:n.id,no_memo:!n.memo,memo:n.memo||"点击添加备注",has_lat_lng:e.hasLatLng(),has_edit_btn:i.indexOf(v,e.type())>=0?true:false,location_id:((n.locationId||"")+"").replace(/^g_/,""),idx:t._getDualNum(n.travelOrder+1),originIdx:n.travelOrder,address:n.address,showAddress:n.address?true:false,showAddrRow:(n.address?true:false)||e.hasLatLng(),hasMoveBtn:t._observer.getDayLen()>1?true:false,has_top_order:t.setOrderButtonView("top",n.type_id,e),has_bottom_order:t.setOrderButtonView("bottom",n.type_id,e),orderLink:t.getOrderLink(n.type_id,e)};var l=[];s.forEach(n,function(e,n){var r;if(e&&(r=t.SHOW_ATTRS[n])){var i=r.label;l.push({label:i,content:e})}});f.infos=l;var h=u.element.render(f);var p=o(h);return p},updateOrderLink:function(){var e=this._box.find(".js_order_link");if(e.length===0){return}e.attr("href",this.getOrderLink())},getHotelOrderLink:function(){var e=this._model;var t=e.context("poiIdNum");var n=e.parent().context("hotelMap")||{};var r=this._model.context("poi_detail")||n[t];if(r&&r.qunarSeq){var i=e.parent().context("day_date");var o=new Date;var a=s.format(i);var f=s.format(o);var l=a<=f?o:i;var c=s.plusDay(l,1);var h=r.qunarSeq.split(/_(?=\d+)/);return u["order_hotel"].render({startDate:s.format(l),endDate:s.format(c),city:h[0],id:h[1]})}},getTrafficOrderLink:function(){var e=this._model;var t=e.context("type_id");var n=t===12?"order_train":"order_flight";var r=s.format(e.parent().context("day_date"));var i=s.format(new Date);var o=r<=i?i:r;return u[n].render({startCity:e.context("begin_city")||e.context("startCity"),endCity:e.context("end_city")||e.context("endCity"),startDate:o})},getOrderLink:function(){var e=this._model;var t=this;var n=e.context("type_id");var r={6:function(){return t.getHotelOrderLink()},12:function(){return t.getTrafficOrderLink()},13:function(){return t.getTrafficOrderLink()},4:function(){var t=e.context("poiIdNum");var n=e.parent().context("sightMap")||{};if(t in n){return n[t].webUrl}else{var r=e.context("poi_detail");if(r&&r.bookingUrl){return r.bookingUrl}else if(r&&r.qunarSeq){return window.location.protocol+"//piao.qunar.com/ticket/detail.htm?id="+/\d+/.exec(r.qunarSeq)[0]+"&in_track=travel_around"}}}};var i=r[n];return i&&i()},setOrderButtonView:function(e){var t=this._model;var n=this;var r=t.context("type_id");var i={top:{12:function(){return true},13:function(){return true}},bottom:{6:function(){return true},4:function(){var e=t.context("poiIdNum");var n=t.parent().context("sightMap")||{};var r=t.context("poi_detail");if(e in n){return true}else if(r){if(r.bookingUrl&&r.bookingUrl.length>0){return true}else if(r.priceNumber>0&&r.qunarSeq&&r.qunarSeq.length>0){return true}else{return false}}else{return false}}}};if(i[e]&&i[e][r]){return i[e][r]()}},renderMemo:function(e){this.memoEle.html(s.HTMLEncode(e))},renderName:function(e){var t=this;t.name_txt.html(s.HTMLEncode(e))},modelChange:function(e,t,n){var r=this;switch(e){case"memo":r.renderMemo(t||"点击添加备注");case"begin_city":r.updateOrderLink();case"end_city":r.updateOrderLink();case"name":var i=r._model.context("name");var s=r._model.context("startCity");var o=r._model.context("endCity");var u=r._model.context("transType");var a=i||s&&o||s+"-"+o||u;r.renderName(a);default:break}},_getDayList:function(){var e=this;var t=e.model().parent().order();var n=e._observer.getDayLen();if(n===1){return""}var r="";if(d){if(n>5){r="style='height:128px;overflow-y:auto'"}}var i=['<div class="day_move_list" ',r,'><ul class="day_move_list_inner">',function(e){var n=[],r;for(var i=0;i<e;i++){if(i===t){continue}var s="";if(!r){r=true;s="first"}n.push('<li class="day_item ',s,'" data-order = "'+i+'"><a href="javascript:;" >第',i+1,"天</a></li>")}return n.join("")}(n),"</ul></div>"].join("");return i},getId:function(){return this.context("id")},setDragProxy:function(e){this._drag_proxy=e},remove:function(){if(this._drag_proxy){this._drag_proxy.undrag()}o(this).unbind("memo_save_click",this._saveMemo);f.prototype.remove.apply(this,arguments)}};i.extend(y,f,b);n.exports=y}(t.exports,t,e);e.____MODULES["faae91d418a28269c766345667db8876"]=t.exports})(this);(function(e){var t={id:"01075c6a3339c100f41a0a66e6a27e1a",filename:"EleList.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var o=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var u=e.____MODULES["f2f15a51d66bfd2af2213994bf6d509b"];var a=e.____MODULES["faae91d418a28269c766345667db8876"];var f={nodata:"暂无数据",same:"两点相同"};var l=function(e,t,n){var r=this;r._box=e;r._observer=t;r._dayView=n;r._eles=[];r._init()};l.prototype={constructor:l,_init:function(){var e=this;e._win=e._box.closest(".day_detail_out_box");e._container=e._box.closest(".day_detail_box");e._drag_ph=o('<div class="day_element_node js_drag_ph" style="height:64px;border:1px dashed #ccc;">')},render:function(e){var t=this;var n=e.elements;t._eles.forEach(function(e){e.remove()});t._box.empty();t._eles=[];t._day_order=e.dayOrder;if(n&&n.length){n.forEach(function(e,n){t.addEle(e);t.addTrafficRowDom(e)});t.refreshNo();t.show()}else{t._eles=[];t.hide()}},_getDualNum:function(e){var t=e;if(t<10){return"0"+t}else{return t}},refreshNo:function(){var e=this;e._box.find(".day_element_node").filter(function(e){var t=o(this);var n=t.data("type")===2;if(n){t.find(".poi_idx").hide()}return!n}).each(function(t,n){o(this).find(".poi_idx").text(e._getDualNum(t+1))})},addTrafficRowDom:function(e){var t=this;var n=this._eles,r=e.order();var i=n[r];if(i){var s=i.getDom();var o=s.prev(".day_element_node");if(s.length&&o.length){var u=o.data("poi-id");var a=o.data("id");var l=o.data("type");var c=s.data("poi-id");var h=s.data("id");var p=s.data("type");var d=a+"_"+l+"_"+h+"_"+p;var v=t.getDayModel();var m=v.getTraffic();var g=m[d],y;if(u&&c&&u===c){s.before(t._getRouteHtml(d,f.same,"nodata"))}else{if(g){if(typeof g.route==="string"){g.route=window.JSON.parse(g.route)}y=g.route}if(y&&y.route_info){var b=g.route.mode,w=g.route.distance_txt;s.before(t._getRouteHtml(d,w,b))}else{s.before(t._getRouteHtml(d,f.nodata,"nodata"))}}}}},_getRouteHtml:function(e,t,n){var r=o(window.QTMPL.element_route.render({key:e,distance:t,mode:n}));if(n==="nodata"&&t!=="正在查询中"){r.hide()}else{r.show()}return r},addEle:function(e,t,n){var r=this;var i=new a({model:e,parent:r,observer:r._observer});var u=i.box();if(t==null||r._eles.length==0||t==r._eles.length){r._box.append(u);r._eles.push(i)}else{r._eles[t-1].getDom().after(u);r._eles.splice(t,0,i)}r.wrapEle(i);r.refreshNo();if(o.type(n)==="function"){u.hide().fadeIn(function(){n()})}s.imgLoad(u.find("img")[0],function(){s.fixImg(this,{width:62,height:62})})},rmEle:function(e,t){var n=this,r=n._eles,i=r.indexOf(e);r.splice(i,1);e.remove()},rmEleByIndex:function(e,t){var n=this;var r=this._eles[e];if(r){this._eles.splice(e,1);n.rmEleAndUpdateTraffic(r,e);if(o.type(t)==="function"){r.box().effect("fade",{mode:"hide"},function(){r.remove();n.updateRmNums(e);t()})}}},rmEleAndUpdateTraffic:function(e,t){var n=e.getDom();var r=this._eles.length;if(t===r){n.prev(".js_routeline").remove();return}else if(t===0){n.next(".js_routeline").remove();return}else{n.prev(".js_routeline").remove();n.next(".js_routeline").remove();var i=n.prev(".day_element_node");var s=n.next(".day_element_node");var o=this.get_querying_html(i,s);n.replaceWith(o)}},get_querying_html:function(e,t){if(e&&t){var n=e.data("id")+"_"+e.data("type")+"_"+t.data("id")+"_"+t.data("type");return this._getRouteHtml(n,"正在查询中","nodata")}},renderRowTraffic:function(e,t){if(e){var n=this._box.find(".js_routeline[data-key="+e+"]");if(t&&t.status==="same"){n.replaceWith(this._getRouteHtml(e,f.same,"nodata"))}else if(t&&t.route){n.replaceWith(this._getRouteHtml(e,t.route.distance_txt,t.route.mode))}else{n.replaceWith(this._getRouteHtml(e,f.nodata,"nodata"))}}},len:function(){return this._eles.length},show:function(){var e=this;e._is_show=true;e._box.show()},hide:function(){var e=this;e._is_show=false;e._box.hide()},isShow:function(){return this._is_show},getEleDom:function(e){var t=this._eles[e];return t&&t.box()},wrapEle:function(e){var t=this;var n=e.box();var r;var s=new u({drag_able_dom:n,container:t._container,html:function(){var e=n.clone();var t=n.offset();t.position="absolute";t.width=n.width();e.addClass("day_element_node_drag").css(t).data({rect:{w:t.width,h:n.height()}});return e},drag_start:function(){n.hide();if(!n.prev(".js_routeline").hide().length){n.next(".js_routeline").hide()}n.after(t._drag_ph);r=t._win.offset();r.height=t._win.height()},move:function(e,n){var s=e.data("rect");var o=i.mix({},s,n);var u=t.locate(o);if(u){var a=u.target;t._drag_ph.remove();if(a){a.before(t._drag_ph)}else{t._box.append(t._drag_ph)}t._drag_ph.data("index",u.index)}if(o.top<r.top+100){t._win.scrollTop(t._win.scrollTop()-10)}else if(o.top>r.top+r.height-100){t._win.scrollTop(t._win.scrollTop()+10)}},drag_end:function(){var e=t._drag_ph.data("index");var r=t._eles.map(function(e){return e.box()}).indexOf(n);if(r<e){e-=1}if(r===e||typeof e==="undefined"){t._drag_ph.remove();var i=n.prev(".js_routeline");var s=n.next(".js_routeline");if(i.length&&i.find(".p_nodata").length===0){i.show()}if(s.length&&s.find(".p_nodata").length===0){s.show()}n.show()}else{var o=t._eles[r];n.show();t._eles.splice(r,1);t._eles.splice(e,0,o);var u=n;var a=u.next(".js_routeline");var f=u.prev(".js_routeline");a.remove();f.remove();var l=u.next(".day_element_node");var c=u.prev(".day_element_node");if(l[0]&&c[0]){l.before(t.get_querying_html(c,l))}u.show();t._drag_ph.replaceWith(u);u.next(".js_routeline").remove();u.prev(".js_routeline").remove();var h=u.prev(".day_element_node"),p=u.next(".day_element_node");if(h[0]){u.before(t.get_querying_html(h,u))}if(p[0]){u.after(t.get_querying_html(u,p))}t._observer.trigger("view_move_elements",o.model(),e);t.refreshNo()}t._drag_ph.remove()}});e.setDragProxy(s)},getDayModel:function(){return this._dayView.getDayModel()},updateRmNums:function(e){this.refreshNo()},reload:function(){var e=this.getDayModel();var t=e.contextAll();var n=e.children();t.elements=n;this.render(t)},updateNums:function(e,t,n){if(arguments.length<3){if(i.DEBUG){throw"updateNums!!"}}var r=this;var s=r._eles;for(var o=e;o<t;o++){if(i.DEBUG){console&&console.log(s[o]._box.find(".name_txt").html())}s[o].adjustByNum(n)}},wrapTrafficDom:function(e){var t=this._eles,n=e.order();var r=t[n];if(r){var i=r.getDom();i.attr("data-id",e.context("id"));i.attr("data-poi-id",e.getPoiId());var s=i.prev(".day_element_node");if(i.length&&s.length){i.before(this.get_querying_html(s,i))}}},locate:function(e){var t=this,n=e.w,r=e.h,s=e.left,o=e.top,u=s+n,a=o+r,f=s+n/2,l=o+r/2;var c=null,h=null;var p=n*r;t._eles.map(function(e){return e.box()}).some(function(e,t){if(!e.is(":visible")){return false}var n=i.mix(e.offset(),{w:e.width(),h:e.height()});var r=Math.max(s,n.left),f=Math.max(o,n.top),l=Math.min(u,n.left+n.w),c=Math.min(a,n.top+n.h);if(r>l||f>c){return false}var p=f+(c-f)/2,d=n.top+n.h/2;if(p<d){h=t}else{h=t+1}return true});if(h!==null){h=Math.min(Math.max(0,h),t._eles.length);var d,c=(d=t._eles[h])?d.box():null;return{index:h,target:c}}return null}};n.exports=l}(t.exports,t,e);e.____MODULES["01075c6a3339c100f41a0a66e6a27e1a"]=t.exports})(this);(function(e){var t={id:"a07b3c9326f0e9f77e61ef0532ee7edd",filename:"DayView.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var u=e.____MODULES["0236011a11f892ee83ded579d0d56f82"];var a=e.____MODULES["2711d630d7ade8814168031a697f00b6"];var f=e.____MODULES["6f8bff04201cef34f595d070aa638486"];var l=e.____MODULES["01075c6a3339c100f41a0a66e6a27e1a"];var c=e.____MODULES["1078e55f46c9b52af96debc4b8f2be22"];var h=function(e){var t=this;t._mods=[];var n=s("#day_box");c.call(t,i.mix({box:n},e))};var p={elebox:2};h.prototype={constructor:h,_init:function(e){var t=this,n=t._box,r=t._observer,i=s(".day_title_box",n),h=s(".day_dests_box",n),p=s(".day_element_list",n),d=s(".day_memo_box",n),v=s(".add_tool_box",n);t._win=s("#day_detail_out_box");var m=new u(i,r);var g=new a(h,r);var y=new l(p,r,t);var b=new f(d,r);t._mods=[m,g,y,b];v.delegate(".js_other_add","click",function(e){var n=this;var i=this.getAttribute("type");o.planBc("customer_"+i);r.fire("user_want_add_other",i,t._model)});c.prototype._init.call(this,e);t._initScrollBar()},scrolling:function(e){var t=this;var n=s(e.target);var r=this.getScrollVal();if(r<20){t._win.removeClass("top_border")}else{t._win.addClass("top_border")}},_initScrollBar:function(){var e=this;e._win.bind("scroll",s.proxy(e.scrolling,e))},listen:function(){var e=this;this._observer.on("view_move_elements",function(){e.bodyResize()});this._box.delegate(".js_routeline","click",function(t){i.PubSub.fire("one_day_map_traffic_detail",e.model().context("dayOrder"),s(this).data("key"))});this._observer.on("view_move_element_in_day",function(t){mods=e._mods,model=e._model;if(model===t){var n=model.contextAll();var r=model.children();n.elements=r;mods[2].render(n);e.bodyResize()}})},scrollByOffset:function(e){this._win.scrollTop(this.getScrollVal()+e)},getScrollVal:function(){return this._win.scrollTop()},setScrollToEnd:function(){var e=this.getScrollDom();e.scrollTop(e[0].scrollHeight)},getScrollDom:function(){return this._win},render:function(){var e=this,t=e._mods,n=e._model;var r=n.contextAll();var i=n.children();r.elements=i;t.forEach(function(e){e.render(r)});e.bodyResize()},setModel:function(e){var t=this;if(t._model){t.unModelEvent()}t._model=e;t.onModelEvent();t.render()},getDayModel:function(){return this._model},onModelEvent:function(){var e=this,t=e._model,n=e._model_events;o.forEach(n,function(n,r){t.bind(r,n,e)});c.prototype.onModelEvent.call(this)},unModelEvent:function(){var e=this,t=e._model,n=e._model_events;o.forEach(n,function(e,n){t.unbind(n)});c.prototype.unModelEvent.call(this)},modelChange:function(e,t){var n=this,r=n._mods;switch(e){case"dest":r[1].render({dest:t});break;case"memo":r[3].render({memo:t});break;case"day_date":var i={dayOrder:n._model.context("dayOrder"),day_date:n._model.context("day_date"),bookId:n._model.context("bookId")};r[0].render(i);break;default:}},bodyResize:function(){},_model_events:{before_load_ele_traffic:function(e){this._mods[p.elebox].wrapTrafficDom(e)},day_traffic_update:function(e,t){this._mods[2].renderRowTraffic(e,t)},add_element:function(e,t){var n=this,r=n._mods[2];if(!r.isShow()){r.show()}var i=t===n.model().len()-1;r.addEle(e,t,function(){n.bodyResize();if(i){n.setScrollToEnd(true)}})},rm_element:function(e){var t=this;var n=t._mods[2];n.rmEleByIndex(e,function(){if(n.len()===0){n.hide()}t.bodyResize()})},day_self_rm:function(){this._model=null}},scroll:function(e){var t=this;var n=t._mods[2];var r=n.getEleDom(e);if(!r){return}var i=r[0].getBoundingClientRect();var s=t._win[0].getBoundingClientRect();t.scrollByOffset(i.top-s.top)}};i.extend(h,c);n.exports=h}(t.exports,t,e);e.____MODULES["a07b3c9326f0e9f77e61ef0532ee7edd"]=t.exports})(this);(function(e){var t={id:"8e883c83344d2d6003b35d999a529245",filename:"custom_place.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["custom_place"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<form class="b_place_wrap">');r.b("\n"+n);r.b('    <div class="b_poi_pro clrfix">');r.b("\n"+n);r.b('        <div class="b_plc_box clrfix">');r.b("\n"+n);r.b('            <img class="fl" src="//img1.qunarzz.com/p/p18/201308/05/cc2dffa36ecadbaa93835fbb.jpg_180x120_2b8d0597.jpg" style="width:160px;height:120px;"/>');r.b("\n"+n);r.b('            <div class="b_plc_info">');r.b("\n"+n);r.b("                <ul>");r.b("\n"+n);r.b('                    <li class="bp_tit"><span class="bp_name_ch">北京首都大酒店</span><span class="bp_name_en">beijing hotel</span><li>');r.b("\n"+n);r.b("                    <li>地址：法国王府井大街</li>");r.b("\n"+n);r.b("                </ul>");r.b("\n"+n);r.b("            </div>");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b('    <div class="b_poi_custom">');r.b("\n"+n);r.b('        <div class="b_tr b_tr_name clrfix">');r.b("\n"+n);r.b('           <div class="b_ipt_bx clrfix b_ipt_bx_name">');r.b("\n"+n);r.b('                <label for="p_name" class="b_ipt_name"><span class="star">*</span>名&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;称：</label>');r.b("\n"+n);r.b('                <div class="b_ipt_ct"><div class="b_input_box"><input class="tx_ipt" placeholder="请输入名称" type="text" name="name" autocomplete="off"/><div class="sug_poi_box"></div></div></div>');r.b("\n"+n);r.b("           </div>");r.b("\n"+n);r.b('           <div class="b_tip"></div>');r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b('        <div class="b_tr b_tr_typecity clrfix">');r.b("\n"+n);r.b('           <div class="b_ipt_bx b_ipt_bx_ty clrfix">');r.b("\n"+n);r.b('                <label for="name" class="b_ipt_name"><span class="star">*</span>类&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;型：</label>');r.b("\n"+n);r.b('                <div class="b_ipt_ct">');r.b("\n"+n);r.b('                    <div class="b_cs_sel_wrap">');r.b("\n"+n);r.b('                                <input type="hidden" class="valipt" name="type_id"  data-type="number" readonly="true">');r.b("\n"+n);r.b('                                <input class="cs_sel" type="text" readonly="true">');r.b("\n"+n);r.b('                                <ul class="cs_option">');r.b("\n"+n);r.b('                                    <li val="16"><a href="javascript:;">景点</a></li>');r.b("\n"+n);r.b('                                    <li val="18"><a href="javascript:;">美食</a></li>');r.b("\n"+n);r.b('                                    <li val="20"><a href="javascript:;">购物</a></li>');r.b("\n"+n);r.b('                                    <li val="19"><a href="javascript:;">玩乐</a></li>');r.b("\n"+n);r.b('                                    <li val="21"><a href="javascript:;">交通</a></li>');r.b("\n"+n);r.b("                                </ul>");r.b("\n"+n);r.b("                    </div>");r.b("\n"+n);r.b("                </div>");r.b("\n"+n);r.b("           </div>");r.b("\n"+n);r.b('           <div class="b_ipt_bx b_ipt_bx_cy clrfix">');r.b("\n"+n);r.b('                <label for="name" class="b_ipt_name">城&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;市：</label>');r.b("\n"+n);r.b('                <div class="b_ipt_ct">');r.b("\n"+n);r.b('                    <div class="b_input_box"><input type="hidden" class="ipt_cityid" data-type="number" name="cityId"><input type="hidden" class="ipt_disttype" data-type="number" name="ipt_disttype"><input class="tx_ipt ipt_cityname" name="cityName" type="text" autocomplete="off"><div class="b_cy_sug"></div></div>');r.b("\n"+n);r.b("                </div>");r.b("\n"+n);r.b('                <div class="b_tip"></div>');r.b("\n"+n);r.b("           </div>");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b('    <div class="b_tr clrfix">');r.b("\n"+n);r.b('        <div class="b_ipt_bx b_ipt_box_memo clrfix">');r.b("\n"+n);r.b('            <label class="b_ipt_name">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注：</label>');r.b("\n"+n);r.b('            <div class="b_ipt_ct">');r.b("\n"+n);r.b('                <div class="b_txarea_box">');r.b("\n"+n);r.b('                <textarea class="b_txarea" name="memo"></textarea>');r.b("\n"+n);r.b("                </div>");r.b("\n"+n);r.b('                <div class="tip"></div>');r.b("\n"+n);r.b("            </div>");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("\n"+n);r.b("</form>");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["custom_place"]}(t.exports,t,e);e.____MODULES["8e883c83344d2d6003b35d999a529245"]=t.exports})(this);(function(e){var t={id:"734f7c5d863f0e49fc17f1334d3eaece",filename:"custom_traffic.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["custom_traffic"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<form class="b_traffic_wrap">');r.b("\n"+n);r.b('    <div class="b_tr b_traffic_type clrfix">');r.b("\n"+n);r.b('       <div class="b_ipt_bx clrfix b_ipt_bx_type">');r.b("\n"+n);r.b('            <label for="p_name" class="b_ipt_name"><span class="star">*</span>交通方式：</label>');r.b("\n"+n);r.b('            <div class="b_ipt_ct"><div class="b_radio_box"><label><input type="radio" name="type_id" checked="checked" value="13"/>飞机</label><label><input type="radio" name="type_id" value="12"/>火车</label><label><input name="type_id" type="radio" value="14"/>其他</label></div></div>');r.b("\n"+n);r.b("       </div>");r.b("\n"+n);r.b('       <input name="departure_date" class="departure_date" type="hidden">');r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("\n"+n);r.b('    <div class="b_traffic_item b_traffic_flight">');r.b("\n"+n);r.b('       <div class="b_traffic_explain">输入航班号或城市，可查询交通信息</div>');r.b("\n"+n);r.b('       <div class="b_tr b_tr_number clrfix">');r.b("\n"+n);r.b('          <div class="b_ipt_bx b_ipt_bx_number clrfix">');r.b("\n"+n);r.b('               <label for="name" class="b_ipt_name">航&nbsp;&nbsp;班&nbsp;&nbsp;号：</label>');r.b("\n"+n);r.b('               <div class="b_ipt_ct">');r.b("\n"+n);r.b('                    <div class="b_input_box"><input class="tx_ipt" type="text"/><div class="b_sug"></div></div>');r.b("\n"+n);r.b("               </div>");r.b("\n"+n);r.b("          </div>");r.b("\n"+n);r.b('          <div class="search_btn"><a href="javascript:;" class="js_out" data-beacon="check_flightdetail">查询航班详情</a></div>');r.b("\n"+n);r.b('          <div class="b_tip"></div>');r.b("\n"+n);r.b("       </div>");r.b("\n"+n);r.b('       <div class="b_tr b_tr_city clrfix">');r.b("\n"+n);r.b('          <div class="b_ipt_bx b_ipt_bx_cy b_ipt_box_startcity clrfix">');r.b("\n"+n);r.b('               <label for="name" class="b_ipt_name"><span class="star">*</span>出发城市：</label>');r.b("\n"+n);r.b('               <div class="b_ipt_ct">');r.b("\n"+n);r.b('                    <div class="b_input_box"><input type="hidden" class="ipt_cityid" data-type="number" name="cityId"><input class="tx_ipt ipt_cityname" name="cityName" type="text" autocomplete="off"><div class="b_cy_sug"></div></div>');r.b("\n"+n);r.b("               </div>");r.b("\n"+n);r.b("          </div>");r.b("\n"+n);r.b('          <div class="b_ipt_bx b_ipt_bx_cy b_ipt_box_endcity clrfix">');r.b("\n"+n);r.b('               <label for="name" class="b_ipt_name"><span class="star">*</span>到达城市：</label>');r.b("\n"+n);r.b('               <div class="b_ipt_ct">');r.b("\n"+n);r.b('                  <div class="b_input_box"><input type="hidden" class="ipt_cityid" data-type="number" name="cityId"><input class="tx_ipt ipt_cityname" name="cityName" type="text" autocomplete="off"><div class="b_cy_sug"></div></div>');r.b("\n"+n);r.b("               </div>");r.b("\n"+n);r.b("          </div>");r.b("\n"+n);r.b('          <div class="search_btn search_btn_bycy"><a href="javascript:;" class="js_out"  data-beacon="check_flight">查询</a></div>');r.b("\n"+n);r.b('          <div class="b_tip"></div>');r.b("\n"+n);r.b("       </div>");r.b("\n"+n);r.b('       <div class="b_tr clrfix">');r.b("\n"+n);r.b('           <div class="b_ipt_bx b_ipt_box_memo clrfix">');r.b("\n"+n);r.b('               <label class="b_ipt_name">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注：</label>');r.b("\n"+n);r.b('               <div class="b_ipt_ct">');r.b("\n"+n);r.b('                   <div class="b_txarea_box">');r.b("\n"+n);r.b('                   <textarea class="b_txarea"></textarea>');r.b("\n"+n);r.b("                   </div>");r.b("\n"+n);r.b('                   <div class="tip"></div>');r.b("\n"+n);r.b("               </div>");r.b("\n"+n);r.b("           </div>");r.b("\n"+n);r.b("       </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("\n"+n);r.b('    <div class="b_traffic_item b_traffic_train">');r.b("\n"+n);r.b('       <div class="b_traffic_explain">输入车次或城市，可查询交通信息</div>');r.b("\n"+n);r.b('       <div class="b_tr b_tr_number clrfix">');r.b("\n"+n);r.b('          <div class="b_ipt_bx b_ipt_bx_number clrfix">');r.b("\n"+n);r.b('               <label for="name" class="b_ipt_name">车&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;次：</label>');r.b("\n"+n);r.b('               <div class="b_ipt_ct">');r.b("\n"+n);r.b('                    <div class="b_input_box"><input class="tx_ipt"  type="text"/><div class="b_sug"></div></div>');r.b("\n"+n);r.b("               </div>");r.b("\n"+n);r.b("          </div>");r.b("\n"+n);r.b('          <div class="search_btn"><a href="javascript:;" class="js_out" data-beacon="check_traindetail">查询车次详情</a></div>');r.b("\n"+n);r.b('          <div class="b_tip"></div>');r.b("\n"+n);r.b("       </div>");r.b("\n"+n);r.b('       <div class="b_tr b_tr_city clrfix">');r.b("\n"+n);r.b('          <div class="b_ipt_bx b_ipt_bx_cy b_ipt_box_startcity clrfix">');r.b("\n"+n);r.b('               <label for="name" class="b_ipt_name"><span class="star">*</span>出发城市：</label>');r.b("\n"+n);r.b('               <div class="b_ipt_ct">');r.b("\n"+n);r.b('                  <div class="b_input_box"><input type="hidden" class="ipt_cityid" data-type="number" name="cityId"><input class="tx_ipt ipt_cityname" name="cityName" type="text" autocomplete="off"><div class="b_cy_sug"></div></div>');r.b("\n"+n);r.b("               </div>");r.b("\n"+n);r.b("          </div>");r.b("\n"+n);r.b('          <div class="b_ipt_bx b_ipt_bx_cy b_ipt_box_endcity clrfix">');r.b("\n"+n);r.b('               <label for="name" class="b_ipt_name"><span class="star">*</span>到达城市：</label>');r.b("\n"+n);r.b('               <div class="b_ipt_ct">');r.b("\n"+n);r.b('                  <div class="b_input_box"><input type="hidden" class="ipt_cityid" data-type="number" name="cityId"><input class="tx_ipt ipt_cityname" name="cityName" type="text" autocomplete="off"><div class="b_cy_sug"></div></div>');r.b("\n"+n);r.b("               </div>");r.b("\n"+n);r.b("          </div>");r.b("\n"+n);r.b('          <div class="search_btn search_btn_bycy"><a href="javascript:;" class="js_out" data-beacon="check_train">查询</a></div>');r.b("\n"+n);r.b('          <div class="b_tip"></div>');r.b("\n"+n);r.b("       </div>");r.b("\n"+n);r.b('       <div class="b_tr clrfix">');r.b("\n"+n);r.b('           <div class="b_ipt_bx b_ipt_box_memo clrfix">');r.b("\n"+n);r.b('               <label class="b_ipt_name">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注：</label>');r.b("\n"+n);r.b('               <div class="b_ipt_ct">');r.b("\n"+n);r.b('                   <div class="b_txarea_box">');r.b("\n"+n);r.b('                   <textarea class="b_txarea"></textarea>');r.b("\n"+n);r.b("                   </div>");r.b("\n"+n);r.b('                   <div class="tip"></div>');r.b("\n"+n);r.b("               </div>");r.b("\n"+n);r.b("           </div>");r.b("\n"+n);r.b("       </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("\n"+n);r.b('    <div class="b_traffic_item b_traffic_other">');r.b("\n"+n);r.b('       <div class="b_tr b_tr_typename clrfix">');r.b("\n"+n);r.b('          <div class="b_ipt_bx b_ipt_box_typename clrfix">');r.b("\n"+n);r.b('               <label for="name" class="b_ipt_name"><span class="star">*</span>交通方式：</label>');r.b("\n"+n);r.b('               <div class="b_ipt_ct">');r.b("\n"+n);r.b('                    <div class="b_input_box"><input class="tx_ipt" type="text"/></div>');r.b("\n"+n);r.b("               </div>");r.b("\n"+n);r.b("          </div>");r.b("\n"+n);r.b('          <div class="b_tip"></div>');r.b("\n"+n);r.b("       </div>");r.b("\n"+n);r.b('       <div class="b_tr b_tr_city clrfix">');r.b("\n"+n);r.b('          <div class="b_ipt_bx b_ipt_bx_cy b_ipt_box_startcity clrfix">');r.b("\n"+n);r.b('               <label for="name" class="b_ipt_name"><span class="star">*</span>&nbsp;出&nbsp;发&nbsp;地：</label>');r.b("\n"+n);r.b('               <div class="b_ipt_ct">');r.b("\n"+n);r.b('                   <div class="b_input_box"><input type="hidden" class="ipt_cityid" data-type="number" name="cityId"><input class="tx_ipt ipt_cityname" name="cityName" type="text" autocomplete="off" ><div class="b_cy_sug"></div></div>');r.b("\n"+n);r.b("               </div>");r.b("\n"+n);r.b("          </div>");r.b("\n"+n);r.b('          <div class="b_ipt_bx b_ipt_bx_cy b_ipt_box_endcity clrfix">');r.b("\n"+n);r.b('                <label for="name" class="b_ipt_name"><span class="star">*</span>&nbsp;到&nbsp;达&nbsp;地：</label>');r.b("\n"+n);r.b('               <div class="b_ipt_ct">');r.b("\n"+n);r.b('                   <div class="b_input_box"><input type="hidden" class="ipt_cityid" data-type="number" name="cityId"><input class="tx_ipt ipt_cityname" name="cityName" type="text" autocomplete="off"><div class="b_cy_sug"></div></div>');r.b("\n"+n);r.b("               </div>");r.b("\n"+n);r.b("          </div>");r.b("\n"+n);r.b('          <div class="b_tip"></div>');r.b("\n"+n);r.b("       </div>");r.b("\n"+n);r.b('       <div class="b_tr clrfix">');r.b("\n"+n);r.b('           <div class="b_ipt_bx b_ipt_box_memo clrfix">');r.b("\n"+n);r.b('               <label class="b_ipt_name">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注：</label>');r.b("\n"+n);r.b('               <div class="b_ipt_ct">');r.b("\n"+n);r.b('                   <div class="b_txarea_box">');r.b("\n"+n);r.b('                   <textarea class="b_txarea"></textarea>');r.b("\n"+n);r.b("                   </div>");r.b("\n"+n);r.b('                   <div class="tip"></div>');r.b("\n"+n);r.b("               </div>");r.b("\n"+n);r.b("           </div>");r.b("\n"+n);r.b("       </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("</form>");r.b("\n"+n);r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["custom_traffic"]}(t.exports,t,e);e.____MODULES["734f7c5d863f0e49fc17f1334d3eaece"]=t.exports})(this);(function(e){var t={id:"614289ab5b6d4685d7291af1c8b7aaa1",filename:"custom_notes.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["custom_notes"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<form class="b_note_wrap">');r.b("\n"+n);r.b('    <div class="b_tr clrfix">');r.b("\n"+n);r.b('       <div class="b_ipt_bx clrfix b_ipt_bx_name">');r.b("\n"+n);r.b('            <label for="p_name" class="b_ipt_name">标&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;题：</label>');r.b("\n"+n);r.b('            <div class="b_ipt_ct"><div class="b_input_box"><input class="tx_ipt" type="text" name="name" autocomplete="off"/></div></div>');r.b("\n"+n);r.b("       </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b('    <div class="b_tr clrfix">');r.b("\n"+n);r.b('        <div class="b_ipt_bx b_ipt_box_memo">');r.b("\n"+n);r.b('            <label class="b_ipt_name"><span class="star">*</span>备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注：</label>');r.b("\n"+n);r.b('            <div class="b_ipt_ct">');r.b("\n"+n);r.b('                <div class="b_txarea_box">');r.b("\n"+n);r.b('                <textarea class="b_txarea"></textarea>');r.b("\n"+n);r.b("                </div>");r.b("\n"+n);r.b('                <div class="tip"></div>');r.b("\n"+n);r.b("            </div>");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("</form>");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["custom_notes"]}(t.exports,t,e);e.____MODULES["614289ab5b6d4685d7291af1c8b7aaa1"]=t.exports})(this);(function(e){var t={id:"8301b03653b19a52351ef140af29649d",filename:"custom_hotel.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["custom_hotel"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<form class="b_place_wrap">');r.b("\n"+n);r.b('    <div class="b_poi_pro clrfix">');r.b("\n"+n);r.b('        <div class="b_plc_box clrfix">');r.b("\n"+n);r.b('            <img class="fl" src="//img1.qunarzz.com/p/p18/201308/05/cc2dffa36ecadbaa93835fbb.jpg_180x120_2b8d0597.jpg" style="width:160px;height:120px;"/>');r.b("\n"+n);r.b('            <div class="b_plc_info">');r.b("\n"+n);r.b("                <ul>");r.b("\n"+n);r.b('                    <li class="bp_tit"><span class="bp_name_ch">北京首都大酒店</span><span class="bp_name_en">beijing hotel</span><li>');r.b("\n"+n);r.b("                    <li>地址：法国王府井大街</li>");r.b("\n"+n);r.b("                </ul>");r.b("\n"+n);r.b("            </div>");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b('    <div class="b_poi_custom">');r.b("\n"+n);r.b('        <div class="b_tr b_tr_name clrfix">');r.b("\n"+n);r.b('           <div class="b_ipt_bx clrfix b_ipt_bx_name">');r.b("\n"+n);r.b('                <label for="p_name" class="b_ipt_name"><span class="star">*</span>名&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;称：</label>');r.b("\n"+n);r.b('                <div class="b_ipt_ct"><div class="b_input_box"><input class="tx_ipt" placeholder="请输入名称" type="text" name="name" autocomplete="off"/><div class="sug_poi_box"></div></div></div>');r.b("\n"+n);r.b("           </div>");r.b("\n"+n);r.b('           <div class="b_tip"></div>');r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b('        <div class="b_tr b_tr_typecity clrfix">');r.b("\n"+n);r.b('           <div class="b_ipt_bx b_ipt_bx_cy clrfix">');r.b("\n"+n);r.b('                <label for="name" class="b_ipt_name">城&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;市：</label>');r.b("\n"+n);r.b('                <div class="b_ipt_ct">');r.b("\n"+n);r.b('                    <div class="b_input_box"><input type="hidden" class="ipt_cityid" data-type="number" name="cityId"><input type="hidden" class="ipt_disttype" data-type="number" name="ipt_disttype"><input class="tx_ipt ipt_cityname" name="cityName" type="text" autocomplete="off"><div class="b_cy_sug"></div></div>');r.b("\n"+n);r.b("                </div>");r.b("\n"+n);r.b('                <div class="b_tip"></div>');r.b("\n"+n);r.b("           </div>");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b('    <div class="b_tr clrfix hotel_expand_tr">');r.b("\n"+n);r.b('        <div class="b_ipt_bx b_ipt_box_startdate clrfix">');r.b("\n"+n);r.b('            <label class="b_ipt_name">入住日期：</label>');r.b("\n"+n);r.b('            <div class="b_ipt_ct"><div class="b_input_box b_ipt_date"><input class="tx_ipt" type="text" name="startDate" value="2014-09-21" readonly="true"></div></div>');r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b('        <div class="b_ipt_bx b_ipt_box_enddate clrfix">');r.b("\n"+n);r.b('                <label class="b_ipt_name">离店日期：</label>');r.b("\n"+n);r.b('                <div class="b_ipt_ct"><div class="b_input_box b_ipt_date"><input type="text" class="tx_ipt" placeholder="选择离开日期"/></div></div>');r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b('        <div class="b_msgbox"></div>');r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b('    <div class="b_tr clrfix">');r.b("\n"+n);r.b('        <div class="b_ipt_bx b_ipt_box_memo clrfix">');r.b("\n"+n);r.b('            <label class="b_ipt_name">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注：</label>');r.b("\n"+n);r.b('            <div class="b_ipt_ct">');r.b("\n"+n);r.b('                <div class="b_txarea_box">');r.b("\n"+n);r.b('                <textarea class="b_txarea" name="memo"></textarea>');r.b("\n"+n);r.b("                </div>");r.b("\n"+n);r.b('                <div class="tip"></div>');r.b("\n"+n);r.b("            </div>");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("\n"+n);r.b("</form>");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["custom_hotel"]}(t.exports,t,e);e.____MODULES["8301b03653b19a52351ef140af29649d"]=t.exports})(this);(function(e){var t={id:"e8ee66d21b9db82af58224e73052efab",filename:"custom.mod.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){e.____MODULES["8e883c83344d2d6003b35d999a529245"];e.____MODULES["734f7c5d863f0e49fc17f1334d3eaece"];e.____MODULES["614289ab5b6d4685d7291af1c8b7aaa1"];e.____MODULES["8301b03653b19a52351ef140af29649d"];var i=window.QTMPL;n.exports={custom_place:i.custom_place,custom_traffic:i.custom_traffic,custom_note:i.custom_notes,custom_hotel:i.custom_hotel}}(t.exports,t,e);e.____MODULES["e8ee66d21b9db82af58224e73052efab"]=t.exports})(this);(function(e){var t={id:"c39c5d3ce84ae9413e439dd1e9c4fcfb",filename:"helper.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function o(e,t,n){e.qlimitlen(t,{action_less:function(n,r){var i=i||e.parent().next();var s=t-r;if(s<50){i.html("还可输入<span class='highclr'>"+s+"</span>字")}else{i.html("")}},action_more:function(t,n){var r=r||e.parent().next();r.html("<span class='highclr'>您已达到最大限制2000字</span>")}})}function u(e,t){function r(e){var n=function(t){QNR.forEach(t,function(t){e=e.replace(t,"")});return e}(t);return n.match(/[a-z0-9\u4e00-\u9fa5]+/g)}var n=function(e){var t=[];QNR.forEach(e,function(e,n){if(n==0){t.push("【"+e+"】")}else{t.push("\n【"+e+"】")}});return t.join("")}(t);var i=e.parents(".b_txarea_box");e.bind("blur",function(){var e=$(this);var t=e.val();if(!r(t)){$(this).data("hasval",false);$(this).val(n).addClass("memo_virtual")}else{$(this).data("hasval",true)}i.removeClass("b_ipt_on")}).bind("focus",function(){$(this).removeClass("memo_virtual");i.addClass("b_ipt_on")});e.bind("get_val",function(){var e=$.trim($(this).val());if(r(e)){return e}return""});e.trigger("blur")}function a(e,t){e.each(function(){var e=$(this).find(".ipt_cityname");var n=$(this).find(".ipt_cityid");var r=$(this).find(".ipt_disttype");var s=$(this).find(".b_cy_sug");i({el:e,w:"100%",enterFn:function(i,s){var o={city_name:i.city,city_id:i.id,dist_type:i.distType};e.val(o.city_name);n.val(o.city_id);r.val(o.dist_type);e.trigger("change");t&&t(o)},showDef:true,container:s,on:{"q-suggest-show":function(){n.val(0);t&&t({city_name:e.val(),cityId:0})}}});e.bind("keyup",function(e){if(e.keyCode==13){$(this).trigger("blur");$(this).data("q-suggest").hide();return false}})})}function f(e,t){var n=e.parent();if(e.data("fix")){n.addClass("b_fixdate_bx");return false}e.qdatepicker($.extend({ui:"qunar",multi:1,customActiveClass:"dpstartdate",forceCorrect:false,on:{"q-datepicker-show":function(){n.addClass("b_ipt_on")},"q-datepicker-hide":function(){n.removeClass("b_ipt_on")},"q-datepicker-select":function(){}}},t||{}))}function l(e,t,n){$.ajax({url:e,data:t,cache:false,beforeSend:function(){n("正在查询...")},success:function(e,t,r){n(e)},error:function(e,t,r){n("对不起，查询失败！您可以返回后重新尝试")}})}var i=e.____MODULES["f499f9cbe4503a398f85810d66af4579"];var s=e.____MODULES["e8ee66d21b9db82af58224e73052efab"];n.exports={memoLimitLen:o,memoCheck:u,setCitySug:a,setQdatepicker:f,searchLine:l,memoMax:2e3,typeName:{16:"景点",15:"酒店",6:"酒店",18:"美食",5:"美食",20:"购物",13:"飞机",12:"火车",14:"其他",2:"随记",7:"玩乐",4:"景点",8:"购物",21:"交通"},cus_tpl:function(){return{place:s.custom_place,traffic:s.custom_traffic,note:s.custom_note,hotel:s.custom_hotel}}}}(t.exports,t,e);e.____MODULES["c39c5d3ce84ae9413e439dd1e9c4fcfb"]=t.exports})(this);(function(e){var t={id:"d4c62f2b94cc901a544c40c6446ead0f",filename:"cSel.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function s(e){var t={off_option:function(){this.dom.removeClass("b_ipt_on")},open_option:function(){this.dom.addClass("b_ipt_on")}};e["events"]=$.extend(t,e.events||{});e.dom.each(function(t,n){var r=$(n);e.dom=r;var s=new i(e);r.data("ipt",s);e.defFirst&&s.sel(0)})}e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var i=function(){function e(e){QNR.Event.call(this);this.dom=e.dom;this.options=e;this.init()}var t={init:function(){this.val_ipt=this.dom.find(".valipt");this.cs_sel=this.dom.find(".cs_sel");this.cs_option=this.dom.find(".cs_option");this.cs_option_li=this.cs_option&&this.cs_option.find("li");if(this.cs_option_li.length>4){this.cs_option.addClass("adScroll")}this.fire("init_after");this.initEvent()},initEvent:function(){var e=this;this.regCusEvent(this.options.events);this.dom.bind("blur",$.proxy(e.off,e));this.cs_sel.bind("click",function(){!e.lock&&e.open()});this.cs_option_li.bind("click",function(t){e.sel($(this))});this.cs_option.bind("mousedown",function(e){e.stopPropagation()});$(document).bind("mousedown",function(){e.isopen&&e.off()})},regCusEvent:function(e){if(!e){return false}var t=this;for(var n in e){(function(e,n){if(QNR.isFunction(n)){t.on(e,n)}})(n,e[n])}},lockUp:function(){this.lock=true},fillVal:function(e,t){this.cs_sel.val(t);this.val_ipt.val(e)},open:function(){this.cs_option.show();this.isopen=true;this.fire("open_option")},off:function(){this.isopen=false;this.cs_option.hide();this.fire("off_option")},sel:function(e){if(e instanceof $){var t=e;this.fillVal(t.attr("val"),t.text());t.hide().siblings().show()}else if(typeof e=="number"){var t=this.cs_option_li.eq(e);this.fillVal(t.attr("val"),t.text());t.hide().siblings().show()}else if(arguments.length==2){this.fillVal(arguments)}this.off();this.fire("seled_option",this.val_ipt.val())}};$.extend(e.prototype,QNR.Event.prototype,t);return e}();n.exports=s}(t.exports,t,e);e.____MODULES["d4c62f2b94cc901a544c40c6446ead0f"]=t.exports})(this);(function(e){var t={id:"91a8b1e4a10908d4fc9821db1c678f54",filename:"buildHotelForm.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function b(e){var t=[15,6];var n=6;var r=Hogan.compile('<div class="b_plc_box clrfix">        <img style="width:160px;height:120px;" src="{{image}}" class="fl">        <div class="b_plc_info">        <ul>        <li class="bp_tit"><span class="bp_name_ch">{{name}}</span><span class="bp_name_en">{{enName}}</span></li><li>        </li><li>地址：{{address}}</li>        </ul>        </div>        </div>');var s=["价格","地址","电话","其他"];var l={dom:$(i.cus_tpl()["hotel"].render()),curType:15,isnotCustom:false,distInfo:{},isNewSysPoi:false,init:function(){this.observer=e.observer;this.dayInfo=e.dayInfo;this.eleModel=e.eleModel;this.expand_pro=e.expand_pro;this.isUpdate=e.eleModel?true:false;this.b_poi_pro=this.dom.find(".b_poi_pro");this.b_poi_custom=this.dom.find(".b_poi_custom");this.b_ipt_bx_name=this.dom.find(".b_ipt_bx_name");this.name_input=this.dom.find(".b_ipt_bx_name input");this.b_ipt_bx_cy=this.dom.find(".b_ipt_bx_cy");this.b_ipt_box_startdate=this.dom.find(".b_ipt_box_startdate");this.b_ipt_box_enddate=this.dom.find(".b_ipt_box_enddate");this.hotel_expand_tr=this.dom.find(".hotel_expand_tr");this.startDateInput=this.b_ipt_box_startdate.find("input");this.endDateInput=this.b_ipt_box_enddate.find("input");this.b_ipt_box_memo=this.dom.find(".b_ipt_box_memo");this.b_msg_box=this.dom.find(".b_msgbox");this._initCity();this._onEvent();this._initDate();this._initElePoi();this._initDefCitySug();this.name_input.trigger("change")},getCurType:function(){return this.expand_pro&&this.expand_pro.curType||this.curType},setDbType:function(e){if(e){this.curType=6;this.isnotCustom=true}else{this.curType=15;this.isnotCustom=false}},_initDefCitySug:function(){var e=this;var t=e.dayInfo.dest;var n=[];if(t){n=QNR.map(t,function(e){return{city:e.cityName,id:e.cityId,distType:e.distType}})}e.city_input_txt.data("defData",n)},showMsg:function(e){this.b_msg_box.html(e)},checkDate:function(){var e=this;if(e.endDateInput.val()>e.startDateInput.val()){e.showMsg("")}else{e.showMsg("须晚于入住日期");e.dom.data("pass",false)}},_onEvent:function(){var e=this;i.setCitySug(e.dom.find(".b_ipt_bx_cy"),function(t){e.distInfo={cityId:t.city_id,cityName:t.city_name,distType:t.dist_type}});i.setQdatepicker(e.startDateInput,{on:{"q-datepicker-select":function(t,n){e.checkDate()}}});i.setQdatepicker(e.endDateInput,{on:{"q-datepicker-select":function(t,n){e.checkDate()}}});e.name_input.qlimitlen(250).qplaceHolder({customClass:"b_poiname_plcholder"});e._onNameEvent();e._onMemoEvent();e._onCheck()},_onNameEvent:function(){var e=this;e.name_search_inp=e.b_ipt_bx_name.find("input");e.name_search_box=e.b_ipt_bx_name.find(".b_input_box");e.name_search_inp.bind("blur",function(){e.name_search_box.removeClass("b_ipt_on")}).bind("focus",function(){e.name_search_box.addClass("b_ipt_on")});e._onSugPoi()},_onMemoEvent:function(){var e=this;var t=e.memo_textarea=e.b_ipt_box_memo.find("textarea");var n=t.parent().next();i.memoCheck(t,s);i.memoLimitLen(t,i.memoMax,n);t.trigger("blur")},_onSugPoi:function(){function l(e){var t;for(var n=0;n<i.length;n++){if(i[n]["name"]==e){t=n;break}}return t}function c(e){return i[e]}function h(){if(parseInt(e.city_input_val.val())&&e.city_input_type.val()==7){return r+"?mcityId="+($.trim(e.city_input_val.val())||"")+"&q=*&callback=?"}else{return r+"?type=2&distId="+($.trim(e.city_input_val.val())||"")+"&city="+(encodeURIComponent($.trim(e.city_input_txt.val()))||"")+"&q=*&callback=?"}}var e=this,t=e.isUpdate,n=e.name_search_inp.data("has_suggest");if(n){return}var r="/suggest/custom",i=[],s=null,f=e.name_search_inp;f.qsuggest({width:"356px",container:e.b_ipt_bx_name.find(".sug_poi_box"),ajax:{url:h,dataType:"jsonp",cache:false},render:function(e){var t=l(e);var n=c(t);if(n.type){return n.name+(n.city?","+n.city:"")+(n.country?","+n.country:"")+"<em>"+u[a.server_to_front_type[n.type]]+"</em>"}else if(i.length==1){return'添加自定义"'+n.name+'"'}},reader:function(e){i=e.data||[];i.push({name:o.HTMLEncode(f.val())});var t=[];var n;for(var r=0,s=i.length;r<s;r++){var u=i[r];n=u.name;if(i.length==1||u.city){t[t.length]=n}}return t},delay:10,autoSelect:false,on:{"q-suggest-user-action":function(t,n,r,o,u){if(u.hasClass("last")){f.val(u.data("q"))}var a=f.val();if(o===13||o==null){var l=u.index();s=i[l];s.type&&e._onSearchPoi(s)}},"q-suggest-show":function(){var e=$.trim(f.val());i.length>1&&f.data("q-suggest").el.find("table tbody").append('<tr class="last" data-q="'+e+'" data-ind="'+i.length+'"><td>添加自定义"'+e+'"</td></tr>')}}});var p=f.data("q-suggest");e.city_input_txt.bind("change",$.proxy(h,e));f.data("has_suggest",1)},_onSearchPoi:function(e){var t=this;$.ajax({url:"//travel.qunar.com/api/mapsearch/bigIcon",data:{poiId:e.id,type:e.type,poiName:e.name,cityName:e.city},success:function(e){var n=e.data&&e.data.poiDetail;var r=n&&t._parseToElement(n)||null;r&&t._renderPoiFromSys(r)}})},_initElePoi:function(){var e=this,t=e.isUpdate,r=e.eleModel&&e.eleModel.context("type_id")||e.getCurType();if(t){e.b_ipt_bx_name.find("input").val(e.eleModel.context("name")||"");e.b_ipt_box_memo.find("textarea").val(e.eleModel.context("memo")||"");e.memo_textarea.trigger("blur");e.b_poi_pro.data("data",e.eleModel.contextAll());if(r===n){e.setDbType(true)}return}e.name_input.val(e.expand_pro&&e.expand_pro.q||"");if(!t&&r===n){e._renderPoiFromSys(e.expand_pro.ele_model_data);return}if(!t){return}if(r==n){e._renderPoiFromSys(e.eleModel.contextAll())}else{e.b_ipt_bx_name.find("input").val(e.eleModel.context("name")||"")}e.b_ipt_box_memo.find("textarea").val(e.eleModel.context("memo")||"")},_initCity:function(){var e=this,t=e.isUpdate,n=e.dayInfo.dest,r;e.city_input_val=e.city_input_val||e.dom.find(".b_ipt_bx_cy input.ipt_cityid");e.city_input_txt=e.city_input_txt||e.dom.find(".b_ipt_bx_cy input.ipt_cityname");e.city_input_type=e.city_input_type||e.dom.find(".b_ipt_bx_cy input.ipt_disttype");var i=function(){if(t){var i=e.eleModel.context("parentName"),s=e.eleModel.context("cityName");r=i?7:6;return i||s||""}else{if(e.expand_pro&&e.expand_pro.dest_name){r=e.expand_pro.dist_type||6;return e.expand_pro.dest_name}else{var o;if(n&&n.length){o=n[0]}r=(o||{}).distType||6;s=(o||{}).cityName||"";return s}}}();var s=function(){if(t){return e.eleModel.context("parentId")||e.eleModel.context("cityId")||0}else{return e.expand_pro&&e.expand_pro.dest_name?e.expand_pro.dest_id||0:n&&n.length&&n[0].cityId||0}}();e.city_input_val.val(s);e.city_input_txt.val($.trim(i)).trigger("change");e.city_input_type.val(r||6)},_renderPoiFromSys:function(e){var t=this;e.image=e.image||f.getImg(e.type||e.type_id,e);var n=$(r.render(e));t.b_poi_pro.html(n).show().data("data",e);t.city_input_txt.val(e.cityName);t.name_input.val(e.name);t.setDbType(true);t.isNewSysPoi=true;t.b_poi_custom.hide();window.setTimeout(function(){t.dom.closest(".g_dlg_box").addClass("repeat")},50)},_initDate:function(){var e=this,t=e.dayInfo.dayDate;if(e.isUpdate){e.hotel_expand_tr.hide().removeClass("hotel_expand_show");return}else{e.hotel_expand_tr.show().addClass("hotel_expand_show")}var n=e.dayInfo.model.parent();var r=n.children();var i=n.context("startTime");var s=r[r.length-1];var u=new Date(s.day_date());var a=e.eleModel?e.eleModel.context("startDate")||o.format(t):o.format(t);var f=e.eleModel?e.eleModel.context("endDate")||o.format(o.plusDay(t,1)):o.format(o.plusDay(t,1));e.startDateInput.val(a);e.endDateInput.val(f);e.startDateInput.data("q-datepicker").args.minDate=i;e.startDateInput.data("q-datepicker").args.maxDate=u;e.endDateInput.data("q-datepicker").args.minDate=o.plusDay(i,1);e.endDateInput.data("q-datepicker").args.maxDate=o.plusDay(u,1)},_onCheck:function(){function t(t,n){n.html("");if(t===""){n.html("名称不能为空");e.dom.data("pass",false)}else if(!/[0-9a-zA-z\u4e00-\u9fa5]+/.test(t)){n.html("请输入有效的名称");e.dom.data("pass",false)}}function n(t,n){n.html("");if(t&&!/[a-zA-z\u4e00-\u9fa5]+/.test(t)){n.html("请输入有效的城市名");e.dom.data("pass",false)}}var e=this;e.name_input.bind("blur",function(){$tip=$(this).parents(".b_tr").find(".b_tip");t($.trim($(this).val()),$tip)});e.city_input_txt.bind("blur",function(){$tip=$(this).parents(".b_tr").find(".b_tip");n($.trim($(this).val()),$tip)})},_parseToElement:function(e){var t=e.image||e.images;var n=a.server_to_front_type[e.type||e.type_id];if(t){var r=QNR.type(t);if(r==="array"&&t.length){t=t[0].smallUrl}else if(r!=="string"){t=f.getImg(n,e)}else{t=t||f.getImg(n,e)||""}}t=t||f.getImg(n,e)||"";var i={image:t,name:e.name,enName:e.enName,address:e.addr,tel:e.tel,blat:e.blat,blng:e.blng,lat:e.lat,lng:e.lng,glat:e.glat,glng:e.glng,cityId:e.cityId||e.city_id||e.distId,cityName:e.cityName||e.city||e.distName,parentId:e.parentId,parentName:e.parentName,type_id:n,abroad:e.abroad,locationId:e.id||(e.g_id?e.g_id.replace(/^\w_/,""):"0"),poi_detail:e};return i},checkForm:function(){var e=this;e.name_input.trigger("blur");e.city_input_txt.trigger("blur")},doAddElement:function(){var e=this,t=e.getCurType(),n=e.isnotCustom;var r=this.b_ipt_box_enddate.find("input").val();var i={endDate:r,startTime:this.b_ipt_box_startdate.find("input").val()+" 00:00:00",endTime:r+" 00:00:00"};e.checkDate();var s={};if(n){s=e.b_poi_pro.data("data")}else{var o,u=this.b_ipt_bx_cy.find("input.ipt_disttype"),a=parseInt(this.b_ipt_bx_cy.find("input.ipt_cityid").val(),10)||0;if(!u.length||u.val()==6||!a){o={cityId:a,cityName:$.trim(this.b_ipt_bx_cy.find("input.ipt_cityname").val()),parentId:0,parentName:null}}else{o={cityId:0,cityName:null,parentId:parseInt(this.b_ipt_bx_cy.find("input.ipt_cityid").val(),10)||0,parentName:$.trim(this.b_ipt_bx_cy.find("input.ipt_cityname").val())}}s={name:$.trim(this.b_ipt_bx_name.find("input").val()),type_id:t}}var f=i;var l=$.extend(s,o,{memo:e.memo_textarea.data("hasval")?$.trim(e.memo_textarea.val()):""},f);return e.dom.data("pass")?l:false},buildNewPoi:function(){var e=this;var t=e.dayInfo.dayDate;var n=this.eleModel;var r=n.contextAll();var i={travelOrder:r.travelOrder,type_id:15,startTime:o.format(t,"yyyy-MM-dd hh:mm:ss"),endTime:o.format(o.plusDay(t,1),"yyyy-MM-dd hh:mm:ss"),memo:e.memo_textarea.data("hasval")?$.trim(e.memo_textarea.val()):"",name:$.trim(this.b_ipt_bx_name.find("input").val())};return i},doUpdateElement:function(){var e=this;var t=e.dayInfo.dayDate;var n=e.getCurType();var r=e.isnotCustom;var i=true;var s={};var u=$.trim(this.b_ipt_bx_name.find("input").val());var a=$.trim(this.b_ipt_bx_cy.find("input.ipt_cityname").val());if(e.isNewSysPoi){s=e.b_poi_pro.data("data");var f=$.extend(s,{memo:e.memo_textarea.data("hasval")?$.trim(e.memo_textarea.val()):"",travelOrder:e.eleModel.context("travelOrder"),startTime:o.format(t,"yyyy-MM-dd hh:mm:ss"),endTime:o.format(o.plusDay(t,1),"yyyy-MM-dd hh:mm:ss")});return{rmEle:e.eleModel,data:f,isRmAdd:true}}else{if(r){if(e.eleModel.context("name")!==u||e.eleModel.context("cityName")!==a){e.setDbType(false);var l,c=this.b_ipt_bx_cy.find("input.ipt_disttype"),h=parseInt(this.b_ipt_bx_cy.find("input.ipt_cityid").val(),10)||0;if(i&&h&&e.eleModel.context("parentId")==h){l={}}else if(!c.length||c.val()==6||!h){l={cityId:h,cityName:a,parentId:0,parentName:null}}else{l={cityId:0,cityName:null,parentId:parseInt(this.b_ipt_bx_cy.find("input.ipt_cityid").val(),10)||0,parentName:$.trim(this.b_ipt_bx_cy.find("input.ipt_cityname").val())}}return{rmEle:e.eleModel,data:$.extend(e.buildNewPoi(),l),isRmAdd:true}}else{var f={memo:e.memo_textarea.data("hasval")?$.trim(e.memo_textarea.val()):""};return e.dom.data("pass")?f:false}}else{var l,c=this.b_ipt_bx_cy.find("input.ipt_disttype"),h=parseInt(this.b_ipt_bx_cy.find("input.ipt_cityid").val(),10)||0;if(i&&h&&e.eleModel.context("parentId")==h){l={}}else if(!c.length||c.val()==6||!h){l={cityId:h,cityName:a,parentId:0,parentName:null}}else{l={cityId:0,cityName:null,parentId:parseInt(this.b_ipt_bx_cy.find("input.ipt_cityid").val(),10)||0,parentName:$.trim(this.b_ipt_bx_cy.find("input.ipt_cityname").val())}}var f=$.extend(s,l,{memo:e.memo_textarea.data("hasval")?$.trim(e.memo_textarea.val()):"",name:u,type_id:e.getCurType()});return e.dom.data("pass")?f:false}}},submitFormParseData:function(){var e=this;var t=e.eleModel?true:false;e.dom.data("pass",true);e.checkForm();if(!e.dom.data("pass")){return}if(t){return e.doUpdateElement()}else{return e.doAddElement()}},reset:function(e,t,n){this.dom[0].reset();this.isNewSysPoi=false;this.setDbType(false);this.dayInfo=e;this.eleModel=t;this.expand_pro=n;this.isUpdate=t?true:false;this.b_poi_pro.hide();this.b_poi_custom.show();this._initDefCitySug();this._onSugPoi();this._initElePoi();this._initDate();this._initCity();this.name_input.trigger("change");this.memo_textarea.trigger("blur")}};l.init();return l}var i=e.____MODULES["c39c5d3ce84ae9413e439dd1e9c4fcfb"];var s=e.____MODULES["d4c62f2b94cc901a544c40c6446ead0f"];var o=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var u=i.typeName;var a=e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"];var f=e.____MODULES["56483375e8bf013e95419f32c44a39a1"];var l=i.cus_tpl();var c=QNR.Browser.isIE6;var h=QNR.Browser.isIE7;var p=i.memoLimitLen;var d=i.memoCheck;var v=i.setCitySug;var m=i.setQdatepicker;var g=i.searchLine;var y=i.memoMax;n.exports=b}(t.exports,t,e);e.____MODULES["91a8b1e4a10908d4fc9821db1c678f54"]=t.exports})(this);(function(e){var t={id:"ae63a9e46fe5a5492206b478991c1618",filename:"buildNoteForm.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function u(e){var t={dom:$(s["note"].render()),curType:2,init:function(){this.observer=e.observer;this.dayInfo=e.dayInfo;this.eleModel=e.eleModel;this.b_ipt_bx_name=this.dom.find(".b_ipt_bx_name");this.name_input=this.b_ipt_bx_name.find("input");this.memo_textarea=this.dom.find(".b_ipt_box_memo").find("textarea");this.memo_tip=this.memo_textarea.parent().next();this._onEvent();this._onMemoEvent();this.name_input.qlimitlen(20);this._initElePoi()},_onEvent:function(){var e=this;e.dom.find("input,textarea").bind("blur",function(){$(this).parent().removeClass("b_ipt_on")}).bind("focus",function(){$(this).parent().addClass("b_ipt_on")})},_onMemoEvent:function(){var e=this;o(this.memo_textarea,2e3,this.memo_textarea.parent().next())},_initElePoi:function(){var e=this,t=e.eleModel?true:false;if(!t){return}e.name_input.val(e.eleModel.context("name"));e.memo_textarea.val(e.eleModel.context("memo"))},submitFormParseData:function(){var e=this;var t={type_id:e.curType,name:$.trim(e.b_ipt_bx_name.find("input").val())||"随记",memo:$.trim(e.memo_textarea.val())};if(t.memo===""){e.memo_tip.html('<span class="highclr">备注不能为空</span>');return false}return t},reset:function(e,t){this.dayInfo;this.eleModel=t;this.dom[0].reset();this._initElePoi();this.memo_textarea.trigger("blur")}};t.init();return t}var i=e.____MODULES["c39c5d3ce84ae9413e439dd1e9c4fcfb"];var s=i.cus_tpl();var o=i.memoLimitLen;n.exports=u}(t.exports,t,e);e.____MODULES["ae63a9e46fe5a5492206b478991c1618"]=t.exports})(this);(function(e){var t={id:"327c51aab1eda87ff99ee13b56280477",filename:"buildTrafficForm.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function w(e){var t={dom:$(l["traffic"].render()),requesting:false,curType:null,init:function(){this.observer=e.observer;this.dayInfo=e.dayInfo;this.eleModel=e.eleModel;this.b_traffic_type=this.dom.find(".b_traffic_type");this.b_ipt_bx_type=this.dom.find(".b_ipt_bx_type");this.typeInput=this.b_ipt_bx_type.find("input");this.departure_date=this.dom.find(".departure_date");this.b_traffic_flight=this.dom.find(".b_traffic_flight");this.b_traffic_train=this.dom.find(".b_traffic_train");this.b_traffic_other=this.dom.find(".b_traffic_train");this.tabs={13:this.dom.find(".b_traffic_flight"),12:this.dom.find(".b_traffic_train"),14:this.dom.find(".b_traffic_other")};this._initDate();this._onEvent();this.typeInput.eq(0).click();this._listenEvent();this._initElePoi();this._initDefCitySug()},_listenEvent:function(){var e=this;e.observer.on("stop_request_traffic_list",function(){e.requesting=false})},_switchTab:function(){var e=this,t=e.tabs,n=e.curType;for(var r in t){r==n?t[r].removeClass("hide_b_traffic_item "):t[r].addClass("hide_b_traffic_item")}t[n].find(".b_ipt_box_memo textarea").trigger("blur");if(c||h){window.setTimeout(function(){e.dom.addClass("hide_ie6")},50)}},_onEvent:function(){function n(t){e.requesting&&e.observer.fire("view_traffic_line_result",t,e.curType,e.eleModel)}var e=this;var t=e.tabs;e.typeInput.bind("click",function(){var t=parseInt($(this).val(),10);e.curType=t;e._switchTab()});v(e.dom.find(".b_ipt_bx_cy"));e.dom.find(".b_ipt_bx_number input,.b_ipt_box_typename input").qlimitlen(20);e.dom.find(".b_ipt_box_typename input").bind("blur",function(){$(this).parent().removeClass("b_ipt_on")}).bind("focus",function(){$(this).parent().addClass("b_ipt_on")});e._sugTrafficNumber(e.tabs[13],"/travelbook/traffic/flight/suggest?departure_city={{sCity}}&arrival_city={{eCity}}&q=*&departure_date={{sDate}}");e._sugTrafficNumber(e.tabs[12],"/travelbook/traffic/train/suggest?deptCity={{sCity}}&arriCity={{eCity}}&q=*&deptDate={{sDate}}");e.dom.find(".search_btn a").bind("click",function(){var t=$(this).parents(".b_tr"),r=t.find(".b_tip"),i,s;t.find("input").trigger("blur");if(r.text()){return false}if(t.find(".b_ipt_bx_cy").length){var o=$.trim(t.find(".b_ipt_box_startcity .ipt_cityname").val()),u=$.trim(t.find(".b_ipt_box_endcity .ipt_cityname").val());if(o===""||u===""){return false}if(e.curType==13){s="//travel.qunar.com/travelbook/traffic/flight/list";i={departure_city:o,arrival_city:u,q:"",departure_date:e.curDate}}else{s="//travel.qunar.com/travelbook/traffic/train/list";i={deptDate:e.curDate,q:"",trainNumber:"",deptCity:o,arriCity:u};if(i.deptCity===""||i.arriCity===""){return false}}}else{var a=$.trim(t.find("input").val());if(a===""){r.html(e.curType==13?"请先输入航班号再查询":"请先输入车次再查询");return false}if(e.curType==13){s="//travel.qunar.com/travelbook/traffic/flights/"+a;i={departure_date:e.curDate}}else{s="//travel.qunar.com/travelbook/traffic/train/info";i={trainNumber:a,departure_date:e.curDate}}}e.requesting=true;g(s,i,n)});e._initMemoEvent();e._onCheck()},_initDefCitySug:function(){var e=this;var t=e.dayInfo.dest;var n=[];if(t){n=QNR.map(t,function(e){return{city:e.cityName,id:e.cityId}})}e.dom.find(".b_ipt_bx_cy .ipt_cityname").data("defData",n)},_sugTrafficNumber:function(e,t){function u(){var t={sCity:e.find(".b_ipt_box_startcity input.ipt_cityname").val(),eCity:e.find(".b_ipt_box_endcity input.ipt_cityname").val(),sDate:n.curDate};var r=i.render(t);return r}function a(){var e=u();o.url=e;s._cache={};s._last=[]}var n=this;var e=e,r=e.find(".b_ipt_bx_number input");$startCity=e.find(".b_ipt_box_startcity input.ipt_cityname"),$endCity=e.find(".b_ipt_box_endcity input.ipt_cityname"),sugBox=r.next(".b_sug");var i=Hogan.compile(t);r.bind("blur",function(){r.parent().removeClass("b_ipt_on")}).bind("focus",function(){r.parent().addClass("b_ipt_on")});r.qsuggest({container:sugBox,width:"243px",ajax:{url:u(),dataType:"jsonp",cache:false},reader:function(e){querys=e.data||[];return querys}});var s=r.data("q-suggest");var o=s.args.ajax;$startCity.bind("change",a);$endCity.bind("change",a);n.departure_date.bind("change",a)},_initMemoEvent:function(){var e=this;d(e.dom.find("textarea"),["票价","出发时间","到达时间","其他"]);p(e.dom.find("textarea"),2e3)},_initDate:function(){var e=this,t=e.dayInfo.dayDate;dayDateStr=o.format(t);e.departure_date.val(dayDateStr);e.curDate=dayDateStr;e.departure_date.trigger("change")},_initElePoi:function(){var e=this,t=e.eleModel?true:false;e.curType=t?e.eleModel.context("type_id"):e.curType;this.typeInput.eq(b[e.curType]).click();var n=e.tabs[e.curType];var r=e.dayInfo.dest;var i,s;i=function(){if(t){return e.eleModel.context("begin_city")||e.eleModel.context("startCity")||""}return r&&r.length&&r[0].cityName||""}();s=function(){if(t){return e.eleModel.context("end_city")||e.eleModel.context("endCity")||""}return r.length>1&&r[1].cityName||""}();if(t){n.find(".b_ipt_box_startcity .ipt_cityname").val(i);n.find(".b_ipt_box_endcity .ipt_cityname").val(s);n.find(".b_ipt_box_typename input").val(e.eleModel.context("trainType")||e.eleModel.context("name")||"");n.find(".b_ipt_box_memo textarea").val(e.eleModel.context("memo")).trigger("blur");n.find(".b_ipt_bx_number .tx_ipt").val(e.eleModel.context("transNumber")||e.eleModel.context("train_number"))}else{e.dom.find(".b_ipt_box_startcity .ipt_cityname").val(i);e.dom.find(".b_ipt_box_endcity .ipt_cityname").val(s)}},submitFormParseData:function(){var e=this,t=e.eleModel?true:false,n=e.tabs[e.curType];var r=e.collectData();e.tabs[e.curType].data("pass",true);e.checkForm();if(!e.tabs[e.curType].data("pass")){return false}if(t){var i=e.eleModel.context("type_id")===e.curType?false:true;if(i){return{rmEle:e.eleModel,data:$.extend(r,{travelOrder:e.eleModel.context("travelOrder")}),isRmAdd:true}}}return e.tabs[e.curType].data("pass")?r:false},collectData:function(){var e=this;var t=e.tabs[e.curType];var n={begin_city:$.trim(t.find(".b_ipt_box_startcity .ipt_cityname").val()),end_city:$.trim(t.find(".b_ipt_box_endcity .ipt_cityname").val())};if(e.curType!=14){var r=t.find(".b_ipt_box_memo textarea");var i={name:"",type_id:e.curType,start_station:"",end_station:"",price:"",runtime:"",start_terminal:"",end_terminal:"",start_time:"",end_time:"",begin_city:n.begin_city,end_city:n.end_city,train_number:$.trim(t.find(".b_ipt_bx_number input").val()),memo:r.data("hasval")?$.trim(r.val()):""};i.name=i.begin_city+"-"+i.end_city+(i.train_number?"("+i.train_number+")":"")}else{var s=$.trim(t.find(".b_ipt_box_typename input").val());var r=t.find(".b_ipt_box_memo textarea");var i={name:n.begin_city||n.end_city?(n.begin_city||"")+(n.begin_city&&n.end_city?"-":"")+(n.end_city||""):s,type_id:e.curType,trainType:s,begin_city:n.begin_city,end_city:n.end_city,memo:r.data("hasval")?$.trim(r.val()):""}}return i},_onCheck:function(){function t(t,n){var r=e.tabs[e.curType];n.html("");if(t&&!/[0-9a-zA-z]+/.test(t)){n.html(e.curType==13?"请输入正确的航班号":"请输入正确的车次");r.data("pass",false)}}function n(t,n){var r=e.tabs[e.curType];var i=$(this).parents(".b_ipt_bx_cy").siblings(".b_ipt_bx_cy");var s=i.hasClass("b_ipt_box_endcity")?i.find(".ipt_cityname"):$(this);var o=i.hasClass("b_ipt_box_startcity")?i.find(".ipt_cityname"):$(this);var u=$.trim(o.val());var a=$.trim(s.val());n.html("");if(u===""&&a===""){n.html("两个城市都不能为空");r.data("pass",false)}else if(u===""&&/[a-zA-z\u4e00-\u9fa5]+/.test(a)){n.html("出发城市不能为空");r.data("pass",false)}else if(a===""&&/[a-zA-z\u4e00-\u9fa5]+/.test(u)){n.html("到达城市不能为空");r.data("pass",false)}else if(!/[a-zA-z\u4e00-\u9fa5]+/.test(u)&&!/[a-zA-z\u4e00-\u9fa5]+/.test(a)){n.html("城市名都不正确");r.data("pass",false)}else if(!/[a-zA-z\u4e00-\u9fa5]+/.test(u)&&/[a-zA-z\u4e00-\u9fa5]+/.test(a)){n.html("请输入正确的出发城市");r.data("pass",false)}else if(/[a-zA-z\u4e00-\u9fa5]+/.test(u)&&!/[a-zA-z\u4e00-\u9fa5]+/.test(a)){n.html("请输入正确的到达城市");r.data("pass",false)}}function r(t,n){n.html("");tab=e.tabs[e.curType];if(t===""){n.html("交通方式不能为空");tab.data("pass",false)}else if(!/[0-9a-zA-z\u4e00-\u9fa5]+/.test(t)){n.html("请输入有效的交通方式");tab.data("pass",false)}}function i(t,n){n.html("");if(t&&!/[0-9a-zA-z\u4e00-\u9fa5]+/.test(t)){n.html("请输入有效的城市名");e.tabs[e.curType].data("pass",false)}}var e=this;e.dom.find(".b_ipt_bx_number input").bind("blur",function(){$tip=$(this).parents(".b_tr").find(".b_tip");t($.trim($(this).val()),$tip)});e.dom.find(".b_tr_city input.ipt_cityname").bind("blur",function(){$tip=$(this).parents(".b_tr").find(".b_tip");n.call(this,$.trim($(this).val()),$tip)});e.dom.find(".b_ipt_box_typename input").bind("blur",function(){$tip=$(this).parents(".b_tr").find(".b_tip");r($.trim($(this).val()),$tip)});e.dom.find(".b_traffic_other input.ipt_cityname").bind("blur",function(){$tip=$(this).parents(".b_ipt_bx_cy").find(".b_tip");i($.trim($(this).val()),$tip)})},checkForm:function(){var e=this;if(e.curType!=14){e.tabs[e.curType].find(".b_ipt_bx_number input").trigger("blur");e.tabs[e.curType].find(".b_ipt_bx_cy input.ipt_cityname").trigger("blur")}else{e.tabs[e.curType].find(".b_ipt_box_typename input").trigger("blur");e.tabs[e.curType].find("input.ipt_cityname").trigger("blur")}},reset:function(e,t){var n=this;n.dom[0].reset();n.dom.find(".b_tip").html("");n.dom.find(".b_traffic_item").data("pass",true);n.dayInfo=e;n.eleModel=t;if(!t){this.typeInput.eq(0).click()}n._initDate();n._initElePoi();n._initDefCitySug();n.tabs[n.curType].find("textarea").trigger("blur")}};t.init();return t}var i=e.____MODULES["c39c5d3ce84ae9413e439dd1e9c4fcfb"];var s=e.____MODULES["d4c62f2b94cc901a544c40c6446ead0f"];var o=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var u=i.typeName;var a=e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"];var f=e.____MODULES["56483375e8bf013e95419f32c44a39a1"];var l=i.cus_tpl();var c=QNR.Browser.isIE6;var h=QNR.Browser.isIE7;var p=i.memoLimitLen;var d=i.memoCheck;var v=i.setCitySug;var m=i.setQdatepicker;var g=i.searchLine;var y=i.memoMax;var b={13:0,12:1,14:2};n.exports=w}(t.exports,t,e);e.____MODULES["327c51aab1eda87ff99ee13b56280477"]=t.exports})(this);(function(e){var t={id:"7687c1914f49c7176a525ed10ff6c86c",filename:"buildPlaceForm.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function x(e){var t=Hogan.compile('<div class="b_plc_box clrfix">        <img style="width:160px;height:120px;" src="{{image}}" class="fl">        <div class="b_plc_info">        <ul>        <li class="bp_tit"><span class="bp_name_ch">{{name}}</span><span class="bp_name_en">{{enName}}</span></li><li>        </li><li>地址：{{address}}</li>        </ul>        </div>        </div>');var n=["价格","地址","电话","其他"];var r={dom:$(l["place"].render()),curType:null,isnotCustom:false,distInfo:{},isNewSysPoi:false,init:function(){this.observer=e.observer;this.dayInfo=e.dayInfo;this.eleModel=e.eleModel;this.expand_pro=e.expand_pro;this.isUpdate=e.eleModel?true:false;this.b_poi_pro=this.dom.find(".b_poi_pro");this.b_poi_custom=this.dom.find(".b_poi_custom");this.b_ipt_bx_name=this.dom.find(".b_ipt_bx_name");this.name_input=this.dom.find(".b_ipt_bx_name input");this.b_ipt_bx_ty=this.dom.find(".b_ipt_bx_ty");this.b_ipt_bx_ty_wrap=this.dom.find(".b_ipt_bx_ty .b_cs_sel_wrap");this.b_ipt_bx_cy=this.dom.find(".b_ipt_bx_cy");this.b_ipt_box_memo=this.dom.find(".b_ipt_box_memo");this._initCity();this._onEvent();this._initElePoi();this._initDefCitySug();this.name_input.trigger("change")},_initDefCitySug:function(){var e=this;var t=e.dayInfo.dest;var n=[];if(t){n=QNR.map(t,function(e){return{city:e.cityName,id:e.cityId,distType:e.distType}})}e.city_input_txt.data("defData",n)},_onEvent:function(){var e=this;v(e.dom.find(".b_ipt_bx_cy"),function(t){e.distInfo={cityId:t.city_id,cityName:t.city_name,distType:t.dist_type}});s({dom:e.b_ipt_bx_ty_wrap,defFirst:true,events:{seled_option:function(t){e.curType=parseInt(t,10);e.city_input_txt.trigger("change")}}});e.name_input.qlimitlen(250).qplaceHolder({customClass:"b_poiname_plcholder"});e._onNameEvent();e._onMemoEvent();e._onCheck()},_onNameEvent:function(){var e=this;e.name_search_inp=e.b_ipt_bx_name.find("input");e.name_search_box=e.b_ipt_bx_name.find(".b_input_box");e.name_search_inp.bind("blur",function(){e.name_search_box.removeClass("b_ipt_on")}).bind("focus",function(){e.name_search_box.addClass("b_ipt_on")});e._onSugPoi()},_onMemoEvent:function(){var e=this;var t=e.memo_textarea=e.b_ipt_box_memo.find("textarea");var r=t.parent().next();d(t,n);p(t,y,r);t.trigger("blur")},_onSugPoi:function(){function f(e){var t;for(var n=0;n<r.length;n++){if(r[n]["name"]==e){t=n;break}}return t}function l(e){return r[e]}function c(){if(parseInt(e.city_input_val.val())&&e.city_input_type.val()==7){return n+"?mcityId="+($.trim(e.city_input_val.val())||"")+"&q=*&callback=?"}else{return n+"?type=3_4_5_21_6&distId="+($.trim(e.city_input_val.val())||"")+"&city="+(encodeURIComponent($.trim(e.city_input_txt.val()))||"")+"&q=*&callback=?"}}var e=this,t=e.name_search_inp.data("has_suggest");if(t){return}var n="/suggest/custom",r=[],i=null,s=e.name_search_inp;s.qsuggest({width:"356px",container:e.b_ipt_bx_name.find(".sug_poi_box"),ajax:{url:c,dataType:"jsonp",cache:false},render:function(e){var t=f(e);var n=l(t);if(n.type){return n.name+(n.city?","+n.city:"")+(n.country?","+n.country:"")+"<em>"+u[a.server_to_front_type[n.type]]+"</em>"}else if(r.length==1){return'添加自定义"'+n.name+'"'}},reader:function(e){r=e.data||[];r.push({name:o.HTMLEncode(s.val())});var t=[];var n;for(var i=0,u=r.length;i<u;i++){var a=r[i];n=a.name;if(r.length==1||a.city){t[t.length]=n}}return t},delay:10,autoSelect:false,on:{"q-suggest-user-action":function(t,n,o,u,a){if(a.hasClass("last")){s.val(a.data("q"))}var f=s.val();if(u===13||u==null){var l=a.index();i=r[l];i.type&&e._onSearchPoi(i)}},"q-suggest-show":function(){var e=$.trim(s.val());r.length>1&&s.data("q-suggest").el.find("table tbody").append('<tr class="last" data-q="'+e+'" data-ind="'+r.length+'"><td>添加自定义"'+e+'"</td></tr>')}}});var h=s.data("q-suggest");e.city_input_txt.bind("change",$.proxy(c,e));s.data("has_suggest",1)},_onSearchPoi:function(e){var t=this;$.ajax({url:"//travel.qunar.com/api/mapsearch/bigIcon",data:{poiId:e.id,type:e.type,poiName:e.name,cityName:e.city},success:function(e){var n=e.data&&e.data.poiDetail;var r=n&&t._parseToElement(n)||null;r&&t._renderPoiFromSys(r)}})},_initElePoi:function(){var e=this,t=e.isUpdate;curType=t?e.eleModel.context("type_id"):e.curType;e.name_input.val(e.expand_pro&&e.expand_pro.q||"");if(!t){return}if(curType in w){e.isnotCustom=true}this.b_ipt_bx_ty_wrap.data("ipt").sel(b[curType]);e.curType=curType;e.b_ipt_bx_name.find("input").val(e.eleModel.context("name")||"");e.b_ipt_box_memo.find("textarea").val(e.eleModel.context("memo")||"").focus().blur()},_initCity:function(){var e=this,t=e.isUpdate,n=e.dayInfo.dest,r;e.city_input_val=e.city_input_val||e.dom.find(".b_ipt_bx_cy input.ipt_cityid");e.city_input_txt=e.city_input_txt||e.dom.find(".b_ipt_bx_cy input.ipt_cityname");e.city_input_type=e.city_input_type||e.dom.find(".b_ipt_bx_cy input.ipt_disttype");var i=function(){if(t){var i=e.eleModel.context("parentName"),s=e.eleModel.context("cityName");r=i?7:6;return i||s||""}else{if(e.expand_pro&&e.expand_pro.dest_name){r=e.expand_pro.dist_type||6;return e.expand_pro.dest_name}else{var o;if(n&&n.length){o=n[0]}r=(o||{}).distType||6;s=(o||{}).cityName||"";return s}}}();var s=function(){if(t){return e.eleModel.context("parentId")||e.eleModel.context("cityId")||0}else{return e.expand_pro&&e.expand_pro.dest_name?e.expand_pro.dest_id||0:n&&n.length&&n[0].cityId||0}}();e.city_input_val.val(s);e.city_input_txt.val($.trim(i)).trigger("change");e.city_input_type.val(r||6)},_renderPoiFromSys:function(e){var n=this;e.image=e.image||f.getImg(e.type||e.type_id,e);var r=$(t.render(e));n.b_poi_pro.html(r).show().data("data",e);n.isnotCustom=true;n.isNewSysPoi=true;n.curType=e.type_id||e.type;n.b_poi_custom.hide()},_onCheck:function(){function t(t,n){n.html("");if(t===""){n.html("名称不能为空");e.dom.data("pass",false)}else if(!/[0-9a-zA-z\u4e00-\u9fa5]+/.test(t)){n.html("请输入有效的名称");e.dom.data("pass",false)}}function n(t,n){n.html("");if(t&&!/[a-zA-z\u4e00-\u9fa5]+/.test(t)){n.html("请输入有效的城市名");e.dom.data("pass",false)}}var e=this;e.name_input.bind("blur",function(){$tip=$(this).parents(".b_tr").find(".b_tip");t($.trim($(this).val()),$tip)});e.city_input_txt.bind("blur",function(){$tip=$(this).parents(".b_tr").find(".b_tip");n($.trim($(this).val()),$tip)})},_parseToElement:function(e){var t=e.image||e.images;var n=a.server_to_front_type[e.type||e.type_id];if(t){var r=QNR.type(t);if(r==="array"&&t.length){t=t[0].smallUrl}else if(r!=="string"){t=f.getImg(n,e)}else{t=t||f.getImg(n,e)||""}}t=t||f.getImg(n,e)||"";var i={image:t,name:e.name,enName:e.enName,address:e.addr,tel:e.tel,blat:e.blat,blng:e.blng,lat:e.lat,lng:e.lng,glat:e.glat,glng:e.glng,cityId:e.cityId||e.city_id||e.distId,cityName:e.cityName||e.city||e.distName,parentId:e.parentId,parentName:e.parentName,type_id:n,abroad:e.abroad,locationId:e.id||(e.g_id?e.g_id.replace(/^\w_/,""):"0"),poi_detail:e};return i},checkForm:function(){var e=this;e.name_input.trigger("blur");e.city_input_txt.trigger("blur")},submitFormParseData:function(){var e=this,t=false,n=e.isnotCustom,r=e.eleModel?true:false;e.dom.data("pass",true);var i={};var s=e.collectData();e.checkForm();if(!e.dom.data("pass")){return false}if(r){if(e.isNewSysPoi){return{rmEle:e.eleModel,data:$.extend(e.b_poi_pro.data("data"),{memo:s.memo,travelOrder:e.eleModel.context("travelOrder")}),isRmAdd:true}}else{var o=e.eleModel.context("type_id");var u=o!==s.type_id;if(n){var a=!(s.type_id===E[o]||o===s.type_id);if(e.eleModel.context("name")!==s.name||e.eleModel.context("cityName")!==s.cityName||a){var f=$.extend(s,{travelOrder:e.eleModel.context("travelOrder"),type_id:E[s.type_id]});return{rmEle:e.eleModel,data:f,isRmAdd:true}}else{return e.dom.data("pass")?{memo:s.memo}:false}}else if(u){var f=$.extend(s,{travelOrder:e.eleModel.context("travelOrder")});return{rmEle:e.eleModel,data:f,isRmAdd:true}}else{return e.dom.data("pass")?s:false}}}else{if(e.isNewSysPoi){return e.dom.data("pass")?$.extend(e.b_poi_pro.data("data"),s):false}return e.dom.data("pass")?s:false}},collectData:function(){var e=this;var t={name:$.trim(this.b_ipt_bx_name.find("input").val()),type_id:e.curType,memo:e.memo_textarea.data("hasval")?$.trim(e.memo_textarea.val()):""};return $.extend(t,this.getDistInfo())},getDistInfo:function(){var e=this;var t,n=this.b_ipt_bx_cy.find("input.ipt_disttype"),r=parseInt(this.b_ipt_bx_cy.find("input.ipt_cityid").val(),10)||0,i=e.eleModel?true:false;if(i&&r&&e.eleModel.context("parentId")==r){t={}}else if(!n.length||n.val()==6||!r){t={cityId:r,cityName:$.trim(this.b_ipt_bx_cy.find("input.ipt_cityname").val()),parentId:0,parentName:null}}else{t={cityId:0,cityName:null,parentId:parseInt(this.b_ipt_bx_cy.find("input.ipt_cityid").val(),10)||0,parentName:$.trim(this.b_ipt_bx_cy.find("input.ipt_cityname").val())}}return t},reset:function(e,t,n){this.dom[0].reset();this.isNewSysPoi=false;this.isnotCustom=false;this.curType=null;this.dayInfo=e;this.eleModel=t;this.expand_pro=n;this.isUpdate=t?true:false;this.b_poi_pro.hide();this.b_poi_custom.show();this.b_ipt_bx_ty_wrap.data("ipt").sel(0);this._initDefCitySug();this._onSugPoi();this._initElePoi();this._initCity();this.name_input.trigger("change");this.memo_textarea.trigger("blur")}};r.init();return r}var i=e.____MODULES["c39c5d3ce84ae9413e439dd1e9c4fcfb"];var s=e.____MODULES["d4c62f2b94cc901a544c40c6446ead0f"];var o=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var u=i.typeName;var a=e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"];var f=e.____MODULES["56483375e8bf013e95419f32c44a39a1"];var l=i.cus_tpl();var c=QNR.Browser.isIE6;var h=QNR.Browser.isIE7;var p=i.memoLimitLen;var d=i.memoCheck;var v=i.setCitySug;var m=i.setQdatepicker;var g=i.searchLine;var y=i.memoMax;var b={5:1,18:1,16:0,4:0,8:2,20:2,7:3,19:3,21:4};var w={5:1,4:1,8:1,7:1};var E={4:16,8:20,5:18,7:19,21:21};var S={16:4,20:8,18:5,19:7,21:21};n.exports=x}(t.exports,t,e);e.____MODULES["7687c1914f49c7176a525ed10ff6c86c"]=t.exports})(this);(function(e){var t={id:"94411730c6e3a7dd130f7b580c32d31d",filename:"creatCus.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function a(e){this.cusFormObj=this.buildForm(e);this.dom=this.cusFormObj.dom;this.dayInfo=e.dayInfo}e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];e.____MODULES["f359268032ef95a76c48519ac6bb62c6"];e.____MODULES["525d1dc0d8839c64abc3253ded526e97"];e.____MODULES["edb44368d6da1ca32d60ffa026712ff5"];var i=e.____MODULES["91a8b1e4a10908d4fc9821db1c678f54"];var s=e.____MODULES["ae63a9e46fe5a5492206b478991c1618"];var o=e.____MODULES["327c51aab1eda87ff99ee13b56280477"];var u=e.____MODULES["7687c1914f49c7176a525ed10ff6c86c"];a.prototype={cus_obj_fn:function(){return{place:u,traffic:o,note:s,hotel:i}},buildForm:function(e){return this.cus_obj_fn()[e.key](e)},getDom:function(){return this.dom},getStData:function(){return this.cusFormObj.submitFormParseData()},hide:function(){this.dom.hide();this.dom.removeClass("show_wrap")},reset:function(){return this.cusFormObj.reset.apply(this.cusFormObj,arguments)},show:function(){this.dom.show();this.dom.addClass("show_wrap")}};n.exports=a}(t.exports,t,e);e.____MODULES["94411730c6e3a7dd130f7b580c32d31d"]=t.exports})(this);(function(e){var t={id:"0c2d303397633b3ce77b9894528e6c46",filename:"customDialog.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var r=function(t,r,i){function d(e){var t=e.type,n=e.dayModel,r=e.events;QNR.Event.call(this);var i={content:h,titleVisible:false,clsName:"custom_dialog",closeCls:"btn_close",contentStyle:{width:"610px"},hideCloseBtn:false};this.observer=e.observer;this._opt=i;this._dialog=new QNR.Dialog(i);this.header=this.content=this.footer=null;this.day=n;this.dayInfo=this.getDayInfo(n);this.cus={};this.init(e)}e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];e.____MODULES["9107c28b5689cd09e17d4039d9133542"];e.____MODULES["60f02d1516c54ca88306bd00b7b4d021"];var s=e.____MODULES["9f7da0fd7ad3ca7bfc636e2365d14ec5"];var o=window.JSON;var u=e.____MODULES["56483375e8bf013e95419f32c44a39a1"];var a=e.____MODULES["88d5c499e26b6f8fc86d873910ae3aea"];var f=e.____MODULES["e8ee66d21b9db82af58224e73052efab"];var l=e.____MODULES["94411730c6e3a7dd130f7b580c32d31d"];var c=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var h=['<div class="b_dialog js_dialog">','<div class="e_dialog_hd paddingpatch">添加</div>','<div class="e_dialog_ct js_content">','<div class="ct_cont"></div>',"</div>",'<div class="e_dialog_ft"><a href="javascript:;" class="btn_cancel js_close">取 消</a><a href="javascript:;" class="btn_confirm">保 存</a></div>','<a href="#" class="btn_close js_close" title="关闭">x</a>',"</div>"].join("");var p={place:{name:"地点",tpl:f.custom_place},hotel:{name:"酒店",tpl:f.custom_place},traffic:{name:"交通",tpl:f.custom_traffic},note:{name:"随记",tpl:f.custom_note}};d.prototype=$.extend({init:function(e){this.type=e.type;this.wrap=this.getWrap();this.dom=this.getDom().addClass(this._opt.clsName);this.body=this.getBody();this.header=this.getHeader();this.footer=this.getFooter();this.btn_confirm=this.footer.find(".btn_confirm");this._setStyle(this.dom,this._opt.contentStyle);this.btn_confirm.bind("click",$.proxy(this.submitForm,this));this.dom.delegate(".js_out","click",$.proxy(this.out,this));this.regEvent(e.events)},regEvent:function(e){var t=this;for(var n in e){(function(e,n){if(QNR.isFunction(n)){t.on(e,n)}})(n,e[n])}},getDayInfo:function(e){var t=e.day_date();return{model:e,dayDate:new Date(t),dest:e.getDest()}},submitForm:function(){var e=this,t=this.cus[this.key],n=t.getStData();if(!n){return false}!n.image&&!e.eleModel&&$.extend(n,{image:u.getImg(n.type_id,n)});if(this.eleModel){if(n.isRmAdd){e.observer.fire("view_rmAddElement",e.eleModel,n.data)}else{e.observer.fire("view_element_edit",n,e.eleModel)}}else{QNR.PubSub.fire("poi_add_to_book",n)}this.hide()},setBody:function(e){this._dialog.setContent(e)},setTit:function(e){this.header.html(e)},_appendToBody:function(e){this._dialog.getContent().append(e)},_setStyle:function(e,t){this._dialog._setStyle(e,t)},getWrap:function(){return this._dialog.getContainer()},getDom:function(){return this.getWrap().find(".js_dialog")},getHeader:function(){return this.getWrap().find(".e_dialog_hd")},getBody:function(){return this._dialog.getContent()},getFooter:function(){return this.getWrap().find(".e_dialog_ft")},getCloseBtn:function(){return this._dialog.getCloseBtn()},hide:function(){this._dialog.hide()},toCenter:function(){this._dialog.toCenter()},hideCus:function(){var e=this.cus;for(n in e){e[n].hide()}},install:function(){var e=this,t=this.key;if(!this.cus[t]){var n=this.cus[t]=new l({key:t,dayInfo:e.dayInfo,eleModel:e.eleModel,observer:e.observer,expand_pro:e.expand_pro});this._appendToBody(n.getDom())}},switchCus:function(){var e=this.key;if(!this.cus[e]){this.install()}else{this.cus[e].reset(this.dayInfo,this.eleModel,this.expand_pro)}this.hideCus();this.cus[e].show();this.setTit((this.eleModel?"编辑":"添加")+p[e].name)},show:function(e){if(!e){this._dialog.show();return}c.planBc("custom_"+e.key);this.dayInfo=this.getDayInfo(e.dayModel);this.key=e.key;this.expand_pro=e.expand_pro;this.eleModel=e.eleModel;this.switchCus();this._dialog.show()},out:function(){this.wrap.hide()}},QNR.Event.prototype);r.exports=d}(t.exports,t,e);e.____MODULES["0c2d303397633b3ce77b9894528e6c46"]=t.exports})(this);(function(e){var t={id:"6069bbe87b4ae8bb6423c781eacb693a",filename:"customTrigger.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function u(e){if(e){e.key=function(e){if(typeof e=="string"){return e}for(name in o){if(QNR.indexOf(o[name],e)>=0){return name}}}(e.key)}var t=function(){if(!s){s=new i(e)}e?s.show(e):s.show()};t();return s}e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var i=e.____MODULES["0c2d303397633b3ce77b9894528e6c46"];var s;var o={place:[16,18,20,5,4,8,21,7,19],traffic:[13,12,14],note:[2],hotel:[15,6]};n.exports=u}(t.exports,t,e);e.____MODULES["6069bbe87b4ae8bb6423c781eacb693a"]=t.exports})(this);(function(e){var t={id:"4660ce0234875065956a8b2123a87383",filename:"trafficList.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var r=function(t,r,i){function f(e){var t=e.getHours()*60+e.getMinutes(),n;if(360<=t&&t<720){n="上午"}else if(720<=t&&t<780){n="中午"}else if(780<=t&&t<1080){n="下午"}else{n="晚上"}return n}function c(e){var t=e;var n=false;if(e.data&&e.data.flights){n=true;var r=e.data.flights[0];t={flightList:e.data.flights,airlineList:[r.airlineName],timeList:[f(new Date(r.departureTime))]}}var i=$.extend({},l,{init:function(){this._parseData();this.listData=this.data.flightList;this.dom=$(u.render(this.data));this.initDom();(this.allList.length==1||n)&&this.dom_head.hide()},_getSortKey:function(e){return e.hasClass("starttime")?"departureTime":"arrivalTime"},_parseData:function(){var e=t.airlineList;e.unshift("全部");var n=QNR.map(t.flightList,function(e){var t=s.format(new Date(e.departureTime),"hh:mm");var n=s.format(new Date(e.arrivalTime),"hh:mm");var r=f(new Date(e.departureTime));$.extend(e,{startTime:t,endTime:n,timeRange:r});return e});var r=t.timeList;r.unshift("全部");this.data={airlineList:e,flightList:n,timeList:r}},_parseSubmitData:function(e){var t=Hogan.compile("{{#price}}【票价】{{price}}元\n{{/price}}{{#startTime}}【出发时间】{{startTime}}\n{{/startTime}}{{#endTime}}【到达时间】{{endTime}}\n{{/endTime}}{{#other}}【其他】{{other}}{{/other}}");var n=t.render({price:e["price"],startTime:e["startTime"],endTime:e["endTime"],other:(e["departureCity"]||"")+(e["departureAirport"]||"")+(e["departureTerminal"]||"")+"-"+(e["arrivalCity"]||"")+(e["arrivalAirport"]||"")+(e["arrivalTerminal"]||"")});var r=e["flightNumber"];return{name:e["departureCity"]+"-"+e["arrivalCity"]+(r?"("+r+")":""),type_id:13,start_station:e["departureAirport"],end_station:e["arrivalAirport"],price:e["price"],runtime:e["interval"],start_terminal:e["departureTerminal"],end_terminal:e["arrivalTerminal"],start_time:s.format(new Date(e["departureTime"]),"yyyy-MM-dd hh:mm:ss"),end_time:s.format(new Date(e["arrivalTime"]),"yyyy-MM-dd hh:mm:ss"),begin_city:e["departureCity"],end_city:e["arrivalCity"],train_number:e["flightNumber"],memo:n}}});i.init();return i}function h(e){var t=e.data;if(t.deptCity){t={trainList:[t],trainTypeList:[t.trainType],timeRangeList:[f(new Date(t.deptTimeStamp))]}}var n=$.extend({},l,{init:function(){var e=this;this._parseData();this.listData=this.data.trainList;this.dom=$(a.render(this.data));this.initDom();this.allList.length==1&&this.dom_head.hide()},_parseData:function(){var e=t.trainTypeList;e.unshift("全部");var n=QNR.map(t.trainList,function(e){var t=f(new Date(e.deptTimeStamp));$.extend(e,{timeRange:t});return e});var r=t.timeRangeList;r.unshift("全部");this.data={trainTypeList:e,trainList:n,timeRangeList:r}},_getSortKey:function(e){return e.hasClass("starttime")?"deptTimeStamp":"arriTimeStamp"},_parseSubmitData:function(e){var t=Hogan.compile("{{#price}}【票价】{{price}}元\n{{/price}}{{#startTime}}【出发时间】{{startTime}}\n{{/startTime}}{{#endTime}}【到达时间】{{endTime}}\n{{/endTime}}{{#other}}【其他】{{other}}{{/other}}");var n=t.render({price:e["price"],startTime:e["deptTime"],endTime:e["arriTime"],other:(e["deptStation"]||"")+"-"+(e["arriStation"]||"")});var r=e["trainNumber"];return{name:e["deptCity"]+"-"+e["arriCity"]+(r?"("+r+")":""),type_id:12,start_station:e["deptStation"],end_station:e["arriStation"],price:e["price"],runtime:e["interval"],start_time:s.format(new Date(e["deptTimeStamp"]),"yyyy-MM-dd hh:mm:ss"),end_time:s.format(new Date(e["arriTimeStamp"]),"yyyy-MM-dd hh:mm:ss"),begin_city:e["deptCity"],end_city:e["arriCity"],train_number:e["trainNumber"],memo:n}}});n.init();return n}e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var o=e.____MODULES["d4c62f2b94cc901a544c40c6446ead0f"];var u=Hogan.compile('    <div class="flight_list_wrap">        <div class="flight_list_head">            <table class="flight_list_table">                <tr>                    <th>                        <div class="th_ct ct_firm csel_out_wrap">                            <span class="csel_label">航空公司 </span>                            <div class="b_cs_sel_wrap">                                <input type="hidden" class="valipt" name="airlineName" value="全部">                                <input class="cs_sel" type="text" readonly value="全部">                                <ul class="cs_option">                                    {{#airlineList}}                                    <li val="{{.}}"><a href="javascript:;">{{.}}</a></li>                                    {{/airlineList}}                                </ul>                            </div>                        </div>                    </th>                    <th><div class="th_ct ct_cys"><span>出发城市</span><span>到达城市</span></div></td>                    <th><div class="th_ct ct_times"><input name="sortkey" class="sortkey" type="hidden"><input class="sortflag" name="sortflag" type="hidden"><a href="javascript:;" val="1" class="no starttime">起飞时间</a><a href="javascript:;"  val="0" class="no endtime">降落时间</a></div></td>                    <th>                        <div class="th_ct ct_time_range csel_out_wrap">                            <span class="csel_label">起飞时段 </span>                            <div class="b_cs_sel_wrap">                                <input type="hidden" class="valipt" name="timeRange" value="全部">                                <input class="cs_sel" type="text" readonly value="全部">                                <ul class="cs_option">                                    {{#timeList}}                                    <li val="{{.}}"><a href="javascript:;">{{.}}</a></li>                                    {{/timeList}}                                </ul>                            </div>                        </div>                    </th>                </tr>            </table>        </div>        <div class="flight_list_body">            <table>                {{#flightList}}                <tr>                    <td><div class="td_ct ct_firm"><input type="radio" name="flightnum"/>{{airlineName}}{{flightNumber}}</div></td>                    <td><div class="td_ct ct_cys"><span class="startcy">{{departureCity}}<em>({{departureAirport}} {{departureTerminal}})</em></span><span class="endcy">{{arrivalCity}}<em>({{arrivalAirport}} {{arrivalTerminal}})</em></span></div></td>                    <td><div class="td_ct ct_times"><span>{{startTime}}</span><span>{{endTime}}</span></div></td>                    <td><div class="td_ct ct_time_range"><span>{{timeRange}}</span></div></td>                </tr>                {{/flightList}}            </table>            <div class="notr">抱歉，没有找到符合条件的结果</div>        </div>    </div>');var a=Hogan.compile('    <div class="flight_list_wrap">        <div class="flight_list_head">            <table class="flight_list_table">                <tr>                    <th>                        <div class="th_ct ct_firm csel_out_wrap">                            <span class="csel_label">车次类型 </span>                            <div class="b_cs_sel_wrap">                                <input type="hidden" class="valipt" name="trainType" value="全部">                                <input class="cs_sel" type="text" readonly value="全部">                                <ul class="cs_option">                                    {{#trainTypeList}}                                    <li val="{{.}}"><a href="javascript:;">{{.}}</a></li>                                    {{/trainTypeList}}                                </ul>                            </div>                        </div>                    </th>                    <th><div class="th_ct ct_cys"><span>出发城市</span><span>到达城市</span></div></td>                    <th><div class="th_ct ct_times">                        <input name="sortkey" class="sortkey" type="hidden"><input class="sortflag" name="sortflag" type="hidden">                        <a herf="javascript:;" val="1" class="no starttime">发车时间</a>                        <a href="javascript:;" val="0" class="no endtime">到站时间</a></div></td>                    <th>                        <div class="th_ct ct_time_range csel_out_wrap">                            <span class="csel_label">发车时段 </span>                            <div class="b_cs_sel_wrap">                                <input type="hidden" class="valipt" name="timeRange" value="全部">                                <input class="cs_sel" type="text" readonly value="全部">                                <ul class="cs_option">                                    {{#timeRangeList}}                                    <li val="{{.}}"><a href="javascript:;">{{.}}</a></li>                                    {{/timeRangeList}}                                </ul>                            </div>                        </div>                    </th>                </tr>            </table>        </div>        <div class="flight_list_body">            <table>                {{#trainList}}                <tr>                    <td><div class="td_ct ct_firm"><input type="radio" name="flightnum"/>{{trainType}}{{trainNumber}}</div></td>                    <td><div class="td_ct ct_cys"><span class="startcy">{{deptCity}}<em>({{deptStation}})</em></span><span class="endcy">{{arriCity}}<em>({{arriStation}})</em></span></div></td>                    <td><div class="td_ct ct_times"><span>{{deptTime}}</span><span>{{arriTime}}</span></div></td>                    <td><div class="td_ct ct_time_range"><span>{{timeRange}}</span></div></td>                </tr>                {{/trainList}}            </table>            <div class="notr">抱歉，没有找到符合条件的结果</div>        </div>    </div>');var l={data:null,dom:null,listData:null,initDom:function(){var e=this;this.dom_head=this.dom.find(".flight_list_head");this.list_wrap=this.dom.find(".flight_list_body");this.list_table=this.list_wrap.find("table");this.allList=this.dom.find(".flight_list_body tr");this.alllistData=QNR.map(this.listData,function(t,n){t.dom=e.allList.eq(n);e.allList.eq(n).data("data",t);return t});this.csels=this.dom.find(".b_cs_sel_wrap");this.redios=this.allList.find("input");this.notr=this.list_wrap.find(".notr");this.initScroll();o({dom:this.csels,defFirst:true,events:{seled_option:$.proxy(e.filterTr,e)}});this.list_wrap.delegate("table tr","click",function(){var e=$(this),t=e.find("input");if(!t.is(":checked")){t.prop("checked",true)}});this.dom_head.delegate(".ct_times a","click",function(){var t=$(this);var n=$(this).val();var r=1;t.siblings().removeClass("earlier").removeClass("later").addClass("no");if(t.hasClass("earlier")){r=-1;t.removeClass("earlier").removeClass("no").addClass("later")}else{t.removeClass("later").removeClass("no").addClass("earlier")}var i=e._getSortKey($(this));e.sortTr(i,r)});this.allList.eq(0).find("input").prop("checked",true)},sortTr:function(e,t){var n=this;var r=t;var i=n.alllistData;i.sort(function(t,n){var i=(t[e]-n[e])*r;return i});n.list_table.empty();QNR.forEach(i,function(e){n.list_table.append(e.dom)})},filterTr:function(e){var t=this;var r={};var i=t.csels.find("input");var s=false;QNR.forEach(i,function(e){var t=$(e),n=t.attr("name");n&&(r[n]=t.val())});QNR.forEach(t.alllistData,function(e){var t=e.dom,i=true;for(n in r){if(r[n]!="全部"&&r[n]!=e[n]){i=false}}if(i){t.show();s=true}else{t.hide()}});!s?t.notr.show():t.notr.hide();var o=0;while(o<t.alllistData.length){var u=t.alllistData[o].dom;if(u.css("display")!="none"){u.find("input").prop("checked",true);break}o++}},initScroll:function(){if(this.list_wrap.find("tr").length>6){this.list_wrap.addClass("listbody_scroll")}},getCheckData:function(){var e=this;if(e.notr.css("display")!="none"){return null}if(e.alllistData.length==1){return this._parseSubmitData(this.alllistData[0])}var t=this.redios.filter("input[checked]");var n=t.length?t.parents("tr"):null;if(n&&n.css("display")!="none"){return this._parseSubmitData(e.alllistData[n.index()])}}};r.exports={cflightList:c,cTrainList:h}}(t.exports,t,e);e.____MODULES["4660ce0234875065956a8b2123a87383"]=t.exports})(this);(function(e){var t={id:"8fbfd62920ccc602c18b0fef50fb1f75",filename:"trafficLineDialog.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function l(e){var t={_dialog:null,observer:e,init:function(){this._dialog=new QNR.Dialog({content:f,titleVisible:false,clsName:"trafficline_dialog",closeCls:"btn_close",hideCloseBtn:false});this.wrap=this._dialog.getContainer();this.add_book_btn=this.wrap.find("a.btn_confirm");this.wrap.delegate(".js_out","click",$.proxy(this.out,this));this.wrap.delegate(".js_submit","click",$.proxy(this.sbmit,this))},out:function(){this.wrap.hide();this.add_book_btn.addClass("hide");this.observer.fire("user_want_add_other");this.observer.fire("stop_request_traffic_list")},sbmit:function(){var e=this,t=e.listObj&&e.listObj.getCheckData();if(!t){return false}$.extend(t,{image:a.getImg(t.type_id,t)});if(e.eleModel){e.observer.fire("view_rmAddElement",e.eleModel,t)}else{QNR.PubSub.fire("poi_add_to_book",t)}e.hide()},show:function(e,t,n){var r="";this.eleModel=n;var i=$('<div class="noresult"></div>');if(t instanceof jQuery||typeof t=="string"){r=i.html(t)}else{if(e==13){if(!t||!t.data&&!t.flightList||t.data&&!t.data.flights.length){r=i.html("没有搜索到航班信息")}else{this.listObj=o(t);r=this.listObj.dom;this.add_book_btn.removeClass("hide")}}else{if(!t||!t.data){r=i.html("没有搜索到列车信息")}else{this.listObj=u(t);r=this.listObj.dom;this.add_book_btn.removeClass("hide")}}}this._dialog.setContent(r);this._dialog.show()},hide:function(){this._dialog.getContent().empty();this.add_book_btn.addClass("hide");this._dialog.hide()}};t.init();return t}function h(e,t,n,r){if(!c){c=l(n)}c.show(t,e,r)}e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];e.____MODULES["9107c28b5689cd09e17d4039d9133542"];var i=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var s=e.____MODULES["4660ce0234875065956a8b2123a87383"];var o=s.cflightList;var u=s.cTrainList;var a=e.____MODULES["56483375e8bf013e95419f32c44a39a1"];var f=['<div class="b_dialog js_dialog trafficline_dialog" style="width:598px">','<div class="e_dialog_hd paddingpatch">查询结果</div>','<div class="e_dialog_ct js_content">','<div class="ct_cont"></div>',"</div>",'<div class="e_dialog_ft"><a href="javascript:;" class="btn_cancel js_out" data-beacon="list_cancel">返 回</a><a href="javascript:;" class="btn_confirm js_submit hide" data-beacon="list_add">加入行程</a></div>','<a href="#" class="btn_close js_close" title="关闭">x</a>',"</div>"].join("");var c;n.exports=h}(t.exports,t,e);e.____MODULES["8fbfd62920ccc602c18b0fef50fb1f75"]=t.exports})(this);(function(e){var t={id:"a9711b463b35a4c5ca16e83a7c750dec",filename:"book.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function D(e){var t=T.getDayByOrder(e);t.loadEles(function(){var n=t.getLngLatData();var r=n.is_abroad,i=n.data;var o={cur_day:e,day_len:T.len(),is_abroad:r,data:i};s.PubSub.fire("show_day_map",o)})}function P(e){}function H(e){var t=j(e);f.saveBook(t,function(t){e.clearChanged()})}function B(e){var t=j(e);f.saveBook(t,function(t){e.clearChanged()})}function j(e,t){function r(e,t){var n=e.children(),i=0,s;while(s=n[i]){var o=s.getDbData();F(o,t,s);r(s,t);i++}}if(s.type(e)!=="array"){e=[e]}var n={add:[],update:[],"delete":[],nodes:[]};e.forEach(function(e){if(!e){return}var i=e.getDbData();F(i,n,e);if(t){r(e,n)}});return n}function F(e,t,n){if(e){var r=e.command;delete e.command;t[r].push(e);t.nodes.push(n)}}var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var o=e.____MODULES["f3a70949d66a5dac19d321c4bb9e82f8"];var u=e.____MODULES["9f7da0fd7ad3ca7bfc636e2365d14ec5"];var a=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var f=e.____MODULES["0d69e05a3d7d97743857afa7e3b62db1"];var l=e.____MODULES["c40a12a69af5784a5522d77d468cee9c"];var c=e.____MODULES["11196581d12c301d7679eb4cbc6a7b18"];var h=e.____MODULES["9b26ef05f14959a7ee8c30e49af33f44"];var p=e.____MODULES["f925719cdf04599aefc650349ef5a8e7"];var d=e.____MODULES["c332ad9877eaf8e1dc5cd36e053c3583"];var v=e.____MODULES["a07b3c9326f0e9f77e61ef0532ee7edd"];var m=e.____MODULES["6069bbe87b4ae8bb6423c781eacb693a"];var g=e.____MODULES["8fbfd62920ccc602c18b0fef50fb1f75"];var y=e.____MODULES["c51777e35917abcb15bcf62b870b9df9"];var b=e.____MODULES["7d96db7148e169d323379e8589367acb"];var w=99;var E=a.planBc;var S=new u,x=new u;var T,N,C,k,L;var A=function(e){S.getDayLen=function(){return T.len()};N=new h(i("div.trip_top_box"),S);T=new l(e,x);k=new c({model:T,observer:S});M();_();O();var t=o.get(),n=parseInt(t.dayOrder,10)||0,r=T.getDays().length,s=Math.min(n,r-1);T.selectDay(s)};window.getModelBook=function(){return T};var O=function(){s.PubSub.on("poi_add_to_book",function(e,t){var t=t||T.getSelectDay();t.addElement(e)});s.PubSub.on("toadd_custom_poi",function(e,t){var n=T.getSelectDay();S.fire("user_want_add_other",e,n,null,t)});s.PubSub.on("route_add_to_day",function(e){var t=T.getSelectDay();var n=t.getId();if(n){var r={routeid:e,id:n};var i=t.len();f.addRoute(r,function(e,r){T.reloadDays(e,n,r);t.reload(function(){k.selectDay(t.order());C.setModel(t);C.render();setTimeout(function(){C.scroll(i)},0)})})}});s.PubSub.on("route_day_add_to_day",function(e,t){var n=T.getSelectDay();var r=n.getId();if(r){var i=n.len()-1;var s={order:t,routeid:e,id:r,travel_order:i};f.addRoute(s,function(e){var t=T.getDayById(e);if(t){t.reload(function(){k.selectDay(t.order());C.setModel(t);C.render();setTimeout(function(){C.scroll(i+1)},0)})}})}});s.PubSub.on("one_day_map_to_show",D);s.PubSub.on("reset_map_button",function(){});s.PubSub.on("one_day_map_traffic_detail",function(e,t){if(!L){L=p;L.init(S)}var n=T.getDayByOrder(e);L.show(n,T.len());L.openTrafficDetail(t)});s.PubSub.on("one_ele_around_view_detail",function(e){if(!L){L=p;L.init(S)}var t=e.parent();L.show(t,T.len());L.openAroundView(e)});s.PubSub.on("custom_dialog_show",m)};var M=function(){function n(e,n,r,i,s){if(t){return}var o,u,a=false;if(e.nodeType()==="BOOK_ELEMENT"){var u=[n];a=true;if(i&&n!==i){u.concat(i);E("move_poi")}}else{u=T.children()}o=j(u,a);t=true;f.saveBook(o,function(e,n){var r=e.ids||{};n.forEach(function(e){var t=e.commondType();if(t===e.COMMOND_TYPES.ADD){var n=e.loadId(r);if(n&&e.nodeType()==="BOOK_DAY"){T.selectDay(e.order())}}e.clearChanged()});t=false},function(){t=false})}function r(){}function i(e){var t=e.getId()}function u(e){var t=e.getDest();k.selectDay(e.order());if(t.length){var n=t[0];s.PubSub.fire("show_dest",n)}else{s.PubSub.fire("no_dest_for_show")}if(!C){C=new v({model:e,observer:S});C.render()}else{C.setModel(e)}o.set("dayOrder",e.order())}function a(e){k.selectDay(e.order());C.setModel(e);C.render()}var e=[{name:"move_node",fn:n},{name:"day_dests_change",fn:r},{name:"day_selected",fn:u},{name:"rm_node",fn:i},{name:"reload_day",fn:a}];e.forEach(function(e){x.on(e.name,e.fn)});var t=false};var _=function(){function t(e){if(e===T.context("title")){return}T.context("title",e);var t=T.getDbChangeData();f.saveBase(t,function(){T.clearChanged()});E("click_title")}function n(e,t){e.moveTo(T,t);T.selectDay(t)}function r(e){k.selectDay(e);T.selectDay(e)}function i(e){T.startTime(e);var t=T.getDbChangeData();f.saveBase(t,function(){T.clearChanged()});E("edit_date")}function o(e){if(T.len()===1){y.showInfo("只有一天不能删除");y.hideInfo(3e3);return}var t=e.order();T.rmDay(e);e.setDeleted();var n=T.children();var r=j([e].concat(n));f.saveBook(r,function(n,r){r.forEach(function(e){if(e.commondType()===e.COMMOND_TYPES.UPDATE){e.clearChanged()}});if(T.getDayByOrder(t)){T.selectDay(t)}else{T.selectDay(t-1)}e.remove()});E("delete_day")}function u(e){var t=T.getSelectDay();t.delDestByIndex(e);H(t);E("delete_city")}function a(e){var t=T.getSelectDay();t.context("memo",e);H(t)}function l(e){if(T.len()>=w){y.showInfo("行程最多不能超过"+w+"天，请调整后在继续。",true);return}T.createDay(e);E("add_day")}function c(e){T.selectDay(e)}function h(e,t){var n=e.parent();e.moveTo(n,t)}function x(e){var t=e.parent();var n=v(e);t.rmElement(e);d(n.start,n.end,t);e.setDeleted();var r=j([e].concat(t.children()));f.saveBook(r,function(t,n){n.forEach(function(e){e.clearChanged()});e.remove()})}function N(e,t){var n=e.parent();n.rmElement(e);e.setDeleted();t.travelOrder=e.context("travelOrder");var r=n.parseToElement(t);r.context("dayId",n.getId());var i=j([e,r]);f.saveBook(i,function(e,t){T.selectDay(n.order())})}function C(e){var t=T.getSelectDay();if(t.userAddDest(e)){H(t);s.PubSub.fire("show_dest",e)}}function A(e,t){var n=e.parent();var r=v(e);var i=T.getDayByOrder(t);e.parent().rmElement(e);d(r.start,r.end,n);i.loadEles(function(){var t=i.len();e.moveTo(i,t)})}function O(e,t){t.context(e);B(t)}function M(e){var t=e.getPoiId();var n=e.type()*1;if(b.locations.indexOf(n)>-1){s.PubSub.fire("show_poi_detail",t)}}function _(e){if(!L){L=p;L.init(S)}var t=T.getDayByOrder(e);L.show(t,T.len())}function D(e){var t=T.getSelectDay();t.setDest(e);H(t)}function P(){s.PubSub.fire("exit_day_map")}function F(e){s.PubSub.fire("show_dest",e)}function I(e,t,n,r){if(arguments.length>0){m({key:e,dayModel:t,eleModel:n,expand_pro:r,observer:S})}else{m()}}function q(e,t,n){g(e,t,S,n)}function R(e){if(!L){L=p;L.init(S)}var t=T.getSelectDay();t.loadEles(function(){if(e){t.updateTrafficByMode(e,function(){L.show(t,T.len(),e)})}else{L.show(t,T.len())}})}function U(e){s.PubSub.fire("one_ele_around_view_detail",e)}var e=[{name:"view_book_title_change",fn:t},{name:"view_start_date_update",fn:i},{name:"view_add_day",fn:l},{name:"view_rm_day",fn:o},{name:"view_day_move",fn:n},{name:"view_change_day",fn:r},{name:"view_add_dest_in_day",fn:C},{name:"view_day_rm_dest",fn:u},{name:"view_day_memo",fn:a},{name:"view_move_elements",fn:h},{name:"view_day_selected",fn:c},{name:"view_rm_element",fn:x},{name:"view_move_element_to_day",fn:A},{name:"view_element_edit",fn:O},{name:"view_poi_detail",fn:M},{name:"view_day_map",fn:_},{name:"view_day_dest_redraw",fn:D},{name:"view_exit_day_map",fn:P},{name:"view_show_dest",fn:F},{name:"user_want_add_other",fn:I},{name:"view_traffic_line_result",fn:q},{name:"view_traffic_show",fn:R},{name:"view_ele_around",fn:U},{name:"view_rmAddElement",fn:N}];e.forEach(function(e){S.on(e.name,e.fn)});var d=function(e,t,n){if(e&&t){n.loadTraffic(e,t)}};var v=function(e){var t=e.parent();var n=t.children();var r=e.contextAll().travelOrder;var i=n[r-1];var s=n[r+1];return{start:i,end:s}}};window.BOOK_INIT=A}(t.exports,t,e);e.____MODULES["a9711b463b35a4c5ca16e83a7c750dec"]=t.exports})(this);(function(e){var t={id:"7c39992162f54803257bd8c4484bd343",filename:"sch_box_src.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){e.____MODULES["1c215cb2b26f2cbeb305c7cbcf472a99"];e.____MODULES["a9711b463b35a4c5ca16e83a7c750dec"]}(t.exports,t,e);e.____MODULES["7c39992162f54803257bd8c4484bd343"]=t.exports})(this)