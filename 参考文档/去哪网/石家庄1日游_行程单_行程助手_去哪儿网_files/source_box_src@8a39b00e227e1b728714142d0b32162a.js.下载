(function(e){var t={id:"9f7da0fd7ad3ca7bfc636e2365d14ec5",filename:"Event.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=i.Event,o=[].slice;var u=function(){u.$super.apply(this,arguments)};i.extend(u,s,{bind:function(e,t,n){if(i.type(e)==="object"){var r=[];for(var s in e){r.push(this.bind(s,e[s],n))}return r}else{if(n){t=i.proxy(t,n)}var o=this._getOne(e);if(o.fired){t.apply(null,t.args);delete o.fired;delete o.args;return t}this._getOne(e).push(t);return t}},trigger:function(e){var t=this._getOne(e)||[];var n=o.call(arguments,1);var r=this;var i=t.map(function(e){return e.apply(r,n)});return i},triggerReady:function(e){var t=this._getOne(e);var n=o.call(arguments,1);t.forEach(function(e,t){if(typeof e!="function"){return null}return e.apply(null,n)});t.fired=true;t.args=n}});u.prototype.fire=u.prototype.trigger;n.exports=u}(t.exports,t,e);e.____MODULES["9f7da0fd7ad3ca7bfc636e2365d14ec5"]=t.exports})(this);(function(e){var t={id:"edb44368d6da1ca32d60ffa026712ff5",filename:"jquery.placeholder.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){(function(e){e.fn.qplaceHolder=function(t){var n="qplaceholder";var r=t&&t.customClass;var i=t&&t.placeholder;var s=t&&t.allBrowser||false;var o;if(s){o=false}else{o=function(){return"placeholder"in document.createElement("input")}();if(o){return this}}this.each(function(t,s){function p(){if(e.trim(o.val())===""){l.show()}else{l.hide()}}var o=e(s);var u=o.parent("div"),a=i||o.attr("placeholder"),f=e.trim(o.val()),l;if(!a){return false}o.removeAttr("placeholder");var c=parseInt(o.css("line-height")||o.css("height")||0,10)+parseInt(o.css("padding-top")||0,10)+parseInt(o.css("padding-bottom")||0,10);var h={display:f===""?"block":"none",position:"absolute",left:parseInt(u.css("padding-left")||0,10)+parseInt(o.css("padding-left")||0,10),top:parseInt(u.css("padding-top")||0,10),height:c+"px","line-height":c+"px",color:"#999","font-size":"14px"};u.css({position:"relative"});l=a instanceof e?a:e("<span>"+a+"</span>");r?l.addClass(r):l.css(h);u.append(l);o.data("qplaceholder",l);o.bind("propertychange."+n,p);o.bind("change."+n,p);o.bind("blur."+n,p).bind("focus."+n,function(){l.hide()});l.bind("click."+n,function(){o.trigger("focus")});l.bind("focus."+n,function(){o.trigger("focus")})});return this}})(jQuery)}(t.exports,t,e);e.____MODULES["edb44368d6da1ca32d60ffa026712ff5"]=t.exports})(this);(function(e){var t={id:"525d1dc0d8839c64abc3253ded526e97",filename:"jquery.qlimitlen.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];(function(e){function t(t){var n=this;var r=e.trim(n.val());var s=Math.ceil(i.countStrByWord(r));if(s<=t){n.trigger("action_less",s);return}if(s>t){r=i.cutString(r,t,"");n.trigger("action_more",s)}n.val(r)}e.fn.qlimitlen=function(n,r){var i="qlimitlen";this.each(function(s,o){var u=e(o);var a=a||20;if(!n){return}u.bind("keyup."+i,e.proxy(t,u,n));u.bind("keydown."+i,e.proxy(t,u,n));u.bind("check",e.proxy(t,u,n));u.trigger("check");if(r){for(i in r){u.bind(i,e.proxy(r[i]))}}});return this}})(jQuery)}(t.exports,t,e);e.____MODULES["525d1dc0d8839c64abc3253ded526e97"]=t.exports})(this);(function(e){var t={id:"f359268032ef95a76c48519ac6bb62c6",filename:"jquery.qsuggest.1.3.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){(function(e){function s(e){var t=e.offset();t["top"]+=e.outerHeight();return t}function o(e){return e.closest("table").data("data")[e.attr("data-ind")*1]}function u(e){var t=this;var n=t.visible();var r=e.keyCode;if(r===40&&!n){t.show();return}var i=t.el.find("tr");var s=i.filter(".active");switch(r){case 38:case 40:if(n){t._excludeEl=t._mouseFocus;s.removeClass("active");var u=e.keyCode===38?s.prev():s.next();if(u.size()===0)u=i.filter(r===38?":last":":first");var a=t.args.getData||o;var f=a(u);t.setValue(f);u.addClass("active");e.preventDefault();t._trigger("q-suggest-user-action",[e,f,r,u])}break;case 13:if(n){var f=t.getValue();t.hide();t._trigger("q-suggest-user-action",[e,f,r,s])}break;case 27:if(n){t.hide();t._trigger("q-suggest-user-action",[e,t.getValue(),r,s])}break;case 18:case 9:break;default:}}function a(e,t){if(!this.init)return new qsuggest(e,t);else return this.init(e,t)}var t=function(){var e="data-detect-oninput",t={},n={},r=1,i=1;var s=function(e,n,r,i){if(e.addEventListener)e.addEventListener(n,r,false);else if(e.attachEvent)e.attachEvent("on"+n,r);(t[i]||(t[i]=[])).push({t:n,h:r})};var o=function(e,n){if(!t[n])return;for(var r=0,i;i=t[n][r];r++)if(e.removeEventListener)e.removeEventListener(i["t"],i["h"],false);else if(e.detachEvent)e.detachEvent("on"+i["t"],i["h"]);delete t[n]};var u=function(e,t){var n=e.value;var r=function(){var i;if((i=e.value)!==n){if(r._sleep!==true)t.call(e,i,n);n=e.value}};return r};var a=navigator.userAgent.toLowerCase();return{version:"1.3",bind:function(t,o){var f,l=o[e];if(!l)o[e]=l=r++;if(!(f=t.getAttribute(e)))t.setAttribute(e,f=""+i++);var c=u(t,o);if("oninput"in t&&!/opera/.test(a))s(t,"input",c,l);else{var h;s(t,"focus",function(){if(!h)h=setInterval(c,100)},l);s(t,"blur",function(){if(h){clearInterval(h);h=null}},l)}n[l]={eid:f,checker:c};return t},unbind:function(t,r){if(r[e]){o(t,r[e]);delete n[r[e]]}return t},set:function(t,r){var i=t.getAttribute(e);if(i){var s=[];for(var o in n)if(n[o]["eid"]===i){s.push(n[o]["checker"]);n[o]["checker"]._sleep=true}t.value=r;for(var u=0,a=s.length;u<a;u++){s[u].call(t);s[u]._sleep=false}}else t.value=r}}}();e.qsuggest={version:"1.2"};var n=e.qsuggest.ROOT_KEY="q-suggest";var r=0;var i={ajax:{url:null,cache:false,success:function(){}},reader:function(e){return e},loader:function(e){return e},max:10,min:1,container:null,delay:100,rdelay:1e3,requestWithNothing:false,trimQuery:true,autoSelect:true,css:{"z-index":500},setValue:function(e){return e},render:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},exattr:function(e){return e}};e.extend(a.prototype,{init:function(s,a){this.key=++r;var f=this.ns=n+this.key;a=this.args=e.extend(true,{},i,a||{});var l=this.activeEl=e(s);var c=this;this.el=e('<div class="'+n+(a.customClass?" "+a.customClass:"")+'"></div>').appendTo(a["container"]||document.body).hide();this.el.data(n,this);this._handler=null;this._ajaxHandler=null;this._excludeEl=null;this._mouseFocus=null;this._last=[];this._cache={};this._value=null;e.each(a["on"]||{},function(e,t){l.bind(e+"."+f,t)});if(a["css"])this.el.css(c.args["css"]);var c=this;var h=false;l.bind("keydown."+f,function(e){var t=e.keyCode;if(t>=229){h=true}});t.bind(l[0],function(){c.show()});l.bind("keydown."+f,function(e){if(h){h=false;return}var t=c.args.keyevent||u;t.call(c,e);h=false});l.bind("blur."+f,function(e){if(c.visible()){var t=c.el.find("tr.active");if(t.length>0){var n=c.args.getData||o;if(c.args.autoSelect){c.setValue(n(t))}}else{c._trigger("q-suggest-noresult",[l])}c.hide()}});e("tr",this.el[0]).live("mouseover."+f+" mouseout."+f+" mousedown."+f,function(t){var n=e.nodeName(t.target,"tr")?e(t.target):e(t.target).parents("tr").eq(0);if(e(n[0]).attr("data-sug_type")==1){t.preventDefault();return}var r=n[0]!=c._excludeEl;if(t.type==="mouseover"){if(r){n.parents().children().removeClass("active");n.addClass("active");c._excludeEl=null}c._mouseFocus=n[0]}else if(t.type==="mouseout"){c._mouseFocus=null}else{var i=c.args.getData||o;c.setValue(i(n));c.hide();c._trigger("q-suggest-user-action",[t,c.getValue(),null,n])}});return this},req:function(){var t=this;if(t._handler)clearTimeout(t._handler);if(t._timeoutHandler){clearTimeout(t._timeoutHandler);t._timeoutHandler=null}if(t._ajaxHandler){t._ajaxHandler=null}t._handler=setTimeout(function(){var n=t.activeEl.val(),r=t.args.loader(n),i=null,s;if(t.args.trimQuery)r=e.trim(r);if(!r&&!t.args.requestWithNothing){t.draw(null);return}if(t._last&&t._last[0]===r){t.draw(t._last[1]);return}if(t._last&&t._last[0]==r)i=t._last;else if(t.args.cache&&t._cache[r])i=t._cache[r];var o=typeof t.args.ajax.url=="function"?t.args.ajax.url():t.args.ajax.url;if(i)t.draw((t._last=i)[1]);else if(!o)t.draw(null);else{o=o.replace(/\*|([^*]+)$/,encodeURIComponent(r)+"$1");var u=t.args.ajax.success;t._timeoutHandler=setTimeout(function(){t.hide()},t.args.rdelay);t._ajaxHandler=e.ajax(e.extend({},t.args.ajax,{url:o,success:function(e,i){clearTimeout(t._timeoutHandler);t._timeoutHandler=null;t._ajaxHandler=null;if(n!==t.activeEl.val())return;var s=t.args.reader.call(t,e,i);if(t.type(s)==="Array"){t.draw(s);t._last=t._cache[r]=[r,s,i]}u.apply(this,arguments)}}))}},t.args.delay)},type:function(e){return Object.prototype.toString.call(e).slice(8,-1)},show:function(){this.req()},hide:function(){if(this.visible()){this.el.hide();this._trigger("q-suggest-hide")}},draw:function(t){var n=this;this.el.empty();var r=this.args.min,i=this.args.max;if(!t||!t.length||t.length<r){this.hide();return}var o=[],u=this.args.render,a=this.args.exattr,f=true;var l=e.type(this.args.firstChoose)==="undefined"?true:this.args.firstChoose;var c=e.type(this.args.firstFunc)==="undefined"?function(){return true}:this.args.firstFunc;o.push('<table cellspacing="0" cellpadding="2"><tbody>');e.each(t,function(e,t){if(e>=i)return false;var n="";var r=c;if(f&&l&&r(t)){f=false;n=' class="active" '}o.push("<tr",n,' data-ind="',e,'"><td>',u(t),"</td></tr>")});o.push("</tbody></table>");var h=e(o.join("")).appendTo(this.el).data("data",t);if(!this.args["container"])this.el.css(s(this.activeEl));var p=this.args["width"],d=this.activeEl.outerWidth();if(typeof p==="function"){p=p()}if(!p||p<d)p=d;this.el.css("width",p);this.el.show();this._trigger("q-suggest-show",[t])},dispose:function(){this._trigger("q-suggest-dispose");this.activeEl.unbind("."+this.ns);e(window).unbind("."+this.ns);this.el.remove()},visible:function(){return this.el.is(":visible")},_trigger:function(){this.activeEl.triggerHandler.apply(this.activeEl,arguments)},setValue:function(e){t.set(this.activeEl[0],e);this._value=e;this._setExtData();this._trigger("q-suggest-setvalue",[e,this.activeEl])},_setExtData:function(){var e=this.el.find("tr.active");var t=this.args.getExtData?this.args.getExtData(this.el.find("tr.active")):{};this._trigger("q-suggest-setextdata",[t,this.activeEl])},getValue:function(){return this._value},set:function(e,t){var n=false;switch(e){case"container":this.el.appendTo(t||document.body);this.el.css({top:"",left:""});break}if(!n)for(var r=0,i=e.split("."),s=i.length,o=this.args;r<s&&(r!==s-1&&(o[i[r]]||(o[i[r]]={}))||(o[i[r]]=t));o=o[i[r]],r++){}return t},get:function(e){for(var t=0,n=this.args,r=e.split("."),i=r.length;t<i&&(n=n[r[t]]);t++){}return n}});e.fn.qsuggest=function(){var t=arguments;if(arguments.length>1&&this.data(n)){var r=null;if(arguments[0]==="option"||arguments[0]==="setting")this.each(function(i,s){var o=e(s);var u=this.data(n);if(u)r=r||(t.length>2?u.set(t[1],t[2]):u.get(t[1]))});return r}else if(arguments.length<=1){this.each(function(r,i){var s=e(i);if(s.data(n)){s.data(n).dispose();s.removeData(n)}var o=new a(i,t[0]);s.data(n,o)})}return this}})(jQuery)}(t.exports,t,e);e.____MODULES["f359268032ef95a76c48519ac6bb62c6"]=t.exports})(this);(function(e){var t={id:"fb6676bbeb3f7bf171ccf693306b1d38",filename:"suggest.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function s(e){function r(){var e=t.data("q-suggest");t.parent("div").addClass("sctext_box_on")}function i(){t.parent("div").removeClass("sctext_box_on")}var t=e.el;var n=e.entercb;t.qsuggest($.extend(e,{autoSelect:false,delay:100}));t.bind("focus.on",r);t.bind("blur.off",i);t.bind("keyup",function(e){var n=e.keyCode||e.which;if(n!=40&&n!=38&&n!=13){t.data("q-suggest").show()}})}var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];e.____MODULES["f359268032ef95a76c48519ac6bb62c6"];n.exports=s}(t.exports,t,e);e.____MODULES["fb6676bbeb3f7bf171ccf693306b1d38"]=t.exports})(this);(function(e){var t={id:"cca8bfa16c042ce6eb4021cac0c04274",filename:"config.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r={SUG_URLS:{CITY:"/suggest/plan?q=*&type=1&limit=4&callback=?",AREA:"/suggest/plan?q=*&type=2&limit=7&callback=?"},SEARCH_URI:"/place/api/dist/np/{{distId}}?new_plan=true",SEARCH_HOME_DEST_URI:"/place/api/dist/np2/{{distId}}",RECOMMEND_CITYS:"/place/api/dist/recommend_cities",DEST_INFO:{CITY_LOCATION:"/api/mapsearch/distIds/"},DEST_TYPE:{6:"城市",3:"国家",1:"州",7:"城市",0:"国际"}};t.exports=r}(t.exports,t,e);e.____MODULES["cca8bfa16c042ce6eb4021cac0c04274"]=t.exports})(this);(function(e){var t={id:"f499f9cbe4503a398f85810d66af4579",filename:"CitySug.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function f(e){function u(e){var t=c(e);e=h(t);if(!e){return""}var n="";if(!e.id&&!e.isDef){n='<div class="sug_item item sug_selfdefine">添加自定义“'+QNR.HTMLEncode(e.city)+"”</div>"}else{var r=[];var i=[];e.city?r.push(e.city):null;e.country?r.push(e.country):null;e.cityEnName?i.push(e.cityEnName):null;e.countryEnName?i.push(e.countryEnName):null;n='<div class="sug_item item">'+QNR.HTMLEncode(r.join(","))+"&nbsp;"+QNR.HTMLEncode(i.join(","))+"</div>"}return n}function f(e){r=e.data||[];var n=QNR.some(r,function(e){if(e.city==t.val()){return true}});!n&&r.push({query:t.val(),id:0,distType:"6",city:t.val(),cityEnName:"",province:"",provinceEnName:"",country:"中国",countryEnName:"China"});var i=[];var s;for(var o=0,u=r.length;o<u;o++){var a=r[o];s=[a.id,a.distType].join("_");i[i.length]=s}return i}function l(e,t,r,i,s){n(p(h(i)),s)}function c(e){var t;for(var n=0;n<r.length;n++){var i=r[n];if([i.id,i.distType].join("_")==e){t=n;break}}return t}function h(e){return r[e]}function p(e){return{city_name:e.city,city_id:e.id,days:e.trDays||1}}function m(){t.bind("keyup focus",function(e){code=e.keyCode||e.which;defData=t.data("defData");if(defData&&defData.length&&t.val()===""&&(e.type=="focus"||e.type=="keyup"&&code==8)){var n=[];QNR.forEach(defData,function(e){e.isDef=true;n.push([e.id,e.distType].join("_"))});r=defData;if(e.type=="keyup"){setTimeout(function(){t.data("q-suggest").draw(n);t.data("q-suggest")._last=[]},200)}else{t.data("q-suggest").draw(n);t.data("q-suggest")._last=[]}}})}var t=e.el;var n=e.enterFn;var r=[];var s=a.CITY;var d={max:10,customClass:"city_sug",el:i("body"),ajax:{url:s,dataType:"jsonp",cache:false},render:u,reader:f,entercb:l};t.qplaceHolder().qlimitlen(10);var v=i.extend(e.on,{"q-suggest-user-action":function(e,r,i,s,o){var u=o.data("ind");t.val(h(u).city);n&&n(h(u),s)}});e.showDef&&m();o(i.extend(d,e,{on:v}))}var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];e.____MODULES["edb44368d6da1ca32d60ffa026712ff5"];e.____MODULES["525d1dc0d8839c64abc3253ded526e97"];var s=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var o=e.____MODULES["fb6676bbeb3f7bf171ccf693306b1d38"];var u=e.____MODULES["cca8bfa16c042ce6eb4021cac0c04274"];var a=u.SUG_URLS;n.exports=f}(t.exports,t,e);e.____MODULES["f499f9cbe4503a398f85810d66af4579"]=t.exports})(this);(function(e){var t={id:"461f9fd1460bd21be4b632cf6533fbdb",filename:"CityMod.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=window;var s=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var o=e.____MODULES["88d5c499e26b6f8fc86d873910ae3aea"];var u=function(){var e=i.getModelBook();var t={};var n=e.children().map(function(e){return e.getDest()}).expand().filter(function(e){var n=e.cityId;if(n&&!t[n]){t[n]=true;return e}});return n};var a=function(e,t){if(!t&&s.type(e)==="function"){t=e;e={}}var n=e.day||i.getModelBook().getSelectDay();var r=e.page_size||6;var u=n.getDest();var a=u.map(function(e){return e.cityId+"_"+e.distType||6}).join(",");var f="/travelbook/plan/hotcities";o.get(f,{cityIds:a,pageSize:r},function(e){var n=e.data;var r=n.cities||[];if(r.length>10){r=r.slice(0,10)}t(r)},function(){t([])})};n.exports={getCityList:u,getHotCity:a}}(t.exports,t,e);e.____MODULES["461f9fd1460bd21be4b632cf6533fbdb"]=t.exports})(this);(function(e){var t={id:"982ab75b02893ded6bae1666afafbc53",filename:"SwitchTab.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var u=e.____MODULES["f499f9cbe4503a398f85810d66af4579"];var a=e.____MODULES["461f9fd1460bd21be4b632cf6533fbdb"];var f=function(e){var t=s("#switch_tab_bpx");this._box=t;this._observer=e.observer;this._init()};var l={constructor:f,_init:function(){var e=this,t=e._box;e._$body=s("body");e._tabs=t.find("li.source_tab");e._title_tab=t.find("li.dest_tab");e._dest_name=e._title_tab.find("span.dest_name");e._dest_change_btn=e._title_tab.find("a.dest_change");e._add_dest_box=t.find(".add_dest_box");e._city_list_box=e._add_dest_box.find(".city_list");e._hot_city_box=e._add_dest_box.find(".hot_city").hide();e._city_sug_box=e._add_dest_box.find(".city_sug_box");e._city_inp=e._add_dest_box.find("input");e._init_sug=false;e.listen()},listen:function(){var e=this;e._tabs.click(function(){var t=s(this);var n=t.index();e._tabs.removeClass("selected");t.addClass("selected");e._observer.fire("switch_dest_collect_tab",n)});e._dest_change_btn.click(function(t){t.preventDefault();t.stopPropagation();if(!e._init_sug){e._initCitySug()}var n=a.getCityList();var r=e._dest.cityId*1;n=n.filter(function(e){return e.cityId!==r});a.getHotCity(function(t){if(t.length){var n=t.map(function(e){return"<a class='dest_name js_dest' href='#' data-id='"+e.distId+"'>"+e.distName+"</a>"}).join("");e._hot_city_box.find("p").html(n);e._hot_city_box.show()}});var s=n.map(function(e){return'<div class="l_item"><a class="item_content js_dest" href="#" data-id="'+e.cityId+'" data-type="'+e.distType+'">'+e.cityName+"</a></div>"}).join("");var o=e._dest_name.position().left-8;if(i.Browser.isIE6){n.length>5?e._city_list_box.addClass("autoscroll"):e._city_list_box.removeClass("autoscroll");o=0}e._city_list_box.html(s);e._add_dest_box.css("left",o).show()});e._add_dest_box.mousedown(function(e){e.stopPropagation()});e._$body.on("mousedown.switch_dest",function(t){e._add_dest_box.hide();e._city_inp.val("")});e._add_dest_box.delegate(".js_dest","click",function(t){t.preventDefault();var n=this.getAttribute("data-id");var r=this.getAttribute("data-type")||6;var i=this.innerHTML;e.changeDest({id:n,name:i,distType:r});if(this.className.match(/dest_name/)){o.planBc("switch_dependence_city")}else{o.planBc("switch_city")}})},switchTabTit:function(e){this._tabs.removeClass("selected");this._tabs.eq(e).addClass("selected")},_initCitySug:function(){var e=this;u({el:e._city_inp,container:e._add_dest_box.find(".sug_con"),enterFn:function(t,n){if(n!=13&&n!=null){return}var r=t.id,i=t.city,s=t.distType;e.changeDest({id:r,name:i,distType:s});o.planBc("switch_search_city")}});e._init_sug=true;e._city_inp.keydown(function(e){e.stopPropagation()})},changeDest:function(e){var t=e.id;var n=e.name;var r=e.distType;var i={cityId:t,cityName:n,distType:r};this._add_dest_box.hide();this._observer.fire("change_dest",i)},setDest:function(e){var t=this;t._dest=e;t._dest_name.text(o.cutString(s.trim(e.cityName),5,"..."));t._tabs.removeClass("selected").eq(0).addClass("selected")},showNoDest:function(){var e=this;e._dest={};e._dest_name.text("请选择城市");e._tabs.removeClass("selected").eq(0).addClass("selected")}};f.prototype=l;n.exports=f}(t.exports,t,e);e.____MODULES["982ab75b02893ded6bae1666afafbc53"]=t.exports})(this);(function(e){var t={id:"302f8bb902b3c3e1b4660c83d164820a",filename:"poi_item.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["poi_item"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<li class="poi_item ');if(r.s(r.f("is_collect",e,t,1),e,t,0,35,50,"{{ }}")){r.rs(e,t,function(e,t,n){n.b("collet_poi_item")});e.pop()}r.b('" data-type="');r.b(r.v(r.f("type",e,t,0)));r.b('" data-city="');r.b(r.v(r.f("city",e,t,0)));r.b('">');r.b("\n"+n);r.b('<div class="p_left_box">');r.b("\n"+n);r.b('    <div class="poi_img_box">');r.b("\n"+n);r.b('            <img src="');r.b(r.v(r.f("image",e,t,0)));r.b('" class="poi_img" >');r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("    ");if(r.s(r.f("distance",e,t,1),e,t,0,244,446,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<div class="distance_box ');if(n.s(n.f("view_pos",e,t,1),e,t,0,282,318,"{{ }}")){n.rs(e,t,function(e,t,n){n.b("distance_box_width js_view_position ")});e.pop()}n.b('"><div class="distance_bg"></div><div class="distance_con"><i class="distance_icon"></i>距离约');n.b(n.v(n.f("distance",e,t,0)));n.b("</div></div>")});e.pop()}r.b("\n"+n);r.b("    ");if(r.s(r.f("haslatlng",e,t,1),e,t,0,478,609,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<div class="distance_box view_position js_view_position "><div class="distance_bg"></div><div class="distance_con">查看位置</div></div>')});e.pop()}r.b("\n"+n);r.b("</div>");r.b("\n"+n);r.b('<dl class="poi_box">');r.b("\n"+n);r.b('    <dt class="poi_name"><a href="#" target="_blank" class="name_wrap"><strong class="main_title lowie_hover">');r.b(r.v(r.f("main_title",e,t,0)));r.b("</strong></a>");if(r.s(r.f("subtitle",e,t,1),e,t,0,802,844,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<span class="subtitle">');n.b(n.v(n.f("subtitle",e,t,0)));n.b("</span>")});e.pop()}r.b("</dt>");r.b("\n"+n);r.b("    ");r.b(r.t(r.f("poi_info",e,t,0)));r.b("\n"+n);r.b('    <dd class="poi_button"><button class="btn" type="button" >添加到行程</button></dd>');r.b("\n"+n);r.b("</dl>");r.b("\n"+n);if(r.s(r.f("is_collect",e,t,1),e,t,0,985,1030,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<a href="javascript:;" class="close_btn"></a>')});e.pop()}r.b("\n"+n);r.b("</li>");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["poi_item"]}(t.exports,t,e);e.____MODULES["302f8bb902b3c3e1b4660c83d164820a"]=t.exports})(this);(function(e){var t={id:"85cbf6cc8cabf130fa1a4bf936b70fac",filename:"route.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["route"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="sight_route">');r.b("\n"+n);r.b('    <div class="sight_route_name"><a href="');r.b(r.v(r.f("route_url",e,t,0)));r.b('" target="_blank" data-beacon="to_dest_route">');r.b(r.v(r.f("name",e,t,0)));r.b("<a></div>");r.b("\n"+n);r.b('    <p class="sight_route_desc">');r.b("\n"+n);r.b("    ");r.b(r.v(r.f("desc",e,t,0)));r.b("\n"+n);r.b("    </p>");r.b("\n"+n);r.b('    <ol class="route_box">');r.b("\n"+n);if(r.s(r.f("routes",e,t,1),e,t,0,247,623,"{{ }}")){r.rs(e,t,function(e,t,r){r.b('        <li class="route_item">');r.b("\n"+n);r.b("            <ul>");r.b("\n"+n);r.b('                <li class="r_day_add_box" ><a href="javascript:;"  class="r_day_add" data-routeid="');r.b(r.v(r.f("id",e,t,0)));r.b('" data-order="');r.b(r.v(r.f("index",e,t,0)));r.b('" ></a></li>');r.b("\n"+n);r.b('                <li class="day"><div class="txt"><span>D');r.b(r.v(r.f("index",e,t,0)));r.b('</span><div class="icon"></div></div></li>');r.b("\n"+n);r.b("                ");r.b(r.t(r.f("day_route",e,t,0)));r.b("\n"+n);r.b("            </ul>     ");r.b("\n"+n);r.b("        </li>");r.b("\n")});e.pop()}r.b("    </ol>");r.b("\n"+n);r.b('    <div class="route_button">');r.b("\n"+n);r.b('        <button class="btn" type="button" data-routeid="');r.b(r.v(r.f("id",e,t,0)));r.b('">添加到行程</button>');r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("</div> ");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["route"]}(t.exports,t,e);e.____MODULES["85cbf6cc8cabf130fa1a4bf936b70fac"]=t.exports})(this);(function(e){var t={id:"515af4a210b8bd4d307a396569a1b9d0",filename:"mark.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["mark"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="b_mark_popup m_mark" style="color:red;">');r.b("\n"+n);r.b('    <a href="javascript:;" class="mkcont">');r.b("\n"+n);r.b('        <span class="bm_tri"></span>');r.b("\n"+n);r.b('        <span class="bm_title"><em class="ind">');r.b(r.t(r.f("indexStr",e,t,0)));r.b('</em><em class="all">');r.b(r.v(r.f("name",e,t,0)));r.b('</em><em class="shut">');r.b(r.v(r.f("s_name",e,t,0)));r.b("</em></span>");r.b("\n"+n);r.b("    </a>");r.b("\n"+n);r.b("</div>");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["mark"]}(t.exports,t,e);e.____MODULES["515af4a210b8bd4d307a396569a1b9d0"]=t.exports})(this);(function(e){var t={id:"3632b9c0095db72c3b028cee74b397eb",filename:"point.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["point"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="m_poi_point"><a href="javascript:;">');r.b(r.v(r.f("indexWord",e,t,0)));r.b("</a></div>");r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["point"]}(t.exports,t,e);e.____MODULES["3632b9c0095db72c3b028cee74b397eb"]=t.exports})(this);(function(e){var t={id:"22935298acf6d3acbc64646c80cc5dfe",filename:"mark_ico.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["mark_ico"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="b_mark_popup m_mark">');r.b("\n"+n);r.b('	<div class="mark_ct js_mark_ct">');r.b("\n"+n);r.b('		<div class="mark_ico"></div>');r.b("\n"+n);r.b('		<div class="confirm_dlg">');r.b("\n"+n);r.b('			<div class="confirm_inner">');r.b("\n"+n);r.b('				<p class="cf_content">');r.b("\n"+n);r.b('					<span class="cf_msg">标记位置</span>');r.b("\n"+n);r.b("				</p>");r.b("\n"+n);r.b('				<div class="buttons">');r.b("\n"+n);r.b('					<a class="cancel js_close" href="#">取消</a>');r.b("\n"+n);r.b('					<a href="#" class="confirm js_ok">确定位置</a>');r.b("\n"+n);r.b("				</div>");r.b("\n"+n);r.b("			</div>");r.b("\n"+n);r.b("		</div>");r.b("\n"+n);r.b("	</div>");r.b("\n"+n);r.b("</div>");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["mark_ico"]}(t.exports,t,e);e.____MODULES["22935298acf6d3acbc64646c80cc5dfe"]=t.exports})(this);(function(e){var t={id:"7ea48124f3242f657c6c82dbe706450c",filename:"mark_confirm.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["mark_confirm"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="b_mark_popup m_mark">');r.b("\n"+n);r.b('	<div class="mark_ct js_mark_ct">');r.b("\n"+n);r.b('		<div class="confirm_dlg">');r.b("\n"+n);r.b('			<div class="confirm_inner">');r.b("\n"+n);r.b('				<p class="cf_content">');r.b("\n"+n);r.b('					<span class="cf_msg">修改位置</span>');r.b("\n"+n);r.b("				</p>");r.b("\n"+n);r.b('				<div class="buttons">');r.b("\n"+n);r.b('					<a href="#" class="confirm js_remove">清除位置</a>');r.b("\n"+n);r.b('					<a href="#" class="confirm js_ok">确定位置</a>');r.b("\n"+n);r.b("				</div>");r.b("\n"+n);r.b('				<a href="#" class="close_btn js_close"></a>');r.b("\n"+n);r.b("			</div>");r.b("\n"+n);r.b("		</div>");r.b("\n"+n);r.b("	</div>");r.b("\n"+n);r.b("</div>");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["mark_confirm"]}(t.exports,t,e);e.____MODULES["7ea48124f3242f657c6c82dbe706450c"]=t.exports})(this);(function(e){var t={id:"dacd39f425f4c7469335c26c545bc050",filename:"dest_box.mod.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){e.____MODULES["302f8bb902b3c3e1b4660c83d164820a"];e.____MODULES["85cbf6cc8cabf130fa1a4bf936b70fac"];e.____MODULES["515af4a210b8bd4d307a396569a1b9d0"];e.____MODULES["3632b9c0095db72c3b028cee74b397eb"];e.____MODULES["22935298acf6d3acbc64646c80cc5dfe"];e.____MODULES["7ea48124f3242f657c6c82dbe706450c"];var i=window.QTMPL;n.exports={poi_item:i.poi_item,route:i.route,mark:i.mark,point:i.point,mark_ico:i.mark_ico,mark_confirm:i.mark_confirm}}(t.exports,t,e);e.____MODULES["dacd39f425f4c7469335c26c545bc050"]=t.exports})(this);(function(e){var t={id:"48a6bc89d864a7b0fd198921504df48e",filename:"confirm.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s;var o=i("body");var u={top:"50%",left:"50%","margin-top":"-42px","margin-left":"-86px"};var a=0;var f=function(e,t,n,r){var f="confirm_"+a++;if(s){s.remove()}var l=i('<div class="del_confirm_dlg" style="display:none;"><div class="del_confirm_inner">        <p class="cf_content"><em class="cf_icon"></em><span class="cf_msg">'+e+'</span></p>        <div class="buttons"><a href="javascript:;" class="cancel">取消</a><a href="javascript:;" class="confirm">确定</a></div>        </div></div>');if(i.type(n)==="object"){r=n;n=null}r=r||u;l.css(r);var c=function(){o.unbind("mousedown."+f);n&&n(l);l.remove();t=null;if(s===l){s=null}};l.bind("mousedown",function(e){e.stopPropagation()});l.find(".confirm").click(function(){t();l.remove();if(s===l){s=null}});l.find(".cancel").click(c);s=l;o.append(l);o.bind("mousedown."+f,function(){c()});l.show();return l};n.exports={confirm:f}}(t.exports,t,e);e.____MODULES["48a6bc89d864a7b0fd198921504df48e"]=t.exports})(this);(function(e){var t={id:"ace694a9422bedcb7c6cf17fc29702df",filename:"RouteBox.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var u=e.____MODULES["dacd39f425f4c7469335c26c545bc050"];var a=e.____MODULES["48a6bc89d864a7b0fd198921504df48e"];var f=u.route;var l='<div class="tip_box hide"><span class="tip">更多线路<i class="icon"></i></span></div>';var c=i.Browser.isIE6||i.Browser.isIE7;var h=function(e){var t=this;t._box=s("#route_box");t._observer=e.observer;t._$win=s(window);t._init()};h.prototype={constructor:h,_init:function(){var e=this,t=e._box;e._route_wrap_dom=s('<div class="route_wrap_dom"></div>').appendTo(t);e._tip_dom=s(l).appendTo(t);e.listen()},listen:function(){var e=this,t=e._box;var n=function(){var t="hide";return function(n){if(e._route_doms&&e._route_doms.length>1){if(t==="hide"){t="show";var r=e._route_wrap_dom.data("max-height");e._route_wrap_dom.animate({height:r},500);e._tip_dom.html('<span class="tip">收起<i class="icon up"></i></span>');o.planBc("line_more")}else{t="hide";var i=e._route_wrap_dom.data("min-height");e._route_wrap_dom.animate({height:i},500);e._tip_dom.html('<span class="tip">更多线路<i class="icon"></i></span>');o.planBc("line_cut")}}}}();e._tip_dom.click(n);t.delegate(".route_button .btn","click",function(t){var n=s(this);var r=n.data("routeid");var i=n.closest(".sight_route").find("div.sight_route_name").text();var u=this.getBoundingClientRect();var f={top:u.top-105,left:u.left-38};a.confirm("将在攻略中，插入"+i,function(){e._observer.trigger("route_add_to_day",r);o.planBc("line_add")},function(e){e.fadeOut(800)},f).hide().fadeIn(800)}).delegate(".poi_name","click",function(t){t.preventDefault();var n=this.getAttribute("data-id");e._observer.trigger("show_poi_detail",n);o.planBc("line_poi")}).delegate(".r_day_add","click",function(t){t.preventDefault();var n=s(this);var r=n.data("order")*1;var i=n.data("routeid");var u=this.getBoundingClientRect();var f={top:u.top-105,left:u.left-80};a.confirm("将在第"+(getModelBook().getSelectDay().order()+1)+"天末尾处，插入此行程",function(){e._observer.trigger("route_day_add_to_day",i,r);o.planBc("line_one_day_add")},function(e){e.fadeOut(800)},f).hide().fadeIn(800)});if(c){t.delegate(".route_button .btn","mouseenter",function(){s(this).addClass("btn_hover")}).delegate(".route_button .btn","mouseleave",function(){s(this).removeClass("btn_hover")})}e._$win.on("resize",function(){var t=e._route_wrap_dom.find("div.sight_route");if(e._box.is(":visible")&&t[0]){e.redrawHeight(t,true)}})},render:function(e){var t;this._tip_dom.html('<span class="tip">更多线路<i class="icon"></i></span>');if(e&&(t=e.length)){var n=this.wrapHtml(this.parse(e));this._route_doms=n;this._route_wrap_dom.html(n);this.show();this.redrawHeight(n)}else{this.clear();this.hide()}},redrawHeight:function(e,t){var n=e.length;var r=0;e.each(function(e,t){r+=s(t).outerHeight()+10});this._route_wrap_dom.data("max-height",r);if(n>1){var i=e.eq(0).outerHeight();e.filter(":gt(0)").hide();this._route_wrap_dom.data("min-height",i).height(i);e.show();this._tip_dom.show();if(t&&this._tip_dom.text().match(/收起/)){this._route_wrap_dom.height(r)}}},wrapHtml:function(e){var t=s(e).filter(".sight_route");return t},parse:function(e){var t=this;var n=e.map(function(e){return f.render(t._parseRouteItem(e))}).join("");return n},_parseRouteItem:function(e,t){var n=this;var r=e.title,i=o.cutString(e.intro,200,"..."),s=e.items,u=e.id,a=s.map(n._parsePois),f=e.route_url;return{id:u,name:r,desc:i,routes:a,route_url:f}},_parsePois:function(e,t){var n=e.poiDetails;var r=n.pop();var i="";if(r){i='<li class="poi"><span class="poi_name last" data-id="'+r.id+'">'+r.name+"</span></li>"}var s=n.map(function(e,t){return'<li class="poi"><span class="poi_name" data-id="'+e.id+'" >'+e.name+"</span><i>&gt;</i></li>"}).join("");var o=s+i;return{day_order:t,index:t+1,day_route:o}},clear:function(){this._route_wrap_dom.removeData();if(this._route_doms){this._route_doms.remove();this._route_doms=null}},show:function(){this._box.show()},hide:function(){this._box.hide()},resetRouteHeight:function(){var e=this;var t=e._route_wrap_dom.find("div.sight_route");if(e._box.is(":visible")&&t[0]){e.redrawHeight(t,true)}}};n.exports=h}(t.exports,t,e);e.____MODULES["ace694a9422bedcb7c6cf17fc29702df"]=t.exports})(this);(function(e){var t={id:"56483375e8bf013e95419f32c44a39a1",filename:"def_img_config.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r="//source.qunarzz.com/site/images/travel/new_plan/";var i=r+"big_ele_sight.jpg",s=r+"big_ele_flight.jpg",o=r+"big_ele_shop.jpg",u=r+"big_ele_food.jpg",a=r+"big_ele_hotel.jpg",f=r+"big_ele_traffic.jpg",l=r+"big_ele_note.jpg",c=r+"big_ele_event.jpg",h=r+"big_ele_location.jpg",p=r+"big_ele_yule.jpg",d=r+"big_ele_ship.jpg",v=r+"big_ele_car.jpg",m="//s.qunarzz.com/travel/plan/big_ele_fun_v2.jpg",g=r+"big_ele_train.jpg";var y={4:i,16:i,5:u,6:a,15:a,18:u,8:o,20:o,7:m,19:m,13:s,21:function(e){var t=e.style;var n;switch(t){case"火车":n=g;break;case"飞机":n=s;break;case"汽车":n=v;break;case"轮船":n=d;break;default:n=f;break}return n},12:g,14:f,22:v,23:v,2:l,def:h,getImg:function(e,t){var n=this[e];if(n){if(typeof n==="function"){return n(t)}return n}else{return this.def}}};t.exports=y}(t.exports,t,e);e.____MODULES["56483375e8bf013e95419f32c44a39a1"]=t.exports})(this);(function(e){var t={id:"149b8fe92ccc904ad366cf8da083f63d",filename:"config.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["56483375e8bf013e95419f32c44a39a1"];var o=e.____MODULES["dacd39f425f4c7469335c26c545bc050"];var u=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var a=o.poi_item;var f;var l={tag:function(e){if(!e){return""}if(typeof e==="string"){e=e.split(/\s+/)}if(e&&e.length){return'<dd class="poi_info">标签:&nbsp;'+e.join("&nbsp;")+"</dd>"}return""},addr:function(e){if(!e){return""}return'<dd class="poi_info">地址:&nbsp;'+e+"</dd>"},intro:function(e){if(!e){return""}e=u.splitStr(e,100,"...");return'<dd class="poi_info">简介:&nbsp;'+e+"</dd>"},memo:function(e){if(!e){return""}return'<dd class="poi_info">备注:&nbsp;'+e+"</dd>"},priceDesc:function(e){var t=e*1;var n=i.type(e);if(t===t){if(!t){return""}return'<dd class="poi_info price">价格:&nbsp;<em class="rmb">￥</em><em class="num">'+e+"</em>起</dd>"}else if(n==="string"){return'<dd class="poin_info price">价格:&nbsp;'+e+"</dd>"}else{return""}}};var c={1:"经济型",2:"舒适型",3:"高档型",4:"豪华型"};var h={1:"一星级",2:"二星级",3:"三星级",4:"四星级",5:"五星级"};var p=[{key:"tag",fn:l.tag}];var d=[{key:"star&dangci",fn:function(e){var t=e[0],n=e[1],r;if(r=h[t]||c[n]){return'<dd class="poi_info">'+r+"</dd>"}else{return""}}},{key:"priceDesc",fn:l.priceDesc},{key:"addr",fn:l.addr}];var v=[{key:"tag",fn:l.tag},{key:"priceDesc",fn:function(e){return l.priceDesc(e).replace("起","")}}];var m=[{key:"tag",fn:l.tag}];var g=[{key:"addr",fn:l.addr}];var y=function(e,t){var n=s[e];if(n){if(typeof n==="function"){return n(t)}else{return n}}else{return s.def}};var b={dest_content_url:Hogan.compile("/place/api/poi_search/{{dest_id}}/pois"),front_to_server_type:{4:4,6:2,5:5,7:6,8:3,21:21},server_to_front_type:{4:4,2:6,5:5,6:7,3:8,21:21},_getBaseInfo:function(e){var t=e.image||y(e.type,e);var n={image:t,main_title:e.name,subtitle:e.enName,city:e.cityName,type:e.type,is_collect:e.is_collect,haslatlng:e.lng||e.blng||e.glng,distance:e.distance?e.distance>2e3?Math.round(e.distance/10)/100+"公里":e.distance+"米":null};if(n.distance){var r=n.haslatlng;if(r){n.view_pos=true}delete n.haslatlng}return n},_getInfoHtml:function(e,t){var n=t.map(function(t){var n=t.key,r=t.fn,i;i=n.split("&");if(i.length>1){var s=i.map(function(t){return e[t]});return r(s)}return r(e[n])}).join("");return n},parseToHtml:function(e){var t=this._getBaseInfo(e);var n=this._getInfoHtml(e,p);var r=[],i;e.commentCount&&r.push({name:"评论",cls:"ugc_comment",val:e.commentCount});e.imageCount&&r.push({name:"照片",cls:"ugc_photo",val:e.imageCount});var s=(i=r.length)>0?'<dd class="poi_info">'+r.map(function(t,n){var r="";if(i-1==n){r="last"}var s="/place/poi/"+e.id;return'<a href="'+s+'" target="_blank" class="ugc_txt '+t.cls+" "+r+'" >'+t.name+(t.val?"("+t.val+")":"")+"</a>"}).join("")+"</dd>":"";var o=n+s;t.poi_info=o;return a.render(t)},parseHotelHtml:function(e){var t=this._getBaseInfo(e);t.poi_info=this._getInfoHtml(e,d);return a.render(t)},parseTrafficHtml:function(e){var t=this._getBaseInfo(e);t.poi_info=this._getInfoHtml(e,g);return a.render(t)},parseFoodHtml:function(e){var t=this._getBaseInfo(e);t.poi_info=this._getInfoHtml(e,g);return a.render(t)},parseShopHtml:function(e){var t=this._getBaseInfo(e);t.poi_info=this._getInfoHtml(e,g);return a.render(t)},parseComHtml:function(e){var t=this._getBaseInfo(e);t.poi_info=this._getInfoHtml(e,[{key:"addr",fn:l.addr},{key:"intro",fn:l.intro}]);return a.render(t)},parseEventHtml:function(e){var t=this._getBaseInfo(e);t.poi_info=this._getInfoHtml(e,[{key:"memo",fn:l.memo}]);return a.render(t)},parseP2PHtml:function(e){var t={main_title:e.name,city:e.beginCity,type:e.typeId,image:e.image||y(e.type,e),is_collect:e.is_collect};t.poi_info=this._getInfoHtml(e,[{key:"memo",fn:l.memo}]);return a.render(t)}};n.exports=b}(t.exports,t,e);e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"]=t.exports})(this);(function(e){var t={id:"7b71296703db79fa05edd07faae9908a",filename:"PoiList.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function f(e){var t=e.find("img");var n={width:168,height:126};t.each(function(e,t){u.imgLoad(t,function(){u.fixImg(t,n)})})}var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"];var u=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var a=i.Browser.isIE6||i.Browser.isIE7;var l=function(e){var t=this;t._box=e.box;t._observer=e.observer;t._from=e.from||"poi_list";t._init()};l.prototype={constructor:l,_init:function(){this._box.html('<ul class="poi_list"></ul><div class="tip_box"><span class="tip">正在载入...</span></div>');this._list_dom=this._box.find("ul");this._tip=this._box.find(".tip_box");this._tip_text=this._tip.find(".tip");this.listen()},listen:function(){var e=this},wrap_dom:function(e,t,n){var r=this;e.delegate("button.btn","click",function(n){var i=s(this);i.attr("disabled","disabled");r._observer.trigger("poi_add_to_book",t,r._from,e);setTimeout(function(){i.removeAttr("disabled")},250);if(r._from==="collect"){u.planBc("like_add_poi")}else{u.planBc("add_poi")}});e.delegate(".name_wrap , .poi_img , .ugc_comment , .ugc_photo","click",function(e){e.preventDefault();if(r._from==="poi_list"){r._observer.trigger("show_poi_detail",t.id)}else if(r._from==="collect"){var n=t.locationId;if(n){if(s.type(n)==="string"){n=n.replace(/\w_/,"")}r._observer.trigger("show_poi_detail",n)}}if(this.className.match(/name_wrap/)){u.planBc("list_click_title")}else if(this.className.match(/poi_img/)){u.planBc("list_click_pic")}else if(this.className.match(/ugc_comment/)){u.planBc("list_click_comment")}else if(this.className.match(/ugc_photo/)){u.planBc("list_click_photo")}});e.delegate(".js_view_position","click",function(e){e.preventDefault();r._observer.fire("show_poi_position",t);u.planBc("place")});if(t.is_collect){if(a){e.hover(function(){e.addClass("collet_poi_item_hover")},function(){e.removeClass("collet_poi_item_hover")})}e.delegate(".close_btn","click",function(n){n.preventDefault();r._observer.fire("delete_collect_item",t,e);u.planBc("like_delete_poi")})}if(a){e.find("button.btn").hover(function(){s(this).addClass("btn_hover")},function(){s(this).removeClass("btn_hover")})}},clear:function(){var e=this;e._list_dom.empty();e._tip_text.parent().show()},render:function(e,t,n){var r=this;var i=e.map(s.proxy(r.parseToHtml,r)).join("");var o=s(i).filter("li");o.each(function(t,n){r.wrap_dom(s(n),e[t],t)});f(o);if(t){r._list_dom.append(o)}else{r._list_dom.html(o)}if(n){r._tip_text.parent().hide()}else{r._tip_text.parent().show()}},parseToHtml:function(e,t,n){var r=this,s;var u;var a;if(e.summary){var f=JSON.parse(e.summary);e=i.mix({},f,e,true);var l=n[t];l.is_collect=true;if(typeof f.is_abroad!=="undefined"){f.abroad=f.is_abroad}if(f.abroad){l.lng=f.lng||f.glng;l.lat=f.lat||f.glat}else{l.lng=f.lng||f.blng;l.lat=f.lat||f.blat}}if(r._from==="collect"){s=e.typeId;e.is_collect=true}else{s=o.server_to_front_type[e.type]}e.type=s;var c=false;switch(s){case 4:case 16:a=o.parseToHtml(e);break;case 6:case 15:a=o.parseHotelHtml(e);break;case 5:case 18:a=o.parseFoodHtml(e);break;case 8:case 20:a=o.parseShopHtml(e);break;case 21:a=o.parseTrafficHtml(e);break;case 12:case 13:case 14:e.name=e.beginCity+"-"+e.endCity;a=o.parseP2PHtml(e);break;default:c=true;a=o.parseComHtml(e);break}if(c&&e.is_collect){switch(s){case 2:a=o.parseEventHtml(e);break;default:break}}return a},parseOldData:function(e){var t={cityId:e.city_id,cityName:e.city,addr:e.addr,blng:e.blng,blat:e.blat,image:e.image,id:e.g_id.replace(/\w_/,""),name:e.name,lat:e.lat,lng:e.lng,detail:e.detail,is_abroad:e.is_abroad,tel:e.tel,tag:e.tag,dangci:e.dangci,style:e.style,stars:e.stars,type:e.type};return t}};n.exports=l}(t.exports,t,e);e.____MODULES["7b71296703db79fa05edd07faae9908a"]=t.exports})(this);(function(e){var t={id:"6f8e7a3740302dadaf0a3a6688f6d5d6",filename:"QueryBox.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];e.____MODULES["f359268032ef95a76c48519ac6bb62c6"];var o=function(e){var t=this;t._box=i("#source_filter_box");t._observer=e.observer;t._init()};o.prototype={constructor:o,_init:function(){var e=this,t=e._box;e._$body=i("body");e._main_type_doms=t.find("li[data-type]");e._sub_type_dom=t.find("div.sub_type_box");e._more_type_dom=t.find("li.last");e._search_box=t.find("div.source_search_box");e._search_inp=t.find("input");e._search_ph=t.find(".search_ph");e._search_del=t.find(".search_del");e._initSearchBox();e.listen()},listen:function(){var e=this;e._main_type_doms.on("mouseenter",function(e){if(this.className.match(/selected/)){return}this.className="source_type hover"}).on("mouseleave",function(e){if(this.className.match(/selected/)){return}this.className="source_type"}).click(function(){e._main_type_doms.removeClass("selected");var t=i(this).removeClass("hover").addClass("selected").data("type");e._more_type_dom.find(".cnt").text("更多");e._observer.trigger("show_dest_type_content",t);var n=this.getAttribute("data-bc");if(n){s.planBc(n)}});e._more_type_dom.click(function(t){e._sub_type_dom.toggle()});e._sub_type_dom.mousedown(function(e){e.stopPropagation()}).delegate(".sub_type","click",function(){e._main_type_doms.removeClass("selected");e._more_type_dom.find(".cnt").text(this.innerText||this.textContent);e._sub_type_dom.hide();var t=this.getAttribute("data-type");e._observer.fire("show_dest_type_content",t);var n=this.getAttribute("data-bc");if(n){s.planBc(n)}});e._$body.on("mousedown.querybox",function(t){e._sub_type_dom.hide()});e._observer.on("show_dest_content",function(){e._main_type_doms.removeClass("selected");e._main_type_doms.eq(0).removeClass("hover").addClass("selected");e._more_type_dom.find(".cnt").text("更多")})},_initSearchBox:function(){function f(e){var t=e.distType,n=e.cityName,r=e.cityId;if(t==7){return s+"?mcityId="+r+"&q=*&callback=?"}else{return s+"?distId="+(r||"")+"&city="+encodeURIComponent(n||"")+"&q=*&callback=?"}}function h(t){e._main_type_doms.removeClass("selected");if(typeof t==="string"){var n=t;e._observer.trigger("search_query",n)}else if(typeof t==="object"){var n=t.name,r=t.id;if(r){e._observer.trigger("show_poi_detail",r)}else{e._observer.trigger("search_query",n)}}}var e=this,t=e._search_inp,n=e._search_ph,r=e._search_del;var s="/suggest/custom";var o=[];var u=null;var a=e._search_box.width();t.blur(function(t){e._search_box.removeClass("source_search_box_focus");var s=i.trim(this.value);if(s){n.hide();r.show()}else{n.show();r.hide()}}).focus(function(t){e._search_box.addClass("source_search_box_focus");n.hide();r.hide()}).keyup(function(e){if(e.which!==13){return}var t=i.trim(this.value);if(t){if(u&&t===u.query){}else{h(t)}}}).keydown(function(e){e.stopPropagation()});n.click(function(){t.focus()});r.click(function(){t.val("");t.focus()});t.qsuggest({width:"100%",container:e._search_box.find(".sug_con"),ajax:{url:s+"?q=*&callback=?",dataType:"jsonp",cache:false},reader:function(e){o=[];u=null;return e&&e.data&&e.data.map(function(e){o.push(e);return e.name})},delay:10,on:{"q-suggest-user-action":function(e,n,r,i,s){var a=t.val();if(i===13){if(a===r){var f=s.index();u=o[f];h(u)}else{h(a)}return}if(i===null){var f=s.index();u=o[f];h(u)}}}});var l=t.data("q-suggest");l.setValue=function(e){l.constructor.prototype.setValue.call(this,e)};var c=l.args.ajax;e._observer.on("show_dest_content",function(e){c.url=f(e);l._cache={};l._last=[]})},reset:function(){me._more_type_dom.find(".cnt").text("更多");me._sub_type_dom.hide()}};n.exports=o}(t.exports,t,e);e.____MODULES["6f8e7a3740302dadaf0a3a6688f6d5d6"]=t.exports})(this);(function(e){var t={id:"bec76438512a77fc271867b9d43fa95b",filename:"DestBox.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=e.____MODULES["88d5c499e26b6f8fc86d873910ae3aea"];var o=e.____MODULES["ace694a9422bedcb7c6cf17fc29702df"];var u=e.____MODULES["7b71296703db79fa05edd07faae9908a"];var a=e.____MODULES["6f8e7a3740302dadaf0a3a6688f6d5d6"];var f=e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"];var l=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var c=i(window);var h=10,p=4;var d={offset:0,limit:h,dest_id:null,max:null,type:4,dist_type:6};var v={4:"热门景点",6:"酒店",5:"美食",8:"购物",21:"交通"};var m={init:function(e){var t=this;t._box=i("#source_detail_box");t._content_box=i("#source_detail_inner");t._wrapBox=t._content_box.parent();t._no_data_dom=i("#source_query_ph");t.route_box=new o({observer:e});t.poilist_box=new u({box:i("#poi_list_box"),observer:e});t.query_box=new a({observer:e});t._cache_param=i.extend({},d);t._observer=e;t._initScroll();t.listen()},clearCacheParam:function(){this._cache_param=i.extend({},d)},resetView:function(){var e=this;e.clearCacheParam();e.poilist_box.clear();e.route_box.clear()},resetScroll:function(){},getScrollVal:function(){return this._content_box.scrollTop()},setScroll:function(){this._scroll_top=this._content_box.scrollTop()},scrolling:function(e){var t=this;var n=i(e.target);var r=this.getScrollVal();if(r<20){t._wrapBox.removeClass("top_border")}else{t._wrapBox.addClass("top_border")}if(r+n.innerHeight()>=n[0].scrollHeight){if(t._cache_param.max){return}else{if(t._cache_param.search){t.search();return}t.loadDestContent()}}},_initScroll:function(){var e=this;e._content_box.bind("scroll",i.proxy(e.scrolling,e))},listen:function(){var e=this;e._observer.on("show_dest_content",function(t){var n=t.cityId;var r=t.distType;e.resetView();e._cache_param.dest_id=n;e._cache_param.dest_name=t.cityName;e._cache_param.dist_type=r;e.loadDestContent({dest_id:n,dist_type:r,need_routes:true})});e._observer.on("show_dest_type_content",function(t){var n=e._cache_param.dest_id;var r=e._cache_param.dest_name;var i=e._cache_param.dist_type;e.resetView();e._cache_param.dest_id=n;e._cache_param.dest_name=r;e._cache_param.dist_type=i;e._cache_param.type=t;var s={dest_id:n};if(t==4){s.need_routes=true}e.loadDestContent(s)});e._observer.on("search_query",e.search,e);e._observer.on("no_dest_for_show",e.showNoData,e);e._no_data_dom.delegate(".js_other_add","click",function(){var t=this.getAttribute("type");var n=this.getAttribute("query");var r=i.extend({},e._cache_param);r.q=QNR.HTMLDecode(r.q);QNR.PubSub.fire("toadd_custom_poi",t,i.extend({q:n},r))})},loadDestContent:function(e){var t=this,n=!e,e=e||t._cache_param,r=e.dest_id,i=t._cache_param,o=f.front_to_server_type[e.type||i.type],u=f.dest_content_url.render({dest_id:r});e.dist_type&&(i.dist_type=e.dist_type);if(t.loading&&n){return}if(t.loader){t.loader.abort();t.loading=false}var a={poi_types:o,_id:r,dist_type:i.dist_type,need_routes:e.need_routes,offset:e.offset||i.offset,limit:e.limit||i.limit};t.loading=true;t.loader=s.get(u,a,function(e){t.loading=false;var n=e.data;t.renderDestContent(n);t.loader=null;i.offset=i.offset+i.limit},function(){t.toggleNoData(i.offset===0);t.loading=false;t.loader=null})},showNoData:function(){this.resetView();this.toggleNoData(true)},search:function(e){var t=this;var n=t._cache_param.dest_id;var r=t._cache_param.dest_name,i=t._cache_param.dist_type;if(t.loading&&e===void 0){return}if(t.loader){t.loader.abort();t.loading=false}if(e){t.clearCacheParam();t._cache_param.dest_id=n;t._cache_param.dest_name=r;t._cache_param.search=true;t._cache_param.q=l.HTMLEncode(e);t._cache_param.dist_type=i}var o=t._cache_param.offset,u=t._cache_param.limit,e=t._cache_param.q,i=t._cache_param.dist_type;t.loading=true;var a="/place/api/poi_search/"+n+"/pois";t.loader=s.ajax({url:a,data:{order:1,poi_name:e,dist_type:i||6,offset:o,limit:u,_t:(new Date).getTime()},success:function(e){var n=e.data;var r=n.pois;if(!r.length){t.toggleNoData(true)}else{t.renderDestContent(n)}t._cache_param.offset+=u;t.loading=false;t.loader=null},error:function(){t.loading=false;t.loader=null;t.toggleNoData(true)}})},toggleNoData:function(e){var t=this;if(e){var n=this._cache_param;var r;if(n.search){r="没有查询到关于"+n.q+"的结果";r+='<span class="cr_place_span">创建地点:<a href="javascript:;" class="js_other_add" type="place" query="'+n.q+'">'+n.q+"</a></span>"}else{r=(n.dest_name||"这里")+"暂时还没有"+v[n.type]+"的数据"}this._no_data_dom.find("p").html(r);this._no_data_dom.show()}else{this._no_data_dom.hide()}},renderDestContent:function(e){var t=this;var n=e.routes||[];var r=e.route_urls||{};QNR.forEach(n,function(e){e.route_url=r[e.id]});var i=e.pois;var s=true;if(t._cache_param.offset>0){s=false}if(i.length<t._cache_param.limit){t._cache_param.max=true}if(!t._cache_param.offset){t.route_box.render(n)}t.poilist_box.render(i,!s,t._cache_param.max);c.resize();if(s){t.toggleNoData(!(n.length||i.length))}},show:function(){this._box.show()},hide:function(){this._box.hide()}};n.exports=m}(t.exports,t,e);e.____MODULES["bec76438512a77fc271867b9d43fa95b"]=t.exports})(this);(function(e){var t={id:"d338914a134bc4d4b5632a56b51e8d08",filename:"poi_info_box.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["poi_info_box"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<div class="box poi_summary_box">');r.b("\n"+n);if(r.s(r.f("has_img",e,t,1),e,t,0,50,463,"{{ }}")){r.rs(e,t,function(e,t,r){r.b('    <div class="poi_img_box">');r.b("\n"+n);r.b('        <ul class="poi_img_list" style="width:');r.b(r.v(r.f("total_width",e,t,0)));r.b('">');r.b("\n"+n);if(r.s(r.f("images",e,t,1),e,t,0,168,309,"{{ }}")){r.rs(e,t,function(e,t,r){r.b('            <li class="img_item" style="width:');r.b(r.v(r.f("width",e,t,0)));r.b('">');r.b("\n"+n);r.b('                <img src="');r.b(r.v(r.f("src",e,t,0)));r.b('" class="poi_img">');r.b("\n"+n);r.b("            </li>");r.b("\n")});e.pop()}r.b("        </ul>    ");r.b("\n"+n);r.b('        <a class="btn prev" href="javascript:;"></a>');r.b("\n"+n);r.b('        <a class="btn next" href="javascript:;"></a>');r.b("\n"+n);r.b("    </div>   ");r.b("\n")});e.pop()}r.b('    <div class="poi_summary ');if(r.s(r.f("has_img",e,t,1),e,t,0,516,529,"{{ }}")){r.rs(e,t,function(e,t,n){n.b("no_top_border")});e.pop()}r.b('">');r.b("\n"+n);r.b('        <strong class="label">简介</strong>');r.b("\n"+n);r.b('        <p class="summary">');r.b("\n"+n);r.b("            ");r.b(r.v(r.f("intro",e,t,0)));r.b("\n"+n);r.b("        </p>");r.b("\n"+n);r.b("    </div>    ");r.b("\n"+n);r.b("</div>");r.b("\n"+n);r.b('<div class="box poi_info_box">');r.b("\n"+n);r.b('        <div class="poi_info_inner">');r.b("\n"+n);if(r.s(r.f("infos",e,t,1),e,t,0,761,970,"{{ }}")){r.rs(e,t,function(e,t,r){r.b('                <dl class="row ');if(r.s(r.f("long_label",e,t,1),e,t,0,808,813,"{{ }}")){r.rs(e,t,function(e,t,n){n.b("row_f")});e.pop()}r.b('">');r.b("\n"+n);r.b('                    <dt class="label">');r.b(r.v(r.f("label",e,t,0)));r.b("</dt>");r.b("\n"+n);r.b('                    <dd class="txt">');r.b(r.t(r.f("text",e,t,0)));r.b("</dd>");r.b("\n"+n);r.b("                </dl>");r.b("\n")});e.pop()}r.b("        </div>");r.b("\n"+n);r.b("</div>");r.b("\n"+n);if(r.s(r.f("tips",e,t,1),e,t,0,1015,1148,"{{ }}")){r.rs(e,t,function(e,t,r){r.b('<div class="box poi_tip_box">');r.b("\n"+n);r.b('    <div class="title_label">小贴士</div>');r.b("\n"+n);r.b('    <div class="content">');r.b("\n"+n);r.b("        ");r.b(r.t(r.f("tips",e,t,0)));r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("</div>");r.b("\n")});e.pop()}return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["poi_info_box"]}(t.exports,t,e);e.____MODULES["d338914a134bc4d4b5632a56b51e8d08"]=t.exports})(this);(function(e){var t={id:"04be2bbdb921ffba7930a32c475160fc",filename:"poi_comment.mustache",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){if(typeof window.QTMPL==="undefined")window.QTMPL={};window.QTMPL["poi_comment"]=new window.Hogan.Template(function(e,t,n){var r=this;r.b(n=n||"");r.b('<li class="e_comment_item clrfix" id="cmt_item_');r.b(r.v(r.f("comment_id",e,t,0)));r.b('" >');r.b("\n"+n);r.b('    <div class="e_comment_main" >');r.b("\n"+n);r.b('        <div class="e_comment_main_inner" >');r.b("\n"+n);r.b('            <div class="e_comment_title" data-beacon="comment_title" ><a  href="');r.b(r.v(r.f("cmt_url",e,t,0)));r.b('" target="_blank">');r.b(r.v(r.f("title",e,t,0)));r.b("</a></div>");r.b("\n"+n);r.b('            <div class="e_comment_star_box" >');r.b("\n"+n);r.b('                <span class="total_star"><span class="cur_star star_');r.b(r.v(r.f("star",e,t,0)));r.b('"></span></span>');r.b("\n"+n);r.b("            </div>");r.b("\n"+n);r.b('            <div class="e_comment_content">');r.b("\n"+n);r.b("                ");r.b(r.v(r.f("content",e,t,0)));r.b("\n"+n);r.b("            </div>");r.b("\n"+n);if(r.s(r.f("has_images",e,t,1),e,t,0,548,1219,"{{ }}")){r.rs(e,t,function(e,t,r){r.b('            <div class="e_comment_imgs_box">');r.b("\n"+n);r.b('                <div class="e_comment_imgs clrfix">');r.b("\n"+n);r.b('                    <ul class="base_fl" >');r.b("\n"+n);if(r.s(r.f("images",e,t,1),e,t,0,723,989,"{{ }}")){r.rs(e,t,function(e,t,r){r.b("                        <li>");r.b("\n"+n);r.b('                        <a data-beacon="comment_pic"  href="');r.b(r.v(r.f("cmt_url",e,t,0)));r.b('" target="_blank">');r.b("\n"+n);r.b('                            <img class="cmt_img" src="');r.b(r.v(r.d(".",e,t,0)));r.b('" >');r.b("\n"+n);r.b("                        </a>");r.b("\n"+n);r.b("                        </li>");r.b("\n")});e.pop()}r.b("                    </ul>");r.b("\n"+n);r.b('                    <span class="img_count">');if(r.s(r.f("img_count",e,t,1),e,t,0,1085,1143,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<a href="');n.b(n.v(n.f("cmt_url",e,t,0)));n.b('" target="_blank">共');n.b(n.v(n.f("img_count",e,t,0)));n.b("张》</a>")});e.pop()}r.b("</span>");r.b("\n"+n);r.b("                </div>");r.b("\n"+n);r.b("            </div>");r.b("\n")});e.pop()}r.b('            <div class="e_comment_add_info">');r.b("\n"+n);r.b("                <ul>");r.b("\n"+n);r.b("                    <li>");r.b(r.v(r.f("date",e,t,0)));r.b(" ");if(r.s(r.f("book_id",e,t,1),e,t,0,1346,1482,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<span class="e_comment_from_book">发表于攻略<a data-beacon="comment_travelbook" href="');n.b(n.v(n.f("book_url",e,t,0)));n.b('" target="_blank">');n.b(n.v(n.f("book_title",e,t,0)));n.b("</a></span>")});e.pop()}r.b("</li>");r.b("\n"+n);r.b('                    <li class="last e_comment_reply_box">');r.b("\n"+n);r.b("                    ");if(r.s(r.f("my",e,t,1),e,t,0,1585,1690,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<div class="e_comment_rm pngfix" data-cid="');n.b(n.v(n.f("comment_id",e,t,0)));n.b('" ><a data-beacon="delete" href="#">删除</a></div>')});e.pop()}r.b("\n"+n);r.b('                    <div class="e_comment_reply pngfix"><a data-beacon="reply" href="');r.b(r.v(r.f("cmt_url",e,t,0)));r.b('" target="_blank">回复</a>');if(r.s(r.f("reply_count",e,t,1),e,t,0,1834,1876,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<span class="num">(');n.b(n.v(n.f("reply_count",e,t,0)));n.b(")</span>")});e.pop()}r.b("</div>");r.b("\n"+n);r.b("                    </li>");r.b("\n"+n);r.b("                </ul>");r.b("\n"+n);r.b("            </div>");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b('        <div class="e_comment_usr">');r.b("\n"+n);r.b('            <div class="e_comment_usr_pic">');r.b("\n"+n);r.b('                <a href="');r.b(r.v(r.f("usr_url",e,t,0)));r.b('" target="_blank">');r.b("\n"+n);r.b('                    <img height="45" width="45" src="');r.b(r.v(r.f("usr_pic",e,t,0)));r.b('" />');r.b("\n"+n);r.b("            </a>");r.b("\n"+n);r.b("        </div>");r.b("\n"+n);r.b('        <div class="e_comment_usr_name">');r.b("\n"+n);if(r.s(r.f("is_youke",e,t,1),e,t,0,2298,2346,"{{ }}")){r.rs(e,t,function(e,t,n){n.b("            <span>");n.b(n.v(n.f("usr_name",e,t,0)));n.b("</a>");n.b("\n")});e.pop()}if(!r.s(r.f("is_youke",e,t,1),e,t,1,0,0,"")){r.b('            <a href="');r.b(r.v(r.f("usr_url",e,t,0)));r.b('" target="_blank">');r.b(r.v(r.f("usr_name",e,t,0)));r.b("</a>");r.b("\n")}r.b("        </div>");r.b("\n"+n);r.b('        <div class="e_comment_usr_total">');if(r.s(r.f("usr_comment_num",e,t,1),e,t,0,2555,2602,"{{ }}")){r.rs(e,t,function(e,t,n){n.b('<span class="num">');n.b(n.v(n.f("usr_comment_num",e,t,0)));n.b("篇点评</span>")});e.pop()}r.b("</div>");r.b("\n"+n);r.b("    </div>");r.b("\n"+n);r.b("</li>");r.b("\n"+n);r.b("\n");return r.fl();});if(typeof t!=="undefined")t.exports=window.QTMPL["poi_comment"]}(t.exports,t,e);e.____MODULES["04be2bbdb921ffba7930a32c475160fc"]=t.exports})(this);(function(e){var t={id:"8570cd8a973e704b33fb1b6e91b8a48e",filename:"poi_box.mod.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){e.____MODULES["d338914a134bc4d4b5632a56b51e8d08"];e.____MODULES["04be2bbdb921ffba7930a32c475160fc"];var i=window.QTMPL;n.exports={poi_info_box:i.poi_info_box,poi_comment:i.poi_comment}}(t.exports,t,e);e.____MODULES["8570cd8a973e704b33fb1b6e91b8a48e"]=t.exports})(this);(function(e){var t={id:"f4d68ced3c24bacfdf57b629c2a72f58",filename:"PoiInfo.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=e.____MODULES["8570cd8a973e704b33fb1b6e91b8a48e"];var o=s.poi_info_box;var u=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var a=e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"];var f=i(window);var l=[{label:"建议游玩",key:"travelTime",long_label:true},{label:"时间",key:"openTime"},{key:"price",lable_fn:function(e){var t="价格";var n=e.type;switch(n){case 4:case 16:t="门票";break;case 6:case 15:t="价格";break;case 5:case 8:case 18:case 20:t="人均";break;default:}return t},fn:function(e,t){var n=t.type;if(n==8||n==20){return""}if((n==4||n===16)&&t.bookingUrl){return""+e+"<a href='"+t.bookingUrl+"?from=travelplan' class='booking_btn' target='_blank'>预订</a>"}if(n==6||n===15){if(!(e*1)){return""}if(t.qunarSeq){var r="//hotel.qunar.com/city/"+t.qunarSeq.replace(/(\w+)(_\d+)/,function(e,t,n){return t+"/dt-"+n.substring(1)})+"?from=travelplan";return"<em class='rmb'>￥</em><em class='num'>"+e+"</em>起<a href='"+r+"' class='booking_btn' target='_blank'>预订</a>"}else{return"<em class='rmb'>￥</em><em class='num'>"+e+"</em>起"}}return e}},{label:"交通",key:"trafficInfo"},{label:"地址",key:"addr"},{label:"电话",key:"tel"},{label:"官网",key:"officialSite",fn:function(e){if(!e){return null}if(!e.match(/^(http|https):\/\//)){e="http://"+e}return'<a href="'+e+'" target="_blank">'+e+"</a>"}}];var c=function(e){var t=this;t._box=e.box;t._observer=e.observer;t._init()};var h=c.prototype;h._init=function(){this.listen()};h._initImgBox=function(e,t){var n=this,r=n._box,i=r.find("div.poi_img_box"),s=r.find("ul"),o=i.find("a.next"),a=i.find("a.prev"),l=e.images.length;var c={width:t,height:i.height()};if(l===1){o.hide();a.hide()}else{o.show();a.show()}setTimeout(function(){i.find("img").each(function(e){u.imgLoad(this,function(){u.fixImg(this,c)})})},0);var h=false,p=0,d,v;a.click(function(){if(v){return}if(!h){s.children().clone().prependTo(s);s.width(c.width*l*2);d=-c.width*l;s.css("marginLeft",d);h=true}if(p+l===0){d=-c.width*l;s.css("marginLeft",d);p=0}v=true;s.animate({marginLeft:d+c.width},250,function(){p-=1;d+=c.width;v=false});u.planBc("up_pic")});o.click(function(){if(v){return}if(!h){s.children().clone().prependTo(s);s.width(c.width*l*2);d=-c.width*l;s.css("marginLeft",d);h=true}if(p===l-1){d=-c.width*(l-1);s.css("marginLeft",d);p=-1}v=true;s.animate({marginLeft:d-c.width},350,function(){p+=1;d-=c.width;v=false});u.planBc("next_pic")});this._resize_fn=function(){c={width:r.width(),height:i.height()};i.find("img").each(function(e){u.imgLoad(this,function(){u.fixImg(this,c)})})};this._resize_fn();f.resize(this._resize_fn)};h.listen=function(){};h._parse=function(e){var t=this._box.width();var n;var r={name:e.name,id:e.id,en_name:e.enName,intro:e.intro||"暂无简介",tips:e.tips||n};var i=l.map(function(t){var n=t.key,r=e[n];if(t.fn){r=t.fn(r,e)}if(!r){return null}var i=t.label;if(t.lable_fn){i=t.lable_fn(e)}return{label:i,text:r,long_label:t.long_label}}).filter(function(e){return e!==null});var s=e.images||[],o=s.map(function(e){return{src:e.middleUrl}}),u=!!o.length;r.infos=i;r.images=o;r.has_img=u;if(r.has_img){r.total_width=t*o.length+"px";r.width=t+"px";var a=new Image;a.src=o[0].src}return r};h.render=function(e){var t=this,n=t._parse(e),r=o.render(n);t.empty();t._box.html(r);if(n.has_img){t._initImgBox(e,n.width.replace("px","")*1)}else{t._box.find("div.poi_img_box").hide()}};h.clear=function(){this.empty()};h.empty=function(){this._box.empty();if(this._resize_fn){f.unbind("resize",this._resize_fn)}};n.exports=c}(t.exports,t,e);e.____MODULES["f4d68ced3c24bacfdf57b629c2a72f58"]=t.exports})(this);(function(e){var t={id:"1b17ded1293e96f46062ae226688c132",filename:"PoiComment.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var s=e.____MODULES["8570cd8a973e704b33fb1b6e91b8a48e"];var o=s.poi_comment;var u=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var a=function(e){var t=this;t._box=e.box;t._observer=e.observer;t._init()};var f=a.prototype;f._init=function(){var e=this;var t=e._box.html('<div class="box poi_comment_box"><div class="comment_label">点评(<span class="num"></span>)</div><div class="comments"><div class="b_comment_box"><ul></ul></div><div class="tip_box"><span class="tip">请稍等</span></div></div></div>');e._title_box=t.find(".comment_label");e._comment_num=t.find(".num");e._comments_box=t.find(".b_comment_box ul");e._tip_text=t.find(".tip");this.listen()};f.listen=function(){};f.parse=function(e,t){var n=e.author;var r=e.createTime;var i=n.userId;var s=i==="0@qunar";var o="//travel.qunar.com/space/"+i;var a=false;var f=u.format(new Date(r));var l=e.imageCount&&e.imageCount>3?e.imageCount:0;var c="//travel.qunar.com/place/comments/"+e.id;if(t){c="//review.qunar.com/h/"+t+"/"+e.id}var h={cmt_url:c,poi_id:e.poiId,date:f,star:e.userRating,comment_id:e.id,title:e.title,content:e.body,has_images:e.images&&e.images.length>0,images:e.images&&e.images.slice(0,3),img_count:l,book_title:e.bookTitle,book_id:e.bookId,book_url:"//travel.qunar.com/travelbook/books/detail/finish/"+e.bookId+"/view",reply_count:e.replyCount,usr_name:u.cutString(n.nickName,12),usr_pic:n.largeHeadImg,usr_comment_num:0,my:a,is_youke:s,usr_url:o};if(s){h.usr_url="javascript:;"}return h};f.render=function(e,t,n,r){var i=this;var s=e.length;var u=e.map(function(e,t,n){var r=i.parse(e,n.hotelSeq);return o.render(r)}).join("");if(n){if(s){i._comments_box.append(u)}}else{if(!t){i._box.hide()}else{i._box.show()}i._comment_num.text(t);i._comments_box.html(u).show()}if(r){i._tip_text.text("没有更多内容")}else{i._tip_text.text("请稍后")}};f.clear=function(){var e=this;e._comments_box.empty().hide();e._tip_text.text("没有评论数据")};n.exports=a}(t.exports,t,e);e.____MODULES["1b17ded1293e96f46062ae226688c132"]=t.exports})(this);(function(e){var t={id:"2a6c3f7ac10afc75549b51ee175552b2",filename:"PoiBox.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function v(e,t,n){var r=c+e;return o.get(r,function(e){var r=e.data;if(r&&r.poi){t(r.poi);return}n&&n()},function(){n&&n()})}function m(e,t,n){e.level=20;return o.get(h,e,function(e){var n=e.hotelSeq;var r=e.data||[];r.hotelSeq=n;t(r,e.totalCount)},n)}var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["88d5c499e26b6f8fc86d873910ae3aea"];var u=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var a=e.____MODULES["f4d68ced3c24bacfdf57b629c2a72f58"];var f=e.____MODULES["1b17ded1293e96f46062ae226688c132"];var l=e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"];var c="/place/poi/api/";var h="/place/api/comment";var p={offset:0,limit:10};var d={init:function(e){var t=this;t.view_event=e;t._poi_data=null;t._box=s("#poi_detail");t._box_name=s(".poi_name_box",t._box);t._poi_detail_wrap=s(".poi_detail_wrap",t._box);t._poi_info_wrap=s("#poi_info_wrap");t._poi_comment_wrap=s("#poi_comment_wrap");t._close_btn=s("button.close_btn",t._box);t._add_btn=s("button.add_btn",t._box);t._poi_detail_wrap_parent=t._poi_detail_wrap.parent();t._cache_params=i.mix({},p);t._poi_info=new a({box:t._poi_info_wrap,observer:e});t._poi_comment=new f({box:t._poi_comment_wrap,observer:e});t.listen()},getScrollVal:function(){return this._poi_detail_wrap.scrollTop()},scrolling:function(e){var t=this;var n=s(e.target);var r=this.getScrollVal();if(r<20){t._poi_detail_wrap.removeClass("top_border")}else{t._poi_detail_wrap.addClass("top_border")}if(r+n.innerHeight()>=n[0].scrollHeight){t.loadCommet(t._poi_id,true)}},_initScrollBar:function(){var e=this;e._scrollbar=true;e._poi_detail_wrap.bind("scroll",s.proxy(e.scrolling,e))},listen:function(){var e=this;e._close_btn.click(s.proxy(e.hide,e));e._add_btn.click(s.proxy(e.addPoi,e));e.view_event.on("show_poi_detail",function(t){if(!e._scrollbar){e._initScrollBar()}e.resetView();e.loadPoiInfo(t);e.loadCommet(t)})},resetView:function(){var e=this;e.clearCacheParam();e._poi_info.clear();e._poi_comment.clear()},clearCacheParam:function(){this._cache_params=i.mix({},p)},loadPoiInfo:function(e){var t=this;v(e,function(n){t.view_event.fire("show_poi_detail_success");n.type=l.server_to_front_type[n.type];t.setData(n,e);t.renderName(n);t._poi_info.render(n);t.show()},function(){t.view_event.fire("show_poi_detail_error");t.hide()})},loadCommet:function(e,t){var n=this,r=n._cache_params;var i=0,s=r.limit;if(t){if(n.loading){return}i=r.offset}if(n._cache_params.max){n.loading=false;return}var o={id:e,offset:i,limit:s,order:1};n.loading=true;m(o,function(e,r){n.loading=false;if(!e.length||e.length<n._cache_params.limit||r<=n._cache_params.limit){n._cache_params.max=true}n._poi_comment.render(e,r,t,n._cache_params.max)},function(){n.loading=false});r.offset=i+s},renderName:function(e){var t=this._box_name;var n=14;var r=e.id?"/place/poi/"+e.id+"?from=travelplan":"javascript:;";if(e.type==6||e.type==15){if(!e.qunarSeq){r="javascript:;"}else{r="//hotel.qunar.com/city/"+e.qunarSeq.replace(/(\w+)(_\d+)/,function(e,t,n){return t+"/dt-"+n.substring(1)})+"?from=travelplan"}}var i="<h3 class='main_title'><a href='"+r+"' title='"+e.name+"' target='_blank' >"+e.name+"</a></h3>";if(e.enName){n=10;i+="<h4 class='subtitle'><a href='"+r+"' title='"+e.enName+"' target='_blank' >"+e.enName+"</a></h4>"}t.html(i).find("h3").css("margin-top",n)},addPoi:function(){var e=this,t=e._poi_data;e.view_event.trigger("poi_add_to_book",t,"poi_detail");u.planBc("poi_detail_add_poi")},setData:function(e,t){this._poi_id=t;this._poi_data=e},hide:function(){this._box.hide();this.view_event.fire("hide_poi_detial");u.planBc("close")},show:function(){this._box.show()}};n.exports=d}(t.exports,t,e);e.____MODULES["2a6c3f7ac10afc75549b51ee175552b2"]=t.exports})(this);(function(e){var t={id:"1b3c2fa103584dcde5d4b4e7832d3b59",filename:"CollectBox.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["88d5c499e26b6f8fc86d873910ae3aea"];var u=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var a=e.____MODULES["72ccee1acde6f77563f5f551b427b29d"];var f=e.____MODULES["7b71296703db79fa05edd07faae9908a"];var l='<div class="collect_wrap"><div id="collect_win" class="collect_win"><div class="poi_list_box collect_content"></div><div class="no_data"><div class="source_query_ph_bg"><p class="txt">你还没有收集想去的地方</p></div></div></div></div>';var c='<div class="source_filter_box clrfix" ><div class="city_select_box"><div class="txt_label"><span class="txt">暂无城市</span><a class="arrow down" href="javascript:;"></a></div><div class="city_list_box"><ul class="city_lists"></ul></div></div><div class="source_type_box clrfix"><ul><li class="source_type selected" data-type="all" data-bc="like_all_poi" ><span class="label"><em class="cnt">全部</em></span><div class="select_arrow"></div></li><li class="dline"></li><li class="source_type " data-type="4" data-bc="like_scenery_tab"><span class="label"><em class="cnt">景点</em></span><div class="select_arrow"></div></li><li class="dline"></li><li class="source_type" data-type="6" data-bc="like_hotel_tab"><span class="label"><em class="cnt">酒店</em></span><div class="select_arrow"></div></li><li class="dline"></li><li class="source_type" data-type="5" data-bc="like_food_tab"><span class="label"><em class="cnt">美食</em></span><div class="select_arrow"></div></li><li class="dline"></li><li class="source_type last"><span class="label"><em class="cnt">更多</em><i class="down_arrow"></i></span></li></ul><div class="sub_type_box" style="display: none;"><div class="sub_type_inner"><div class="sub_type lowie_hover" data-type="8" data-bc="like_shop_tab"><a href="javascript:;" class="cnt">购物</a></div><div class="sub_type lowie_hover" data-type="7" data-bc="like_fun_tab"><a href="javascript:;" class="cnt">玩乐</a></div><div class="sub_type lowie_hover" data-type="21" data-bc="like_traffic_tab"><a href="javascript:;" class="cnt">交通</a></div></div></div></div></div>';var h="/travelbook/elementcollect/desiredtriplist/";var p={4:[4,17,18],6:[6,15],5:[5,18],8:[8,20],7:[7],21:[12,13,14,22,23,21]};var d={init:function(e){var t=this;t._observer=e;t._init_dom=false;t._box=s("#collect_box")},_initDom:function(){var e=this;e._$body=s("body");e._init_dom=true;e._filter_dom=s(c).appendTo(e._box);e._collect_dom=s(l).appendTo(e._box);e._collect_content=e._collect_dom.find(".collect_content");e._city_box=e._filter_dom.find(".city_select_box");e._city_txt=e._city_box.find(".txt");e._arrow=e._city_box.find(".arrow");e._city_list=e._city_box.find(".city_lists");e._sub_type_dom=e._filter_dom.find("div.sub_type_box");e._more_type_dom=e._filter_dom.find("li.last");e._no_data=e._collect_dom.find("div.no_data");e.poi_list=new f({box:e._collect_content,observer:e._observer,from:"collect"});var t=s("#collect_win");t.height(s(window).height()-216);e.listen()},listen:function(){var e=this;e.cur_type=null;e.cur_city=null;e._observer.on("delete_collect_item",s.proxy(e.deleteCollect,e));e._filter_dom.delegate("li[data-type]","mouseenter",function(e){if(this.className.match(/selected/)){return}this.className="source_type hover"}).delegate("li[data-type]","mouseleave",function(e){if(this.className.match(/selected/)){return}this.className="source_type"}).delegate("li[data-type]","click",function(t){t.preventDefault();var n=this.getAttribute("data-type");if(n==="all"){n=null}e._filter_dom.find("li[data-type]").removeClass("selected");s(this).removeClass("hover").addClass("selected");e._more_type_dom.find(".cnt").text("更多");e.cur_type=n;e.filterByType(n);var r=this.getAttribute("data-bc");if(r){u.planBc(r)}});e._more_type_dom.click(function(t){e._sub_type_dom.toggle()});e._sub_type_dom.mousedown(function(e){e.stopPropagation()}).delegate(".sub_type","click",function(){e._filter_dom.find("li[data-type]").removeClass("selected");e._more_type_dom.find(".cnt").text(this.innerText||this.textContent);e._sub_type_dom.hide();var t=this.getAttribute("data-type");e.cur_type=t;e.filterByType(t);var n=this.getAttribute("data-bc");if(n){u.planBc(n)}});e._$body.on("mousedown.collect_box",function(t){e._sub_type_dom.hide()})},loadData:function(e){var t=this;if(!t._init_dom){t._initDom();o.get("/travelbook/elementcollect/desiredtriplist",{bookId:a.Book_Id,_t:(new Date).getTime()},function(n){var r=n.data;if(r&&r.length){var i={};var s=r.map(function(e){if(i[e.cityName]){return}i[e.cityName]=true;return e.cityName}).filter(function(e){return!!e});t._no_data.hide();t.renderCity(s);t.poi_list.render(r,false,true)}else{t._no_data.show()}e&&e()},function(){t._no_data.show();e&&e()})}else{e&&e()}},renderCity:function(e){var t=this;t._city_txt.text("全部城市");if(e.length>1){t._arrow.show();var n=['<li class="c_item"><a  data-type="all" href="#">全部城市</a></li>'].concat(e.map(function(e){return'<li class="c_item"><a href="#">'+e+"</a></li>"})).join("");if(i.Browser.isIE6){if(e.length>5){t._city_list.addClass("autoscroll")}else{t._city_list.removeClass("autoscroll")}}t._city_list.html(n).hide();t._city_txt.parent().click(function(){t._city_list.toggle()});t._city_list.delegate("a","click",function(e){e.preventDefault();var n=this.getAttribute("data-type");if(n){var r="all";t.cur_city=null}else{var r=this.innerHTML;t.cur_city=r}t._city_list.toggle();t.filterCity(r)})}else{t._arrow.hide()}},filterCity:function(e){var t=this,n=t._collect_content;var r=n.find("li");var i;if(e==="all"){if(t.cur_type){t.filterByType(t.cur_type);return}i=r.show();t._city_txt.text("全部城市")}else{var s="[data-city="+e+"]";if(t.cur_type){var o=p[t.cur_type];var u=o.map(function(e){return s+"[data-type="+e+"]"}).join(",");s=u}i=r.hide().filter(s).show();t._city_txt.text(e)}if(!i.length){t._no_data.show()}else{t._no_data.hide()}},filterByType:function(e){var t=this,n=t._collect_content;var r=n.find("li");var i;if(!e){if(t.cur_city){t.filterCity(t.cur_city);return}i=r.show()}else{var s=p[e];var o;if(t.cur_city){o=s.map(function(e){return"[data-city="+t.cur_city+'][data-type="'+e+'"]'}).join(",")}else{o=s.map(function(e){return'[data-type="'+e+'"]'}).join(",")}i=r.hide().filter(o).show()}if(!i.length){t._no_data.show()}else{t._no_data.hide()}},resize:function(){},show:function(){var e=this;this.loadData(function(){e._box.show();e.resize()})},hide:function(){this._box.hide()},deleteCollect:function(e,t){var n=this;var r=e.id,i=e.type||e.typeId;o.post("/travelbook/elementcollect/delete",{bookId:a.Book_Id,elementType:i,elementId:r},function(){t.remove();if(!n._collect_content.find("li")[0]){n._no_data.show()}else{n._no_data.hide()}n.resize()})}};n.exports=d}(t.exports,t,e);e.____MODULES["1b3c2fa103584dcde5d4b4e7832d3b59"]=t.exports})(this);(function(e){var t={id:"ffa72cb41e9c72c97d9577d7c4202b4c",filename:"jquery.mousewheel.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){(function(e){e(jQuery)})(function(e){function o(t){var n=t||window.event,s=[].slice.call(arguments,1),o=0,u=0,a=0,f=0,l=0,c;t=e.event.fix(n);t.type="mousewheel";if(n.wheelDelta){o=n.wheelDelta}if(n.detail){o=n.detail*-1}if(n.deltaY){a=n.deltaY*-1;o=a}if(n.deltaX){u=n.deltaX;o=u*-1}if(n.wheelDeltaY!==undefined){a=n.wheelDeltaY}if(n.wheelDeltaX!==undefined){u=n.wheelDeltaX*-1}f=Math.abs(o);if(!r||f<r){r=f}l=Math.max(Math.abs(a),Math.abs(u));if(!i||l<i){i=l}c=o>0?"floor":"ceil";o=Math[c](o/r);u=Math[c](u/i);a=Math[c](a/i);s.unshift(t,o,u,a);return(e.event.dispatch||e.event.handle).apply(this,s)}var t=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"];var n="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];var r,i;if(e.event.fixHooks){for(var s=t.length;s;){e.event.fixHooks[t[--s]]=e.event.mouseHooks}}e.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var e=n.length;e;){this.addEventListener(n[--e],o,false)}}else{this.onmousewheel=o}},teardown:function(){if(this.removeEventListener){for(var e=n.length;e;){this.removeEventListener(n[--e],o,false)}}else{this.onmousewheel=null}}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})}(t.exports,t,e);e.____MODULES["ffa72cb41e9c72c97d9577d7c4202b4c"]=t.exports})(this);(function(e){var t={id:"525e8dc17b8a8011c6f7f0bbe1f060c2",filename:"index.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){n.exports=e.____MODULES["ffa72cb41e9c72c97d9577d7c4202b4c"]}(t.exports,t,e);e.____MODULES["525e8dc17b8a8011c6f7f0bbe1f060c2"]=t.exports})(this);(function(e){var t={id:"0e398f005e8c078f0e28d2364a3efeee",filename:"qscroll.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){e.____MODULES["525e8dc17b8a8011c6f7f0bbe1f060c2"];var i=function(e,t,n){var r=e(t),i=e(document),s=t.Math,o=t.parseInt,u=[].slice,a={}.toString;var f=20,l=20;var c="SHOW",h="HIDE",p="NO_SCROLL";var d='<div class="sliderbox" style="display:none">								<div style="height:50px;" class="slider"></div>					  </div>';var v=function(){var e="scroll_",t=0;return function(){var n=t++;return e+n}}();var m=0;if(n.Browser.isMac){f=5}var g=["vertical","horizontal"];var y="linear";var b=function(t){n.Event.call(this);var r,i,o;this.opts={};r=t.win;if(r instanceof e){this.win=r}else{this.win=e(r)}if(e.type(t.slider)==="undefined"){i=e(d)}else if(t.slider instanceof e){i=t.slider}else{i=e(t.slider,this.win)}if(!t.slider){this.opts.autoAddBar=true;this.win.parent().append(i).css("position","relative")}this.win.css({overflow:"hidden",outline:"none"});o=i.find(t.bar||".slider");this.slider=i;this.bar=o;this.content=t.content instanceof e?t.content:this.win.find(t.content);if(t.gap&&n.Browser.isMac){t.gap=s.ceil(t.gap/5)}this.opts.gap=t.gap||f;this.opts.direction=t.direction||g[0];this.opts.dontRelease=t.dontRelease||false;this.opts.min_bar_height=40;this._enabled=false;this._init(t)};var w={constructor:b,_init:function(e){var t=this;t.options=e;this._initEvents();if(e.events){for(var r in e.events){(function(e,r){if(n.isFunction(r)){t.on(e,r)}})(r,e.events[r])}}},_initRange:function(){var e=this;e._range={con:0,win:0,sld:0,bar:0}},_initSize:function(){var e=this,t=e.opts,n;if(t.direction===g[0]){n=e._range={con:e.content.height(),win:e.win.height()};if(n.con<=n.win){e._status=p;return}else{e._status=c}n.max=n.con-n.win;if(e.opts.autoAddBar){var r=e.win.position();delete r.left;r.right=0;e.slider.height(n.win).css(r);n.sld=n.win}n.sld=e.slider.height()||n.win;n.bar=s.floor(n.sld*n.win/n.con);if(n.bar<e.opts.min_bar_height){n.bar=e.opts.min_bar_height}e.bar.height(n.bar)}else{n=e._range={con:e.content.width(),win:e.win.width()};n.max=n.con-n.win;n.sld=e.slider.width()||n.win;n.bar=s.floor(n.sld*n.win/n.con);if(n.bar<e.opts.min_bar_height){n.bar=e.opts.min_bar_height}e.bar.width(n.bar)}},_initEvents:function(){var t=this,n=t.id,o=t.slider,u=t.bar;var a=null;t._show_timer=null;var f=0,l;t.win.bind("mouseenter."+n,function(e){t.enable()}).bind("mouseleave."+n,function(e){t.hide()}).mousewheel(function(e,n,r,i){var s=e.target;if(s.nodeName.toLowerCase().match(/textarea/)){return}if(typeof i==="number"&&i){n=i}var o=-n*t.opts.gap;t._scrollBy(o)}).bind("keydown."+n,function(e){var n=e.which;if(n===38){t._moveBar(-50)}else if(n===40){t._moveBar(50)}});o.mousedown(function(e){var n=e.pageY;var r=function(){var e=n-(u.offset().top+t._range.bar/2);if(e===0){clearTimeout(a);a=null;return}if(s.abs(e)>=50){e=e>0?50:-50}t._moveBar(e);a=setTimeout(r,200)};r()}).mouseup(function(e){if(a){clearTimeout(a);a=null}}).mouseenter(e.proxy(t.show,t)).mouseleave(e.proxy(t.hide,t));u.mousedown(function(e){e.stopPropagation();var r=e.pageX,s=e.pageY;u.css("cursor","pointer");x();i.bind("mousemove."+n,function(e){var n=e.pageY;var r=n-s;s=n;t._moveBar(r,true)});i.bind("mouseup."+n,function(e){i.unbind("mousemove."+n);u.css("cursor","");T()})}).mouseup(function(){if(a){clearTimeout(a);a=null}});r.on("resize."+n,function(){t._contentResize()})},_moveBar:function(e,t){if(this._status===p||!t&&this._scrolling){return}var n=this,r=n._range,i=n.bar,u=n.slider;var a=o(i.css("top"),10)||0;var f=(r.con-r.win)/(r.sld-r.bar);var l=s.max(s.min(a+e,r.sld-r.bar),0);var c=e*f;var h=s.max(s.min(n._getCurPos()+c,r.max),0);if(h>r.max){n._scollEnded();return}if(h===0){n._scrollZero()}if(t){n._scrolling=false;n.win.scrollTop(h);i.css("top",l);n.fire("scroll",-h,l,c,e,n);return}n._scrolling=true;n.bar.animate({top:l},{duration:150,easing:y,step:function(e){n.win.scrollTop(e*f)},complete:function(){n._scrolling=false;n.fire("scroll",h,l,c,e,n)}})},hasScrollBar:function(){return this._status!==p},_adjust:function(){var e=this,t=e.content,n=e.bar,r,i;r=e._getCurPos();i=s.max(s.abs(r)*(e._range.sld-e._range.bar)/(e._range.con-e._range.win),0);if(e.opts.direction===g[0]){n.css("top",i)}else{n.css("left",i)}},_getCurPos:function(){var e=this;if(e.opts.direction===g[0]){return e.win.scrollTop()}else{return e.win.scrollLeft()}},getRange:function(){return this._range},_scrollBy:function(e,t,n){var r=this,i=r.win,u=r.content,a=r.slider,f=r.bar,l=r._range,c,h,d,v;if(r._scrolling){return}if(this._status===p){r._scollEnded();t&&t();return}c=r._getCurPos();h=c+e;if(h<0){h=0}if(h>r._range.max){h=r._range.max}v=(l.sld-l.bar)/(l.con-l.win);d=s.min(s.abs(h)*v,l.sld-l.bar);var m=o(f.css("top"))||0;var g=function(){r._scrolling=false;if(t)t();r.fire("scroll",h,d,e,d-m,r);if(h<=r._range.max){r._scollEnded()}if(h===0){r._scrollZero()}};var y=h/2;if(n){r.win.animate({scrollTop:h},y,function(){g()});r.bar.animate({top:d},y);return}r.win.scrollTop(h);r.bar.css("top",d);g()},_contentResize:function(){var e=this;e._initSize();e._adjust()},_scollEnded:function(){var e=this,t=e.content;e.fire("scroll_end")},_scrollZero:function(){this.fire("scroll_start")},scroll:function(e,t,n){e=-e;this._scrollBy(e,t,n)},enable:function(){var e=this;if(!e._enabled){if(e.opts.autoAddBar){e.slider.height(e.win.height())}e._initSize();e._enabled=true}if(e._show_timer){clearTimeout(e._show_timer);e._show_timer=null}e.show()},disable:function(){},reset:function(){this._contentResize();if(this.opts.direction===g[0]){this.win.scrollTop(0);this.bar.css("top",0)}else{this.win.scrollLeft(0);this.bar.css("left",0)}},show:function(){var e=this;if(this._status!==p){if(e._show_timer){clearTimeout(e._show_timer);e._show_timer=null}this.slider.show()}},hide:function(){var e=this;e._show_timer=setTimeout(function(){e.slider.hide()},200)},setScrollToEnd:function(e){var t=this._range;var n=t.win-t.con;this.scroll(n,null,e)},setNoScroll:function(){this.hide();this._status=p},getContent:function(){return this.content},getSlider:function(){return this.slider},getWin:function(){return this.win},getBar:function(){return this.bar},remove:function(){var e=this,t=e.id;e.unbind();r.unbind("resize."+t);e.win.unbind("mouseenter."+t).unbind("mouseleave."+t).unmousewheel();e.slider.unbind();e.bar.unbind();if(e.opts.autoAddBar){e.slider.remove()}for(var n in this){delete this[n]}}};w.setBarHeight=w._contentResize;w.resize=w._contentResize;e.extend(b.prototype,n.Event.prototype,w);var E=e("body");var S=function(e){var t=e.target;if(!t.nodeName.toLowerCase().match(/input|textarea/)){return false}};var x=function(){E.addClass("unselect").attr("unselectable","on").on("selectstart",S)};var T=function(){E.removeClass("unselect").removeAttr("unselectable").unbind("selectstart",S)};return b}(jQuery,window,QNR);n.exports=i}(t.exports,t,e);e.____MODULES["0e398f005e8c078f0e28d2364a3efeee"]=t.exports})(this);(function(e){var t={id:"9c0f36c90ca983fdbd5357f94ed8777d",filename:"AroundView.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["88d5c499e26b6f8fc86d873910ae3aea"];var u=e.____MODULES["aef633924a0fa77f0f39939c0bf845f7"];var a=e.____MODULES["7b71296703db79fa05edd07faae9908a"];var f=e.____MODULES["0e398f005e8c078f0e28d2364a3efeee"];var l=e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"];var c=10;var h={offset:0,limit:c,poi_type:4,add_center_distance:true};var p={init:function(e){var t=this;t.view_event=e;t._cache_param=s.extend({},h);t._box=s("#around_box");t._select_box=s(".select_box",t._box);t._close_btn=s(".at_btn_box a",t._box);t._around_main_win=s(".around_main_win",t._box);t._around_main=t._around_main_win.children().filter(".around_main");t._around_content=t._around_main.children();t._title_box=s(".at_poi_name",t._box);t._no_data_dom=s(".source_query_ph",t._box);t.poi_list=new a({box:t._around_content,observer:t.view_event});t.listen()},_initScroll:function(){var e=this;this._scrollbar=new f({win:e._around_main,content:e._around_content,events:{scroll:function(t,n,r,i,s){var o=s.getRange();var u=o.con,a=o.win;if(u-t-a<100){e._scroll()}}}});e._scrollbar.enable()},listen:function(){var e=this;var t=e._select_box.find(".list_box");e._close_btn.click(s.proxy(e.hide,e));e._select_box.delegate(".txt_label","click",function(e){t.toggle()}).mousedown(function(e){e.stopPropagation()});e._select_box.delegate(".item","click",function(n){n.preventDefault();var r=s(this);var i=r.data("type");e.empty();e.query(i);t.hide();e._select_box.find(".txt").text(r.text());u.planBc("nearby_type")});s("body").on("mousedown.AroundView",function(e){t.hide()});e._box.delegate(".poi_button","mousedown",function(e){u.planBc("nearby_add")})},hide:function(){this._box.hide();this.view_event.fire("hide_around_box")},show:function(e){var t=this;t.empty();t._title_box.text(e.context("name")+"周边");t._box.show();t._cache_param.pid=e.getPoiId();t._cache_param.lng=e.lng();t._cache_param.lat=e.lat();if(!t._scrollbar){t._initScroll()}t.query()},empty:function(){this._select_box.find(".txt").text("景点");this.clearCache();this.poi_list.clear()},clearCache:function(){this._cache_param=s.extend(this._cache_param,h)},query:function(e){var t=this;t._no_data_dom.hide();if(e==="all"){delete t._cache_param.poi_type}else if(e){e=l.front_to_server_type[e];t._cache_param.poi_type=e}var n="/place/api/nearBy/poi";var r=i.mix({},t._cache_param);var s=r.poi_type;delete r.poi_type;r.poi_types=s;var u=t._cache_param.offset>0;o.get(n,r,function(e){var n=e.totalCount;var r=e.data;if(n===0){t._cache_param.max=true;t.showNoData()}else{if(r.length===0||r.length<t._cache_param.limit){t._cache_param.max=true}t.poi_list.render(r,u,t._cache_param.max)}if(u){t._scrollbar.resize()}else{t._scrollbar.reset()}},function(){t.showNoData();console&&console.log("error",arguments)})},showNoData:function(){this._no_data_dom.show()},_scroll:function(){var e=this;if(e._cache_param.max){return}e._cache_param.offset+=e._cache_param.limit;e.query()}};var d={init:function(e){this.data=e;this.items=i.map(e,function(e){return new p})}};n.exports=p}(t.exports,t,e);e.____MODULES["9c0f36c90ca983fdbd5357f94ed8777d"]=t.exports})(this);(function(e){var t={id:"34e814670e74b19de1c6553b8188f327",filename:"qmap.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];if(typeof window.QNR=="undefined"){window.QNR={}}window.QNR.Map=i.Map||{};(function(){function e(e,t){var n=this;this._event=this._event||[];this._event["baidu"]=this._event["baidu"]||[];this._event["baidu"][e]=this._event["baidu"][e]||[];var r=this._event["baidu"][e].length;this._event["baidu"][e][r]=function(e){e.target=n;if(e.point){e.latlng=new i.Map.LatLng(new BMap.Point(e.point.lng,e.point.lat))}if(e.pixel){e.pixel={x:e.pixel.x,y:e.pixel.y}}t.apply(n,[e])};this._objs["baidu"].addEventListener(e,this._event["baidu"][e][r]);return this._event["baidu"][e][r]}function t(e,t){a(this._event["baidu"][e],t);this._objs["baidu"].removeEventListener(e,t)}function n(e,t){var n=this;this._event=this._event||[];this._event["google"]=this._event["google"]||[];this._event["google"][e]=this._event["google"][e]||[];var r=this._event["google"][e].length;var s=google.maps.event.addListener(this._objs["google"],e,function(e){var r=e;if(e&&e.latLng){e.latlng=new i.Map.LatLng(new google.maps.LatLng(e.latLng.lat(),e.latLng.lng()))}if(e&&e.pixel){e.pixel={x:e.pixel.x,y:e.pixel.y}}t.apply(n,[e])});this._event["google"][e][r]=s;return s}function r(e,t){a(this._event["google"][e],t);google.maps.event.removeListener(t)}function s(e,t){var n=function(){};n.prototype=t.prototype;e.prototype=new n;e.prototype.constructor=e}function o(e,t){for(var n in e.prototype){if("function"==typeof e.prototype[n]){t[n]=e.prototype[n]}}}function u(e,t){if("undefined"==typeof e){return t}else if(e){return true}else{return false}}function a(e,t){var n=e.length;while(n--){if(n in e&&e[n]===t){e.splice(n,1)}}return e}function f(e){var t=[],n=0,r;for(r in e){if(e.hasOwnProperty(r)){t[n++]=r}}return t}i.Map=function(e,t,n){e=e.toLowerCase();if("baidu"===e){return new i.Map.Adapter.Baidu(t,n)}else if("google"===e){return new i.Map.Adapter.Google(t,n)}else{throw"No such adapter vendor."}};i.Map.LatLng=function(e,t,n){this._objs={};this.addObject(e,t,n)};i.Map.LatLng.prototype={addObject:function(e,t,n){if(window.BMap&&BMap.Point&&e instanceof BMap.Point){this._objs["baidu"]={lat:e.lat,lng:e.lng,obj:e}}else if(window.google&&google.maps&&google.maps.LatLng&&e instanceof google.maps.LatLng){this._objs["google"]={lat:e.lat(),lng:e.lng(),obj:e}}else{this._objs[n]={lat:e,lng:t,obj:null}}},getLat:function(e){var t=f(this._objs),n;if(this._objs[e]){n=this._objs[e]}else{n=this._objs[t[0]]}return n.lat},getLng:function(e){var t=f(this._objs),n;if(this._objs[e]){n=this._objs[e]}else{n=this._objs[t[0]]}return n.lng},equals:function(e){},_toBaidu:function(){if(!this._objs["baidu"]){this._transLatLng("baidu")}else if(!this._objs["baidu"].obj){this._objs["baidu"].obj=new BMap.Point(this._objs["baidu"].lng,this._objs["baidu"].lat)}return this._objs["baidu"].obj},_toGoogle:function(){if(!this._objs["google"]){this._transLatLng("google")}if(!this._objs["google"].obj){this._objs["google"].obj=new google.maps.LatLng(this._objs["google"].lat,this._objs["google"].lng)}return this._objs["google"].obj},_transLatLng:function(e){var t,n,r,i;t=f(this._objs);r=t.length;for(n=0;n<r;n++){i="_"+t[n].toLowerCase()+"To"+e.charAt(0).toUpperCase()+e.substring(1).toLowerCase();if(this[i]&&"function"==typeof this[i]){this._objs[e]=this[i](this._objs[t[n]]);break}}if(!this._objs[e]){throw"Can't convert to "+e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()}},_baiduToGoogle:function(e){return{lat:e.lat-.006,lng:e.lng-.0065,obj:null}},_googleToBaidu:function(e){return{lat:e.lat+.006,lng:e.lng+.0065,obj:null}}};i.Map.Pixel=function(e,t){this.x=e;this.y=t;this._objs={}};i.Map.Pixel.prototype._toBaidu=function(){if(!this._objs["baidu"]){this._objs["baidu"]=BMap.Pixel(this.x,this.y)}return this._objs["baidu"]};i.Map.Pixel.prototype._toGoogle=function(){if(!this._objs["google"]){this._objs["google"]=new google.maps.Point(this.x,this.y)}return this._objs["google"]};i.Map.Bounds=function(e,t,n){this._sw=e,this._ne=t;this._objs=[];if("baidu"==n){this._toBaidu()}else if("google"==n){this._toGoogle()}};i.Map.Bounds.prototype._toBaidu=function(){if(!this._objs["baidu"]){this._objs["baidu"]=new BMap.Bounds(this._sw?this._sw._toBaidu():null,this._ne?this._ne._toBaidu():null);o(this._toBaidu,this)}return this._objs["baidu"]};i.Map.Bounds.prototype._toBaidu.prototype.equals=function(e){return this._objs["baidu"].equals(e._toBaidu)};i.Map.Bounds.prototype._toBaidu.prototype.getSouthWest=function(){var e=this._objs["baidu"].getSouthWest();return new i.Map.LatLng(new BMap.Point(e.lng,e.lat))};i.Map.Bounds.prototype._toBaidu.prototype.getNorthEast=function(){var e=this._objs["baidu"].getNorthEast();return new i.Map.LatLng(new BMap.Point(e.lng,e.lat))};i.Map.Bounds.prototype._toBaidu.prototype.isEmpty=function(){return this._objs["baidu"].isEmpty()};i.Map.Bounds.prototype._toBaidu.prototype.toSpan=function(){var e=this._objs["baidu"].toSpan();return new i.Map.LatLng(new BMap.Point(e.lng,e.lat))};i.Map.Bounds.prototype._toBaidu.prototype.intersects=function(e){return!this._objs["baidu"].intersects(e._toBaidu()).isEmpty()};i.Map.Bounds.prototype._toBaidu.prototype.getCenter=function(){var e=this._objs["baidu"].getCenter();return new i.Map.LatLng(new BMap.Point(e.lng,e.lat))};i.Map.Bounds.prototype._toBaidu.prototype.extend=function(e){this._objs["baidu"].extend(e._toBaidu());this._sw=this.getSouthWest();this._ne=this.getNorthEast()};i.Map.Bounds.prototype._toBaidu.prototype.containsPoint=function(e){var t=this._objs["baidu"];var n=e._toBaidu();return t.containsPoint(n)};i.Map.Bounds.prototype._toGoogle=function(e){if(!this._objs["google"]){if(this._sw&&this._ne){this._objs["google"]=new google.maps.LatLngBounds(this._sw._toGoogle(),this._ne._toGoogle())}else{this._objs["google"]=new google.maps.LatLngBounds}o(this._toGoogle,this)}return this._objs["google"]};i.Map.Bounds.prototype._toGoogle.prototype.equals=function(e){return this._objs["google"].equals(e._toGoogle())};i.Map.Bounds.prototype._toGoogle.prototype.getSouthWest=function(){var e=this._objs["google"].getSouthWest();return new i.Map.LatLng(e.lat(),e.lng(),"google")};i.Map.Bounds.prototype._toGoogle.prototype.getNorthEast=function(){var e=this._objs["google"].getNorthEast();return new i.Map.LatLng(e.lat(),e.lng(),"google");return new i.Map.LatLng(google.maps.LatLng(e.lat(),e.lng()))};i.Map.Bounds.prototype._toGoogle.prototype.isEmpty=function(){return this._objs["google"].isEmpty()};i.Map.Bounds.prototype._toGoogle.prototype.toSpan=function(){var e=this._objs["google"].toSpan();return new i.Map.LatLng(google.maps.LatLng(e.lat(),e.lng()))};i.Map.Bounds.prototype._toGoogle.prototype.intersects=function(e){return this._objs["google"].intersects(e._toGoogle())};i.Map.Bounds.prototype._toGoogle.prototype.getCenter=function(){var e=this._objs["google"].getCenter();return new i.Map.LatLng(new google.maps.LatLng(e.lat(),e.lng()))};i.Map.Bounds.prototype._toGoogle.prototype.extend=function(e){this._objs["google"].extend(e._toGoogle());this._sw=this.getSouthWest();this._ne=this.getNorthEast()};i.Map.Bounds.prototype._toGoogle.prototype.containsPoint=function(e){var t=this._objs["google"];var n=e._toGoogle();return t.contains(n)};i.Map.Size=function(e,t){this.width=e;this.height=t;this._objs=[]};i.Map.Size.prototype._toBaidu=function(){if(!this._objs["baidu"]){this._objs["baidu"]=new BMap.Size(this.width,this.height)}return this._objs["baidu"]};i.Map.Size.prototype._toGoogle=function(){if(!this._objs["google"]){this._objs["google"]=new google.maps.Size(this.width,this.height)}return this._objs["google"]};i.Map.Icon=function(e,t,n,r){this._url=e,this._size=t,this._origin=n,this._anchor=r;this._objs=[]};i.Map.Icon.prototype._toBaidu=function(){var e={};if(!this._objs["baidu"]){if(this._origin)e.imageOffset=new BMap.Size(0-this._origin.x,this._origin.y);if(this._anchor)e.anchor=new BMap.Size(this._anchor.x,this._anchor.y);this._objs["baidu"]=new BMap.Icon(this._url,this._size._toBaidu(),e)}return this._objs["baidu"]};i.Map.Icon.prototype._toGoogle=function(){var e,t;if(!this._objs["google"]){if(this._anchor){e=this._anchor._toGoogle();t=this._origin._toGoogle();this._objs["google"]=new google.maps.MarkerImage(this._url,this._size._toGoogle(),t,e)}else if(this._origin){t=this._origin._toGoogle();this._objs["google"]=new google.maps.MarkerImage(this._url,this._size._toGoogle(),t)}else{this._objs["google"]=new google.maps.MarkerImage(this._url,this._size._toGoogle())}}return this._objs["google"]};i.Map.Control=function(e,t,n){this._map=e;this._objs=[];this._opts=t||{};this._init=n};i.Map.Control.prototype._toBaidu=function(){var e=this;if(!this._objs["baidu"]){this._objs["baidu"]=new BMap.Control;this._objs["baidu"].defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT;this._objs["baidu"].defaultOffset=new BMap.Size(0,0);this._objs["baidu"].initialize=function(){return e._init.apply(e._objs["baidu"],[e._map])}}return this._objs["baidu"]};i.Map.Control.prototype._toGoogle=function(){var e=this;if(!this._objs["google"]){var t=this._init(this._map);this._objs["google"]={pos:google.maps.ControlPosition.RIGHT_BOTTOM,div:t}}return this._objs["google"]};i.Map.Control.Position={};i.Map.Control.Position.TOP_LEFT=1;i.Map.Control.Position.TOP_RIGHT=2;i.Map.Control.Position.BOTTOM_LEFT=3;i.Map.Control.Position.BOTTOM_RIGHT=4;i.Map.Control.Position._toBaidu=function(e){var t=[null,BMAP_ANCHOR_TOP_LEFT,BMAP_ANCHOR_TOP_RIGHT,BMAP_ANCHOR_BOTTOM_LEFT,BMAP_ANCHOR_BOTTOM_RIGHT];return t[e]};i.Map.Control.Position._toGoogle=function(e){var t=[null,google.maps.ControlPosition.LEFT_TOP,google.maps.ControlPosition.TOP_RIGHT,google.maps.ControlPosition.BOTTOM_LEFT,google.maps.ControlPosition.BOTTOM_RIGHT];return t[e]};i.Map.Control.Navigation=function(e,t){i.Map.Control.apply(this,[e,t,null]);this._opts.position=this._opts.position||i.Map.Control.Position.TOP_LEFT};i.Map.Control.Navigation.prototype=new i.Map.Control;i.Map.Control.Navigation.prototype.constructor=i.Map.Control.Navigation;i.Map.Control.Navigation.prototype._toBaidu=function(){if(!this._objs["baidu"]){var e=this._opts.style;this._objs["baidu"]=new BMap.NavigationControl({anchor:i.Map.Control.Position._toBaidu(this._opts.position),type:e})}return this._objs["baidu"]};i.Map.Control.Navigation.prototype._toGoogle=function(){var e=i.Map.Control.Position._toGoogle(this._opts.position);var t=this._opts.style;if(!this._objs["google"]){this._objs["google"]={pos:e,obj:{panControl:true,panControlOptions:{position:e},zoomControl:true,zoomControlOptions:{position:e,style:t}}}}return this._objs["google"]};i.Map.Control.OverviewMap=function(e,t){i.Map.Control.apply(this,arguments)};i.Map.Control.OverviewMap.prototype=new i.Map.Control;i.Map.Control.OverviewMap.prototype.constructor=i.Map.Control.OverviewMap;i.Map.Control.OverviewMap.prototype._toBaidu=function(){return new BMap.OverviewMapControl({isOpen:u(this._options.open,false)})};i.Map.Control.OverviewMap.prototype._toGoogle=function(){var e={overviewMapControl:true,overviewMapControlOptions:{opened:u(this._options.open,false)}};return e};i.Map.Overlay=function(){};i.Map.Overlay.prototype._toBaidu=function(n){var r=this.constructor.prototype;var i=r._objs=r._objs||[];var o=this,u;if(!i["baidu"]){i["baidu"]=function(e,t){this._overlay=e;this._map=t};s(i["baidu"],BMap.Overlay);i["baidu"].prototype.initialize=function(){var e=this._map;return r.onInit.apply(this,[e,this._overlay])};i["baidu"].prototype.draw=function(){var e=this._map;return r.onDraw.apply(this,[e,this._overlay])};i["baidu"].prototype.getPanes=function(){var e=this._map;return e.getPanes()}}this.addEventListener=e;this.removeEventListener=t;if(!this.hasOwnProperty("_objs")){this._objs=[]}if(!this._objs["baidu"]){this._objs["baidu"]=new i["baidu"](o,n)}return this._objs["baidu"]};i.Map.Overlay.prototype._toGoogle=function(e){var t=this.constructor.prototype;var i=t._objs=t._objs||[];var o=this,u;if(!i["google"]){i["google"]=function(e,t){this._overlay=e;this._map=t};s(i["google"],google.maps.OverlayView);i["google"].prototype.onAdd=function(){var e=this._map;this._div=t.onInit.apply(this,[e,this._overlay]);return this._div};i["google"].prototype.draw=function(){var e=this._map;return t.onDraw.apply(this,[e,this._overlay])};i["google"].prototype.onRemove=function(){this._div.parentNode.removeChild(this._div);this._div=null}}o.addEventListener=n;o.removeEventListener=r;if(!this.hasOwnProperty("_objs")){this._objs=[]}if(!this._objs["google"]){this._objs["google"]=new i["google"](o,e)}return this._objs["google"]};i.Map.Overlay.Marker=function(e,t){this._point=e,this._options=t;this._map=null,this._objs=[],this._event=[]};i.Map.Overlay.Marker.prototype=new i.Map.Overlay;i.Map.Overlay.Marker.prototype.constructor=i.Map.Overlay.Marker;i.Map.Overlay.Marker.prototype._toBaidu=function(e){this._map=e;var t={enableDragging:this._options["draggable"]||false,enableClicking:this._options["clickable"]||true,raiseOnDrag:this._options["raiseOnDrag"]||false,title:this._options["title"]||""};if(this._options["icon"]){t.icon=this._options["icon"]._toBaidu()}if(!this._objs["baidu"]){this._objs["baidu"]=new BMap.Marker(this._point._toBaidu(),t);o(this._toBaidu,this)}return this._objs["baidu"]};i.Map.Overlay.Marker.prototype._toBaidu.prototype.addEventListener=e;i.Map.Overlay.Marker.prototype._toBaidu.prototype.removeEventListener=t;i.Map.Overlay.Marker.prototype._toBaidu.prototype.setPosition=function(e){};i.Map.Overlay.Marker.prototype._toBaidu.prototype.getPosition=function(){};i.Map.Overlay.Marker.prototype._toBaidu.prototype.getPoint=function(){return this._point};i.Map.Overlay.Marker.prototype._toGoogle=function(){var e={clickable:this._options["clickable"]||true,draggable:this._options["draggable"]||false,position:this._point._toGoogle(),raiseOnDrag:this._options["raiseOnDrag"]||false,title:this._options["title"]||""};if(this._options["icon"]){e.icon=this._options["icon"]._toGoogle()}var t=new google.maps.Marker(e);if(!this._objs["google"]){this._objs["google"]=new google.maps.Marker(e);o(this._toGoogle,this)}return this._objs["google"]};i.Map.Overlay.Marker.prototype._toGoogle.prototype.getPoint=function(){return this._point};i.Map.Overlay.Marker.prototype._toGoogle.prototype.addEventListener=n;i.Map.Overlay.Marker.prototype._toGoogle.prototype.removeEventListener=r;i.Map.Overlay.Marker.prototype._toGoogle.prototype.setIcon=function(e){this._objs["google"].setIcon(e)};i.Map.Overlay.Marker.prototype._toGoogle.prototype.getIcon=function(e){return i.Map.Icon._fromBaidu(this._objs["baidu"].getIcon())};i.Map.Overlay.Polyline=function(e,t){this._map=null;this._points=e;this._options=t||{};this._objs=[];this._event=[]};i.Map.Overlay.Polyline.prototype=new i.Map.Overlay;i.Map.Overlay.Polyline.prototype.constructor=i.Map.Overlay.Polyline;i.Map.Overlay.Polyline.prototype._toBaidu=function(e){this._map=e;var t=[],n=this._points.length;for(var r=0;r<n;r++){t.push(this._points[r]._toBaidu())}var s={strokeStyle:"solid",enableMassClear:true,enableEditing:false};i.mix(s,this._options,true);if(!this._objs["baidu"]){this._objs["baidu"]=new BMap.Polyline(t,s);o(this._toBaidu,this)}return this._objs["baidu"]};i.Map.Overlay.Polyline.prototype._toBaidu.prototype.addEventListener=e;i.Map.Overlay.Polyline.prototype._toBaidu.prototype.removeEventListener=t;i.Map.Overlay.Polyline.prototype._toBaidu.prototype.getPath=function(){var e=this._objs["baidu"].getPath();var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(new i.Map.LatLng(e[n]))}return t};i.Map.Overlay.Polyline.prototype._toBaidu.prototype.setPath=function(e){var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(e[n]._toBaidu())}this._objs["baidu"].setPath(t)};i.Map.Overlay.Polyline.prototype._toBaidu.prototype.setStrokeColor=function(e){this._objs["baidu"].setStrokeColor(e)};i.Map.Overlay.Polyline.prototype._toGoogle=function(e){this._map=e;var t=[],n=this._points.length;for(var r=0;r<n;r++){t.push(this._points[r]._toGoogle())}var i={path:t,strokeColor:"#0096ff"};if(this._options["strokeColor"])i.strokeColor=this._options["strokeColor"];if(this._options["strokeOpacity"])i.strokeOpacity=this._options["strokeOpacity"];if(this._options["strokeWeight"])i.strokeWeight=this._options["strokeWeight"];if(this._options["clickable"])i.clickable=this._options["clickable"];if(!this._objs["google"]){this._objs["google"]=new google.maps.Polyline(i);o(this._toGoogle,this)}return this._objs["google"]};i.Map.Overlay.Polyline.prototype._toGoogle.prototype.addEventListener=n;i.Map.Overlay.Polyline.prototype._toGoogle.prototype.removeEventListener=r;i.Map.Overlay.Polyline.prototype._toGoogle.prototype.getPath=function(){var e=this._objs["google"].getPath();var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(new i.Map.LatLng(e[n]))}return t};i.Map.Overlay.Polyline.prototype._toGoogle.prototype.setPath=function(e){var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(e[n]._toGoogle())}this._objs["google"].setPath(t)};i.Map.Overlay.Polyline.prototype._toGoogle.prototype.setStrokeColor=function(e){this._objs["google"].setOptions({strokeColor:e})};i.Map.Overlay.Polygon=function(e,t){this._map=null;this._points=e;this._options=t;this._objs=[];this._event=[]};i.Map.Overlay.Polygon.prototype=new i.Map.Overlay;i.Map.Overlay.Polygon.prototype.constructor=i.Map.Overlay.Polygon;i.Map.Overlay.Polygon.prototype._toBaidu=function(e){this._map=e;var t=[],n=this._points.length;for(var r=0;r<n;r++){t.push(this._points[r]._toBaidu())}var i={strokeStyle:"solid",enableMassClear:true,enableEditing:false};if(this._options["strokeColor"])i.strokeColor=this._options["strokeColor"];if(this._options["strokeOpacity"])i.strokeOpacity=this._options["strokeOpacity"];if(this._options["strokeWeight"])i.strokeWeight=this._options["strokeWeight"];if(this._options["fillColor"])i.fillColor=this._options["fillColor"];if(this._options["fillOpacity"])i.fillOpacity=this._options["fillOpacity"];if(this._options["clickable"])i.enableClicking=this._options["clickable"];if(!this._objs["baidu"]){this._objs["baidu"]=new BMap.Polygon(t,i);o(this._toBaidu,this)}return this._objs["baidu"]};i.Map.Overlay.Polygon.prototype._toBaidu.prototype.addEventListener=e;i.Map.Overlay.Polygon.prototype._toBaidu.prototype.removeEventListener=t;i.Map.Overlay.Polygon.prototype._toBaidu.prototype.getPath=function(){var e=this._objs["baidu"].getPath();var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(new i.Map.LatLng(e[n]))}return t};i.Map.Overlay.Polygon.prototype._toBaidu.prototype.setPath=function(e){var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(e[n]._toBaidu())}this._objs["baidu"].setPath(t)};i.Map.Overlay.Polygon.prototype._toBaidu.prototype.setStrokeColor=function(e){this._objs["baidu"].setStrokeColor(e)};i.Map.Overlay.Polygon.prototype._toBaidu.prototype.setFillColor=function(e){this._objs["baidu"].setFillColor(e)};i.Map.Overlay.Polygon.prototype._toBaidu.prototype.setFillOpacity=function(e){this._objs["baidu"].setFillOpacity(e)};i.Map.Overlay.Polygon.prototype._toBaidu.prototype.getBounds=function(e){return this._objs["baidu"].getBounds()};i.Map.Overlay.Polygon.prototype._toGoogle=function(e){this._map=e;var t=[],n=this._points.length;for(var r=0;r<n;r++){t.push(this._points[r]._toGoogle())}t.push(this._points[0]._toGoogle());var i={paths:t};if(this._options["strokeColor"])i.strokeColor=this._options["strokeColor"];if(this._options["strokeOpacity"])i.strokeOpacity=this._options["strokeOpacity"];if(this._options["strokeWeight"])i.strokeWeight=this._options["strokeWeight"];if(this._options["fillColor"])i.fillColor=this._options["fillColor"];if(this._options["fillOpacity"])i.fillOpacity=this._options["fillOpacity"];if(this._options["clickable"])i.clickable=this._options["clickable"];if(!this._objs["google"]){this._objs["google"]=new google.maps.Polygon(i);o(this._toGoogle,this)}return this._objs["google"]};i.Map.Overlay.Polygon.prototype._toGoogle.prototype.addEventListener=n;i.Map.Overlay.Polygon.prototype._toGoogle.prototype.removeEventListener=r;i.Map.Overlay.Polygon.prototype._toGoogle.prototype.getPath=function(){var e=this._objs["google"].getPath();var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(new i.Map.LatLng(e[n]))}return t};i.Map.Overlay.Polygon.prototype._toGoogle.prototype.setPath=function(e){var t=[],n,r=e.length;for(n=0;n<r;n++){t.push(e[n]._toGoogle())}this._objs["google"].setPath(t)};i.Map.Overlay.Polygon.prototype._toGoogle.prototype.setStrokeColor=function(e){this._objs["google"].setOptions({strokeColor:e})};i.Map.Overlay.Polygon.prototype._toGoogle.prototype.setFillColor=function(e){this._objs["google"].setOptions({fillColor:e})};i.Map.Overlay.Polygon.prototype._toGoogle.prototype.setFillOpacity=function(e){this._objs["google"].setOptions({fillOpacity:e})};i.Map.Overlay.Polygon.prototype._toGoogle.prototype.getBounds=function(){return this._objs["google"].getBounds()};i.Map.Adapter={};i.Map.Adapter.Baidu=function(e,t){this._overlays=[],this._controls=[],this._event=[],this._objs=[];var n={mapType:BMAP_NORMAL_MAP,enableHighResolution:false,enableAutoResize:true,enableMapClick:false};if("number"==typeof t.minZoom){n.minZoom=t.minZoom}if("number"==typeof t.maxZoom){n.maxZoom=t.maxZoom}this._map=new BMap.Map(e,n);if(t.center&&"number"==typeof t.zoom){this._map.centerAndZoom(t.center._toBaidu(),t.zoom)}u(t.scrollwheel,false)?this._map.enableScrollWheelZoom():this._map.disableScrollWheelZoom();u(t.doubleClickZoom,true)?this._map.enableDoubleClickZoom():this._map.disableDoubleClickZoom();u(t.keyboard,false)?this._map.enableKeyboard():this._map.disableKeyboard();this._objs["baidu"]=this._map};i.Map.Adapter.Google=function(e,t){this._overlays=[],this._controls=[],this._event=[],this._objs=[];e="string"==typeof e?document.getElementById(e):e;this._options={center:t.center._toGoogle(),zoom:t.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:true};this._options.draggable=u(t.draggable,true);this._options.scrollwheel=u(t.scrollwheel,false);this._options.disableDoubleClickZoom=!u(t.doubleClickZoom,true);this._options.keyboardShortcuts=u(t.keyboard,false);if("number"==typeof t.minZoom){this._options.minZoom=t.minZoom}if("number"==typeof t.maxZoom){this._options.maxZoom=t.maxZoom}this._options.styles=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];this._map=new google.maps.Map(e,this._options);this._objs["google"]=this._map};i.Map.Adapter.Baidu.prototype.getContainer=function(){return this._map.getContainer()};i.Map.Adapter.Google.prototype.getContainer=function(){return this._map.getDiv()};i.Map.Adapter.Baidu.prototype.getMap=function(){return this._map};i.Map.Adapter.Google.prototype.getMap=function(){return this._map};i.Map.Adapter.Baidu.prototype.getCenter=i.Map.Adapter.Google.prototype.getCenter=function(){return i.Map.LatLng(this._map.getCenter())};i.Map.Adapter.Baidu.prototype.setCenter=function(e){this._map.setCenter(e._toBaidu())};i.Map.Adapter.Google.prototype.setCenter=function(e){this._map.setCenter(e._toGoogle())};i.Map.Adapter.Baidu.prototype.getZoom=i.Map.Adapter.Google.prototype.getZoom=function(){return this._map.getZoom()};i.Map.Adapter.Baidu.prototype.setZoom=i.Map.Adapter.Google.prototype.setZoom=function(e){this._map.setZoom(e)};i.Map.Adapter.Baidu.prototype.getBounds=function(){var e=this._map.getBounds();return new i.Map.Bounds(new i.Map.LatLng(e.getSouthWest()),new i.Map.LatLng(e.getNorthEast()),"baidu")};i.Map.Adapter.Google.prototype.getBounds=function(){var e=this._map.getBounds();return new i.Map.Bounds(new i.Map.LatLng(e.getSouthWest()),new i.Map.LatLng(e.getNorthEast()),"google")};i.Map.Adapter.Baidu.prototype.setCursor=function(e){this._map.setDefaultCursor(e)};i.Map.Adapter.Google.prototype.setCursor=function(e){this._map.setOptions({draggableCursor:e})};i.Map.Adapter.Baidu.prototype.setViewport=function(e,t){var n=[],r,s;if(e instanceof i.Map.Bounds){n.push(e.getSouthWest()._toBaidu());n.push(e.getNorthEast()._toBaidu())}else if(e instanceof Array){s=e.length;for(r=0;r<s;r++){n.push(e[r]._toBaidu())}}this._map.setViewport(n,t)};i.Map.Adapter.Google.prototype.setViewport=function(e,t){var n;if(e instanceof i.Map.Bounds){n=e._toGoogle()}else if(e instanceof Array){var n=new google.maps.LatLngBounds,r,s=e.length;for(r=0;r<s;r++){n.extend(e[r]._toGoogle())}}if(t&&t.margins){var o=this._map.getDiv().clientHeight,u=this._map.getDiv().clientWidth;var a=t.margins[0],f=t.margins[1],l=t.margins[2],c=t.margins[3];var h=o-a-l,p=u-c-f;var d=n.toSpan();var v;if(h/d.lat()<p/d.lng()){v=h/d.lat();c+=(p-d.lng()*v)*c/(c+f);f+=(p-d.lng()*v)*f/(c+f)}else{v=p/d.lng();a+=(h-d.lat()*v)*a/(a+l);l+=(h-d.lat()*v)*l/(a+l)}var m=n.getSouthWest(),g=n.getNorthEast();var y=new google.maps.LatLng(m.lat()-c/v,m.lng()-l/v);var b=new google.maps.LatLng(g.lat()+f/v,g.lng()+a/v);n.extend(y);n.extend(b)}this._map.fitBounds(n)};i.Map.Adapter.Google.prototype.setViewport=function(e,t){var n;var r=this;if(e instanceof i.Map.Bounds){n=e._toGoogle()}else if(e instanceof Array){var n=new google.maps.LatLngBounds,s,o=e.length;for(s=0;s<o;s++){n.extend(e[s]._toGoogle())}}this._map.fitBounds(n);if(t&&t.margins){var u=null;var a=function(){var e=new google.maps.LatLngBounds;var i=r._map.getDiv().clientHeight,s=r._map.getDiv().clientWidth;var o=t.margins[0],a=t.margins[1],f=t.margins[2],c=t.margins[3];if(o){var h=new google.maps.Point(0,o);var p=l.getGLatLng(r._map,h,n);e.extend(p)}if(c){var h=new google.maps.Point(c,0);var p=l.getGLatLng(r._map,h,n);e.extend(p)}if(a){var h=new google.maps.Point(s-a,0);var p=l.getGLatLng(r._map,h,n);e.extend(p)}if(f){var h=new google.maps.Point(0,i-f);var p=l.getGLatLng(r._map,h,n);e.extend(p)}r._map.fitBounds(n.union(e));if(u){google.maps.event.removeListener(u)}};if(!r._map.getProjection()){u=google.maps.event.addListener(r._map,"projection_changed",a)}else{a()}}};i.Map.Adapter.Baidu.prototype.MAP_TYPE="baidu";i.Map.Adapter.Google.prototype.MAP_TYPE="google";i.Map.Adapter.Baidu.prototype.panBy=function(e,t){this._map.panBy(e,t)};i.Map.Adapter.Google.prototype.panBy=function(e,t){this._map.panBy(-e,-t)};i.Map.Adapter.Baidu.prototype.panTo=function(e){this._map.panTo(e._toBaidu())};i.Map.Adapter.Google.prototype.panTo=function(e){this._map.panTo(e._toGoogle())};i.Map.Adapter.Baidu.prototype.addControl=function(e){this._map.addControl(e._toBaidu());this._controls.push(e)};i.Map.Adapter.Google.prototype.addControl=function(e){var t=e._toGoogle();if(t.obj instanceof i.Map.Control){this._map.controls[t.pos].push(t.obj);this._controls.push(e)}else{this._map.setOptions(t.obj);this._controls.push(e)}};i.Map.Adapter.Baidu.prototype.removeControl=function(e){this._map.removeControl(e._toBaidu());a(this._controls,e)};i.Map.Adapter.Google.prototype.removeControl=function(e){var t=e._toGoogle(),n,r;if(e instanceof i.Map.Control){n=this._map.controls[t.pos].getLength();for(r=0;r<n;r++){if(this._map.controls[t.pos].getAt(r)==e._toGoogle()){this._map.controls[t.pos].removeAt(r);a(this._controls,e)}}}else{for(r in t){if(t.hasOwnProperty(r)){if(true==t[r]){t[r]=false}}}this._map.setOptions(t);a(this._controls,e)}};i.Map.Adapter.Baidu.prototype.addOverlay=function(e){e._adapter="baidu";this._map.addOverlay(e._toBaidu(this))};i.Map.Adapter.Baidu.prototype.removeOverlay=function(e){this._map.removeOverlay(e._toBaidu(this))};i.Map.Adapter.Baidu.prototype.getPanes=function(){var e;e=this._map.getPanes();return{map:e.mapPane,markerShadow:e.markerShadow,markerPane:e.markerPane,floatShadow:e.floatShadow,markerMouseTarget:e.overlayMouseTarget,floatPane:e.floatPane}};i.Map.Adapter.Baidu.prototype.pointToPixel=function(e,t){return this._map.pointToOverlayPixel(e._toBaidu())};i.Map.Adapter.Baidu.prototype.addEventListener=e;i.Map.Adapter.Baidu.prototype.removeEventListener=t;i.Map.Adapter.Google.prototype.addEventListener=n;i.Map.Adapter.Google.prototype.removeEventListener=r;i.Map.Adapter.Google.prototype.addOverlay=function(e){var t=e._toGoogle(this);e._adapter="google";t.setMap(this._map)};i.Map.Adapter.Google.prototype.removeOverlay=function(e){var t=e._toGoogle(this);t.setMap(null)};i.Map.Adapter.Google.prototype.getPanes=function(){var e,t=0,n=this._overlays.length,r;for(var t=0;t<n;t++){if(this._overlays[t]){r=this._overlays[t]._toGoogle(this);if(!(r.getPanes&&r.getPanes())){continue}e=r.getPanes();return{map:e.mapPane,markerShadow:e.overlayShadow,markerPane:e.overlayImage,floatShadow:e.floatShadow,markerMouseTarget:e.overlayMouseTarget,floatPane:e.floatPane}}}return{}};i.Map.Adapter.Google.prototype.pointToPixel=function(e,t){var n=t.getProjection();return n.fromLatLngToDivPixel(e._toGoogle())};var l=function(){function t(e){return e*Math.PI/180}function n(n,r,i,s){var o=t(n);var u=t(i);var a=o-u;var f=t(r)-t(s);var l=2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(o)*Math.cos(u)*Math.pow(Math.sin(f/2),2)));l=l*e;return l}function r(e,t){var n=Math.pow(2,e.getZoom());var r=new google.maps.LatLng(e.getBounds().getNorthEast().lat(),e.getBounds().getSouthWest().lng());var i=e.getProjection().fromLatLngToPoint(r);var s=e.getProjection().fromLatLngToPoint(t);var o=new google.maps.Point(Math.floor((s.x-i.x)*n),Math.floor((s.y-i.y)*n));return o}function i(e,t,n){var r=e.getProjection();var i=Math.pow(2,e.getZoom());var s=new google.maps.LatLng((n||e.getBounds()).getNorthEast().lat(),(n||e.getBounds()).getSouthWest().lng());var o=e.getProjection().fromLatLngToPoint(s);var u=new google.maps.Point(t.x/i+o.x,t.y/i+o.y);var a=e.getProjection().fromPointToLatLng(u);return a}var e=6378.137;return{calDistance:n,getGPix:r,getGLatLng:i}}()})()}(t.exports,t,e);e.____MODULES["34e814670e74b19de1c6553b8188f327"]=t.exports})(this);(function(e){var t={id:"b2bd20ce8abfb5f44654103deab53ed9",filename:"MapLoader.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){function c(e,t){if(!f[e]){f[e]=new l(e)}f[e].load(function(){t(e)})}var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];e.____MODULES["34e814670e74b19de1c6553b8188f327"];var s=i.QMap;var o=window;var u=(o.__BAIDU_URL__||"https://api.map.baidu.com/api")+"?v=2.0&ak=ZAwlP8RG0tengGxBZerHUXHg&s=1";var a=o.__GOOGLE_URL__||"http://maps.google.cn/maps/api/js?v=3.9&key=AIzaSyDsv6Wsc_53sZOEf3jaxiZgNPw_6ptXC5U&sensor=false&libraries=places";var f={baidu:null,google:null};o.MapLoadCallback={};var l=function(e){this.loading=false;this.loaded=false;this._url=e==="google"?a:u;this._callbacks=[]};l.prototype.load=function(e){var t=this;var n="map_load_callback_"+(new Date).getTime();if(t.loaded){e();return}else{t._callbacks.push(e)}if(t.loading){return}o.MapLoadCallback[n]=function(){t.loading=false;t.loaded=true;var e=t._callbacks;var r;while(r=e.shift()){r()}try{o.MapLoadCallback[n]}catch(i){}};t.loading=true;var r=this._url+"&callback=MapLoadCallback."+n;i.loadJS(r)};n.exports=c}(t.exports,t,e);e.____MODULES["b2bd20ce8abfb5f44654103deab53ed9"]=t.exports})(this);(function(e){var t={id:"dfd66d8a77e8f348619e6734d9b7e0b4",filename:"MapLoader.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){n.exports=e.____MODULES["b2bd20ce8abfb5f44654103deab53ed9"]}(t.exports,t,e);e.____MODULES["dfd66d8a77e8f348619e6734d9b7e0b4"]=t.exports})(this);(function(e){var t={id:"8f497e9f3a20743d77a2de8d09bc7071",filename:"Mark.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["dacd39f425f4c7469335c26c545bc050"];var o=s.point;var u=s.mark;var a=500;var f=function(e,t,n,r){this.point=e;this._data=t;var i=this.parse(t,n);if(!r){this._div_obj=$(u.render(i))}else{this._div_obj=$(o.render(t))}this._div_obj.css({"z-index":a-n.toString().split(",")[0]});if(!i.image){this._div_obj.find("div.inner").css("padding","4px")}};f.prototype=new i.Map.Overlay;f.prototype.constructor=f;f.prototype.parse=function(e,t){var n={name:e.name,indexStr:t,s_name:i.subStr(e.name,8)};return n};f.prototype.setContent=function(e){this._div_obj=$(e)};f.prototype.setDrawOffset=function(e,t){this._draw_offset={x:e,y:t}};f.prototype.getDrawOffset=function(){return this._draw_offset||{x:0,y:0}};f.prototype.onInit=function(e,t){var n=this.getPanes();(n.markerPane||n.overlayImage).appendChild(t._div_obj[0]);var r=e.pointToPixel(t.point,this);t._div_obj.css({left:r.x+t.getDrawOffset().x||0+"px",top:r.y+t.getDrawOffset().y||0+"px"});t._initEvents();return t._div_obj[0]};f.prototype.onDraw=function(e,t){var n=e.pointToPixel(t.point,this);t._div_obj.css({left:n.x+t.getDrawOffset().x||0+"px",top:n.y+t.getDrawOffset().y||0+"px"})};f.prototype._initEvents=function(){var e=this;var t=e._div_obj.css("z-index");e._div_obj.mouseenter(function(){e._div_obj.css("z-index",1e3).addClass("m_overing");e._div_obj.find("div.js_detail").show()}).mouseleave(function(){e._div_obj.css("z-index",t).removeClass("m_overing");e._div_obj.find("div.js_detail").hide()})};f.prototype.getDom=function(e){return this._div_obj};f.prototype.getPoint=function(){return this.point};n.exports=f}(t.exports,t,e);e.____MODULES["8f497e9f3a20743d77a2de8d09bc7071"]=t.exports})(this);(function(e){var t={id:"c457c1b7a1f0b2a13c3b1505f623abfa",filename:"MapBox.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["edb20c2042b670af16af04b9e354052a"];var o=e.____MODULES["dfd66d8a77e8f348619e6734d9b7e0b4"];var u=e.____MODULES["8f497e9f3a20743d77a2de8d09bc7071"];var a={init:function(e){var t=this;t._box=s("#map_box");t._observer=e;t._maps={bmap:null,gmap:null};t._inited=false;t.listen()},_init:function(){var e=this,t=e._box;e._inited=true;e._map_md_name=t.find(".map_days_box .md_name");e._map_con=t.find(".map_con");e._bmap_dom=t.find(".bmap");e._gmap_dom=t.find(".gmap");e._close_btn=t.find("button");e._close_btn.click(function(t){e._observer.fire("exit_map_view");e.removeOverlays()})},listen:function(){var e=this},removeOverlays:function(){var e=this;[true,false].forEach(function(t){e.getMap(t,function(e){var t=e.overlays;t.forEach(function(t){t.getDom().unbind();e.removeOverlay(t)})})})},renderMap:function(e){var t=this;var n=e.is_abroad;if(!t._inited){t._init()}t._map_md_name.text(e.name);t.getMap(n,function(n,r){var s=[];var o=n.overlays;o.forEach(function(e){e.getDom().unbind();n.removeOverlay(e)});n.overlays=[];var a=e.id;var f={name:e.name,lat:e.lat,lng:e.lng,id:a};var l=new i.Map.LatLng(f.lat,f.lng,r);var c=new u(l,f,"&nbsp;&nbsp;");n.addOverlay(c);n.overlays.push(c);s.push(l);setTimeout(function(){if(r==="google"){n.setViewport(s);n.setZoom(13)}else{n.setViewport(s,{margins:[10,10,10,10]});n.setZoom(14)}},350);c.getDom().addClass("mark_position").on("click",function(e){e.preventDefault();t._observer.trigger("show_poi_detail",a)})})},getMap:function(e,t){var n=this,r,s,u,a;if(e){r=n._maps.gmap;s=n._gmap_dom;u="google";a="gmap";n._gmap_dom.css("left",0);n._bmap_dom.css("left",-2e3)}else{r=n._maps.bmap;s=n._bmap_dom;u="baidu";a="bmap";n._bmap_dom.css("left",0);n._gmap_dom.css("left",-2e3)}if(r){t&&t(r,u,s)}else{o(u,function(){r=i.Map(u,s[0],{center:new i.Map.LatLng(0,0,u),zoom:10,draggable:true,scrollwheel:true});if(u==="baidu"){r.addControl(new i.Map.Control.Navigation(r,{style:BMAP_NAVIGATION_CONTROL_SMALL}))}else{r.addControl(new i.Map.Control.Navigation)}r.overlays=[];n._maps[a]=r;t&&t(r,u,s)})}}};n.exports=a}(t.exports,t,e);e.____MODULES["c457c1b7a1f0b2a13c3b1505f623abfa"]=t.exports})(this);(function(e){var t={id:"dde49379dabad396bc9ea77f9a14cfb5",filename:"source_box.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["9f7da0fd7ad3ca7bfc636e2365d14ec5"];var o=e.____MODULES["982ab75b02893ded6bae1666afafbc53"];var u=e.____MODULES["bec76438512a77fc271867b9d43fa95b"];var a=e.____MODULES["2a6c3f7ac10afc75549b51ee175552b2"];var f=e.____MODULES["1b3c2fa103584dcde5d4b4e7832d3b59"];var l=e.____MODULES["9c0f36c90ca983fdbd5357f94ed8777d"];var c=e.____MODULES["c457c1b7a1f0b2a13c3b1505f623abfa"];var h=e.____MODULES["72ccee1acde6f77563f5f551b427b29d"];var p=e.____MODULES["88d5c499e26b6f8fc86d873910ae3aea"];var d={sys_hotel:6};var v=e.____MODULES["149b8fe92ccc904ad366cf8da083f63d"];var m=e.____MODULES["56483375e8bf013e95419f32c44a39a1"];var g={view_event:new s,init:function(){var e=this,t=e.view_event;e._box=$("#trip_info_box");e._containers=[];e._containers.push({key:"trip",dom:$(".trip_source_box",e._box)});e._containers.push({key:"poi",dom:$(".poi_detail_box",e._box)});e._containers.push({key:"map",dom:$(".map_box",e._box)});e._containers.push({key:"around",dom:$(".around_box",e._box)});e.switch_tab_box=new o({observer:t});e._history=[];u.init(t);a.init(t);f.init(t);l.init(t);c.init(t);e.listen()},listen:function(){function t(t){e.showDom("trip");f.hide();u.show();e.switch_tab_box.setDest(t);e.view_event.trigger("show_dest_content",t)}function n(){if(e._history.length>1){var t=e._history.pop();e.showDom(e._history[e._history.length-1]||"trip")}else{e.showDom("trip")}}var e=this;i.PubSub.on("show_dest",t);i.PubSub.on("no_dest_for_show",function(){e.switch_tab_box.showNoDest();e.view_event.trigger("switch_dest_collect_tab",1);e.switch_tab_box.switchTabTit(1);e.view_event.trigger("no_dest_for_show")});i.PubSub.on("show_poi_detail",function(t){e.view_event.trigger("show_poi_detail",t)});i.PubSub.on("show_day_map",function(t){e.showDom("map");e.view_event.trigger("show_day_map",t)});i.PubSub.on("exit_day_map",function(){e.showDom("trip")});i.PubSub.on("show_ele_around",function(t){e.showDom("around");l.show(t)});e.view_event.on("change_dest",t);e.view_event.on("poi_add_to_book",function(t,n,r){if(n==="poi_list"||n==="poi_detail"){var s=e.parseToElement(t);if(t.type===d.sys_hotel){i.PubSub.fire("toadd_custom_poi",d.sys_hotel,{curType:d.sys_hotel,ele_model_data:s})}else{i.PubSub.fire("poi_add_to_book",s)}}else if(n==="collect"){var s=e.parseCollectData(t);if(s.type===d.sys_hotel){i.PubSub.fire("toadd_custom_poi",d.sys_hotel,{curType:d.sys_hotel,ele_model_data:s})}else{i.PubSub.fire("poi_add_to_book",s)}}});e.view_event.on("route_add_to_day",function(e){i.PubSub.fire("route_add_to_day",e)});e.view_event.on("route_day_add_to_day",function(e,t){i.PubSub.fire("route_day_add_to_day",e,t)});e.view_event.on("show_poi_detail_success",function(){e.showDom("poi")});e.view_event.on("show_poi_position",function(t){var n={lng:(t.abroad?t.glng:t.blng)||t.lng,lat:(t.abroad?t.glat:t.blat)||t.lat,id:t.id,is_abroad:t.abroad,name:t.name};e.showDom("map");c.renderMap(n)});e.view_event.on("switch_dest_collect_tab",function(e){if(e){u.hide();f.show()}else{f.hide();u.show()}});e.view_event.on("hide_poi_detial",n);e.view_event.on("hide_around_box",n);e.view_event.on("exit_map_view",function(){if(e._history.length){e.showDom(e._history[e._history.length-1])}else{e.showDom("trip")}})},_getImg:function(e,t){var n=m[e];if(n){if(typeof n==="function"){return n(t)}else{return n}}else{return m.def}},parseToElement:function(e){var t=e.image||e.images;var n=e.type;if(t){var r=i.type(t);if(r==="array"&&t.length){t=t[0].smallUrl}else if(r!=="string"){t=this._getImg(n,e)}}else{t=this._getImg(n,e)}var s={image:t,name:e.name,enName:e.enName,address:e.addr,tel:e.tel,blat:e.blat,blng:e.blng,lat:e.lat,lng:e.lng,glat:e.glat,glng:e.glng,cityId:e.cityId||e.city_id||e.distId,cityName:e.cityName||e.city||e.distName,type_id:n,abroad:e.abroad,locationId:e.id||(e.g_id?e.g_id.replace(/^\w_/,""):"0"),poi_detail:e};return s},parseCollectData:function(e){var t=i.mix({},e);var n=t.summary&&JSON.parse(t.summary)||{};delete t.id;delete t.dayId;delete t.timeType;delete t.travelOrder;delete t.send;delete t.sendTime;delete t.sendTime2;delete t.is_collect;delete t.poiId;delete t.poiIdNum;delete t.clientId;delete t.summary;t.type=t.typeId;if(typeof n.is_abroad!=="undefined"){t.abroad=n.is_abroad}t.address=n.addr;t.poi_detail=n;t.lng=n.lng||n.blng||n.glng;t.lat=n.lat||n.blat||n.glat;if(!t.image){t.image=m[t.type||t.type_id]||m.def}return t},showDom:function(e){var t=this;if(i.Browser.isIE){var n=this._containers[0].dom;if(n.is(":visible")){u.setScroll()}}this._containers.forEach(function(t){if(t.key===e){t.dom.show()}else{t.dom.hide()}});if(e!=="map"&&e!==t._history[t._history.length-1]){t._history.push(e);if(t._history.length>10){t._history.splice(0,1)}}if(e==="trip"){u.route_box.resetRouteHeight();if(i.Browser.isIE){u.resetScroll()}}}};n.exports=g}(t.exports,t,e);e.____MODULES["dde49379dabad396bc9ea77f9a14cfb5"]=t.exports})(this);(function(e){var t={id:"a86dbffe263749cd3b408a237f5273f0",filename:"source.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["2a65ea94c2b49824e7e8a17b5f2548d4"];var s=e.____MODULES["dde49379dabad396bc9ea77f9a14cfb5"];s.init()}(t.exports,t,e);e.____MODULES["a86dbffe263749cd3b408a237f5273f0"]=t.exports})(this);(function(e){var t={id:"b54f8f080ccb1f30eab835f49a284952",filename:"source_box_src.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){e.____MODULES["a86dbffe263749cd3b408a237f5273f0"]}(t.exports,t,e);e.____MODULES["b54f8f080ccb1f30eab835f49a284952"]=t.exports})(this)